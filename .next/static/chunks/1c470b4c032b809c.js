(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,564541,e=>{"use strict";var a=e.i(843476),s=e.i(522016),t=e.i(618566),i=e.i(271645),l=e.i(991918),r=e.i(225913),n=e.i(475254);let d=(0,n.default)("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);var c=e.i(322625),o=e.i(448020),x=e.i(407398),m=e.i(729085),h=e.i(852540),u=e.i(409560),j=e.i(250121),p=e.i(180580);let g=i.createContext(null);function v(){let e=i.useContext(g);if(!e)throw Error("useSidebar must be used within a SidebarProvider.");return e}function b({defaultOpen:e=!0,open:s,onOpenChange:t,className:l,style:r,children:n,...d}){let x=(0,c.useIsMobile)(),[m,h]=i.useState(!1),[u,j]=i.useState(e),v=s??u,b=i.useCallback(e=>{let a="function"==typeof e?e(v):e;t?t(a):j(a),document.cookie=`sidebar_state=${a}; path=/; max-age=604800`},[t,v]),y=i.useCallback(()=>x?h(e=>!e):b(e=>!e),[x,b,h]);i.useEffect(()=>{let e=e=>{"b"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),y())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[y]);let C=v?"expanded":"collapsed",f=i.useMemo(()=>({state:C,open:v,setOpen:b,isMobile:x,openMobile:m,setOpenMobile:h,toggleSidebar:y}),[C,v,b,x,m,h,y]);return(0,a.jsx)(g.Provider,{value:f,children:(0,a.jsx)(p.TooltipProvider,{delayDuration:0,children:(0,a.jsx)("div",{"data-slot":"sidebar-wrapper",style:{"--sidebar-width":"16rem","--sidebar-width-icon":"3rem",...r},className:(0,o.cn)("group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",l),...d,children:n})})})}function y({side:e="left",variant:s="sidebar",collapsible:t="offcanvas",className:i,children:l,...r}){let{isMobile:n,state:d,openMobile:c,setOpenMobile:x}=v();return"none"===t?(0,a.jsx)("div",{"data-slot":"sidebar",className:(0,o.cn)("bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col",i),...r,children:l}):n?(0,a.jsx)(u.Sheet,{open:c,onOpenChange:x,...r,children:(0,a.jsxs)(u.SheetContent,{"data-sidebar":"sidebar","data-slot":"sidebar","data-mobile":"true",className:"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden",style:{"--sidebar-width":"18rem"},side:e,children:[(0,a.jsxs)(u.SheetHeader,{className:"sr-only",children:[(0,a.jsx)(u.SheetTitle,{children:"Sidebar"}),(0,a.jsx)(u.SheetDescription,{children:"Displays the mobile sidebar."})]}),(0,a.jsx)("div",{className:"flex h-full w-full flex-col",children:l})]})}):(0,a.jsxs)("div",{className:"group peer text-sidebar-foreground hidden md:block","data-state":d,"data-collapsible":"collapsed"===d?t:"","data-variant":s,"data-side":e,"data-slot":"sidebar",children:[(0,a.jsx)("div",{"data-slot":"sidebar-gap",className:(0,o.cn)("relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180","floating"===s||"inset"===s?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]":"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]")}),(0,a.jsx)("div",{"data-slot":"sidebar-container",className:(0,o.cn)("fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex","left"===e?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]","floating"===s||"inset"===s?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]":"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l",i),...r,children:(0,a.jsx)("div",{"data-sidebar":"sidebar","data-slot":"sidebar-inner",className:"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm",children:l})})]})}function C({className:e,onClick:s,...t}){let{toggleSidebar:i}=v();return(0,a.jsxs)(x.Button,{"data-sidebar":"trigger","data-slot":"sidebar-trigger",variant:"ghost",size:"icon",className:(0,o.cn)("h-7 w-7",e),onClick:e=>{s?.(e),i()},...t,children:[(0,a.jsx)(d,{}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle Sidebar"})]})}function f({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"sidebar-content","data-sidebar":"content",className:(0,o.cn)("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...s})}function N({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"sidebar-group","data-sidebar":"group",className:(0,o.cn)("relative flex w-full min-w-0 flex-col p-2",e),...s})}function T({className:e,asChild:s=!1,...t}){let i=s?l.Slot:"div";return(0,a.jsx)(i,{"data-slot":"sidebar-group-label","data-sidebar":"group-label",className:(0,o.cn)("text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...t})}function w({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"sidebar-group-content","data-sidebar":"group-content",className:(0,o.cn)("w-full text-sm",e),...s})}function S({className:e,...s}){return(0,a.jsx)("ul",{"data-slot":"sidebar-menu","data-sidebar":"menu",className:(0,o.cn)("flex w-full min-w-0 flex-col gap-1",e),...s})}function k({className:e,...s}){return(0,a.jsx)("li",{"data-slot":"sidebar-menu-item","data-sidebar":"menu-item",className:(0,o.cn)("group/menu-item relative",e),...s})}let D=(0,r.cva)("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:p-0!"}},defaultVariants:{variant:"default",size:"default"}});function A({asChild:e=!1,isActive:s=!1,variant:t="default",size:i="default",tooltip:r,className:n,...d}){let c=e?l.Slot:"button",{isMobile:x,state:m}=v(),h=(0,a.jsx)(c,{"data-slot":"sidebar-menu-button","data-sidebar":"menu-button","data-size":i,"data-active":s,className:(0,o.cn)(D({variant:t,size:i}),n),...d});return r?("string"==typeof r&&(r={children:r}),(0,a.jsxs)(p.Tooltip,{children:[(0,a.jsx)(p.TooltipTrigger,{asChild:!0,children:h}),(0,a.jsx)(p.TooltipContent,{side:"right",align:"center",hidden:"collapsed"!==m||x,...r})]})):h}var F=e.i(217923),H=e.i(761911),R=e.i(178583),I=e.i(223945);let B=(0,n.default)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);var q=e.i(212426),L=e.i(25652),P=e.i(239616),M=e.i(98919),K=e.i(263488),E=e.i(618348);let V=(0,n.default)("FileChartColumn",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 18v-1",key:"zg0ygc"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"M16 18v-3",key:"j5jt4h"}]]),$=(0,n.default)("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);var U=e.i(664030),Q=e.i(555436),O=e.i(39312),z=e.i(826707),W=e.i(21218),G=e.i(327025);let _=(0,n.default)("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);var Y=e.i(758472),X=e.i(802330),J=e.i(266027),Z=e.i(635321),ee=e.i(535251),ea=e.i(63209),es=e.i(879002),et=e.i(243553),ei=e.i(686311),el=e.i(400417),er=e.i(809637),en=e.i(129228),ed=e.i(555706),ec=e.i(509694),eo=e.i(475225),ex=e.i(841891),em=e.i(438814),eh=e.i(322787),eu=e.i(785183),ej=e.i(93230),ep=e.i(872526),eg=e.i(234239),ev=e.i(731195),eb=e.i(559559),ey=e.i(30656);function eC(){let{data:e,isLoading:t}=(0,J.useQuery)({queryKey:["/api/admin/overview/stats"],refetchInterval:3e4}),i=e||{users:{total:0,new24h:0,online:0,dailyRegistrations:0,premiumMembers:0},content:{total:0,new24h:0,avgPostsPerUser:0},revenue:{total:0,today:0},moderation:{pending:0,reports:0}},{data:l,isLoading:r}=(0,J.useQuery)({queryKey:["/api/admin/overview/engagement-metrics"],refetchInterval:3e4}),n=l||{dailyActiveUsers:0,postsToday:0,commentsToday:0,likesToday:0},{data:d,isLoading:c}=(0,J.useQuery)({queryKey:["/api/admin/overview/revenue-breakdown"],refetchInterval:6e4}),o=d||{stripe:0,crypto:0,total:0},{data:x,isLoading:m}=(0,J.useQuery)({queryKey:["/api/admin/overview/top-content"],refetchInterval:6e4}),h=Array.isArray(x)?x:[],{data:u,isLoading:p}=(0,J.useQuery)({queryKey:["/api/admin/overview/top-users"],refetchInterval:6e4}),g=Array.isArray(u)?u:[],{data:v,isLoading:b}=(0,J.useQuery)({queryKey:["/api/admin/overview/activity-feed"],refetchInterval:15e3}),y=Array.isArray(v)?v:[],{data:C,isLoading:f}=(0,J.useQuery)({queryKey:["/api/admin/overview/user-growth"],refetchInterval:6e4}),N=Array.isArray(C)?C:[],{data:T,isLoading:w}=(0,J.useQuery)({queryKey:["/api/admin/overview/content-trend"],refetchInterval:6e4}),S=Array.isArray(T)?T:[],k=[{name:"Stripe",value:o.stripe,fill:"hsl(var(--primary))"},{name:"Crypto",value:o.crypto,fill:"hsl(var(--chart-2))"}];return t?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(j.Skeleton,{className:"h-10 w-64"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(8)].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s))})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Overview Dashboard"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-total-users",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Users"}),(0,a.jsx)(H.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-users",children:i.users.total}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",i.users.new24h," in last 24h"]})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-total-content",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Content"}),(0,a.jsx)(R.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-content",children:i.content.total}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",i.content.new24h," in last 24h"]})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-total-revenue",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Revenue"}),(0,a.jsx)(q.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-total-revenue",children:["$",i.revenue.total]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+$",i.revenue.today," today"]})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-pending-moderation",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Pending Moderation"}),(0,a.jsx)(ea.AlertCircle,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-pending-moderation",children:i.moderation.pending}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[i.moderation.reports," reports"]})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-online-users",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Online Users"}),(0,a.jsx)(H.Users,{className:"h-4 w-4 text-green-500"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-online-users",children:i.users.online}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Active in last 15min"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-daily-registrations",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Daily Registrations"}),(0,a.jsx)(es.UserPlus,{className:"h-4 w-4 text-blue-500"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-daily-registrations",children:i.users.dailyRegistrations}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Registered today"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-premium-members",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Premium Members"}),(0,a.jsx)(et.Crown,{className:"h-4 w-4 text-amber-500"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-premium-members",children:i.users.premiumMembers}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Level 5 and above"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-avg-posts-user",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Avg Posts/User"}),(0,a.jsx)(L.TrendingUp,{className:"h-4 w-4 text-purple-500"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-posts-user",children:i.content.avgPostsPerUser.toFixed(1)}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Per user average"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4","data-testid":"section-engagement-metrics",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-dau",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"DAU"}),(0,a.jsx)(W.Activity,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-xl font-bold","data-testid":"text-dau",children:n.dailyActiveUsers})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-posts-today",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Posts Today"}),(0,a.jsx)(R.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-xl font-bold","data-testid":"text-posts-today",children:n.postsToday})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-comments-today",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Comments Today"}),(0,a.jsx)(ei.MessageSquare,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-xl font-bold","data-testid":"text-comments-today",children:n.commentsToday})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-likes-today",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Likes Today"}),(0,a.jsx)(el.ThumbsUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-xl font-bold","data-testid":"text-likes-today",children:n.likesToday})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-user-growth-chart",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"User Growth (Last 7 Days)"})}),(0,a.jsx)(Z.CardContent,{children:f?(0,a.jsx)(j.Skeleton,{className:"h-64"}):N.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(en.LineChart,{data:N,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"date"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(ed.Line,{type:"monotone",dataKey:"users",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-content-trend-chart",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Content Trend (Last 7 Days)"})}),(0,a.jsx)(Z.CardContent,{children:w?(0,a.jsx)(j.Skeleton,{className:"h-64"}):S.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ec.BarChart,{data:S,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"date"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eo.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-revenue-breakdown-chart",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Revenue Breakdown"})}),(0,a.jsx)(Z.CardContent,{children:c?(0,a.jsx)(j.Skeleton,{className:"h-64"}):o.total>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ex.PieChart,{children:[(0,a.jsx)(em.Pie,{data:k,cx:"50%",cy:"50%",labelLine:!1,label:e=>`${e.name}: $${e.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:k.map((e,s)=>(0,a.jsx)(eh.Cell,{fill:e.fill},`cell-${s}`))}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eb.Legend,{})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No revenue data"})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-top-content",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Top Content"})}),(0,a.jsx)(Z.CardContent,{children:m?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):h.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{"data-testid":"table-top-content",children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{className:"w-12",children:"#"}),(0,a.jsx)(ee.TableHead,{children:"Title"}),(0,a.jsx)(ee.TableHead,{children:"Author"}),(0,a.jsx)(ee.TableHead,{children:"Views"})]})}),(0,a.jsx)(ee.TableBody,{children:h.map((e,t)=>(0,a.jsxs)(ee.TableRow,{"data-testid":`row-top-content-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{className:"font-medium",children:t+1}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(s.default,{href:`/thread/${e.slug}`,className:"text-primary hover:underline","data-testid":`link-content-${e.id}`,children:e.title})}),(0,a.jsx)(ee.TableCell,{children:e.author}),(0,a.jsx)(ee.TableCell,{children:e.views})]},e.id))})]})}):(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No content data"})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-top-users",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Top Users Leaderboard"})}),(0,a.jsx)(Z.CardContent,{children:p?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):g.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{"data-testid":"table-top-users",children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{className:"w-12",children:"#"}),(0,a.jsx)(ee.TableHead,{children:"Username"}),(0,a.jsx)(ee.TableHead,{children:"Rep"}),(0,a.jsx)(ee.TableHead,{children:"Coins"}),(0,a.jsx)(ee.TableHead,{children:"Posts"})]})}),(0,a.jsx)(ee.TableBody,{children:g.map((e,t)=>(0,a.jsxs)(ee.TableRow,{"data-testid":`row-top-user-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{className:"font-medium",children:t+1}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(s.default,{href:`/user/${e.username}`,className:"text-primary hover:underline","data-testid":`link-user-${e.id}`,children:e.username})}),(0,a.jsx)(ee.TableCell,{children:e.reputation}),(0,a.jsx)(ee.TableCell,{children:e.coinBalance}),(0,a.jsx)(ee.TableCell,{children:e.totalPosts})]},e.id))})]})}):(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No user data"})})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-activity-feed",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Recent Admin Activity"})}),(0,a.jsx)(Z.CardContent,{children:b?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):y.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Admin"}),(0,a.jsx)(ee.TableHead,{children:"Action"}),(0,a.jsx)(ee.TableHead,{children:"Target"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Time"})]})}),(0,a.jsx)(ee.TableBody,{children:y.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`activity-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{"data-testid":`activity-admin-${e.id}`,children:e.adminUsername||"System"}),(0,a.jsx)(ee.TableCell,{"data-testid":`activity-action-${e.id}`,children:e.actionType}),(0,a.jsx)(ee.TableCell,{"data-testid":`activity-target-${e.id}`,children:e.targetType}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"success"===e.status?"default":"destructive",children:e.status})}),(0,a.jsx)(ee.TableCell,{"data-testid":`activity-time-${e.id}`,children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]},e.id))})]})}):(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No recent activity"})})]})]})}var ef=e.i(954616),eN=e.i(87945),eT=e.i(885024),ew=e.i(79196),eS=e.i(840176),ek=e.i(615683),eD=e.i(779966),eA=e.i(870682),eF=e.i(223622);let eH=(0,n.default)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);var eR=e.i(575822),eI=e.i(440160),eB=e.i(373375),eq=e.i(463059),eL=e.i(87316),eP=e.i(945919),eM=e.i(501831);function eK(){let[e,t]=(0,i.useState)(""),[l,r]=(0,i.useState)("all"),[n,d]=(0,i.useState)("all"),[c,o]=(0,i.useState)("createdAt"),[h,u]=(0,i.useState)("desc"),[p,g]=(0,i.useState)(1),[v,b]=(0,i.useState)(25),[y,C]=(0,i.useState)(null),[f,N]=(0,i.useState)(!1),[T,w]=(0,i.useState)(!1),[S,k]=(0,i.useState)(),[D,A]=(0,i.useState)(""),[F,R]=(0,i.useState)(""),[I,B]=(0,i.useState)(""),{toast:q}=(0,ek.useToast)(),{data:P,isLoading:K}=(0,J.useQuery)({queryKey:["/api/admin/users",{search:e,role:l,status:n,sortBy:c,sortOrder:h,page:p,limit:v}]}),E=P?.users||[],V=P?.totalPages||1,$=P?.total||0,{data:U}=(0,J.useQuery)({queryKey:["/api/admin/users/stats",{search:e,role:l,status:n}],queryFn:()=>{let a=new URLSearchParams;e&&a.append("search",e),"all"!==l&&a.append("role",l),"all"!==n&&a.append("status",n);let s=a.toString();return fetch(`/api/admin/users/stats${s?"?"+s:""}`).then(e=>e.json())}}),O=U||{total:0,avgReputation:0,avgCoins:0,bannedCount:0},{data:z}=(0,J.useQuery)({queryKey:["/api/admin/users",y?.id,"activity"],queryFn:()=>fetch(`/api/admin/users/${y?.id}/activity`).then(e=>e.json()),enabled:!!y}),W=z||{totalThreads:0,totalReplies:0,totalContent:0,coinsEarned:0,coinsSpent:0,accountAge:0},{data:G}=(0,J.useQuery)({queryKey:["/api/admin/users",y?.id,"posts"],queryFn:()=>fetch(`/api/admin/users/${y?.id}/posts`).then(e=>e.json()),enabled:!!y}),_=Array.isArray(G)?G:[],{data:Y}=(0,J.useQuery)({queryKey:["/api/admin/users",y?.id,"coin-history"],queryFn:()=>fetch(`/api/admin/users/${y?.id}/coin-history`).then(e=>e.json()),enabled:!!y}),X=Array.isArray(Y)?Y:[],ea=(0,ef.useMutation)({mutationFn:async({userId:e,reason:a})=>(0,eM.apiRequest)("POST",`/api/admin/users/${e}/ban`,{reason:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),q({title:"User banned successfully"}),C(null)},onError:()=>{q({title:"Failed to ban user",variant:"destructive"})}}),es=(0,ef.useMutation)({mutationFn:async({userId:e,suspendedUntil:a,reason:s})=>(0,eM.apiRequest)("POST",`/api/admin/users/${e}/suspend`,{suspendedUntil:a,reason:s}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),q({title:"User suspended successfully"}),N(!1),k(void 0),A(""),C(null)},onError:()=>{q({title:"Failed to suspend user",variant:"destructive"})}}),et=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("POST",`/api/admin/users/${e}/activate`,{}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),q({title:"User activated successfully"}),C(null)},onError:()=>{q({title:"Failed to activate user",variant:"destructive"})}}),ei=(0,ef.useMutation)({mutationFn:async({userId:e,role:a,reason:s})=>(0,eM.apiRequest)("POST",`/api/admin/users/${e}/role`,{role:a,reason:s}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),q({title:"User role changed successfully"}),w(!1),R(""),B(""),C(null)},onError:()=>{q({title:"Failed to change user role",variant:"destructive"})}}),el=(0,ef.useMutation)({mutationFn:async({userId:e,amount:a,reason:s})=>(0,eM.apiRequest)("POST",`/api/admin/users/${e}/adjust-coins`,{amount:a,reason:s}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),q({title:"Coins adjusted successfully"})},onError:()=>{q({title:"Failed to adjust coins",variant:"destructive"})}}),en=async()=>{try{let a=new URLSearchParams({search:e,role:l,status:n,sortBy:c,sortOrder:h}),s=await fetch(`/api/admin/users/export/csv?${a}`);if(!s.ok)throw Error("Export failed");let t=await s.blob(),i=window.URL.createObjectURL(t),r=document.createElement("a");r.href=i,r.download=`users-export-${new Date().toISOString()}.csv`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(i),document.body.removeChild(r),q({title:"Users exported successfully"})}catch(e){q({title:"Failed to export users",variant:"destructive"})}};return K?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(j.Skeleton,{className:"h-10 w-64"}),(0,a.jsx)(j.Skeleton,{className:"h-96"})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"User Management"}),(0,a.jsxs)(x.Button,{onClick:en,variant:"outline","data-testid":"button-export-users",children:[(0,a.jsx)(eI.Download,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4","data-testid":"section-user-stats",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-total-users-stat",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Users"}),(0,a.jsx)(H.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-users-stat",children:O.total})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-avg-reputation",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Avg Reputation"}),(0,a.jsx)(L.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-reputation",children:(O.avgReputation||0).toFixed(0)})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-avg-coins",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Avg Coins"}),(0,a.jsx)(eR.Coins,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-coins",children:(O.avgCoins||0).toFixed(0)})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-banned-count",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Banned/Suspended"}),(0,a.jsx)(eF.Ban,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-banned-count",children:O.bannedCount})})]})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Search & Filters"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(Q.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(m.Input,{placeholder:"Search by username or email...",value:e,onChange:e=>t(e.target.value),className:"pl-9","data-testid":"input-user-search"})]}),(0,a.jsxs)(eT.Select,{value:l,onValueChange:r,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-role-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Filter by role"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Roles"}),(0,a.jsx)(eT.SelectItem,{value:"member",children:"Member"}),(0,a.jsx)(eT.SelectItem,{value:"moderator",children:"Moderator"}),(0,a.jsx)(eT.SelectItem,{value:"admin",children:"Admin"})]})]}),(0,a.jsxs)(eT.Select,{value:n,onValueChange:d,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-status-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Filter by status"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Status"}),(0,a.jsx)(eT.SelectItem,{value:"active",children:"Active"}),(0,a.jsx)(eT.SelectItem,{value:"suspended",children:"Suspended"}),(0,a.jsx)(eT.SelectItem,{value:"banned",children:"Banned"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)(eT.Select,{value:c,onValueChange:o,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-sort-by",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Sort by"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"username",children:"Username"}),(0,a.jsx)(eT.SelectItem,{value:"email",children:"Email"}),(0,a.jsx)(eT.SelectItem,{value:"coinBalance",children:"Coins"}),(0,a.jsx)(eT.SelectItem,{value:"reputation",children:"Reputation"}),(0,a.jsx)(eT.SelectItem,{value:"createdAt",children:"Created At"}),(0,a.jsx)(eT.SelectItem,{value:"lastActive",children:"Last Active"})]})]}),(0,a.jsxs)(eT.Select,{value:h,onValueChange:u,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-sort-order",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Sort order"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"asc",children:"Ascending"}),(0,a.jsx)(eT.SelectItem,{value:"desc",children:"Descending"})]})]})]})]})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Users (",$,")"]})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"User"}),(0,a.jsx)(ee.TableHead,{children:"Email"}),(0,a.jsx)(ee.TableHead,{children:"Role"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Coins"}),(0,a.jsx)(ee.TableHead,{children:"Joined"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:E.length>0?E.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`user-row-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{"data-testid":`user-name-${e.id}`,children:e.username}),(0,a.jsx)(ee.TableCell,{children:e.email}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"outline",children:e.role})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"active"===e.status?"default":"destructive",children:e.status})}),(0,a.jsx)(ee.TableCell,{"data-testid":`user-coins-${e.id}`,children:e.coinBalance}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>C(e),"data-testid":`button-view-user-${e.id}`,children:[(0,a.jsx)(eH,{className:"h-4 w-4 mr-1"}),"View"]}),"active"===e.status?(0,a.jsxs)(x.Button,{size:"sm",variant:"destructive",onClick:()=>ea.mutate({userId:e.id,reason:"Manual ban"}),"data-testid":`button-ban-user-${e.id}`,children:[(0,a.jsx)(eF.Ban,{className:"h-4 w-4 mr-1"}),"Ban"]}):(0,a.jsxs)(x.Button,{size:"sm",variant:"default",onClick:()=>et.mutate(e.id),"data-testid":`button-activate-user-${e.id}`,children:[(0,a.jsx)(eH,{className:"h-4 w-4 mr-1"}),"Activate"]})]})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No users found"})})})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Items per page:"}),(0,a.jsxs)(eT.Select,{value:v.toString(),onValueChange:e=>b(parseInt(e)),children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-20","data-testid":"select-items-per-page",children:(0,a.jsx)(eT.SelectValue,{})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"10",children:"10"}),(0,a.jsx)(eT.SelectItem,{value:"25",children:"25"}),(0,a.jsx)(eT.SelectItem,{value:"50",children:"50"}),(0,a.jsx)(eT.SelectItem,{value:"100",children:"100"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>g(e=>Math.max(1,e-1)),disabled:1===p,"data-testid":"button-previous-page",children:[(0,a.jsx)(eB.ChevronLeft,{className:"h-4 w-4 mr-1"}),"Previous"]}),(0,a.jsxs)("span",{className:"text-sm","data-testid":"text-page-info",children:["Page ",p," of ",V]}),(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>g(e=>Math.min(V,e+1)),disabled:p===V,"data-testid":"button-next-page",children:["Next",(0,a.jsx)(eq.ChevronRight,{className:"h-4 w-4 ml-1"})]})]})]})]})]}),(0,a.jsx)(ew.Dialog,{open:!!y,onOpenChange:e=>!e&&C(null),children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-3xl max-h-[80vh] overflow-y-auto","data-testid":"modal-user-detail",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsxs)(ew.DialogTitle,{children:["User Details: ",y?.username]}),(0,a.jsx)(ew.DialogDescription,{children:"Comprehensive user information and management"})]}),y&&(0,a.jsxs)(eS.Tabs,{defaultValue:"profile",className:"w-full",children:[(0,a.jsxs)(eS.TabsList,{className:"grid w-full grid-cols-4",children:[(0,a.jsx)(eS.TabsTrigger,{value:"profile","data-testid":"tab-profile",children:"Profile"}),(0,a.jsx)(eS.TabsTrigger,{value:"activity","data-testid":"tab-activity",children:"Activity"}),(0,a.jsx)(eS.TabsTrigger,{value:"posts","data-testid":"tab-posts",children:"Posts"}),(0,a.jsx)(eS.TabsTrigger,{value:"coin-history","data-testid":"tab-coin-history",children:"Coin History"})]}),(0,a.jsxs)(eS.TabsContent,{value:"profile",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Username"}),(0,a.jsx)("p",{className:"font-medium",children:y.username})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Email"}),(0,a.jsx)("p",{className:"font-medium",children:y.email})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Role"}),(0,a.jsx)(ey.Badge,{variant:"outline",children:y.role})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,a.jsx)(ey.Badge,{variant:"active"===y.status?"default":"destructive",children:y.status})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Coin Balance"}),(0,a.jsx)("p",{className:"font-medium",children:y.coinBalance})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Reputation"}),(0,a.jsx)("p",{className:"font-medium",children:y.reputation})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Level"}),(0,a.jsx)("p",{className:"font-medium",children:y.level||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Created At"}),(0,a.jsx)("p",{className:"font-medium",children:(0,er.formatDistanceToNow)(new Date(y.createdAt),{addSuffix:!0})})]}),y.lastActive&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Last Active"}),(0,a.jsx)("p",{className:"font-medium",children:(0,er.formatDistanceToNow)(new Date(y.lastActive),{addSuffix:!0})})]}),y.suspendedUntil&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Suspended Until"}),(0,a.jsx)("p",{className:"font-medium",children:(0,eP.format)(new Date(y.suspendedUntil),"PPP")})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap pt-4",children:[(0,a.jsxs)(x.Button,{onClick:()=>{N(!0)},variant:"outline",disabled:"active"!==y.status,children:[(0,a.jsx)(eL.Calendar,{className:"h-4 w-4 mr-1"}),"Suspend"]}),(0,a.jsxs)(x.Button,{onClick:()=>{w(!0)},variant:"outline",children:[(0,a.jsx)(M.Shield,{className:"h-4 w-4 mr-1"}),"Change Role"]}),(0,a.jsxs)(x.Button,{onClick:()=>{el.mutate({userId:y.id,amount:100,reason:"Admin adjustment"})},variant:"outline",children:[(0,a.jsx)(eR.Coins,{className:"h-4 w-4 mr-1"}),"Add 100 Coins"]})]})]}),(0,a.jsx)(eS.TabsContent,{value:"activity",className:"space-y-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm",children:"Total Threads"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("p",{className:"text-2xl font-bold",children:W.totalThreads})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm",children:"Total Replies"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("p",{className:"text-2xl font-bold",children:W.totalReplies})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm",children:"Content Published"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("p",{className:"text-2xl font-bold",children:W.totalContent})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm",children:"Coins Earned"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("p",{className:"text-2xl font-bold",children:W.coinsEarned})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm",children:"Coins Spent"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("p",{className:"text-2xl font-bold",children:W.coinsSpent})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm",children:"Account Age"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[W.accountAge," days"]})})]})]})}),(0,a.jsx)(eS.TabsContent,{value:"posts",children:_.length>0?(0,a.jsx)("div",{className:"space-y-2",children:_.map(e=>(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"pt-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(s.default,{href:`/thread/${e.slug}`,className:"text-primary hover:underline font-medium",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["thread"===e.type?"Thread":"Reply"," Â· ",(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})]})]}),void 0!==e.views&&(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.views," views"]})]})})},e.id))}):(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No posts yet"})}),(0,a.jsx)(eS.TabsContent,{value:"coin-history",children:X.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Date"}),(0,a.jsx)(ee.TableHead,{children:"Type"}),(0,a.jsx)(ee.TableHead,{children:"Amount"}),(0,a.jsx)(ee.TableHead,{children:"Description"}),(0,a.jsx)(ee.TableHead,{children:"Balance"})]})}),(0,a.jsx)(ee.TableBody,{children:X.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"earn"===e.type||"recharge"===e.type?"default":"secondary",children:e.type})}),(0,a.jsxs)(ee.TableCell,{className:e.amount>0?"text-green-600":"text-red-600",children:[e.amount>0?"+":"",e.amount]}),(0,a.jsx)(ee.TableCell,{children:e.description}),(0,a.jsx)(ee.TableCell,{children:e.balance})]},e.id))})]})}):(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No coin history"})})]})]})}),(0,a.jsx)(ew.Dialog,{open:f,onOpenChange:N,children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"dialog-suspend-user",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Suspend User"}),(0,a.jsxs)(ew.DialogDescription,{children:["Temporarily suspend ",y?.username,"'s account"]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Suspended Until"}),(0,a.jsxs)(eA.Popover,{children:[(0,a.jsx)(eA.PopoverTrigger,{asChild:!0,children:(0,a.jsxs)(x.Button,{variant:"outline",className:"w-full justify-start text-left font-normal mt-2","data-testid":"input-suspended-until",children:[(0,a.jsx)(eL.Calendar,{className:"mr-2 h-4 w-4"}),S?(0,eP.format)(S,"PPP"):(0,a.jsx)("span",{children:"Pick a date"})]})}),(0,a.jsx)(eA.PopoverContent,{className:"w-auto p-0",children:(0,a.jsx)(eD.Calendar,{mode:"single",selected:S,onSelect:k,initialFocus:!0})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Reason"}),(0,a.jsx)(eN.Textarea,{placeholder:"Enter suspension reason...",value:D,onChange:e=>A(e.target.value),className:"mt-2","data-testid":"input-suspend-reason"})]})]}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),(0,a.jsx)(x.Button,{onClick:()=>{y&&S&&es.mutate({userId:y.id,suspendedUntil:S.toISOString(),reason:D})},disabled:!S||es.isPending,"data-testid":"button-suspend-confirm",children:es.isPending?"Suspending...":"Suspend User"})]})]})}),(0,a.jsx)(ew.Dialog,{open:T,onOpenChange:w,children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"dialog-change-role",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Change User Role"}),(0,a.jsxs)(ew.DialogDescription,{children:["Change the role for ",y?.username]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"New Role"}),(0,a.jsxs)(eT.Select,{value:F,onValueChange:R,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full mt-2","data-testid":"select-new-role",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select new role"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"member",children:"Member"}),(0,a.jsx)(eT.SelectItem,{value:"moderator",children:"Moderator"}),(0,a.jsx)(eT.SelectItem,{value:"admin",children:"Admin"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Reason (Optional)"}),(0,a.jsx)(eN.Textarea,{placeholder:"Enter reason for role change...",value:I,onChange:e=>B(e.target.value),className:"mt-2","data-testid":"input-role-change-reason"})]})]}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),(0,a.jsx)(x.Button,{onClick:()=>{y&&F&&ei.mutate({userId:y.id,role:F,reason:I})},disabled:!F||ei.isPending,"data-testid":"button-change-role-confirm",children:ei.isPending?"Changing...":"Change Role"})]})]})})]})}var eE=e.i(110320),eV=e.i(716759),e$=e.i(732486),eU=e.i(269638);let eQ=(0,n.default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var eO=e.i(286536),ez=e.i(878894),eW=e.i(503116),eG=e.i(284614),e_=e.i(16715);let eY=(0,n.default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var eX=e.i(727612),eJ=e.i(744793);function eZ(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)("all"),[l,r]=(0,i.useState)(1),[n,d]=(0,i.useState)(20),[c,o]=(0,i.useState)([]),[h,u]=(0,i.useState)("pending"),[p,g]=(0,i.useState)(1),[v,b]=(0,i.useState)(20),[y,C]=(0,i.useState)(100),[f,N]=(0,i.useState)("all"),[T,w]=(0,i.useState)(!1),[S,k]=(0,i.useState)(null),[D,A]=(0,i.useState)(!1),[F,H]=(0,i.useState)(null),[I,B]=(0,i.useState)(""),[q,P]=(0,i.useState)(!1),[K,E]=(0,i.useState)(!1),[V,$]=(0,i.useState)(null),[U,Q]=(0,i.useState)(null),[O,z]=(0,i.useState)(!1),[W,G]=(0,i.useState)(""),[_,Y]=(0,i.useState)(!1),[X,ea]=(0,i.useState)(7),[es,et]=(0,i.useState)(""),[ei,el]=(0,i.useState)(null),[en,ed]=(0,i.useState)(!1),[ec,eo]=(0,i.useState)(""),[ex,em]=(0,i.useState)(!1),[eh,eu]=(0,i.useState)(null),[ej,ep]=(0,i.useState)(!1),[eg,ev]=(0,i.useState)(!1),[eb,eC]=(0,i.useState)(""),{data:eD,isLoading:eA}=(0,J.useQuery)({queryKey:["/api/moderation/queue",{type:s,page:l,perPage:n}],refetchInterval:3e4}),{data:eH}=(0,J.useQuery)({queryKey:["/api/moderation/queue/count"],refetchInterval:3e4}),{data:eR,isLoading:eI}=(0,J.useQuery)({queryKey:["/api/moderation/reported",{status:h,page:p,perPage:v}],refetchInterval:3e4}),{data:eL}=(0,J.useQuery)({queryKey:["/api/moderation/reported/count"],refetchInterval:3e4}),{data:eK,isLoading:eZ}=(0,J.useQuery)({queryKey:["/api/moderation/history",{limit:y,moderatorId:"all"!==f?f:void 0}],refetchInterval:!1}),{data:e0,isLoading:e2}=(0,J.useQuery)({queryKey:["/api/moderation/stats"],refetchInterval:6e4}),e1=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("POST",`/api/moderation/${e}/approve`,{}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),e({title:"Content approved successfully"}),o([])},onError:()=>{e({title:"Failed to approve content",variant:"destructive"})}}),e4=(0,ef.useMutation)({mutationFn:async({contentId:e,reason:a,deletePermanently:s})=>(0,eM.apiRequest)("POST",`/api/moderation/${e}/reject`,{reason:a,deletePermanently:s}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),e({title:"Content rejected successfully"}),A(!1),B(""),P(!1),H(null),w(!1),o([])},onError:()=>{e({title:"Failed to reject content",variant:"destructive"})}}),e3=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("POST","/api/moderation/bulk-approve",{contentIds:e}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),e({title:`Successfully approved ${c.length} items`}),o([]),ep(!1)},onError:()=>{e({title:"Failed to approve selected items",variant:"destructive"})}}),e5=(0,ef.useMutation)({mutationFn:async({contentIds:e,reason:a})=>(0,eM.apiRequest)("POST","/api/moderation/bulk-reject",{contentIds:e,reason:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),e({title:`Successfully rejected ${c.length} items`}),o([]),ev(!1),eC("")},onError:()=>{e({title:"Failed to reject selected items",variant:"destructive"})}}),e6=(0,ef.useMutation)({mutationFn:async({reportId:e,reason:a})=>(0,eM.apiRequest)("POST",`/api/moderation/report/${e}/dismiss`,{reason:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/moderation/reported"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/reported/count"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),e({title:"Report dismissed successfully"}),z(!1),G(""),E(!1)},onError:()=>{e({title:"Failed to dismiss report",variant:"destructive"})}}),e8=(0,ef.useMutation)({mutationFn:async({reportId:e,action:a,reason:s,suspendDays:t})=>(0,eM.apiRequest)("POST",`/api/moderation/report/${e}/action`,{action:a,reason:s,suspendDays:t}),onSuccess:(a,s)=>{eM.queryClient.invalidateQueries({queryKey:["/api/moderation/reported"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/reported/count"]}),eM.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]});let t="delete"===s.action?"deleted":"warn"===s.action?"warned":"suspend"===s.action?"suspended":"banned";e({title:`Author ${t} successfully`}),E(!1),Y(!1),ed(!1),et(""),eo(""),em(!1)},onError:()=>{e({title:"Failed to take action",variant:"destructive"})}}),e7=async a=>{try{let e=await fetch(`/api/moderation/${a}/details`),s=await e.json();k(s),w(!0)}catch(a){e({title:"Failed to load content details",variant:"destructive"})}},e9=async a=>{try{let e=await fetch(`/api/moderation/report/${a}`),s=await e.json();$(s),Q(a),E(!0)}catch(a){e({title:"Failed to load report details",variant:"destructive"})}},ae=e=>{H(e),A(!0)},aa=(e,a)=>e.length<=a?e:e.substring(0,a)+"...",as=eD?.items||[],at=eR?.items||[],ai=eK||[],al=as.length>0&&c.length===as.length;return c.length>0&&(c.length,as.length),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Content Moderation"})}),(0,a.jsxs)(eS.Tabs,{defaultValue:"queue",className:"space-y-4",children:[(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsxs)(eS.TabsTrigger,{value:"queue","data-testid":"tab-moderation-queue",children:["Moderation Queue",eH&&eH.pending>0&&(0,a.jsx)(ey.Badge,{variant:"destructive",className:"ml-2",children:eH.pending})]}),(0,a.jsxs)(eS.TabsTrigger,{value:"reported","data-testid":"tab-reported-content",children:["Reported Content",eL&&eL.pending>0&&(0,a.jsx)(ey.Badge,{variant:"destructive",className:"ml-2",children:eL.pending})]}),(0,a.jsx)(eS.TabsTrigger,{value:"history","data-testid":"tab-moderation-history",children:"Moderation History"}),(0,a.jsx)(eS.TabsTrigger,{value:"stats","data-testid":"tab-moderation-stats",children:"Statistics"})]}),(0,a.jsxs)(eS.TabsContent,{value:"queue",className:"space-y-4",children:[(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsx)(Z.CardTitle,{children:"Content Type"}),(0,a.jsx)(eS.Tabs,{value:s,onValueChange:t,className:"w-auto",children:(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsx)(eS.TabsTrigger,{value:"all","data-testid":"filter-content-type-all",children:"All"}),(0,a.jsx)(eS.TabsTrigger,{value:"thread","data-testid":"filter-content-type-thread",children:"Threads"}),(0,a.jsx)(eS.TabsTrigger,{value:"reply","data-testid":"filter-content-type-reply",children:"Replies"})]})})]})})}),c.length>0&&(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsxs)(x.Button,{onClick:()=>{0===c.length||c.length>100||ep(!0)},disabled:0===c.length||c.length>100||e3.isPending,"data-testid":"button-bulk-approve",children:[(0,a.jsx)(eU.CheckCircle,{className:"h-4 w-4 mr-2"}),"Approve Selected (",c.length,")"]}),(0,a.jsxs)(x.Button,{variant:"destructive",onClick:()=>{0===c.length||c.length>100||ev(!0)},disabled:0===c.length||c.length>100||e5.isPending,"data-testid":"button-bulk-reject",children:[(0,a.jsx)(eQ,{className:"h-4 w-4 mr-2"}),"Reject Selected (",c.length,")"]}),c.length>100&&(0,a.jsx)(e$.Alert,{className:"flex-1",children:(0,a.jsx)(e$.AlertDescription,{children:"Maximum 100 items can be selected for bulk actions"})})]})})}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Pending Content (",eD?.total||0,")"]})}),(0,a.jsxs)(Z.CardContent,{children:[eA?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-16"},s))}):0===as.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No pending items in queue"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{"data-testid":"table-moderation-queue",children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{className:"w-12",children:(0,a.jsx)(eE.Checkbox,{checked:al,onCheckedChange:e=>{e?o((eD?.items||[]).map(e=>e.id)):o([])},"data-testid":"checkbox-select-all"})}),(0,a.jsx)(ee.TableHead,{children:"Content Preview"}),(0,a.jsx)(ee.TableHead,{children:"Author"}),(0,a.jsx)(ee.TableHead,{children:"Category"}),(0,a.jsx)(ee.TableHead,{children:"Submitted"}),(0,a.jsx)(ee.TableHead,{children:"Word Count"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:as.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(eE.Checkbox,{checked:c.includes(e.id),onCheckedChange:a=>{var s;return s=e.id,void(a?o([...c,s]):o(c.filter(e=>e!==s)))},"data-testid":`checkbox-select-${e.id}`})}),(0,a.jsx)(ee.TableCell,{className:"max-w-md",children:(0,a.jsxs)("div",{className:"space-y-1",children:[e.title&&(0,a.jsx)("div",{className:"font-medium",children:aa(e.title,50)}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:aa(e.body,100)}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(ey.Badge,{variant:"outline",children:e.type}),e.hasLinks&&(0,a.jsx)(ey.Badge,{variant:"secondary",children:"Links"}),e.hasImages&&(0,a.jsx)(ey.Badge,{variant:"secondary",children:"Images"})]})]})}),(0,a.jsxs)(ee.TableCell,{children:["@",e.authorUsername]}),(0,a.jsx)(ee.TableCell,{children:"thread"===e.type?e.categoryName:e.threadTitle}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:e.wordCount}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsxs)(x.Button,{size:"sm",variant:"ghost",onClick:()=>e7(e.id),"data-testid":`button-view-details-${e.id}`,children:[(0,a.jsx)(eO.Eye,{className:"h-4 w-4 mr-1"}),"View"]}),(0,a.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>e1.mutate(e.id),disabled:e1.isPending,"data-testid":`button-approve-${e.id}`,children:[(0,a.jsx)(eU.CheckCircle,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,a.jsxs)(x.Button,{size:"sm",variant:"destructive",onClick:()=>ae(e.id),"data-testid":`button-reject-${e.id}`,children:[(0,a.jsx)(eQ,{className:"h-4 w-4 mr-1"}),"Reject"]})]})})]},e.id))})]})}),eD&&eD.pages>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 mt-4 flex-wrap",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Items per page:"}),(0,a.jsxs)(eT.Select,{value:n.toString(),onValueChange:e=>d(Number(e)),children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-20",children:(0,a.jsx)(eT.SelectValue,{})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"10",children:"10"}),(0,a.jsx)(eT.SelectItem,{value:"20",children:"20"}),(0,a.jsx)(eT.SelectItem,{value:"50",children:"50"}),(0,a.jsx)(eT.SelectItem,{value:"100",children:"100"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>r(e=>Math.max(1,e-1)),disabled:1===l,children:[(0,a.jsx)(eB.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,a.jsxs)("span",{className:"text-sm",children:["Page ",l," of ",eD.pages]}),(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>r(e=>Math.min(eD.pages,e+1)),disabled:l===eD.pages,children:["Next",(0,a.jsx)(eq.ChevronRight,{className:"h-4 w-4"})]})]})]})]})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"reported",className:"space-y-4",children:[(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsx)(Z.CardTitle,{children:"Filter by Status"}),(0,a.jsxs)(eT.Select,{value:h,onValueChange:u,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-48",children:(0,a.jsx)(eT.SelectValue,{})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"pending",children:"Pending"}),(0,a.jsx)(eT.SelectItem,{value:"resolved",children:"Resolved"}),(0,a.jsx)(eT.SelectItem,{value:"dismissed",children:"Dismissed"})]})]})]})})}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Reported Content (",eR?.total||0,")"]})}),(0,a.jsxs)(Z.CardContent,{children:[eI?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-16"},s))}):0===at.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No reported content found"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{"data-testid":"table-reported-content",children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Content Preview"}),(0,a.jsx)(ee.TableHead,{children:"Author"}),(0,a.jsx)(ee.TableHead,{children:"Reports"}),(0,a.jsx)(ee.TableHead,{children:"Reasons"}),(0,a.jsx)(ee.TableHead,{children:"First Reported"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:at.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{className:"max-w-md",children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-sm",children:aa(e.contentPreview,100)}),(0,a.jsx)(ey.Badge,{variant:"outline",children:e.contentType})]})}),(0,a.jsxs)(ee.TableCell,{children:["@",e.authorUsername]}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"destructive",children:e.reportCount})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.reasons.slice(0,3).map((e,s)=>(0,a.jsx)(ey.Badge,{variant:"secondary",children:e},s)),e.reasons.length>3&&(0,a.jsxs)(ey.Badge,{variant:"secondary",children:["+",e.reasons.length-3]})]})}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.firstReportedAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"pending"===e.status?"destructive":"resolved"===e.status?"default":"secondary",children:e.status})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsxs)(x.Button,{size:"sm",variant:"ghost",onClick:()=>e9(e.contentId),children:[(0,a.jsx)(eO.Eye,{className:"h-4 w-4 mr-1"}),"View Details"]}),"pending"===e.status&&(0,a.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>e9(e.contentId),"data-testid":`button-take-action-${e.contentId}`,children:[(0,a.jsx)(M.Shield,{className:"h-4 w-4 mr-1"}),"Take Action"]})]})})]},e.contentId))})]})}),eR&&eR.pages>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 mt-4 flex-wrap",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Items per page:"}),(0,a.jsxs)(eT.Select,{value:v.toString(),onValueChange:e=>b(Number(e)),children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-20",children:(0,a.jsx)(eT.SelectValue,{})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"10",children:"10"}),(0,a.jsx)(eT.SelectItem,{value:"20",children:"20"}),(0,a.jsx)(eT.SelectItem,{value:"50",children:"50"}),(0,a.jsx)(eT.SelectItem,{value:"100",children:"100"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>g(e=>Math.max(1,e-1)),disabled:1===p,children:[(0,a.jsx)(eB.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,a.jsxs)("span",{className:"text-sm",children:["Page ",p," of ",eR.pages]}),(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>g(e=>Math.min(eR.pages,e+1)),disabled:p===eR.pages,children:["Next",(0,a.jsx)(eq.ChevronRight,{className:"h-4 w-4"})]})]})]})]})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"history",className:"space-y-4",children:[(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsx)(Z.CardTitle,{children:"Filters"}),(0,a.jsxs)("div",{className:"flex gap-4 flex-wrap",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm",children:"Moderator:"}),(0,a.jsxs)(eT.Select,{value:f,onValueChange:N,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-48","data-testid":"select-moderator-filter",children:(0,a.jsx)(eT.SelectValue,{})}),(0,a.jsx)(eT.SelectContent,{children:(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Moderators"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm",children:"Limit:"}),(0,a.jsxs)(eT.Select,{value:y.toString(),onValueChange:e=>C(Number(e)),children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-32",children:(0,a.jsx)(eT.SelectValue,{})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"50",children:"50"}),(0,a.jsx)(eT.SelectItem,{value:"100",children:"100"}),(0,a.jsx)(eT.SelectItem,{value:"200",children:"200"}),(0,a.jsx)(eT.SelectItem,{value:"500",children:"500"})]})]})]}),(0,a.jsxs)(x.Button,{variant:"outline",onClick:()=>eM.queryClient.invalidateQueries({queryKey:["/api/moderation/history"]}),children:[(0,a.jsx)(e_.RefreshCw,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]})})}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsx)(Z.CardTitle,{children:"Moderation History"}),(0,a.jsx)(Z.CardDescription,{children:"Read-only log of recent moderation actions"})]}),(0,a.jsx)(Z.CardContent,{children:eZ?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):0===ai.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No moderation history available"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{"data-testid":"table-history",children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Timestamp"}),(0,a.jsx)(ee.TableHead,{children:"Moderator"}),(0,a.jsx)(ee.TableHead,{children:"Action"}),(0,a.jsx)(ee.TableHead,{children:"Content"}),(0,a.jsx)(ee.TableHead,{children:"Reason"})]})}),(0,a.jsx)(ee.TableBody,{children:ai.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{children:(0,eP.format)(new Date(e.createdAt),"MMM d, yyyy HH:mm")}),(0,a.jsxs)(ee.TableCell,{children:["@",e.moderatorUsername]}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"approve"===e.actionType?"default":"reject"===e.actionType?"destructive":"secondary",children:e.actionType})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-sm",children:aa(e.contentTitle,50)}),(0,a.jsx)(ey.Badge,{variant:"outline",children:e.contentType})]})}),(0,a.jsx)(ee.TableCell,{className:"max-w-md",children:e.reason?aa(e.reason,100):"-"})]},e.id))})]})})})]})]}),(0,a.jsx)(eS.TabsContent,{value:"stats",className:"space-y-4",children:e2?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(8)].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s))}):e0?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-today-approved",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Today Approved"}),(0,a.jsx)(eU.CheckCircle,{className:"h-4 w-4 text-green-500"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:e0.todayApproved})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-today-rejected",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Today Rejected"}),(0,a.jsx)(eQ,{className:"h-4 w-4 text-red-500"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:e0.todayRejected})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-today-reports-handled",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Today Reports Handled"}),(0,a.jsx)(ez.AlertTriangle,{className:"h-4 w-4 text-orange-500"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:e0.todayReportsHandled})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-total-moderated-today",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Moderated Today"}),(0,a.jsx)(L.TrendingUp,{className:"h-4 w-4 text-blue-500"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:e0.totalModeratedToday})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-avg-response-time",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Avg Response Time"}),(0,a.jsx)(eW.Clock,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[e0.avgResponseTimeMinutes,"m"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Average time to first action"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-most-active-moderator",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Most Active Moderator"}),(0,a.jsx)(eG.User,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-lg font-bold",children:["@",e0.mostActiveModerator||"N/A"]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-pending-under-1hr",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Pending < 1hr"}),(0,a.jsx)(R.FileText,{className:"h-4 w-4 text-green-500"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:e0.pendingUnderOneHour}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Fresh submissions"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-pending-over-24hrs",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Pending > 24hrs"}),(0,a.jsx)(ez.AlertTriangle,{className:"h-4 w-4 text-red-500"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:e0.pendingOverTwentyFourHours}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Urgent - needs attention"})]})]})]}):null})]}),(0,a.jsx)(ew.Dialog,{open:T,onOpenChange:w,children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-4xl max-h-[90vh]","data-testid":"dialog-content-details",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsxs)(ew.DialogTitle,{children:["Review Content - ",S?.type==="thread"?"Thread":"Reply"]})}),(0,a.jsx)(eV.ScrollArea,{className:"max-h-[calc(90vh-150px)]",children:S&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Content"}),S.title&&(0,a.jsx)("h4",{className:"text-lg font-bold mb-2",children:S.title}),(0,a.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:S.body})]}),S.parentThread&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Parent Thread"}),(0,a.jsx)("div",{className:"p-3 bg-muted rounded-lg",children:(0,a.jsx)("p",{className:"text-sm",children:S.parentThread.title})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Author Information"}),(0,a.jsxs)("div",{className:"flex items-start gap-4 p-4 bg-muted rounded-lg",children:[(0,a.jsx)(eJ.Avatar,{children:(0,a.jsx)(eJ.AvatarFallback,{children:S.author.username[0].toUpperCase()})}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium",children:["@",S.author.username]}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:S.author.role})]}),(0,a.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Reputation:"})," ",(0,a.jsx)("span",{className:"font-medium",children:S.author.reputation})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Member since:"})," ",(0,a.jsx)("span",{className:"font-medium",children:(0,eP.format)(new Date(S.author.createdAt),"MMM d, yyyy")})]})]}),S.author.badges&&S.author.badges.length>0&&(0,a.jsx)("div",{className:"flex gap-1 flex-wrap",children:S.author.badges.map((e,s)=>(0,a.jsx)(ey.Badge,{variant:"secondary",children:e},s))})]})]})]}),S.recentPosts.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Author's Recent Posts"}),(0,a.jsx)("div",{className:"space-y-2",children:S.recentPosts.map(e=>(0,a.jsx)("div",{className:"p-3 bg-muted rounded-lg text-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.title}),(0,a.jsx)("div",{className:"text-muted-foreground",children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,a.jsx)(ey.Badge,{variant:"outline",children:e.type})]})},e.id))})]}),S.warnings.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2 text-orange-600",children:"Warning History"}),(0,a.jsx)("div",{className:"space-y-2",children:S.warnings.map((e,s)=>(0,a.jsxs)("div",{className:"p-3 bg-orange-50 dark:bg-orange-950/20 rounded-lg text-sm border border-orange-200 dark:border-orange-800",children:[(0,a.jsx)("div",{className:"font-medium",children:e.reason}),(0,a.jsxs)("div",{className:"text-muted-foreground",children:["By @",e.moderator," â¢ ",(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})]})]},s))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Metadata"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 p-4 bg-muted rounded-lg text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Created:"})," ",(0,eP.format)(new Date(S.metadata.createdAt),"MMM d, yyyy HH:mm")]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Word Count:"})," ",S.metadata.wordCount]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Has Links:"})," ",S.metadata.hasLinks?"Yes":"No"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Has Images:"})," ",S.metadata.hasImages?"Yes":"No"]}),S.metadata.category&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Category:"})," ",S.metadata.category]})]})]})]})}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{variant:"ghost",onClick:()=>w(!1),children:"Close"}),(0,a.jsxs)(x.Button,{variant:"outline",onClick:()=>{S&&e1.mutate(S.id)},children:[(0,a.jsx)(eU.CheckCircle,{className:"h-4 w-4 mr-2"}),"Approve"]}),(0,a.jsxs)(x.Button,{variant:"destructive",onClick:()=>{S&&ae(S.id)},children:[(0,a.jsx)(eQ,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]})}),(0,a.jsx)(ew.Dialog,{open:D,onOpenChange:A,children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"dialog-reject-content",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Reject Content"}),(0,a.jsx)(ew.DialogDescription,{children:"Please provide a reason for rejecting this content"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,a.jsx)(eN.Textarea,{value:I,onChange:e=>B(e.target.value),placeholder:"Enter reason for rejection...",className:"min-h-24","data-testid":"textarea-reason"}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[I.length,"/500 characters"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eE.Checkbox,{checked:q,onCheckedChange:e=>P(e),id:"delete-permanently"}),(0,a.jsx)("label",{htmlFor:"delete-permanently",className:"text-sm cursor-pointer",children:"Delete permanently"})]})]}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{variant:"ghost",onClick:()=>A(!1),children:"Cancel"}),(0,a.jsx)(x.Button,{variant:"destructive",onClick:()=>{!F||!I||I.length<10||I.length>500?e({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):e4.mutate({contentId:F,reason:I,deletePermanently:q})},disabled:e4.isPending||I.length<10||I.length>500,children:"Reject"})]})]})}),(0,a.jsx)(ew.Dialog,{open:K,onOpenChange:E,children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-4xl max-h-[90vh]","data-testid":"dialog-report-details",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Report Details"})}),(0,a.jsx)(eV.ScrollArea,{className:"max-h-[calc(90vh-150px)]",children:V&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Content"}),V.content.title&&(0,a.jsx)("h4",{className:"text-lg font-bold mb-2",children:V.content.title}),(0,a.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:V.content.body})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold mb-2",children:["Reports (",V.reports.length,")"]}),(0,a.jsx)("div",{className:"space-y-3",children:V.reports.map((e,s)=>(0,a.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium",children:["@",e.reporterUsername]}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,a.jsx)(ey.Badge,{variant:"destructive",children:e.reason})]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]},s))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Author Information"}),(0,a.jsx)("div",{className:"p-4 bg-muted rounded-lg",children:(0,a.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Username:"})," ",(0,a.jsxs)("span",{className:"font-medium",children:["@",V.author.username]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Reputation:"})," ",(0,a.jsx)("span",{className:"font-medium",children:V.author.reputation})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Role:"})," ",(0,a.jsx)("span",{className:"font-medium",children:V.author.role})]})]})})]})]})}),(0,a.jsxs)(ew.DialogFooter,{className:"flex-wrap gap-2",children:[(0,a.jsx)(x.Button,{variant:"ghost",onClick:()=>E(!1),children:"Close"}),(0,a.jsx)(x.Button,{variant:"secondary",onClick:()=>{z(!0)},children:"Dismiss Report"}),(0,a.jsxs)(x.Button,{variant:"destructive",onClick:()=>{U&&e8.mutate({reportId:U,action:"delete",reason:"Content deleted by moderator"})},children:[(0,a.jsx)(eX.Trash2,{className:"h-4 w-4 mr-2"}),"Delete Content"]}),(0,a.jsxs)(x.Button,{variant:"outline",onClick:()=>{U&&e8.mutate({reportId:U,action:"warn",reason:"Warning issued for reported content"})},className:"border-yellow-500 text-yellow-600 hover:bg-yellow-50 dark:hover:bg-yellow-950/20",children:[(0,a.jsx)(ez.AlertTriangle,{className:"h-4 w-4 mr-2"}),"Warn Author"]}),(0,a.jsxs)(x.Button,{variant:"outline",onClick:()=>{V&&(el(V.author.username),Y(!0))},className:"border-orange-500 text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-950/20",children:[(0,a.jsx)(eY,{className:"h-4 w-4 mr-2"}),"Suspend Author"]}),(0,a.jsxs)(x.Button,{variant:"destructive",onClick:()=>{V&&(eu(V.author.username),ed(!0))},children:[(0,a.jsx)(eF.Ban,{className:"h-4 w-4 mr-2"}),"Ban Author"]})]})]})}),(0,a.jsx)(ew.Dialog,{open:O,onOpenChange:z,children:(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Dismiss Report"}),(0,a.jsx)(ew.DialogDescription,{children:"Optionally provide a reason for dismissing this report"})]}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (optional, max 500 characters)"}),(0,a.jsx)(eN.Textarea,{value:W,onChange:e=>G(e.target.value),placeholder:"Enter reason for dismissal...",className:"min-h-24"})]})}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{variant:"ghost",onClick:()=>z(!1),children:"Cancel"}),(0,a.jsx)(x.Button,{onClick:()=>{U&&e6.mutate({reportId:U,reason:W||void 0})},disabled:e6.isPending,children:"Dismiss Report"})]})]})}),(0,a.jsx)(ew.Dialog,{open:_,onOpenChange:Y,children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"dialog-suspend-author",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Suspend Author"}),(0,a.jsx)(ew.DialogDescription,{children:"Temporarily suspend this user's account"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Suspend Days (1-365)"}),(0,a.jsx)(m.Input,{type:"number",min:1,max:365,value:X,onChange:e=>ea(Number(e.target.value)),"data-testid":"input-suspend-days"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,a.jsx)(eN.Textarea,{value:es,onChange:e=>et(e.target.value),placeholder:"Enter reason for suspension...",className:"min-h-24","data-testid":"textarea-reason"})]})]}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{variant:"ghost",onClick:()=>Y(!1),children:"Cancel"}),(0,a.jsx)(x.Button,{variant:"destructive",onClick:()=>{!U||!es||es.length<10||es.length>500?e({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):X<1||X>365?e({title:"Suspend days must be between 1 and 365",variant:"destructive"}):e8.mutate({reportId:U,action:"suspend",reason:es,suspendDays:X})},disabled:e8.isPending||es.length<10||es.length>500||X<1||X>365,children:"Suspend User"})]})]})}),(0,a.jsx)(ew.Dialog,{open:en,onOpenChange:ed,children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"dialog-ban-author",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Ban Author"}),(0,a.jsx)(ew.DialogDescription,{children:"Permanently ban this user from the platform"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(e$.Alert,{variant:"destructive",children:[(0,a.jsx)(ez.AlertTriangle,{className:"h-4 w-4"}),(0,a.jsx)(e$.AlertDescription,{children:"This action is permanent and cannot be undone."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,a.jsx)(eN.Textarea,{value:ec,onChange:e=>eo(e.target.value),placeholder:"Enter reason for ban...",className:"min-h-24","data-testid":"textarea-reason"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eE.Checkbox,{checked:ex,onCheckedChange:e=>em(e),id:"ban-confirm"}),(0,a.jsx)("label",{htmlFor:"ban-confirm",className:"text-sm cursor-pointer",children:"I understand this is permanent"})]})]}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{variant:"ghost",onClick:()=>ed(!1),children:"Cancel"}),(0,a.jsx)(x.Button,{variant:"destructive",onClick:()=>{!U||!ec||ec.length<10||ec.length>500?e({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):ex?e8.mutate({reportId:U,action:"ban",reason:ec}):e({title:"Please confirm that you understand this action is permanent",variant:"destructive"})},disabled:e8.isPending||!ex||ec.length<10||ec.length>500,children:"Ban User"})]})]})}),(0,a.jsx)(ew.Dialog,{open:ej,onOpenChange:ep,children:(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Approve Selected Items"}),(0,a.jsxs)(ew.DialogDescription,{children:["Are you sure you want to approve ",c.length," items?"]})]}),(0,a.jsxs)(e$.Alert,{children:[(0,a.jsx)(ez.AlertTriangle,{className:"h-4 w-4"}),(0,a.jsx)(e$.AlertDescription,{children:"This action cannot be undone."})]}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{variant:"ghost",onClick:()=>ep(!1),children:"Cancel"}),(0,a.jsx)(x.Button,{onClick:()=>{e3.mutate(c)},disabled:e3.isPending,children:"Approve All"})]})]})}),(0,a.jsx)(ew.Dialog,{open:eg,onOpenChange:ev,children:(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Reject Selected Items"}),(0,a.jsxs)(ew.DialogDescription,{children:["Reject ",c.length," selected items"]})]}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,a.jsx)(eN.Textarea,{value:eb,onChange:e=>eC(e.target.value),placeholder:"This reason will apply to all selected items...",className:"min-h-24","data-testid":"textarea-reason"})]})}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{variant:"ghost",onClick:()=>ev(!1),children:"Cancel"}),(0,a.jsx)(x.Button,{variant:"destructive",onClick:()=>{!eb||eb.length<10||eb.length>500?e({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):e5.mutate({contentIds:c,reason:eb})},disabled:e5.isPending||eb.length<10||eb.length>500,children:"Reject All"})]})]})})]})}var e0=e.i(653145),e2=e.i(994814),e1=e.i(743004),e4=e.i(82403),e3=e.i(488844),e5=e.i(870273),e6=e.i(107233);let e8=e1.z.object({type:e1.z.enum(["ea","indicator","article","source_code"]),title:e1.z.string().min(10,"Title must be at least 10 characters").max(120),description:e1.z.string().min(300,"Description must be at least 300 characters"),category:e1.z.string().min(1,"Category is required"),priceCoins:e1.z.number().min(0).max(1e4),isFree:e1.z.boolean(),platform:e1.z.enum(["MT4","MT5","Both"]).optional(),version:e1.z.string().optional(),tags:e1.z.string().optional(),license:e1.z.string().optional(),minDeposit:e1.z.number().optional(),hedging:e1.z.boolean().optional(),changelog:e1.z.string().optional()});function e7({trigger:e}){let{toast:s}=(0,ek.useToast)(),[t,l]=(0,i.useState)(!1),[r,n]=(0,i.useState)([]),d=(0,e0.useForm)({resolver:(0,e2.zodResolver)(e8),defaultValues:{type:"ea",title:"",description:"",category:"",priceCoins:0,isFree:!0,platform:"MT4",version:"1.0",tags:"",license:"Standard",minDeposit:void 0,hedging:!1,changelog:""}}),c=(0,ef.useMutation)({mutationFn:async e=>{let a=e.tags?e.tags.split(",").map(e=>e.trim()).filter(Boolean):[],s={...e,tags:a,status:"approved",files:[],images:[]};return(await (0,eM.apiRequest)("POST","/api/admin/content",s)).json()},onSuccess:()=>{s({title:"Content Created!",description:"The marketplace content has been successfully added."}),d.reset(),n([]),l(!1),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/revenue-chart"]}),eM.queryClient.invalidateQueries({queryKey:["/api/content"]})},onError:e=>{s({variant:"destructive",title:"Failed to Create Content",description:e.message||"Could not create marketplace content. Please try again."})}}),o=["Expert Advisors","Indicators","Scripts","Templates","Trading Systems","Libraries","Utilities","Educational"],h=["Scalping","Day Trading","Swing Trading","Grid","Martingale","Breakout","Trend Following","Mean Reversion","News Trading","High Frequency","Performance Report"],u=d.watch("isFree");return(0,i.useEffect)(()=>{u&&d.setValue("priceCoins",0)},[u,d]),(0,a.jsxs)(ew.Dialog,{open:t,onOpenChange:l,children:[(0,a.jsx)(ew.DialogTrigger,{asChild:!0,children:e||(0,a.jsxs)(x.Button,{"data-testid":"button-add-content",children:[(0,a.jsx)(e6.Plus,{className:"h-4 w-4 mr-2"}),"Add Content"]})}),(0,a.jsxs)(ew.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Add Marketplace Content"}),(0,a.jsx)(ew.DialogDescription,{children:"Create new marketplace content (EA, Indicator, Article, or Source Code). All fields marked with * are required."})]}),(0,a.jsx)(e4.Form,{...d,children:(0,a.jsxs)("form",{onSubmit:d.handleSubmit(e=>{c.mutate(e)}),className:"space-y-6",children:[(0,a.jsx)(e4.FormField,{control:d.control,name:"type",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Content Type *"}),(0,a.jsxs)(eT.Select,{onValueChange:e.onChange,value:e.value,children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eT.SelectTrigger,{"data-testid":"select-content-type",children:(0,a.jsx)(eT.SelectValue,{})})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"ea",children:"Expert Advisor (EA)"}),(0,a.jsx)(eT.SelectItem,{value:"indicator",children:"Indicator"}),(0,a.jsx)(eT.SelectItem,{value:"article",children:"Article"}),(0,a.jsx)(eT.SelectItem,{value:"source_code",children:"Source Code"})]})]}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:d.control,name:"title",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Title *"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{placeholder:"e.g., Gold Scalper Pro EA v2.5",...e,"data-testid":"input-content-title"})}),(0,a.jsxs)(e4.FormDescription,{children:[e.value.length,"/120 characters"]}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:d.control,name:"description",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Description *"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eN.Textarea,{placeholder:"Detailed description of the content, features, benefits, and usage instructions...",className:"min-h-[150px]",...e,"data-testid":"textarea-content-description"})}),(0,a.jsxs)(e4.FormDescription,{children:[e.value.length," characters (minimum 300)"]}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:d.control,name:"category",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Category *"}),(0,a.jsxs)(eT.Select,{onValueChange:e.onChange,value:e.value||void 0,children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eT.SelectTrigger,{"data-testid":"select-category",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select a category..."})})}),(0,a.jsx)(eT.SelectContent,{children:o.map(e=>(0,a.jsx)(eT.SelectItem,{value:e,children:e},e))})]}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:d.control,name:"platform",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Platform"}),(0,a.jsxs)(eT.Select,{onValueChange:e.onChange,value:e.value||void 0,children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eT.SelectTrigger,{"data-testid":"select-platform",children:(0,a.jsx)(eT.SelectValue,{})})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"MT4",children:"MT4"}),(0,a.jsx)(eT.SelectItem,{value:"MT5",children:"MT5"}),(0,a.jsx)(eT.SelectItem,{value:"Both",children:"Both MT4 & MT5"})]})]}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(e4.FormField,{control:d.control,name:"isFree",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eE.Checkbox,{checked:e.value,onCheckedChange:e.onChange,"data-testid":"checkbox-is-free"})}),(0,a.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,a.jsx)(e4.FormLabel,{children:"Free Content"}),(0,a.jsx)(e4.FormDescription,{children:"Check if this content is free"})]})]})}),(0,a.jsx)(e4.FormField,{control:d.control,name:"priceCoins",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Price (Coins) *"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{type:"number",min:0,max:1e4,disabled:u,...e,onChange:a=>e.onChange(parseInt(a.target.value)||0),"data-testid":"input-price-coins"})}),(0,a.jsx)(e4.FormDescription,{children:"0-10,000 coins"}),(0,a.jsx)(e4.FormMessage,{})]})})]}),(0,a.jsx)(e4.FormField,{control:d.control,name:"tags",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Tags"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-3",children:h.map(e=>(0,a.jsx)(ey.Badge,{variant:r.includes(e)?"default":"outline",className:"cursor-pointer",onClick:()=>{let a;n(a=r.includes(e)?r.filter(a=>a!==e):[...r,e]),d.setValue("tags",a.join(", "))},"data-testid":`tag-${e.toLowerCase().replace(/\s+/g,"-")}`,children:e},e))}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{placeholder:"Or enter custom tags separated by commas...",...e,"data-testid":"input-tags"})}),(0,a.jsx)(e4.FormDescription,{children:"Click tags above or enter custom tags separated by commas (max 8)"}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(e4.FormField,{control:d.control,name:"version",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Version"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{placeholder:"e.g., 1.0, 2.5.1",...e,"data-testid":"input-version"})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:d.control,name:"license",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"License"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{placeholder:"e.g., Standard, Extended, GPL",...e,"data-testid":"input-license"})}),(0,a.jsx)(e4.FormMessage,{})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(e4.FormField,{control:d.control,name:"minDeposit",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Minimum Deposit"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{type:"number",placeholder:"e.g., 100",...e,onChange:a=>e.onChange(a.target.value?parseInt(a.target.value):void 0),value:e.value||"","data-testid":"input-min-deposit"})}),(0,a.jsx)(e4.FormDescription,{children:"Minimum account balance required"}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:d.control,name:"hedging",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4 mt-2",children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eE.Checkbox,{checked:e.value,onCheckedChange:e.onChange,"data-testid":"checkbox-hedging"})}),(0,a.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,a.jsx)(e4.FormLabel,{children:"Supports Hedging"}),(0,a.jsx)(e4.FormDescription,{children:"Check if this EA supports hedging"})]})]})})]}),(0,a.jsx)(e4.FormField,{control:d.control,name:"changelog",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Changelog"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eN.Textarea,{placeholder:"Version history and updates...",className:"min-h-[100px]",...e,"data-testid":"textarea-changelog"})}),(0,a.jsx)(e4.FormDescription,{children:"Document version changes and improvements"}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)(x.Button,{type:"submit",disabled:c.isPending,"data-testid":"button-submit-content",children:c.isPending?"Creating...":"Create Content"}),(0,a.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>{d.reset(),n([]),l(!1)},"data-testid":"button-cancel",children:"Cancel"})]})]})})]})]})}let e9=e1.z.object({reason:e1.z.string().min(10,"Reason must be at least 10 characters").max(500,"Reason must be less than 500 characters")}),ae=e1.z.object({durationDays:e1.z.number().min(1,"Duration must be at least 1 day").max(365,"Duration cannot exceed 365 days")});function aa(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)(""),[l,r]=(0,i.useState)(""),[n,d]=(0,i.useState)("all"),[c,o]=(0,i.useState)("all"),[h,u]=(0,i.useState)("all"),[p,g]=(0,i.useState)(1),[v,b]=(0,i.useState)(20),[y,C]=(0,i.useState)(null),[f,N]=(0,i.useState)(null),[T,w]=(0,i.useState)(null);(0,i.useEffect)(()=>{let e=setTimeout(()=>{r(s),g(1)},300);return()=>clearTimeout(e)},[s]),(0,i.useEffect)(()=>{g(1)},[n,c,h]);let S=new URLSearchParams({page:p.toString(),limit:v.toString(),...l&&{search:l},..."all"!==n&&{category:n},..."all"!==c&&{status:c},..."all"!==h&&{priceRange:h}}),{data:k,isLoading:D}=(0,J.useQuery)({queryKey:["/api/admin/marketplace/stats"]}),A=k||{totalItems:0,pendingItems:0,totalSales:0,salesThisWeek:0,totalRevenue:0,revenueThisWeek:0},{data:F,isLoading:H}=(0,J.useQuery)({queryKey:["/api/admin/marketplace/items",p,v,l,n,c,h],queryFn:async()=>{let e=await fetch(`/api/admin/marketplace/items?${S}`);if(!e.ok){let a=await e.json();return{items:Array.isArray(a)?a:[],totalItems:Array.isArray(a)?a.length:0,totalPages:1,currentPage:1,pageSize:Array.isArray(a)?a.length:20}}return e.json()}}),R=F?.items||[],I=F?.totalItems||0,B=F?.totalPages||1,{data:P,isLoading:M}=(0,J.useQuery)({queryKey:["/api/admin/marketplace/top-selling"]}),K=Array.isArray(P)?P:[],{data:E,isLoading:V}=(0,J.useQuery)({queryKey:["/api/admin/marketplace/revenue-chart"]}),$=Array.isArray(E)?E:[],{data:U,isLoading:Q}=(0,J.useQuery)({queryKey:["/api/admin/marketplace/top-vendors"]}),O=Array.isArray(U)?U:[],{data:z,isLoading:W}=(0,J.useQuery)({queryKey:["/api/admin/marketplace/items",y],enabled:!!y,queryFn:async()=>{let e=await fetch(`/api/admin/marketplace/items/${y}`);if(!e.ok)throw Error("Failed to fetch item details");return e.json()}}),G=(0,e0.useForm)({resolver:(0,e2.zodResolver)(e9),defaultValues:{reason:""}}),_=(0,e0.useForm)({resolver:(0,e2.zodResolver)(ae),defaultValues:{durationDays:30}}),Y=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("POST",`/api/admin/marketplace/${e}/approve`,{}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-vendors"]}),e({title:"Item approved successfully"})},onError:()=>{e({title:"Failed to approve item",variant:"destructive"})}}),X=(0,ef.useMutation)({mutationFn:async e=>{if(!f)throw Error("No item selected");return(0,eM.apiRequest)("POST",`/api/admin/marketplace/${f}/reject`,e)},onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-vendors"]}),N(null),e({title:"Item rejected successfully"}),G.reset()},onError:()=>{e({title:"Failed to reject item",variant:"destructive"})}}),ea=(0,ef.useMutation)({mutationFn:async e=>{if(!T)throw Error("No item selected");return(0,eM.apiRequest)("POST",`/api/admin/marketplace/${T}/feature`,e)},onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-vendors"]}),w(null),e({title:"Item featured successfully"}),_.reset()},onError:()=>{e({title:"Failed to feature item",variant:"destructive"})}});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Marketplace Management"}),(0,a.jsx)(e7,{})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(m.Input,{placeholder:"Search by title or seller...",value:s,onChange:e=>t(e.target.value),"data-testid":"input-search-items"})}),(0,a.jsxs)(eT.Select,{value:n,onValueChange:d,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-[200px]","data-testid":"select-category-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"All Categories"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Categories"}),(0,a.jsx)(eT.SelectItem,{value:"Expert Advisors",children:"Expert Advisors"}),(0,a.jsx)(eT.SelectItem,{value:"Indicators",children:"Indicators"}),(0,a.jsx)(eT.SelectItem,{value:"Scripts",children:"Scripts"}),(0,a.jsx)(eT.SelectItem,{value:"Templates",children:"Templates"})]})]}),(0,a.jsxs)(eT.Select,{value:c,onValueChange:o,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-status-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"All Statuses"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Statuses"}),(0,a.jsx)(eT.SelectItem,{value:"pending",children:"Pending"}),(0,a.jsx)(eT.SelectItem,{value:"approved",children:"Approved"}),(0,a.jsx)(eT.SelectItem,{value:"rejected",children:"Rejected"})]})]}),(0,a.jsxs)(eT.Select,{value:h,onValueChange:u,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-price-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"All Prices"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Prices"}),(0,a.jsx)(eT.SelectItem,{value:"free",children:"Free (0 coins)"}),(0,a.jsx)(eT.SelectItem,{value:"low",children:"Low (1-100)"}),(0,a.jsx)(eT.SelectItem,{value:"medium",children:"Medium (101-500)"}),(0,a.jsx)(eT.SelectItem,{value:"high",children:"High (500+)"})]})]}),(0,a.jsx)(x.Button,{variant:"outline",onClick:()=>{t(""),d("all"),o("all"),u("all")},"data-testid":"button-clear-filters",children:"Clear Filters"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-total-items",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Items"}),(0,a.jsx)(e3.Package,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:D?(0,a.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-items",children:A.totalItems}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[A.pendingItems," pending approval"]})]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-total-sales",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Sales"}),(0,a.jsx)(L.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:D?(0,a.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-sales",children:A.totalSales}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",A.salesThisWeek," this week"]})]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-total-revenue",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Revenue"}),(0,a.jsx)(q.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:D?(0,a.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-marketplace-revenue",children:["$",A.totalRevenue]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+$",A.revenueThisWeek," this week"]})]})})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-revenue-chart",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Revenue Trend (Last 30 Days)"})}),(0,a.jsx)(Z.CardContent,{children:V?(0,a.jsx)(j.Skeleton,{className:"h-64"}):$.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(en.LineChart,{data:$,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"date"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(ed.Line,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No revenue data available"})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-top-selling",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Top Selling Items"})}),(0,a.jsx)(Z.CardContent,{children:M?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):K.length>0?(0,a.jsx)("div",{className:"space-y-3",children:K.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-muted-foreground",children:["#",s+1]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.sales," sales"]})]})]}),(0,a.jsxs)(ey.Badge,{children:[e.coinPrice," coins"]})]},e.id))}):(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No sales data available"})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-top-vendors",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Top Vendors"})}),(0,a.jsx)(Z.CardContent,{children:Q?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):O.length>0?(0,a.jsx)("div",{className:"space-y-3",children:O.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"text-lg font-bold text-muted-foreground",children:["#",s+1]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.sellerUsername}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.totalSales," sales â¢ ",e.itemCount," items"]})]})]}),(0,a.jsxs)(ey.Badge,{children:[e.totalRevenue," coins earned"]})]},e.sellerId))}):(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No vendor data available"})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-marketplace-items",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Marketplace Items (",I,")"]})}),(0,a.jsx)(Z.CardContent,{children:H?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-16"},s))}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Title"}),(0,a.jsx)(ee.TableHead,{children:"Seller"}),(0,a.jsx)(ee.TableHead,{children:"Price"}),(0,a.jsx)(ee.TableHead,{children:"Sales"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Listed"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:R.length>0?R.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`item-row-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{"data-testid":`item-title-${e.id}`,children:e.title}),(0,a.jsx)(ee.TableCell,{children:e.sellerUsername}),(0,a.jsxs)(ee.TableCell,{children:[e.coinPrice," coins"]}),(0,a.jsx)(ee.TableCell,{children:e.sales}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"approved"===e.status?"default":"secondary",children:e.status})}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsx)(x.Button,{size:"sm",variant:"ghost",onClick:()=>C(e.id),"data-testid":`button-view-item-${e.id}`,children:(0,a.jsx)(eO.Eye,{className:"h-4 w-4"})}),(0,a.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>Y.mutate(e.id),disabled:"approved"===e.status||Y.isPending,"data-testid":`button-approve-item-${e.id}`,children:[(0,a.jsx)(eU.CheckCircle,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,a.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>N(e.id),disabled:"rejected"===e.status,"data-testid":`button-reject-item-${e.id}`,children:[(0,a.jsx)(eQ,{className:"h-4 w-4 mr-1"}),"Reject"]}),(0,a.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>w(e.id),disabled:"approved"!==e.status,"data-testid":`button-feature-item-${e.id}`,children:[(0,a.jsx)(e5.Star,{className:"h-4 w-4 mr-1"}),"Feature"]})]})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No marketplace items found"})})})]})}),I>0&&(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 px-2 py-4 border-t mt-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(p-1)*v+1,"-",Math.min(p*v,I)," of ",I," items"]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm",children:"Items per page:"}),(0,a.jsxs)(eT.Select,{value:v.toString(),onValueChange:e=>b(parseInt(e)),children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-[80px]","data-testid":"select-page-size",children:(0,a.jsx)(eT.SelectValue,{})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"10",children:"10"}),(0,a.jsx)(eT.SelectItem,{value:"20",children:"20"}),(0,a.jsx)(eT.SelectItem,{value:"50",children:"50"}),(0,a.jsx)(eT.SelectItem,{value:"100",children:"100"})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Button,{variant:"outline",size:"sm",onClick:()=>g(1),disabled:1===p,"data-testid":"button-first-page",children:"First"}),(0,a.jsx)(x.Button,{variant:"outline",size:"sm",onClick:()=>g(p-1),disabled:1===p,"data-testid":"button-prev-page",children:"Previous"}),(0,a.jsxs)("span",{className:"text-sm",children:["Page ",p," of ",B]}),(0,a.jsx)(x.Button,{variant:"outline",size:"sm",onClick:()=>g(p+1),disabled:p===B,"data-testid":"button-next-page",children:"Next"}),(0,a.jsx)(x.Button,{variant:"outline",size:"sm",onClick:()=>g(B),disabled:p===B,"data-testid":"button-last-page",children:"Last"})]})]})]})]})})]}),(0,a.jsx)(ew.Dialog,{open:null!==y,onOpenChange:()=>C(null),children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Item Details"})}),W?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(j.Skeleton,{className:"h-20"}),(0,a.jsx)(j.Skeleton,{className:"h-20"}),(0,a.jsx)(j.Skeleton,{className:"h-32"})]}):z?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Title"}),(0,a.jsx)("p",{className:"font-medium",children:z.title})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Category"}),(0,a.jsx)("p",{className:"font-medium",children:z.category})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Price"}),(0,a.jsxs)("p",{className:"font-medium",children:[z.coinPrice," coins"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,a.jsx)(ey.Badge,{children:z.status})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Seller"}),(0,a.jsx)("p",{className:"font-medium",children:z.sellerUsername})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Sales"}),(0,a.jsx)("p",{className:"font-medium",children:z.sales})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Description"}),(0,a.jsx)("p",{className:"text-sm",children:z.description})]}),z.recentPurchases&&z.recentPurchases.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium mb-2",children:"Recent Purchases"}),(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Buyer"}),(0,a.jsx)(ee.TableHead,{children:"Price"}),(0,a.jsx)(ee.TableHead,{children:"Date"})]})}),(0,a.jsx)(ee.TableBody,{children:z.recentPurchases.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{children:e.buyerUsername}),(0,a.jsxs)(ee.TableCell,{children:[e.coins," coins"]}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.purchasedAt),{addSuffix:!0})})]},e.id))})]})]})]}):(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"Item not found"})]})}),(0,a.jsx)(ew.Dialog,{open:null!==f,onOpenChange:()=>N(null),children:(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Reject Marketplace Item"}),(0,a.jsx)(ew.DialogDescription,{children:"Please provide a reason for rejecting this item. The seller will see this reason."})]}),(0,a.jsx)(e4.Form,{...G,children:(0,a.jsxs)("form",{onSubmit:G.handleSubmit(e=>{X.mutate(e)}),className:"space-y-4",children:[(0,a.jsx)(e4.FormField,{control:G.control,name:"reason",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Rejection Reason *"}),(0,a.jsxs)(eT.Select,{onValueChange:a=>{"custom"!==a&&e.onChange(a)},children:[(0,a.jsx)(eT.SelectTrigger,{"data-testid":"select-reject-reason",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select a reason..."})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"Poor description",children:"Poor description"}),(0,a.jsx)(eT.SelectItem,{value:"Inappropriate content",children:"Inappropriate content"}),(0,a.jsx)(eT.SelectItem,{value:"Duplicate listing",children:"Duplicate listing"}),(0,a.jsx)(eT.SelectItem,{value:"Missing files",children:"Missing files"}),(0,a.jsx)(eT.SelectItem,{value:"Price too high",children:"Price too high"}),(0,a.jsx)(eT.SelectItem,{value:"custom",children:"Custom reason..."})]})]}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eN.Textarea,{placeholder:"Or enter a custom reason...",...e,"data-testid":"textarea-reject-reason",className:"min-h-[100px]"})}),(0,a.jsx)(e4.FormDescription,{children:"Minimum 10 characters"}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.Button,{type:"submit",disabled:X.isPending,"data-testid":"button-confirm-reject",children:X.isPending?"Rejecting...":"Reject Item"}),(0,a.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>N(null),children:"Cancel"})]})]})})]})}),(0,a.jsx)(ew.Dialog,{open:null!==T,onOpenChange:()=>w(null),children:(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Feature Marketplace Item"}),(0,a.jsx)(ew.DialogDescription,{children:"Featured items appear prominently on the marketplace homepage."})]}),(0,a.jsx)(e4.Form,{..._,children:(0,a.jsxs)("form",{onSubmit:_.handleSubmit(e=>{ea.mutate(e)}),className:"space-y-4",children:[(0,a.jsx)(e4.FormField,{control:_.control,name:"durationDays",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Feature Duration (Days) *"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{type:"number",min:1,max:365,...e,onChange:a=>e.onChange(parseInt(a.target.value)||1),"data-testid":"input-feature-duration"})}),(0,a.jsx)(e4.FormDescription,{children:"How long should this item be featured? (1-365 days)"}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.Button,{type:"submit",disabled:ea.isPending,"data-testid":"button-confirm-feature",children:ea.isPending?"Featuring...":"Feature Item"}),(0,a.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>w(null),children:"Cancel"})]})]})})]})})]})}var as=e.i(607486),at=e.i(595468),ai=e.i(581418),al=e.i(751737),ar=e.i(688511);let an=e1.z.object({name:e1.z.string().min(1,"Name is required"),country:e1.z.string().optional(),regulation:e1.z.string().optional(),websiteUrl:e1.z.string().url("Must be a valid URL").optional(),minDeposit:e1.z.string().optional(),leverage:e1.z.string().optional(),platform:e1.z.string().optional(),spreadType:e1.z.string().optional(),minSpread:e1.z.string().optional()}),ad=e1.z.object({enabled:e1.z.boolean(),reason:e1.z.string().optional(),severity:e1.z.enum(["low","medium","high","critical"]).optional()}),ac=e1.z.object({reason:e1.z.string().min(10,"Reason must be at least 10 characters")});function ao(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)("brokers"),[l,r]=(0,i.useState)(""),[n,d]=(0,i.useState)(""),[c,o]=(0,i.useState)("all"),[h,u]=(0,i.useState)("all"),[p,g]=(0,i.useState)("all"),[v,b]=(0,i.useState)(1),[y,C]=(0,i.useState)(20),[f,N]=(0,i.useState)(null),[T,w]=(0,i.useState)(null),[S,k]=(0,i.useState)(null),[D,A]=(0,i.useState)(null),[F,H]=(0,i.useState)(null),[R,I]=(0,i.useState)(null),[B,q]=(0,i.useState)(null),[L,P]=(0,i.useState)(!1),[M,K]=(0,i.useState)(!1),[E,V]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=setTimeout(()=>{d(l),b(1)},300);return()=>clearTimeout(e)},[l]),(0,i.useEffect)(()=>{b(1)},[c,h,p]);let{data:$,isLoading:U}=(0,J.useQuery)({queryKey:["/api/admin/brokers/stats"]}),O=$||{totalBrokers:0,verifiedBrokers:0,scamWarnings:0,totalReviews:0,pendingReviews:0,pendingScamReports:0},{data:z,isLoading:W}=(0,J.useQuery)({queryKey:["/api/admin/brokers",n,c,h,p,v,y],queryFn:async()=>{let e=new URLSearchParams({page:v.toString(),pageSize:y.toString()});n&&e.set("search",n),"all"!==c&&e.set("country",c),"verified"===h&&e.set("isVerified","true"),"unverified"===h&&e.set("isVerified","false"),"scam_warning"===h&&e.set("scamWarning","true"),"all"!==p&&e.set("regulation",p);let a=await fetch(`/api/admin/brokers?${e.toString()}`);if(!a.ok)throw Error("Failed to fetch brokers");return a.json()},enabled:"brokers"===s}),G=z?.items||[],_=z?.total||0,{data:Y,isLoading:X}=(0,J.useQuery)({queryKey:["/api/admin/scam-reports",v,y],queryFn:async()=>{let e=new URLSearchParams({page:v.toString(),pageSize:y.toString()}),a=await fetch(`/api/admin/scam-reports?${e.toString()}`);if(!a.ok)throw Error("Failed to fetch scam reports");return a.json()},enabled:"scam-reports"===s}),ea=Y?.items||[],es=Y?.total||0,{data:et,isLoading:el}=(0,J.useQuery)({queryKey:["/api/admin/broker-reviews",v,y],queryFn:async()=>{let e=new URLSearchParams({page:v.toString(),pageSize:y.toString()}),a=await fetch(`/api/admin/broker-reviews?${e.toString()}`);if(!a.ok)throw Error("Failed to fetch reviews");return a.json()},enabled:"reviews"===s}),en=et?.items||[],ed=et?.total||0,ec=(0,e0.useForm)({resolver:(0,e2.zodResolver)(an),defaultValues:{name:"",country:"",regulation:"",websiteUrl:"",minDeposit:"",leverage:"",platform:"",spreadType:"",minSpread:""}}),eo=(0,e0.useForm)({resolver:(0,e2.zodResolver)(an)}),ex=(0,e0.useForm)({resolver:(0,e2.zodResolver)(ad),defaultValues:{enabled:!0,reason:"",severity:"medium"}}),em=(0,e0.useForm)({resolver:(0,e2.zodResolver)(ac),defaultValues:{reason:""}}),eh=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("POST","/api/brokers",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),P(!1),ec.reset(),e({title:"Broker added successfully"})},onError:()=>{e({title:"Failed to add broker",variant:"destructive"})}}),eu=(0,ef.useMutation)({mutationFn:async e=>{if(!T)throw Error("No broker selected");return(0,eM.apiRequest)("PATCH",`/api/admin/brokers/${T}`,e)},onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),w(null),e({title:"Broker updated successfully"})},onError:()=>{e({title:"Failed to update broker",variant:"destructive"})}}),ej=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("DELETE",`/api/admin/brokers/${e}`,{}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),k(null),K(!1),e({title:"Broker deleted successfully"})},onError:()=>{e({title:"Failed to delete broker",variant:"destructive"})}}),ep=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("POST",`/api/admin/brokers/${e}/verify`,{}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),A(null),V(!1),e({title:"Broker verified successfully"})},onError:()=>{e({title:"Failed to verify broker",variant:"destructive"})}}),eg=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("POST",`/api/admin/brokers/${e}/unverify`,{}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),e({title:"Broker verification removed"})},onError:()=>{e({title:"Failed to unverify broker",variant:"destructive"})}}),ev=(0,ef.useMutation)({mutationFn:async e=>{if(!F)throw Error("No broker selected");return(0,eM.apiRequest)("POST",`/api/admin/brokers/${F}/scam-warning`,e)},onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),H(null),ex.reset(),e({title:"Scam warning updated successfully"})},onError:()=>{e({title:"Failed to update scam warning",variant:"destructive"})}}),eb=(0,ef.useMutation)({mutationFn:async({reportId:e,resolution:a})=>(0,eM.apiRequest)("POST",`/api/admin/scam-reports/${e}/resolve`,{resolution:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/scam-reports"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),I(null),e({title:"Scam report resolved"})},onError:()=>{e({title:"Failed to resolve scam report",variant:"destructive"})}}),eC=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("POST",`/api/admin/broker-reviews/${e}/approve`,{}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/broker-reviews"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),q(null),e({title:"Review approved successfully"})},onError:()=>{e({title:"Failed to approve review",variant:"destructive"})}}),eD=(0,ef.useMutation)({mutationFn:async e=>{if(!B)throw Error("No review selected");return(0,eM.apiRequest)("POST",`/api/admin/broker-reviews/${B}/reject`,e)},onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/broker-reviews"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),q(null),em.reset(),e({title:"Review rejected"})},onError:()=>{e({title:"Failed to reject review",variant:"destructive"})}}),eA=e=>{b(e),window.scrollTo({top:0,behavior:"smooth"})},eF=G.find(e=>e.id===f||e.id===T||e.id===S||e.id===D||e.id===F),eH=ea.find(e=>e.id===R),eR=en.find(e=>e.id===B);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Broker Management"}),(0,a.jsx)(x.Button,{onClick:()=>P(!0),"data-testid":"button-add-broker",children:"+ Add Broker"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"stat-total-brokers",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Brokers"}),(0,a.jsx)(as.Building2,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:U?(0,a.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,a.jsx)("div",{className:"text-2xl font-bold",children:O.totalBrokers})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"stat-verified-brokers",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Verified Brokers"}),(0,a.jsx)(at.CheckCircle2,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:U?(0,a.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,a.jsx)("div",{className:"text-2xl font-bold",children:O.verifiedBrokers})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"stat-scam-warnings",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Scam Warnings"}),(0,a.jsx)(ez.AlertTriangle,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:U?(0,a.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,a.jsx)("div",{className:"text-2xl font-bold",children:O.scamWarnings})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"stat-total-reviews",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Reviews"}),(0,a.jsx)(ei.MessageSquare,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:U?(0,a.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,a.jsx)("div",{className:"text-2xl font-bold",children:O.totalReviews})})]})]}),(0,a.jsxs)(eS.Tabs,{value:s,onValueChange:t,className:"space-y-4",children:[(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsxs)(eS.TabsTrigger,{value:"brokers","data-testid":"tab-brokers",children:["Brokers (",O.totalBrokers,")"]}),(0,a.jsxs)(eS.TabsTrigger,{value:"scam-reports","data-testid":"tab-scam-reports",children:["Scam Reports (",O.pendingScamReports,")"]}),(0,a.jsxs)(eS.TabsTrigger,{value:"reviews","data-testid":"tab-reviews",children:["Reviews (",O.totalReviews,")"]})]}),(0,a.jsxs)(eS.TabsContent,{value:"brokers",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)(Q.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(m.Input,{placeholder:"Search by broker name...",value:l,onChange:e=>r(e.target.value),className:"pl-9","data-testid":"input-search-brokers"})]}),(0,a.jsxs)(eT.Select,{value:c,onValueChange:o,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-country-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"All Countries"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Countries"}),(0,a.jsx)(eT.SelectItem,{value:"USA",children:"USA"}),(0,a.jsx)(eT.SelectItem,{value:"UK",children:"UK"}),(0,a.jsx)(eT.SelectItem,{value:"Cyprus",children:"Cyprus"}),(0,a.jsx)(eT.SelectItem,{value:"Australia",children:"Australia"})]})]}),(0,a.jsxs)(eT.Select,{value:h,onValueChange:u,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-verification-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Verification"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All"}),(0,a.jsx)(eT.SelectItem,{value:"verified",children:"Verified"}),(0,a.jsx)(eT.SelectItem,{value:"unverified",children:"Unverified"}),(0,a.jsx)(eT.SelectItem,{value:"scam_warning",children:"Scam Warning"})]})]}),(0,a.jsxs)(eT.Select,{value:p,onValueChange:g,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-regulation-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Regulation"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All"}),(0,a.jsx)(eT.SelectItem,{value:"FCA",children:"FCA"}),(0,a.jsx)(eT.SelectItem,{value:"ASIC",children:"ASIC"}),(0,a.jsx)(eT.SelectItem,{value:"CySEC",children:"CySEC"}),(0,a.jsx)(eT.SelectItem,{value:"CFTC",children:"CFTC"})]})]}),(0,a.jsxs)(eT.Select,{value:y.toString(),onValueChange:e=>C(parseInt(e)),children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-[120px]","data-testid":"select-page-size",children:(0,a.jsx)(eT.SelectValue,{})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"10",children:"10 / page"}),(0,a.jsx)(eT.SelectItem,{value:"20",children:"20 / page"}),(0,a.jsx)(eT.SelectItem,{value:"50",children:"50 / page"}),(0,a.jsx)(eT.SelectItem,{value:"100",children:"100 / page"})]})]}),(0,a.jsx)(x.Button,{variant:"outline",onClick:()=>{r(""),o("all"),u("all"),g("all")},"data-testid":"button-clear-filters",children:"Clear"})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Brokers (",_,")"]})}),(0,a.jsx)(Z.CardContent,{children:W?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-16"},s))}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Name"}),(0,a.jsx)(ee.TableHead,{children:"Country"}),(0,a.jsx)(ee.TableHead,{children:"Regulation"}),(0,a.jsx)(ee.TableHead,{children:"Verified"}),(0,a.jsx)(ee.TableHead,{children:"Reviews"}),(0,a.jsx)(ee.TableHead,{children:"Rating"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:G.length>0?G.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`row-broker-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),e.scamWarning&&(0,a.jsx)(ey.Badge,{variant:"destructive",className:"text-xs",children:"Scam Warning"})]})})}),(0,a.jsx)(ee.TableCell,{children:e.country||"-"}),(0,a.jsx)(ee.TableCell,{children:e.regulation||"-"}),(0,a.jsx)(ee.TableCell,{children:e.isVerified?(0,a.jsxs)(ey.Badge,{variant:"default",children:[(0,a.jsx)(at.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Verified"]}):(0,a.jsx)(ey.Badge,{variant:"secondary",children:"Unverified"})}),(0,a.jsx)(ee.TableCell,{children:e.reviewCount}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(e5.Star,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),(0,a.jsx)("span",{children:e.overallRating||0})]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"approved"===e.status?"default":"secondary",children:e.status})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsx)(x.Button,{size:"sm",variant:"ghost",onClick:()=>N(e.id),"data-testid":`button-view-broker-${e.id}`,children:(0,a.jsx)(eO.Eye,{className:"h-4 w-4"})}),(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>{w(e.id),eo.reset({name:e.name,country:e.country||"",regulation:e.regulation||""})},"data-testid":`button-edit-broker-${e.id}`,children:(0,a.jsx)(ar.Edit,{className:"h-4 w-4"})}),e.isVerified?(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eg.mutate(e.id),"data-testid":`button-unverify-broker-${e.id}`,children:"Unverify"}):(0,a.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>A(e.id),"data-testid":`button-verify-broker-${e.id}`,children:[(0,a.jsx)(ai.ShieldCheck,{className:"h-4 w-4 mr-1"}),"Verify"]}),(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>H(e.id),"data-testid":`button-scam-warning-${e.id}`,children:(0,a.jsx)(al.ShieldAlert,{className:"h-4 w-4"})}),(0,a.jsx)(x.Button,{size:"sm",variant:"destructive",onClick:()=>k(e.id),"data-testid":`button-delete-broker-${e.id}`,children:(0,a.jsx)(eX.Trash2,{className:"h-4 w-4"})})]})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"No brokers found"})})})]})}),_>y&&(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(v-1)*y+1," to ",Math.min(v*y,_)," of ",_," brokers"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eA(1),disabled:1===v,"data-testid":"button-first-page",children:"First"}),(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eA(v-1),disabled:1===v,"data-testid":"button-prev-page",children:"Previous"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 px-4",children:[(0,a.jsx)(m.Input,{type:"number",min:1,max:Math.ceil(_/y),value:v,onChange:e=>{let a=parseInt(e.target.value);a>=1&&a<=Math.ceil(_/y)&&eA(a)},className:"w-16 text-center","data-testid":"input-page-number"}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["of ",Math.ceil(_/y)]})]}),(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eA(v+1),disabled:v>=Math.ceil(_/y),"data-testid":"button-next-page",children:"Next"}),(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eA(Math.ceil(_/y)),disabled:v>=Math.ceil(_/y),"data-testid":"button-last-page",children:"Last"})]})]})]})})]})]}),(0,a.jsx)(eS.TabsContent,{value:"scam-reports",className:"space-y-4",children:(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Scam Reports (",es,")"]})}),(0,a.jsx)(Z.CardContent,{children:X?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-16"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Broker"}),(0,a.jsx)(ee.TableHead,{children:"Reporter"}),(0,a.jsx)(ee.TableHead,{children:"Severity"}),(0,a.jsx)(ee.TableHead,{children:"Report"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Date"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:ea.length>0?ea.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`row-scam-report-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:e.brokerName}),(0,a.jsx)(ee.TableCell,{children:e.username}),(0,a.jsx)(ee.TableCell,{children:e.scamSeverity?(0,a.jsx)(ey.Badge,{variant:"critical"===e.scamSeverity||"high"===e.scamSeverity?"destructive":"medium"===e.scamSeverity?"default":"secondary",children:e.scamSeverity}):"-"}),(0,a.jsx)(ee.TableCell,{className:"max-w-xs truncate",children:e.reviewTitle}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"approved"===e.status?"default":"secondary",children:e.status})}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.datePosted),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>I(e.id),"data-testid":`button-view-report-${e.id}`,children:(0,a.jsx)(eO.Eye,{className:"h-4 w-4"})}),"pending"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eb.mutate({reportId:e.id,resolution:"confirmed"}),disabled:eb.isPending,"data-testid":`button-confirm-scam-${e.id}`,children:"Confirm"}),(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eb.mutate({reportId:e.id,resolution:"dismissed"}),disabled:eb.isPending,"data-testid":`button-dismiss-scam-${e.id}`,children:"Dismiss"})]})]})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No scam reports found"})})})]})})})]})}),(0,a.jsx)(eS.TabsContent,{value:"reviews",className:"space-y-4",children:(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Broker Reviews (",ed,")"]})}),(0,a.jsx)(Z.CardContent,{children:el?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-16"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Broker"}),(0,a.jsx)(ee.TableHead,{children:"Reviewer"}),(0,a.jsx)(ee.TableHead,{children:"Rating"}),(0,a.jsx)(ee.TableHead,{children:"Review"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Date"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:en.length>0?en.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`row-review-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:e.brokerName}),(0,a.jsx)(ee.TableCell,{children:e.username}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(e5.Star,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),(0,a.jsx)("span",{children:e.rating})]})}),(0,a.jsx)(ee.TableCell,{className:"max-w-xs truncate",children:e.reviewTitle}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"approved"===e.status?"default":"secondary",children:e.status})}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.datePosted),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>q(e.id),"data-testid":`button-view-review-${e.id}`,children:(0,a.jsx)(eO.Eye,{className:"h-4 w-4"})}),"pending"===e.status&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eC.mutate(e.id),disabled:eC.isPending,"data-testid":`button-approve-review-${e.id}`,children:"Approve"})})]})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No reviews found"})})})]})})})]})})]}),(0,a.jsx)(ew.Dialog,{open:L,onOpenChange:P,children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"modal-add-broker",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Add New Broker"}),(0,a.jsx)(ew.DialogDescription,{children:"Add a new broker to the directory"})]}),(0,a.jsx)(e4.Form,{...ec,children:(0,a.jsxs)("form",{onSubmit:ec.handleSubmit(e=>{eh.mutate(e)}),className:"space-y-4",children:[(0,a.jsx)(e4.FormField,{control:ec.control,name:"name",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Broker Name *"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{...e,"data-testid":"input-broker-name"})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:ec.control,name:"country",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Country"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{...e,"data-testid":"input-country"})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:ec.control,name:"regulation",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Regulation"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{...e,placeholder:"e.g., FCA, ASIC","data-testid":"input-regulation"})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:ec.control,name:"websiteUrl",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Website URL"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{...e,type:"url",placeholder:"https://...","data-testid":"input-website"})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>P(!1),children:"Cancel"}),(0,a.jsx)(x.Button,{type:"submit",disabled:eh.isPending,"data-testid":"button-submit-add-broker",children:"Add Broker"})]})]})})]})}),(0,a.jsx)(ew.Dialog,{open:!!f,onOpenChange:()=>N(null),children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"modal-view-broker",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Broker Details"})}),eF&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),(0,a.jsx)("div",{className:"text-lg font-semibold",children:eF.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Country"}),(0,a.jsx)("div",{children:eF.country||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Regulation"}),(0,a.jsx)("div",{children:eF.regulation||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,a.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,a.jsx)(ey.Badge,{variant:eF.isVerified?"default":"secondary",children:eF.isVerified?"Verified":"Unverified"}),eF.scamWarning&&(0,a.jsx)(ey.Badge,{variant:"destructive",children:"Scam Warning"}),(0,a.jsx)(ey.Badge,{children:eF.status})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Reviews & Rating"}),(0,a.jsxs)("div",{children:[eF.reviewCount," reviews â¢ ",eF.overallRating,"/5 rating"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Scam Reports"}),(0,a.jsx)("div",{children:eF.scamReportCount})]})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{variant:"outline",onClick:()=>N(null),children:"Close"})})]})}),(0,a.jsx)(ew.Dialog,{open:!!T,onOpenChange:()=>w(null),children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"modal-edit-broker",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Edit Broker"})}),(0,a.jsx)(e4.Form,{...eo,children:(0,a.jsxs)("form",{onSubmit:eo.handleSubmit(e=>{eu.mutate(e)}),className:"space-y-4",children:[(0,a.jsx)(e4.FormField,{control:eo.control,name:"name",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Broker Name *"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{...e})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:eo.control,name:"country",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Country"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{...e})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:eo.control,name:"regulation",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Regulation"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{...e})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>w(null),children:"Cancel"}),(0,a.jsx)(x.Button,{type:"submit",disabled:eu.isPending,children:"Save Changes"})]})]})})]})}),(0,a.jsx)(ew.Dialog,{open:!!S,onOpenChange:()=>{k(null),K(!1)},children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"modal-delete-broker",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Delete Broker"}),(0,a.jsx)(ew.DialogDescription,{children:"This will soft-delete the broker. Reviews will be preserved for audit trail."})]}),eF&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,a.jsx)("div",{className:"font-medium",children:eF.name}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[eF.reviewCount," reviews"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eE.Checkbox,{id:"delete-confirm",checked:M,onCheckedChange:e=>K(e),"data-testid":"checkbox-delete-confirm"}),(0,a.jsx)("label",{htmlFor:"delete-confirm",className:"text-sm font-medium cursor-pointer",children:"Yes, I want to delete this broker"})]})]}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{variant:"outline",onClick:()=>{k(null),K(!1)},children:"Cancel"}),(0,a.jsx)(x.Button,{variant:"destructive",disabled:!M||ej.isPending,onClick:()=>S&&ej.mutate(S),"data-testid":"button-confirm-delete",children:"Delete Broker"})]})]})}),(0,a.jsx)(ew.Dialog,{open:!!D,onOpenChange:()=>{A(null),V(!1)},children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"modal-verify-broker",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Verify Broker"}),(0,a.jsx)(ew.DialogDescription,{children:"Mark this broker as verified after confirming they meet standards"})]}),eF&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,a.jsx)("div",{className:"font-medium",children:eF.name}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[eF.country," â¢ ",eF.regulation]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eE.Checkbox,{id:"verify-confirm",checked:E,onCheckedChange:e=>V(e),"data-testid":"checkbox-verify-confirm"}),(0,a.jsx)("label",{htmlFor:"verify-confirm",className:"text-sm font-medium cursor-pointer",children:"I've verified this broker meets our standards"})]})]}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{variant:"outline",onClick:()=>{A(null),V(!1)},children:"Cancel"}),(0,a.jsxs)(x.Button,{disabled:!E||ep.isPending,onClick:()=>D&&ep.mutate(D),"data-testid":"button-confirm-verify",children:[(0,a.jsx)(ai.ShieldCheck,{className:"h-4 w-4 mr-2"}),"Verify Broker"]})]})]})}),(0,a.jsx)(ew.Dialog,{open:!!F,onOpenChange:()=>H(null),children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"modal-scam-warning",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Scam Warning"}),(0,a.jsx)(ew.DialogDescription,{children:"Add or remove scam warning for this broker"})]}),(0,a.jsx)(e4.Form,{...ex,children:(0,a.jsxs)("form",{onSubmit:ex.handleSubmit(e=>{ev.mutate(e)}),className:"space-y-4",children:[(0,a.jsx)(e4.FormField,{control:ex.control,name:"enabled",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{className:"flex items-center justify-between rounded-lg border p-4",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(e4.FormLabel,{className:"text-base",children:"Enable Scam Warning"}),(0,a.jsx)(e4.FormDescription,{children:"Mark this broker with a scam warning"})]}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eE.Checkbox,{checked:e.value,onCheckedChange:e.onChange,"data-testid":"checkbox-enable-warning"})})]})}),(0,a.jsx)(e4.FormField,{control:ex.control,name:"severity",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Severity"}),(0,a.jsxs)(eT.Select,{onValueChange:e.onChange,defaultValue:e.value,children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eT.SelectTrigger,{"data-testid":"select-severity",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select severity"})})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"low",children:"Low"}),(0,a.jsx)(eT.SelectItem,{value:"medium",children:"Medium"}),(0,a.jsx)(eT.SelectItem,{value:"high",children:"High"}),(0,a.jsx)(eT.SelectItem,{value:"critical",children:"Critical"})]})]}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:ex.control,name:"reason",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Reason"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eN.Textarea,{...e,rows:3,"data-testid":"textarea-warning-reason"})}),(0,a.jsx)(e4.FormDescription,{children:"Optional explanation for the warning"}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>H(null),children:"Cancel"}),(0,a.jsx)(x.Button,{type:"submit",disabled:ev.isPending,children:"Save"})]})]})})]})}),(0,a.jsx)(ew.Dialog,{open:!!R,onOpenChange:()=>I(null),children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-2xl","data-testid":"modal-view-scam-report",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Scam Report Details"})}),eH&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Broker"}),(0,a.jsx)("div",{className:"font-semibold",children:eH.brokerName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Reporter"}),(0,a.jsx)("div",{children:eH.username})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Severity"}),(0,a.jsx)(ey.Badge,{variant:"critical"===eH.scamSeverity||"high"===eH.scamSeverity?"destructive":"default",children:eH.scamSeverity||"Not specified"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Title"}),(0,a.jsx)("div",{children:eH.reviewTitle})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Report"}),(0,a.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:eH.reviewBody})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,a.jsx)(ey.Badge,{children:eH.status})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Submitted"}),(0,a.jsx)("div",{children:(0,er.formatDistanceToNow)(new Date(eH.datePosted),{addSuffix:!0})})]})]}),(0,a.jsxs)(ew.DialogFooter,{children:[eH?.status==="pending"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.Button,{variant:"outline",onClick:()=>R&&eb.mutate({reportId:R,resolution:"dismissed"}),disabled:eb.isPending,"data-testid":"button-dismiss-report",children:"Dismiss Report"}),(0,a.jsx)(x.Button,{onClick:()=>R&&eb.mutate({reportId:R,resolution:"confirmed"}),disabled:eb.isPending,"data-testid":"button-confirm-report",children:"Confirm Scam"})]}),eH?.status!=="pending"&&(0,a.jsx)(x.Button,{variant:"outline",onClick:()=>I(null),children:"Close"})]})]})}),(0,a.jsx)(ew.Dialog,{open:!!B,onOpenChange:()=>q(null),children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-2xl","data-testid":"modal-view-review",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Review Details"})}),eR&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Broker"}),(0,a.jsx)("div",{className:"font-semibold",children:eR.brokerName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Reviewer"}),(0,a.jsx)("div",{children:eR.username})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Rating"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(e5.Star,{className:`h-4 w-4 ${s<eR.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},s)),(0,a.jsxs)("span",{className:"ml-2",children:[eR.rating,"/5"]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Title"}),(0,a.jsx)("div",{children:eR.reviewTitle})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Review"}),(0,a.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:eR.reviewBody})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,a.jsx)(ey.Badge,{children:eR.status})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Submitted"}),(0,a.jsx)("div",{children:(0,er.formatDistanceToNow)(new Date(eR.datePosted),{addSuffix:!0})})]}),"pending"===eR.status&&(0,a.jsx)(e4.Form,{...em,children:(0,a.jsxs)("form",{onSubmit:em.handleSubmit(e=>{eD.mutate(e)}),className:"space-y-4 pt-4 border-t",children:[(0,a.jsx)(e4.FormField,{control:em.control,name:"reason",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Rejection Reason (if rejecting)"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eN.Textarea,{...e,rows:3,placeholder:"Explain why this review is being rejected...","data-testid":"textarea-reject-reason"})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>eR&&eC.mutate(eR.id),disabled:eC.isPending,"data-testid":"button-approve-review",children:"Approve"}),(0,a.jsx)(x.Button,{type:"submit",variant:"destructive",disabled:eD.isPending,"data-testid":"button-reject-review",children:"Reject"})]})]})})]}),eR?.status!=="pending"&&(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{variant:"outline",onClick:()=>q(null),children:"Close"})})]})})]})}var ax=e.i(635408);let am=(0,n.default)("CircleArrowDown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]),ah=(0,n.default)("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);var au=e.i(174886),aj=e.i(521416),ap=e.i(435684);function ag(e,a){let s=e.getFullYear()-a.getFullYear()||e.getMonth()-a.getMonth()||e.getDate()-a.getDate()||e.getHours()-a.getHours()||e.getMinutes()-a.getMinutes()||e.getSeconds()-a.getSeconds()||e.getMilliseconds()-a.getMilliseconds();return s<0?-1:s>0?1:s}let av={coinPurchases:"hsl(var(--primary))",subscriptions:"hsl(142, 76%, 36%)",marketplace:"hsl(262, 83%, 58%)",other:"hsl(var(--muted))"},ab=e1.z.object({adminNotes:e1.z.string().optional(),verified:e1.z.boolean().refine(e=>!0===e,{message:"You must verify all conditions before approving"})}),ay=e1.z.object({reason:e1.z.enum(["insufficient_balance","invalid_wallet","suspicious_activity","verification_required","other"]),detailedReason:e1.z.string().min(10,"Please provide a detailed reason (minimum 10 characters)"),notifyUser:e1.z.boolean().default(!0)}),aC=e1.z.object({transactionId:e1.z.string().min(1,"Transaction ID is required"),notes:e1.z.string().optional(),confirmed:e1.z.boolean().refine(e=>!0===e,{message:"You must confirm payment has been sent"})}),af=e1.z.object({dateFrom:e1.z.string().optional(),dateTo:e1.z.string().optional(),types:e1.z.array(e1.z.string()).min(1,"Select at least one transaction type"),format:e1.z.enum(["csv"]).default("csv"),includeNotes:e1.z.boolean().default(!1)});function aN(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function aT(e){switch(e?.toLowerCase()){case"completed":return"default";case"pending":return"secondary";case"failed":return"destructive";default:return"outline"}}function aw(e){switch(e?.toLowerCase()){case"coin purchase":return"default";case"subscription":return"secondary";case"marketplace":default:return"outline";case"withdrawal":return"destructive"}}function aS(){var e;let[s,t]=(0,i.useState)("30d"),{toast:l}=(0,ek.useToast)(),[r,n]=(0,i.useState)(null),[d,c]=(0,i.useState)(null),[o,h]=(0,i.useState)(null),[u,p]=(0,i.useState)(null),[g,v]=(0,i.useState)(null),[b,y]=(0,i.useState)(!1),{data:C,isLoading:f}=(0,J.useQuery)({queryKey:["/api/admin/finance/overview",s]}),N=C??{totalRevenue:0,revenueGrowth:0,pendingWithdrawals:0,pendingWithdrawalCount:0,totalTransactions:0,transactionsToday:0},{data:T,isLoading:w}=(0,J.useQuery)({queryKey:["/api/admin/finance/transactions/recent",{limit:20,period:s}]}),S=Array.isArray(T)?T:[],{data:k,isLoading:D}=(0,J.useQuery)({queryKey:["/api/admin/finance/withdrawals/pending"]}),A=Array.isArray(k)?k:[],{data:F,isLoading:H}=(0,J.useQuery)({queryKey:["/api/admin/finance/revenue/trend",{period:s}]}),R=Array.isArray(F)?F:[],{data:I,isLoading:B}=(0,J.useQuery)({queryKey:["/api/admin/finance/revenue/by-source",{period:s}]}),P=Array.isArray(I)?I:[],{data:M}=(0,J.useQuery)({queryKey:["/api/admin/finance/withdrawals",u||r||d||o],enabled:!!(u||r||d||o),queryFn:async()=>{let e=u||r||d||o,a=A.find(a=>a.id===e);if(a)return a;let s=await fetch(`/api/admin/finance/withdrawals/${e}`);if(!s.ok)throw Error("Failed to fetch withdrawal");return s.json()}}),{data:K}=(0,J.useQuery)({queryKey:["/api/admin/finance/transactions",g],enabled:!!g,queryFn:async()=>{let e=S.find(e=>e.id===g);if(e)return e;let a=await fetch(`/api/admin/finance/transactions/${g}`);if(!a.ok)throw Error("Failed to fetch transaction");return a.json()}}),E=(0,e0.useForm)({resolver:(0,e2.zodResolver)(ab),defaultValues:{adminNotes:"",verified:!1}}),V=(0,e0.useForm)({resolver:(0,e2.zodResolver)(ay),defaultValues:{reason:"other",detailedReason:"",notifyUser:!0}}),$=(0,e0.useForm)({resolver:(0,e2.zodResolver)(aC),defaultValues:{transactionId:"",notes:"",confirmed:!1}}),Q=(0,e0.useForm)({resolver:(0,e2.zodResolver)(af),defaultValues:{types:[],format:"csv",includeNotes:!1}}),O=(0,ef.useMutation)({mutationFn:async e=>{if(!r)throw Error("No withdrawal selected");return(0,eM.apiRequest)("POST",`/api/admin/finance/withdrawals/${r}/approve`,e)},onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/finance"]}),n(null),E.reset(),l({title:"Withdrawal approved successfully"})},onError:()=>{l({title:"Failed to approve withdrawal",variant:"destructive"})}}),z=(0,ef.useMutation)({mutationFn:async e=>{if(!d)throw Error("No withdrawal selected");return(0,eM.apiRequest)("POST",`/api/admin/finance/withdrawals/${d}/reject`,e)},onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/finance"]}),c(null),V.reset(),l({title:"Withdrawal rejected successfully"})},onError:()=>{l({title:"Failed to reject withdrawal",variant:"destructive"})}}),W=(0,ef.useMutation)({mutationFn:async e=>{if(!o)throw Error("No withdrawal selected");return(0,eM.apiRequest)("POST",`/api/admin/finance/withdrawals/${o}/complete`,e)},onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/finance"]}),h(null),$.reset(),l({title:"Withdrawal marked as completed"})},onError:()=>{l({title:"Failed to complete withdrawal",variant:"destructive"})}}),G=(0,ef.useMutation)({mutationFn:async e=>{let a=new URLSearchParams;e.dateFrom&&a.set("dateFrom",e.dateFrom),e.dateTo&&a.set("dateTo",e.dateTo),e.types.forEach(e=>a.append("types",e)),a.set("format",e.format),a.set("includeNotes",e.includeNotes.toString());let s=await fetch(`/api/admin/finance/transactions/export?${a.toString()}`);if(!s.ok)throw Error("Export failed");let t=await s.blob(),i=window.URL.createObjectURL(t),l=document.createElement("a");l.href=i,l.download=`transactions-${(0,eP.format)(new Date,"yyyy-MM-dd")}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(i)},onSuccess:()=>{y(!1),Q.reset(),l({title:"Transactions exported successfully"})},onError:()=>{l({title:"Failed to export transactions",variant:"destructive"})}});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold","data-testid":"title-finance-management",children:"Finance Management"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(eT.Select,{value:s,onValueChange:t,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-48","data-testid":"select-period-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select period"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"today",children:"Today"}),(0,a.jsx)(eT.SelectItem,{value:"7d",children:"Last 7 Days"}),(0,a.jsx)(eT.SelectItem,{value:"30d",children:"Last 30 Days"}),(0,a.jsx)(eT.SelectItem,{value:"90d",children:"Last 90 Days"}),(0,a.jsx)(eT.SelectItem,{value:"year",children:"This Year"}),(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Time"})]})]}),(0,a.jsxs)(x.Button,{variant:"outline",onClick:()=>y(!0),"data-testid":"button-export-transactions",children:[(0,a.jsx)(eI.Download,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-total-revenue",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Revenue"}),(0,a.jsx)(q.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:f?(0,a.jsx)(j.Skeleton,{className:"h-8 w-24"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-finance-revenue",children:aN(N.totalRevenue)}),(0,a.jsxs)("p",{className:`text-xs flex items-center gap-1 ${N.revenueGrowth>=0?"text-green-600":"text-red-600"}`,children:[N.revenueGrowth>=0?(0,a.jsx)(L.TrendingUp,{className:"h-3 w-3"}):(0,a.jsx)(ax.TrendingDown,{className:"h-3 w-3"}),N.revenueGrowth>=0?"+":"",N.revenueGrowth,"% vs last period"]})]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-pending-withdrawals",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Pending Withdrawals"}),(0,a.jsx)(am,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:f?(0,a.jsx)(j.Skeleton,{className:"h-8 w-24"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:`text-2xl font-bold ${N.pendingWithdrawalCount>0?"text-orange-600":""}`,"data-testid":"text-pending-withdrawals",children:aN(N.pendingWithdrawals)}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[N.pendingWithdrawalCount," ",1===N.pendingWithdrawalCount?"request":"requests"]})]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-total-transactions",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Transactions"}),(0,a.jsx)(ah,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:f?(0,a.jsx)(j.Skeleton,{className:"h-8 w-24"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-transactions",children:(e=N.totalTransactions,new Intl.NumberFormat("en-US").format(e))}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[N.transactionsToday," today"]})]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-top-earner",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Top Earner"}),(0,a.jsx)(U.Trophy,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:f?(0,a.jsx)(j.Skeleton,{className:"h-8 w-24"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[N.topEarner?.avatarUrl&&(0,a.jsxs)(eJ.Avatar,{className:"h-6 w-6",children:[(0,a.jsx)(eJ.AvatarImage,{src:N.topEarner.avatarUrl}),(0,a.jsx)(eJ.AvatarFallback,{children:N.topEarner.username?.[0]?.toUpperCase()})]}),(0,a.jsx)("div",{className:"text-lg font-bold truncate",children:N.topEarner?.username||"N/A"})]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[aN(N.topEarner?.earnings||0)," earned"]})]})})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-revenue-trend",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Revenue Trend"})}),(0,a.jsx)(Z.CardContent,{children:H?(0,a.jsx)(j.Skeleton,{className:"h-64"}):R.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(en.LineChart,{data:R,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"date"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{formatter:e=>aN(Number(e))}),(0,a.jsx)(ed.Line,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3}})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No revenue data available"})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-revenue-by-source",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Revenue by Source"})}),(0,a.jsx)(Z.CardContent,{children:B?(0,a.jsx)(j.Skeleton,{className:"h-64"}):P.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ex.PieChart,{children:[(0,a.jsx)(em.Pie,{data:P,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:60,label:e=>`${e.name}: ${aN(e.value)}`,children:P.map((e,s)=>{let t=e.name.toLowerCase().replace(/\s+/g,"");return(0,a.jsx)(eh.Cell,{fill:av[t]||av.other},`cell-${s}`)})}),(0,a.jsx)(eg.Tooltip,{formatter:e=>aN(Number(e))}),(0,a.jsx)(eb.Legend,{})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No source data available"})})]})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Pending Withdrawals (",A.length,")"]})}),(0,a.jsx)(Z.CardContent,{children:D?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-16"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"User"}),(0,a.jsx)(ee.TableHead,{children:"Amount"}),(0,a.jsx)(ee.TableHead,{children:"Method"}),(0,a.jsx)(ee.TableHead,{children:"Wallet"}),(0,a.jsx)(ee.TableHead,{children:"Requested"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:A.length>0?A.map(e=>{var s,t;let i,r,d,o,m,h,u=(s=new Date,t=new Date(e.createdAt),i=(0,ap.toDate)(s),d=ag(i,r=(0,ap.toDate)(t)),o=Math.abs((0,aj.differenceInCalendarDays)(i,r)),i.setDate(i.getDate()-d*o),m=Number(ag(i,r)===-d),0==(h=d*(o-m))?0:h);return(0,a.jsxs)(ee.TableRow,{"data-testid":`withdrawal-row-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(eJ.Avatar,{className:"h-8 w-8",children:[(0,a.jsx)(eJ.AvatarImage,{src:e.avatarUrl}),(0,a.jsx)(eJ.AvatarFallback,{children:e.username?.[0]?.toUpperCase()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.username}),u>7&&(0,a.jsxs)(ey.Badge,{variant:"destructive",className:"text-xs mt-1",children:[(0,a.jsx)(ez.AlertTriangle,{className:"h-3 w-3 mr-1"}),"Urgent"]})]})]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)("span",{className:"font-bold","data-testid":`withdrawal-amount-${e.id}`,children:aN(e.amount)})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"outline",children:e.method||"USDT"})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2 max-w-xs",children:[(0,a.jsx)("span",{className:"truncate",children:e.walletAddress||"N/A"}),e.walletAddress&&(0,a.jsx)(x.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>{var a;return a=e.walletAddress,void(navigator.clipboard.writeText(a),l({title:"Copied to clipboard"}))},children:(0,a.jsx)(au.Copy,{className:"h-3 w-3"})})]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm",children:(0,eP.format)(new Date(e.createdAt),"MMM dd, yyyy HH:mm")}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsxs)(x.Button,{size:"sm",variant:"outline",className:"bg-green-50 hover:bg-green-100 text-green-700 border-green-200",onClick:()=>n(e.id),"data-testid":`approve-withdrawal-${e.id}`,children:[(0,a.jsx)(eU.CheckCircle,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,a.jsxs)(x.Button,{size:"sm",variant:"outline",className:"bg-red-50 hover:bg-red-100 text-red-700 border-red-200",onClick:()=>c(e.id),"data-testid":`reject-withdrawal-${e.id}`,children:[(0,a.jsx)(eQ,{className:"h-4 w-4 mr-1"}),"Reject"]}),(0,a.jsx)(x.Button,{size:"sm",variant:"ghost",onClick:()=>p(e.id),"data-testid":`view-withdrawal-${e.id}`,children:(0,a.jsx)(eO.Eye,{className:"h-4 w-4"})})]})})]},e.id)}):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No pending withdrawals"})})})]})})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between",children:(0,a.jsxs)(Z.CardTitle,{children:["Recent Transactions (",S.length,")"]})}),(0,a.jsx)(Z.CardContent,{children:w?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-16"},s))}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"User"}),(0,a.jsx)(ee.TableHead,{children:"Type"}),(0,a.jsx)(ee.TableHead,{children:"Amount"}),(0,a.jsx)(ee.TableHead,{children:"Method"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Date"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:S.length>0?S.map(e=>{let s=["coin purchase","subscription","marketplace"].includes(e.type?.toLowerCase()||"");return(0,a.jsxs)(ee.TableRow,{"data-testid":`transaction-row-${e.id}`,className:"cursor-pointer hover:bg-muted/50",onClick:()=>v(e.id),children:[(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(eJ.Avatar,{className:"h-8 w-8",children:[(0,a.jsx)(eJ.AvatarImage,{src:e.avatarUrl}),(0,a.jsx)(eJ.AvatarFallback,{children:e.username?.[0]?.toUpperCase()})]}),(0,a.jsx)("span",{className:"font-medium",children:e.username})]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:aw(e.type),children:e.type||"Unknown"})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("span",{className:`font-semibold ${s?"text-green-600":"text-red-600"}`,"data-testid":`transaction-amount-${e.id}`,children:[s?"+":"-",aN(e.amount)]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)("span",{className:"text-sm",children:e.method||"N/A"})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:aT(e.status||"pending"),children:e.status||"Pending"})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)("div",{className:"text-sm",children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"ghost",onClick:a=>{a.stopPropagation(),v(e.id)},"data-testid":`view-transaction-${e.id}`,children:(0,a.jsx)(eO.Eye,{className:"h-4 w-4"})})})]},e.id)}):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No recent transactions"})})})]})}),S.length>0&&(0,a.jsx)("div",{className:"mt-4 flex justify-center",children:(0,a.jsx)(x.Button,{variant:"outline",children:"View All Transactions"})})]})})]}),(0,a.jsx)(ew.Dialog,{open:!!r,onOpenChange:e=>!e&&n(null),children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-2xl",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Approve Withdrawal Request"}),(0,a.jsx)(ew.DialogDescription,{children:"Review and approve this withdrawal request"})]}),M&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[(0,a.jsxs)(eJ.Avatar,{className:"h-12 w-12",children:[(0,a.jsx)(eJ.AvatarImage,{src:M.avatarUrl}),(0,a.jsx)(eJ.AvatarFallback,{children:M.username?.[0]?.toUpperCase()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:M.username}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Current Balance: ",aN(M.userBalance||0)]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Amount Requested"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:aN(M.amount)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Method"}),(0,a.jsx)("div",{className:"text-lg font-semibold",children:M.method||"USDT"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Wallet Address"}),(0,a.jsx)("div",{className:"font-mono text-sm break-all",children:M.walletAddress||"N/A"})]})]}),(0,a.jsx)(e4.Form,{...E,children:(0,a.jsxs)("form",{onSubmit:E.handleSubmit(e=>O.mutate(e)),className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2 p-4 bg-green-50 dark:bg-green-950 rounded-lg",children:[(0,a.jsx)("div",{className:"font-medium mb-2",children:"Verification Checklist:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(eU.CheckCircle,{className:"h-4 w-4 text-green-600"}),(0,a.jsx)("span",{children:"User has sufficient balance"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(eU.CheckCircle,{className:"h-4 w-4 text-green-600"}),(0,a.jsx)("span",{children:"Wallet address is valid"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(eU.CheckCircle,{className:"h-4 w-4 text-green-600"}),(0,a.jsx)("span",{children:"No suspicious activity detected"})]})]}),(0,a.jsx)(e4.FormField,{control:E.control,name:"adminNotes",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Admin Notes (Optional)"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eN.Textarea,{...e,placeholder:"Add any internal notes..."})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:E.control,name:"verified",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eE.Checkbox,{checked:e.value,onCheckedChange:e.onChange})}),(0,a.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,a.jsx)(e4.FormLabel,{children:"I confirm all verification checks have been completed"}),(0,a.jsx)(e4.FormMessage,{})]})]})}),(0,a.jsx)("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-950 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(ez.AlertTriangle,{className:"h-5 w-5 text-yellow-600 flex-shrink-0"}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("strong",{children:"Warning:"})," Amount will be deducted from user's balance immediately upon approval."]})]})}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>n(null),children:"Cancel"}),(0,a.jsx)(x.Button,{type:"submit",className:"bg-green-600 hover:bg-green-700",disabled:O.isPending,children:O.isPending?"Processing...":"Approve & Process"})]})]})})]})]})}),(0,a.jsx)(ew.Dialog,{open:!!d,onOpenChange:e=>!e&&c(null),children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-2xl",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Reject Withdrawal Request"}),(0,a.jsx)(ew.DialogDescription,{children:"Provide a reason for rejecting this withdrawal request"})]}),M&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[(0,a.jsxs)(eJ.Avatar,{className:"h-12 w-12",children:[(0,a.jsx)(eJ.AvatarImage,{src:M.avatarUrl}),(0,a.jsx)(eJ.AvatarFallback,{children:M.username?.[0]?.toUpperCase()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:M.username}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Requested: ",aN(M.amount)]})]})]}),(0,a.jsx)(e4.Form,{...V,children:(0,a.jsxs)("form",{onSubmit:V.handleSubmit(e=>z.mutate(e)),className:"space-y-4",children:[(0,a.jsx)(e4.FormField,{control:V.control,name:"reason",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Rejection Reason"}),(0,a.jsxs)(eT.Select,{onValueChange:e.onChange,defaultValue:e.value,children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eT.SelectTrigger,{children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select a reason"})})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"insufficient_balance",children:"Insufficient Balance"}),(0,a.jsx)(eT.SelectItem,{value:"invalid_wallet",children:"Invalid Wallet Details"}),(0,a.jsx)(eT.SelectItem,{value:"suspicious_activity",children:"Suspicious Activity"}),(0,a.jsx)(eT.SelectItem,{value:"verification_required",children:"Verification Required"}),(0,a.jsx)(eT.SelectItem,{value:"other",children:"Other"})]})]}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:V.control,name:"detailedReason",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Detailed Reason (shown to user)"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eN.Textarea,{...e,placeholder:"Provide a clear explanation that will be shown to the user...",rows:4})}),(0,a.jsx)(e4.FormDescription,{children:"This message will be sent to the user, so please be clear and professional."}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:V.control,name:"notifyUser",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eE.Checkbox,{checked:e.value,onCheckedChange:e.onChange})}),(0,a.jsx)("div",{className:"space-y-1 leading-none",children:(0,a.jsx)(e4.FormLabel,{children:"Notify user by email"})})]})}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>c(null),children:"Cancel"}),(0,a.jsx)(x.Button,{type:"submit",variant:"destructive",disabled:z.isPending,children:z.isPending?"Processing...":"Reject Request"})]})]})})]})]})}),(0,a.jsx)(ew.Dialog,{open:!!o,onOpenChange:e=>!e&&h(null),children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-2xl",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Mark Withdrawal as Completed"}),(0,a.jsx)(ew.DialogDescription,{children:"Confirm that payment has been successfully sent"})]}),M&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"User:"}),(0,a.jsx)("span",{className:"font-medium",children:M.username})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Amount:"}),(0,a.jsx)("span",{className:"font-bold",children:aN(M.amount)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Method:"}),(0,a.jsx)("span",{children:M.method||"USDT"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Wallet:"}),(0,a.jsx)("span",{className:"font-mono text-xs",children:M.walletAddress})]})]}),(0,a.jsx)(e4.Form,{...$,children:(0,a.jsxs)("form",{onSubmit:$.handleSubmit(e=>W.mutate(e)),className:"space-y-4",children:[(0,a.jsx)(e4.FormField,{control:$.control,name:"transactionId",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Transaction ID / Payment Reference *"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{...e,placeholder:"Enter transaction ID or payment reference"})}),(0,a.jsx)(e4.FormDescription,{children:"The transaction hash or payment reference from the payment gateway"}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:$.control,name:"notes",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Additional Notes (Optional)"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eN.Textarea,{...e,placeholder:"Add any additional information..."})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:$.control,name:"confirmed",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eE.Checkbox,{checked:e.value,onCheckedChange:e.onChange})}),(0,a.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,a.jsx)(e4.FormLabel,{children:"I confirm that payment has been sent successfully"}),(0,a.jsx)(e4.FormMessage,{})]})]})}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>h(null),children:"Cancel"}),(0,a.jsx)(x.Button,{type:"submit",className:"bg-green-600 hover:bg-green-700",disabled:W.isPending,children:W.isPending?"Processing...":"Mark as Completed"})]})]})})]})]})}),(0,a.jsx)(ew.Dialog,{open:!!g,onOpenChange:e=>!e&&v(null),children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-3xl",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Transaction Details"}),(0,a.jsx)(ew.DialogDescription,{children:"Complete information about this transaction"})]}),K&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"col-span-2 p-4 bg-muted/50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Transaction ID"}),(0,a.jsx)("div",{className:"font-mono text-sm",children:K.id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Type"}),(0,a.jsx)(ey.Badge,{variant:aw(K.type),className:"mt-1",children:K.type})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Status"}),(0,a.jsx)(ey.Badge,{variant:aT(K.status||"pending"),className:"mt-1",children:K.status||"Pending"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Amount"}),(0,a.jsx)("div",{className:"text-xl font-bold",children:aN(K.amount)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Payment Method"}),(0,a.jsx)("div",{className:"font-medium",children:K.method||"N/A"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"User"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsxs)(eJ.Avatar,{className:"h-8 w-8",children:[(0,a.jsx)(eJ.AvatarImage,{src:K.avatarUrl}),(0,a.jsx)(eJ.AvatarFallback,{children:K.username?.[0]?.toUpperCase()})]}),(0,a.jsx)("span",{className:"font-medium",children:K.username})]})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Date & Time"}),(0,a.jsx)("div",{children:(0,eP.format)(new Date(K.createdAt),"PPpp")}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,er.formatDistanceToNow)(new Date(K.createdAt),{addSuffix:!0})})]}),K.description&&(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Description"}),(0,a.jsx)("div",{className:"text-sm",children:K.description})]})]}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsxs)(x.Button,{variant:"outline",onClick:()=>{l({title:"Receipt download feature coming soon"})},children:[(0,a.jsx)(eI.Download,{className:"h-4 w-4 mr-2"}),"Download Receipt"]}),(0,a.jsx)(x.Button,{onClick:()=>v(null),children:"Close"})]})]})]})}),(0,a.jsx)(ew.Dialog,{open:b,onOpenChange:y,children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-2xl",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Export Transactions"}),(0,a.jsx)(ew.DialogDescription,{children:"Select filters and export transactions to CSV"})]}),(0,a.jsx)(e4.Form,{...Q,children:(0,a.jsxs)("form",{onSubmit:Q.handleSubmit(e=>G.mutate(e)),className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(e4.FormField,{control:Q.control,name:"dateFrom",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"From Date"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{type:"date",...e})}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:Q.control,name:"dateTo",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"To Date"}),(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(m.Input,{type:"date",...e})}),(0,a.jsx)(e4.FormMessage,{})]})})]}),(0,a.jsx)(e4.FormField,{control:Q.control,name:"types",render:()=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Transaction Types"}),(0,a.jsx)("div",{className:"space-y-2",children:["Coin Purchases","Subscriptions","Marketplace","Withdrawals"].map(e=>(0,a.jsx)(e4.FormField,{control:Q.control,name:"types",render:({field:s})=>(0,a.jsxs)(e4.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eE.Checkbox,{checked:s.value?.includes(e),onCheckedChange:a=>a?s.onChange([...s.value,e]):s.onChange(s.value?.filter(a=>a!==e))})}),(0,a.jsx)(e4.FormLabel,{className:"font-normal",children:e})]})},e))}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:Q.control,name:"format",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{children:[(0,a.jsx)(e4.FormLabel,{children:"Export Format"}),(0,a.jsxs)(eT.Select,{onValueChange:e.onChange,defaultValue:e.value,children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eT.SelectTrigger,{children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select format"})})}),(0,a.jsx)(eT.SelectContent,{children:(0,a.jsx)(eT.SelectItem,{value:"csv",children:"CSV"})})]}),(0,a.jsx)(e4.FormMessage,{})]})}),(0,a.jsx)(e4.FormField,{control:Q.control,name:"includeNotes",render:({field:e})=>(0,a.jsxs)(e4.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,a.jsx)(e4.FormControl,{children:(0,a.jsx)(eE.Checkbox,{checked:e.value,onCheckedChange:e.onChange})}),(0,a.jsx)("div",{className:"space-y-1 leading-none",children:(0,a.jsx)(e4.FormLabel,{children:"Include detailed notes"})})]})}),(0,a.jsxs)(ew.DialogFooter,{children:[(0,a.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancel"}),(0,a.jsx)(x.Button,{type:"submit",disabled:G.isPending,"data-testid":"button-export-submit",children:G.isPending?"Exporting...":"Export"})]})]})})]})}),(0,a.jsx)(ew.Dialog,{open:!!u,onOpenChange:e=>!e&&p(null),children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-2xl",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Withdrawal Details"})}),M&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"User"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsxs)(eJ.Avatar,{className:"h-10 w-10",children:[(0,a.jsx)(eJ.AvatarImage,{src:M.avatarUrl}),(0,a.jsx)(eJ.AvatarFallback,{children:M.username?.[0]?.toUpperCase()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:M.username}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Balance: ",aN(M.userBalance||0)]})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Amount"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:aN(M.amount)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Method"}),(0,a.jsx)("div",{className:"font-medium",children:M.method||"USDT"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Wallet Address"}),(0,a.jsx)("div",{className:"font-mono text-sm break-all bg-muted/50 p-2 rounded",children:M.walletAddress||"N/A"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Requested"}),(0,a.jsx)("div",{children:(0,eP.format)(new Date(M.createdAt),"PPpp")}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,er.formatDistanceToNow)(new Date(M.createdAt),{addSuffix:!0})})]})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{onClick:()=>p(null),children:"Close"})})]})]})})]})}var ak=e.i(101725),aD=e.i(400237);let aA=["hsl(var(--primary))","hsl(var(--secondary))","hsl(var(--accent))","hsl(var(--muted))","#8884d8","#82ca9d","#ffc658","#ff7c7c"];function aF(){let[e,s]=(0,i.useState)("users"),{data:t,isLoading:l}=(0,J.useQuery)({queryKey:["/api/admin/analytics/users"]}),r=t||{dau:0,mau:0,newUsers:0,churnRate:0,growthData:[],countryData:[],activeInactiveData:[]},{data:n,isLoading:d}=(0,J.useQuery)({queryKey:["/api/admin/analytics/content"]}),c=n||{trendData:[],typeDistribution:[],topCreators:[],qualityScores:[]},{data:o,isLoading:x}=(0,J.useQuery)({queryKey:["/api/admin/analytics/financial"]}),m=o||{revenueTrend:[],revenueBySource:[],topEarners:[],transactionVolume:[]},{data:h,isLoading:u}=(0,J.useQuery)({queryKey:["/api/admin/analytics/engagement"]}),p=h||{avgSessionDuration:"0m",bounceRate:0,pagesPerSession:0,heatmapData:[]};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Analytics & Reports"}),(0,a.jsxs)(eS.Tabs,{value:e,onValueChange:s,"data-testid":"tabs-analytics",children:[(0,a.jsxs)(eS.TabsList,{className:"grid w-full grid-cols-4",children:[(0,a.jsx)(eS.TabsTrigger,{value:"users","data-testid":"tab-users",children:"Users"}),(0,a.jsx)(eS.TabsTrigger,{value:"content","data-testid":"tab-content",children:"Content"}),(0,a.jsx)(eS.TabsTrigger,{value:"financial","data-testid":"tab-financial",children:"Financial"}),(0,a.jsx)(eS.TabsTrigger,{value:"engagement","data-testid":"tab-engagement",children:"Engagement"})]}),(0,a.jsx)(eS.TabsContent,{value:"users",className:"space-y-4",children:l?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s))}),(0,a.jsx)(j.Skeleton,{className:"h-96"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-dau",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"DAU"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-dau",children:r.dau}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Daily Active Users"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-mau",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"MAU"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-mau",children:r.mau}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Monthly Active Users"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-new-users",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"New Users"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-new-users",children:r.newUsers}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Last 30 days"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-churn-rate",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Churn Rate"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-churn-rate",children:[r.churnRate,"%"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Monthly churn"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-user-growth",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"User Growth (Last 30 Days)"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(en.LineChart,{data:r.growthData,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"date"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eb.Legend,{}),(0,a.jsx)(ed.Line,{type:"monotone",dataKey:"users",stroke:"hsl(var(--primary))",strokeWidth:2})]})})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-users-by-country",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Users by Country (Top 10)"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ec.BarChart,{data:r.countryData,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"country"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eo.Bar,{dataKey:"users",fill:"hsl(var(--primary))"})]})})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-active-inactive",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Active vs Inactive Users"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ex.PieChart,{children:[(0,a.jsx)(em.Pie,{data:r.activeInactiveData,cx:"50%",cy:"50%",labelLine:!1,label:e=>`${e.name}: ${e.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:r.activeInactiveData.map((e,s)=>(0,a.jsx)(eh.Cell,{fill:aA[s%aA.length]},`cell-${s}`))}),(0,a.jsx)(eg.Tooltip,{})]})})})]})]})]})}),(0,a.jsx)(eS.TabsContent,{value:"content",className:"space-y-4",children:d?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(j.Skeleton,{className:"h-96"}),(0,a.jsx)(j.Skeleton,{className:"h-64"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-content-trend",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Content Creation Trend (Last 30 Days)"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(en.LineChart,{data:c.trendData,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"date"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eb.Legend,{}),(0,a.jsx)(ed.Line,{type:"monotone",dataKey:"count",stroke:"hsl(var(--primary))",strokeWidth:2})]})})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-content-type-distribution",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Content Type Distribution"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ex.PieChart,{children:[(0,a.jsx)(em.Pie,{data:c.typeDistribution,cx:"50%",cy:"50%",labelLine:!1,label:e=>`${e.name}: ${e.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:c.typeDistribution.map((e,s)=>(0,a.jsx)(eh.Cell,{fill:aA[s%aA.length]},`cell-${s}`))}),(0,a.jsx)(eg.Tooltip,{})]})})})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-top-creators",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Top Content Creators"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Rank"}),(0,a.jsx)(ee.TableHead,{children:"Creator"}),(0,a.jsx)(ee.TableHead,{children:"Posts"}),(0,a.jsx)(ee.TableHead,{children:"Views"}),(0,a.jsx)(ee.TableHead,{children:"Avg Quality"})]})}),(0,a.jsx)(ee.TableBody,{children:c.topCreators.length>0?c.topCreators.map((e,s)=>(0,a.jsxs)(ee.TableRow,{"data-testid":`creator-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{"data-testid":`creator-rank-${e.id}`,children:s+1}),(0,a.jsx)(ee.TableCell,{children:e.username}),(0,a.jsx)(ee.TableCell,{children:e.posts}),(0,a.jsx)(ee.TableCell,{children:e.views}),(0,a.jsx)(ee.TableCell,{children:e.avgQuality?.toFixed(1)||"N/A"})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No data available"})})})]})})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-quality-scores",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Quality Scores Histogram"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ec.BarChart,{data:c.qualityScores,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"score"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eo.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})})})]})]})}),(0,a.jsx)(eS.TabsContent,{value:"financial",className:"space-y-4",children:x?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(j.Skeleton,{className:"h-96"}),(0,a.jsx)(j.Skeleton,{className:"h-64"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-revenue-trend",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Revenue Trend (Last 30 Days)"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ak.AreaChart,{data:m.revenueTrend,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"date"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eb.Legend,{}),(0,a.jsx)(aD.Area,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.6})]})})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-revenue-by-source",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Revenue by Source"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ex.PieChart,{children:[(0,a.jsx)(em.Pie,{data:m.revenueBySource,cx:"50%",cy:"50%",labelLine:!1,label:e=>`${e.name}: $${e.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:m.revenueBySource.map((e,s)=>(0,a.jsx)(eh.Cell,{fill:aA[s%aA.length]},`cell-${s}`))}),(0,a.jsx)(eg.Tooltip,{})]})})})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-top-earners",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Top Earners"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Rank"}),(0,a.jsx)(ee.TableHead,{children:"User"}),(0,a.jsx)(ee.TableHead,{children:"Total Earnings"}),(0,a.jsx)(ee.TableHead,{children:"This Month"}),(0,a.jsx)(ee.TableHead,{children:"Sales"})]})}),(0,a.jsx)(ee.TableBody,{children:m.topEarners.length>0?m.topEarners.map((e,s)=>(0,a.jsxs)(ee.TableRow,{"data-testid":`earner-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{"data-testid":`earner-rank-${e.id}`,children:s+1}),(0,a.jsx)(ee.TableCell,{children:e.username}),(0,a.jsxs)(ee.TableCell,{children:["$",e.totalEarnings]}),(0,a.jsxs)(ee.TableCell,{children:["$",e.monthlyEarnings]}),(0,a.jsx)(ee.TableCell,{children:e.sales})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No data available"})})})]})})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-transaction-volume",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Transaction Volume"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ec.BarChart,{data:m.transactionVolume,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"date"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eo.Bar,{dataKey:"volume",fill:"hsl(var(--primary))"})]})})})]})]})}),(0,a.jsx)(eS.TabsContent,{value:"engagement",className:"space-y-4",children:u?(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s))})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-avg-session",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Avg Session Duration"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-session",children:p.avgSessionDuration}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Per user session"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-bounce-rate",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Bounce Rate"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-bounce-rate",children:[p.bounceRate,"%"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Single page visits"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-pages-per-session",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Pages Per Session"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-pages-per-session",children:p.pagesPerSession}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Average pages"})]})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-engagement-heatmap",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Engagement Heatmap (Hourly Activity)"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:300,children:(0,a.jsxs)(ec.BarChart,{data:p.heatmapData,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"hour"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eb.Legend,{}),(0,a.jsx)(eo.Bar,{dataKey:"activity",fill:"hsl(var(--primary))"})]})})})]})]})})]})]})}var aH=e.i(845305),aR=e.i(127876),aI=e.i(493753);function aB(){let[e,s]=(0,i.useState)("general"),[t,l]=(0,i.useState)(""),{toast:r}=(0,ek.useToast)(),{data:n,isLoading:d}=(0,J.useQuery)({queryKey:["/api/admin/settings/general"]}),c=n||{siteName:"YoForex",siteDescription:"",maintenanceMode:!1,registrationEnabled:!0},{data:o,isLoading:h}=(0,J.useQuery)({queryKey:["/api/admin/settings/coin-economy"]}),u=o||{usdToCoinsRate:100,packages:[],minWithdrawal:1e3,withdrawalFee:5},{data:p,isLoading:g}=(0,J.useQuery)({queryKey:["/api/admin/settings/email-templates",{search:t}]}),v=Array.isArray(p)?p:[],{data:b,isLoading:y}=(0,J.useQuery)({queryKey:["/api/admin/settings/feature-flags"]}),C=Array.isArray(b)?b:[],{data:f,isLoading:N}=(0,J.useQuery)({queryKey:["/api/admin/settings/admin-roles"]}),T=Array.isArray(f)?f:[],w=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("PUT","/api/admin/settings/general",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/settings/general"]}),r({title:"Settings updated successfully"})},onError:()=>{r({title:"Failed to update settings",variant:"destructive"})}});(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("PUT","/api/admin/settings/coin-economy",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/settings/coin-economy"]}),r({title:"Coin settings updated successfully"})},onError:()=>{r({title:"Failed to update coin settings",variant:"destructive"})}});let S=(0,ef.useMutation)({mutationFn:async({flagId:e,enabled:a})=>(0,eM.apiRequest)("PUT",`/api/admin/settings/feature-flags/${e}`,{enabled:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/settings/feature-flags"]}),r({title:"Feature flag updated"})},onError:()=>{r({title:"Failed to update feature flag",variant:"destructive"})}});return(0,ef.useMutation)({mutationFn:async({userId:e,role:a})=>(0,eM.apiRequest)("POST","/api/admin/settings/admin-roles/grant",{userId:e,role:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/settings/admin-roles"]}),r({title:"Admin role granted successfully"})},onError:()=>{r({title:"Failed to grant admin role",variant:"destructive"})}}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"System Settings"}),(0,a.jsxs)(eS.Tabs,{value:e,onValueChange:s,"data-testid":"tabs-settings",children:[(0,a.jsxs)(eS.TabsList,{className:"grid w-full grid-cols-5",children:[(0,a.jsx)(eS.TabsTrigger,{value:"general","data-testid":"tab-general",children:"General"}),(0,a.jsx)(eS.TabsTrigger,{value:"coin-economy","data-testid":"tab-coin-economy",children:"Coin Economy"}),(0,a.jsx)(eS.TabsTrigger,{value:"email-templates","data-testid":"tab-email-templates",children:"Email Templates"}),(0,a.jsx)(eS.TabsTrigger,{value:"feature-flags","data-testid":"tab-feature-flags",children:"Feature Flags"}),(0,a.jsx)(eS.TabsTrigger,{value:"admin-roles","data-testid":"tab-admin-roles",children:"Admin Roles"})]}),(0,a.jsx)(eS.TabsContent,{value:"general",className:"space-y-4",children:d?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(Z.Card,{"data-testid":"card-general-settings",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"General Settings"})}),(0,a.jsxs)(Z.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"site-name",children:"Site Name"}),(0,a.jsx)(m.Input,{id:"site-name",defaultValue:c.siteName,"data-testid":"input-site-name"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"site-description",children:"Site Description"}),(0,a.jsx)(eN.Textarea,{id:"site-description",defaultValue:c.siteDescription,"data-testid":"textarea-site-description"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(aI.Label,{htmlFor:"maintenance-mode",children:"Maintenance Mode"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enable site maintenance mode"})]}),(0,a.jsx)(aH.Switch,{id:"maintenance-mode",defaultChecked:c.maintenanceMode,"data-testid":"switch-maintenance-mode"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(aI.Label,{htmlFor:"registration-enabled",children:"Registration Enabled"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Allow new user registrations"})]}),(0,a.jsx)(aH.Switch,{id:"registration-enabled",defaultChecked:c.registrationEnabled,"data-testid":"switch-registration-enabled"})]}),(0,a.jsx)(x.Button,{onClick:()=>w.mutate(c),disabled:w.isPending,"data-testid":"button-save-general",children:"Save Changes"})]})]})}),(0,a.jsx)(eS.TabsContent,{value:"coin-economy",className:"space-y-4",children:h?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-exchange-rate",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Exchange Rate"})}),(0,a.jsxs)(Z.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"usd-to-coins",children:"USD to Coins Rate"}),(0,a.jsx)(m.Input,{id:"usd-to-coins",type:"number",defaultValue:u.usdToCoinsRate,"data-testid":"input-usd-to-coins"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"1 USD = X coins"})]}),(0,a.jsx)(x.Button,{"data-testid":"button-save-exchange-rate",children:"Save Exchange Rate"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-recharge-packages",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Recharge Packages"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Package"}),(0,a.jsx)(ee.TableHead,{children:"Coins"}),(0,a.jsx)(ee.TableHead,{children:"Price (USD)"}),(0,a.jsx)(ee.TableHead,{children:"Bonus"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:u.packages.length>0?u.packages.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`package-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:e.name}),(0,a.jsx)(ee.TableCell,{children:e.coins}),(0,a.jsxs)(ee.TableCell,{children:["$",e.price]}),(0,a.jsxs)(ee.TableCell,{children:[e.bonus,"%"]}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-edit-package-${e.id}`,children:"Edit"})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No packages configured"})})})]})})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-withdrawal-settings",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Withdrawal Settings"})}),(0,a.jsxs)(Z.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"min-withdrawal",children:"Minimum Withdrawal Amount"}),(0,a.jsx)(m.Input,{id:"min-withdrawal",type:"number",defaultValue:u.minWithdrawal,"data-testid":"input-min-withdrawal"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"withdrawal-fee",children:"Withdrawal Fee (%)"}),(0,a.jsx)(m.Input,{id:"withdrawal-fee",type:"number",defaultValue:u.withdrawalFee,"data-testid":"input-withdrawal-fee"})]}),(0,a.jsx)(x.Button,{"data-testid":"button-save-withdrawal",children:"Save Withdrawal Settings"})]})]})]})}),(0,a.jsxs)(eS.TabsContent,{value:"email-templates",className:"space-y-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Search Templates"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(m.Input,{placeholder:"Search templates...",value:t,onChange:e=>l(e.target.value),"data-testid":"input-search-templates"})})]}),g?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(Z.Card,{"data-testid":"card-email-templates",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Email Templates"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Name"}),(0,a.jsx)(ee.TableHead,{children:"Subject"}),(0,a.jsx)(ee.TableHead,{children:"Type"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:v.length>0?v.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`template-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:e.name}),(0,a.jsx)(ee.TableCell,{children:e.subject}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"outline",children:e.type})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-edit-template-${e.id}`,children:"Edit"}),(0,a.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-preview-template-${e.id}`,children:"Preview"})]})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"No templates found"})})})]})})})]})]}),(0,a.jsx)(eS.TabsContent,{value:"feature-flags",className:"space-y-4",children:y?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(Z.Card,{"data-testid":"card-feature-flags",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Feature Flags"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Feature"}),(0,a.jsx)(ee.TableHead,{children:"Description"}),(0,a.jsx)(ee.TableHead,{children:"Enabled"}),(0,a.jsx)(ee.TableHead,{children:"Rollout %"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:C.length>0?C.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`flag-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:e.name}),(0,a.jsx)(ee.TableCell,{children:e.description}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(aH.Switch,{checked:e.enabled,onCheckedChange:a=>S.mutate({flagId:e.id,enabled:a}),"data-testid":`switch-flag-${e.id}`})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)("div",{className:"w-24",children:(0,a.jsx)(aR.Slider,{defaultValue:[e.rolloutPercentage],max:100,step:1,"data-testid":`slider-rollout-${e.id}`})})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-configure-flag-${e.id}`,children:"Configure"})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No feature flags configured"})})})]})})})]})}),(0,a.jsx)(eS.TabsContent,{value:"admin-roles",className:"space-y-4",children:N?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(Z.Card,{"data-testid":"card-admin-roles",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Admin Roles & Permissions"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"User"}),(0,a.jsx)(ee.TableHead,{children:"Email"}),(0,a.jsx)(ee.TableHead,{children:"Role"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:T.length>0?T.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`admin-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:e.username}),(0,a.jsx)(ee.TableCell,{children:e.email}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{children:e.role})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-edit-permissions-${e.id}`,children:"Edit Permissions"}),(0,a.jsx)(x.Button,{size:"sm",variant:"destructive","data-testid":`button-revoke-admin-${e.id}`,children:"Revoke"})]})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"No admins found"})})})]})})})]})})]})]})}function aq(){let[e,s]=(0,i.useState)("security-events"),[t,l]=(0,i.useState)("all"),[r,n]=(0,i.useState)("all"),[d,c]=(0,i.useState)("all"),[o,h]=(0,i.useState)("active"),[u,p]=(0,i.useState)(null),{toast:g}=(0,ek.useToast)(),{data:v,isLoading:b}=(0,J.useQuery)({queryKey:["/api/admin/security/events",{type:t,severity:r,resolved:d}]}),y=Array.isArray(v)?v:[],{data:C,isLoading:f}=(0,J.useQuery)({queryKey:["/api/admin/security/ip-bans",{status:o}]}),N=Array.isArray(C)?C:[],{data:T,isLoading:w}=(0,J.useQuery)({queryKey:["/api/admin/security/performance-metrics"]}),S=T||{cpu:0,memory:0,disk:0,network:0,responseTimeData:[],errorRateData:[],dbQueryTime:{avg:0,min:0,max:0},alerts:[]},k=(0,ef.useMutation)({mutationFn:async({eventId:e,notes:a})=>(0,eM.apiRequest)("POST",`/api/admin/security/events/${e}/resolve`,{notes:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/security/events"]}),g({title:"Event resolved successfully"}),p(null)},onError:()=>{g({title:"Failed to resolve event",variant:"destructive"})}}),D=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("POST","/api/admin/security/ip-bans",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/security/ip-bans"]}),g({title:"IP banned successfully"})},onError:()=>{g({title:"Failed to ban IP",variant:"destructive"})}}),A=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("DELETE",`/api/admin/security/ip-bans/${e}`),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/security/ip-bans"]}),g({title:"IP unbanned successfully"})},onError:()=>{g({title:"Failed to unban IP",variant:"destructive"})}}),F=e=>{switch(e){case"critical":case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Security & Safety"}),(0,a.jsxs)(eS.Tabs,{value:e,onValueChange:s,"data-testid":"tabs-security",children:[(0,a.jsxs)(eS.TabsList,{className:"grid w-full grid-cols-3",children:[(0,a.jsx)(eS.TabsTrigger,{value:"security-events","data-testid":"tab-security-events",children:"Security Events"}),(0,a.jsx)(eS.TabsTrigger,{value:"ip-bans","data-testid":"tab-ip-bans",children:"IP Bans"}),(0,a.jsx)(eS.TabsTrigger,{value:"performance","data-testid":"tab-performance",children:"Performance Metrics"})]}),(0,a.jsxs)(eS.TabsContent,{value:"security-events",className:"space-y-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Filters"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)(eT.Select,{value:t,onValueChange:l,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-type-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Event Type"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Types"}),(0,a.jsx)(eT.SelectItem,{value:"login_attempt",children:"Login Attempt"}),(0,a.jsx)(eT.SelectItem,{value:"suspicious_activity",children:"Suspicious Activity"}),(0,a.jsx)(eT.SelectItem,{value:"data_breach",children:"Data Breach"})]})]}),(0,a.jsxs)(eT.Select,{value:r,onValueChange:n,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-severity-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Severity"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Severities"}),(0,a.jsx)(eT.SelectItem,{value:"critical",children:"Critical"}),(0,a.jsx)(eT.SelectItem,{value:"high",children:"High"}),(0,a.jsx)(eT.SelectItem,{value:"medium",children:"Medium"}),(0,a.jsx)(eT.SelectItem,{value:"low",children:"Low"})]})]}),(0,a.jsxs)(eT.Select,{value:d,onValueChange:c,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-resolved-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Status"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Status"}),(0,a.jsx)(eT.SelectItem,{value:"resolved",children:"Resolved"}),(0,a.jsx)(eT.SelectItem,{value:"unresolved",children:"Unresolved"})]})]})]})})]}),b?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(Z.Card,{"data-testid":"card-security-events",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Security Events (",y.length,")"]})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Timestamp"}),(0,a.jsx)(ee.TableHead,{children:"Type"}),(0,a.jsx)(ee.TableHead,{children:"Severity"}),(0,a.jsx)(ee.TableHead,{children:"Description"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:y.length>0?y.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`event-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:e.type}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:F(e.severity),children:e.severity})}),(0,a.jsx)(ee.TableCell,{children:e.description}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:e.resolved?"secondary":"default",children:e.resolved?"Resolved":"Unresolved"})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>p(e),"data-testid":`button-view-event-${e.id}`,children:e.resolved?"View":"Resolve"})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No security events found"})})})]})})})]}),(0,a.jsx)(ew.Dialog,{open:!!u,onOpenChange:()=>p(null),children:(0,a.jsxs)(ew.DialogContent,{"data-testid":"dialog-event-detail",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Security Event Details"}),(0,a.jsxs)(ew.DialogDescription,{children:["Event ID: ",u?.id]})]}),u&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Type"}),(0,a.jsx)("p",{className:"font-medium",children:u.type})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Severity"}),(0,a.jsx)(ey.Badge,{variant:F(u.severity),children:u.severity})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Description"}),(0,a.jsx)("p",{children:u.description})]}),!u.resolved&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"resolution-notes",children:"Resolution Notes"}),(0,a.jsx)(eN.Textarea,{id:"resolution-notes",placeholder:"Enter resolution notes...","data-testid":"textarea-resolution-notes"}),(0,a.jsx)(x.Button,{onClick:()=>{let e=document.getElementById("resolution-notes")?.value;k.mutate({eventId:u.id,notes:e})},disabled:k.isPending,"data-testid":"button-resolve-event",children:"Resolve Event"})]})]})]})})]}),(0,a.jsxs)(eS.TabsContent,{value:"ip-bans",className:"space-y-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Add IP Ban"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsx)(m.Input,{placeholder:"IP Address",id:"ban-ip-address","data-testid":"input-ban-ip-address"}),(0,a.jsx)(m.Input,{placeholder:"Reason",id:"ban-reason","data-testid":"input-ban-reason"}),(0,a.jsxs)(eT.Select,{defaultValue:"permanent",children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-ban-duration",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Duration"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"permanent",children:"Permanent"}),(0,a.jsx)(eT.SelectItem,{value:"7",children:"7 Days"}),(0,a.jsx)(eT.SelectItem,{value:"30",children:"30 Days"})]})]}),(0,a.jsx)(x.Button,{onClick:()=>{let e=document.getElementById("ban-ip-address")?.value,a=document.getElementById("ban-reason")?.value;D.mutate({ipAddress:e,reason:a,duration:0})},disabled:D.isPending,"data-testid":"button-add-ban",children:"Add Ban"})]})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-4 space-y-0",children:[(0,a.jsx)(Z.CardTitle,{children:"IP Bans"}),(0,a.jsxs)(eT.Select,{value:o,onValueChange:h,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-48","data-testid":"select-ban-status-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Filter"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All"}),(0,a.jsx)(eT.SelectItem,{value:"active",children:"Active"}),(0,a.jsx)(eT.SelectItem,{value:"expired",children:"Expired"})]})]})]}),(0,a.jsx)(Z.CardContent,{children:f?(0,a.jsx)(j.Skeleton,{className:"h-64"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"IP Address"}),(0,a.jsx)(ee.TableHead,{children:"Reason"}),(0,a.jsx)(ee.TableHead,{children:"Banned By"}),(0,a.jsx)(ee.TableHead,{children:"Banned At"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:N.length>0?N.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`ban-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:e.ipAddress}),(0,a.jsx)(ee.TableCell,{children:e.reason}),(0,a.jsx)(ee.TableCell,{children:e.bannedBy}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:e.active?"destructive":"secondary",children:e.active?"Active":"Expired"})}),(0,a.jsx)(ee.TableCell,{children:e.active&&(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>A.mutate(e.id),disabled:A.isPending,"data-testid":`button-unban-${e.id}`,children:"Unban"})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No IP bans found"})})})]})})})]})]}),(0,a.jsx)(eS.TabsContent,{value:"performance",className:"space-y-4",children:w?(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s))})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-cpu",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"CPU Usage"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-cpu",children:[S.cpu,"%"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Current usage"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-memory",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Memory"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-memory",children:[S.memory,"%"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Used"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-disk",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Disk"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-disk",children:[S.disk,"%"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Used"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-network",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Network"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-network",children:[S.network," MB/s"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Throughput"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-response-time",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Response Time (Last 24 Hours)"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(en.LineChart,{data:S.responseTimeData,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"time"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(ed.Line,{type:"monotone",dataKey:"responseTime",stroke:"hsl(var(--primary))",strokeWidth:2})]})})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-error-rate",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Error Rate"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(en.LineChart,{data:S.errorRateData,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"time"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(ed.Line,{type:"monotone",dataKey:"errors",stroke:"hsl(var(--destructive))",strokeWidth:2})]})})})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-db-metrics",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Database Query Time Metrics"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Average"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[S.dbQueryTime.avg,"ms"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Min"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[S.dbQueryTime.min,"ms"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Max"}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:[S.dbQueryTime.max,"ms"]})]})]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-performance-alerts",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Performance Alerts"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Alert"}),(0,a.jsx)(ee.TableHead,{children:"Severity"}),(0,a.jsx)(ee.TableHead,{children:"Time"})]})}),(0,a.jsx)(ee.TableBody,{children:S.alerts.length>0?S.alerts.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{children:e.message}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:F(e.severity),children:e.severity})}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.time),{addSuffix:!0})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:3,className:"text-center py-8 text-muted-foreground",children:"No performance alerts"})})})]})})})]})]})})]})]})}var aL=e.i(296112);function aP(){let[e,s]=(0,i.useState)("announcements"),[t,l]=(0,i.useState)(!1),{toast:r}=(0,ek.useToast)(),{data:n,isLoading:d}=(0,J.useQuery)({queryKey:["/api/admin/communications/announcements"]}),c=Array.isArray(n)?n:[],{data:o,isLoading:h}=(0,J.useQuery)({queryKey:["/api/admin/communications/campaigns"]}),u=Array.isArray(o)?o:[],{data:p,isLoading:g}=(0,J.useQuery)({queryKey:["/api/admin/communications/campaign-stats"]}),v=p||{sent:0,opened:0,openRate:0,clicked:0,clickRate:0,bounced:0,bounceRate:0},b=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("POST","/api/admin/communications/announcements",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/communications/announcements"]}),r({title:"Announcement created successfully"}),l(!1)},onError:()=>{r({title:"Failed to create announcement",variant:"destructive"})}}),y=(0,ef.useMutation)({mutationFn:async({id:e,active:a})=>(0,eM.apiRequest)("PUT",`/api/admin/communications/announcements/${e}`,{active:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/communications/announcements"]}),r({title:"Announcement updated"})},onError:()=>{r({title:"Failed to update announcement",variant:"destructive"})}}),C=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("DELETE",`/api/admin/communications/announcements/${e}`),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/communications/announcements"]}),r({title:"Announcement deleted"})},onError:()=>{r({title:"Failed to delete announcement",variant:"destructive"})}});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Communications"}),(0,a.jsxs)(eS.Tabs,{value:e,onValueChange:s,"data-testid":"tabs-communications",children:[(0,a.jsxs)(eS.TabsList,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(eS.TabsTrigger,{value:"announcements","data-testid":"tab-announcements",children:"Announcements"}),(0,a.jsx)(eS.TabsTrigger,{value:"email-campaigns","data-testid":"tab-email-campaigns",children:"Email Campaigns"})]}),(0,a.jsxs)(eS.TabsContent,{value:"announcements",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Announcements"}),(0,a.jsxs)(ew.Dialog,{open:t,onOpenChange:l,children:[(0,a.jsx)(ew.DialogTrigger,{asChild:!0,children:(0,a.jsx)(x.Button,{"data-testid":"button-create-announcement",children:"Create Announcement"})}),(0,a.jsxs)(ew.DialogContent,{"data-testid":"dialog-create-announcement",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsx)(ew.DialogTitle,{children:"Create Announcement"}),(0,a.jsx)(ew.DialogDescription,{children:"Create a new announcement for your users"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"announcement-title",children:"Title"}),(0,a.jsx)(m.Input,{id:"announcement-title",placeholder:"Announcement title","data-testid":"input-announcement-title"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"announcement-content",children:"Content"}),(0,a.jsx)(eN.Textarea,{id:"announcement-content",placeholder:"Announcement content",rows:4,"data-testid":"textarea-announcement-content"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"announcement-type",children:"Type"}),(0,a.jsxs)(eT.Select,{defaultValue:"info",children:[(0,a.jsx)(eT.SelectTrigger,{id:"announcement-type","data-testid":"select-announcement-type",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select type"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"info",children:"Info"}),(0,a.jsx)(eT.SelectItem,{value:"warning",children:"Warning"}),(0,a.jsx)(eT.SelectItem,{value:"success",children:"Success"}),(0,a.jsx)(eT.SelectItem,{value:"error",children:"Error"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"announcement-audience",children:"Target Audience"}),(0,a.jsxs)(eT.Select,{defaultValue:"all",children:[(0,a.jsx)(eT.SelectTrigger,{id:"announcement-audience","data-testid":"select-announcement-audience",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select audience"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Users"}),(0,a.jsx)(eT.SelectItem,{value:"premium",children:"Premium Users"}),(0,a.jsx)(eT.SelectItem,{value:"free",children:"Free Users"}),(0,a.jsx)(eT.SelectItem,{value:"sellers",children:"Sellers"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"announcement-display",children:"Display Type"}),(0,a.jsxs)(eT.Select,{defaultValue:"banner",children:[(0,a.jsx)(eT.SelectTrigger,{id:"announcement-display","data-testid":"select-announcement-display",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select display type"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"banner",children:"Banner"}),(0,a.jsx)(eT.SelectItem,{value:"modal",children:"Modal"}),(0,a.jsx)(eT.SelectItem,{value:"toast",children:"Toast"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"announcement-start",children:"Start Date"}),(0,a.jsx)(m.Input,{id:"announcement-start",type:"date","data-testid":"input-announcement-start"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"announcement-end",children:"End Date"}),(0,a.jsx)(m.Input,{id:"announcement-end",type:"date","data-testid":"input-announcement-end"})]})]}),(0,a.jsx)(x.Button,{onClick:()=>{let e=document.getElementById("announcement-title")?.value,a=document.getElementById("announcement-content")?.value;b.mutate({title:e,content:a,type:"info",audience:"all"})},disabled:b.isPending,"data-testid":"button-submit-announcement",children:"Create Announcement"})]})]})]})]}),d?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsx)(Z.Card,{"data-testid":"card-announcements",children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Title"}),(0,a.jsx)(ee.TableHead,{children:"Type"}),(0,a.jsx)(ee.TableHead,{children:"Audience"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Views"}),(0,a.jsx)(ee.TableHead,{children:"Clicks"}),(0,a.jsx)(ee.TableHead,{children:"Created"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:c.length>0?c.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`announcement-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:e.title}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"outline",children:e.type})}),(0,a.jsx)(ee.TableCell,{children:e.audience}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(aH.Switch,{checked:e.active,onCheckedChange:a=>y.mutate({id:e.id,active:a}),"data-testid":`switch-announcement-${e.id}`})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(eO.Eye,{className:"h-4 w-4"}),e.views||0]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(aL.MousePointer,{className:"h-4 w-4"}),e.clicks||0]})}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-edit-announcement-${e.id}`,children:"Edit"}),(0,a.jsx)(x.Button,{size:"sm",variant:"destructive",onClick:()=>C.mutate(e.id),disabled:C.isPending,"data-testid":`button-delete-announcement-${e.id}`,children:"Delete"})]})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No announcements found"})})})]})})})})]}),(0,a.jsxs)(eS.TabsContent,{value:"email-campaigns",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Email Campaigns"}),(0,a.jsx)(x.Button,{"data-testid":"button-create-campaign",children:"Create Campaign"})]}),g?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s))}):(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-sent",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Sent"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-sent",children:v.sent}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Emails sent"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-opened",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Opened"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-opened",children:v.opened}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[v.openRate,"% open rate"]})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-clicked",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Clicked"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-clicked",children:v.clicked}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[v.clickRate,"% click rate"]})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-bounced",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Bounced"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-bounced",children:v.bounced}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[v.bounceRate,"% bounce rate"]})]})]})]}),h?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(Z.Card,{"data-testid":"card-campaigns",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Recent Campaigns"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Name"}),(0,a.jsx)(ee.TableHead,{children:"Subject"}),(0,a.jsx)(ee.TableHead,{children:"Sent"}),(0,a.jsx)(ee.TableHead,{children:"Opened"}),(0,a.jsx)(ee.TableHead,{children:"Clicked"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Created"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:u.length>0?u.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`campaign-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:e.name}),(0,a.jsx)(ee.TableCell,{children:e.subject}),(0,a.jsx)(ee.TableCell,{children:e.sent||0}),(0,a.jsx)(ee.TableCell,{children:e.opened||0}),(0,a.jsx)(ee.TableCell,{children:e.clicked||0}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"sent"===e.status?"default":"secondary",children:e.status})}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-view-campaign-${e.id}`,children:"View Report"})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No campaigns found"})})})]})})})]})]})]})]})}function aM(){let[e,s]=(0,i.useState)("all"),[t,l]=(0,i.useState)("all"),[r,n]=(0,i.useState)("all"),[d,c]=(0,i.useState)(null),{toast:o}=(0,ek.useToast)(),{data:m,isLoading:u}=(0,J.useQuery)({queryKey:["/api/admin/support/tickets",{status:e,priority:t,category:r}]}),p=Array.isArray(m)?m:[],{data:g,isLoading:v}=(0,J.useQuery)({queryKey:["/api/admin/support/stats"]}),b=g||{openTickets:0,avgResponseTime:"0h",avgResolutionTime:"0h",satisfactionScore:0},y=(0,ef.useMutation)({mutationFn:async({ticketId:e,data:a})=>(0,eM.apiRequest)("PUT",`/api/admin/support/tickets/${e}`,a),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/support/tickets"]}),o({title:"Ticket updated successfully"})},onError:()=>{o({title:"Failed to update ticket",variant:"destructive"})}}),C=(0,ef.useMutation)({mutationFn:async({ticketId:e,message:a})=>(0,eM.apiRequest)("POST",`/api/admin/support/tickets/${e}/reply`,{message:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/support/tickets"]}),o({title:"Reply sent successfully"})},onError:()=>{o({title:"Failed to send reply",variant:"destructive"})}}),f=(0,ef.useMutation)({mutationFn:async e=>(0,eM.apiRequest)("POST",`/api/admin/support/tickets/${e}/close`),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/support/tickets"]}),o({title:"Ticket closed"}),c(null)},onError:()=>{o({title:"Failed to close ticket",variant:"destructive"})}}),N=e=>{switch(e){case"urgent":case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Support & Tickets"}),v?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s))}):(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-open-tickets",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Open Tickets"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-open-tickets",children:b.openTickets}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Awaiting response"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-avg-response-time",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Avg Response Time"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-response-time",children:b.avgResponseTime}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Time to first response"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-avg-resolution-time",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Avg Resolution Time"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-resolution-time",children:b.avgResolutionTime}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Time to close"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-satisfaction-score",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Satisfaction Score"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-satisfaction-score",children:[b.satisfactionScore,"%"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"User satisfaction"})]})]})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Filters"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)(eT.Select,{value:e,onValueChange:s,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-status-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Status"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Status"}),(0,a.jsx)(eT.SelectItem,{value:"open",children:"Open"}),(0,a.jsx)(eT.SelectItem,{value:"in_progress",children:"In Progress"}),(0,a.jsx)(eT.SelectItem,{value:"resolved",children:"Resolved"}),(0,a.jsx)(eT.SelectItem,{value:"closed",children:"Closed"})]})]}),(0,a.jsxs)(eT.Select,{value:t,onValueChange:l,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-priority-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Priority"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Priorities"}),(0,a.jsx)(eT.SelectItem,{value:"urgent",children:"Urgent"}),(0,a.jsx)(eT.SelectItem,{value:"high",children:"High"}),(0,a.jsx)(eT.SelectItem,{value:"medium",children:"Medium"}),(0,a.jsx)(eT.SelectItem,{value:"low",children:"Low"})]})]}),(0,a.jsxs)(eT.Select,{value:r,onValueChange:n,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-category-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Category"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Categories"}),(0,a.jsx)(eT.SelectItem,{value:"technical",children:"Technical"}),(0,a.jsx)(eT.SelectItem,{value:"billing",children:"Billing"}),(0,a.jsx)(eT.SelectItem,{value:"general",children:"General"})]})]})]})})]}),u?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(Z.Card,{"data-testid":"card-tickets",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Support Tickets (",p.length,")"]})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Ticket #"}),(0,a.jsx)(ee.TableHead,{children:"User"}),(0,a.jsx)(ee.TableHead,{children:"Subject"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Priority"}),(0,a.jsx)(ee.TableHead,{children:"Created"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:p.length>0?p.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`ticket-${e.id}`,children:[(0,a.jsxs)(ee.TableCell,{children:["#",e.id]}),(0,a.jsx)(ee.TableCell,{children:e.username}),(0,a.jsx)(ee.TableCell,{children:e.subject}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"outline",children:e.status})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:N(e.priority),children:e.priority})}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>c(e),"data-testid":`button-view-ticket-${e.id}`,children:"View"})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No tickets found"})})})]})})})]}),(0,a.jsx)(ew.Dialog,{open:!!d,onOpenChange:()=>c(null),children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-3xl","data-testid":"dialog-ticket-detail",children:[(0,a.jsxs)(ew.DialogHeader,{children:[(0,a.jsxs)(ew.DialogTitle,{children:["Ticket #",d?.id]}),(0,a.jsx)(ew.DialogDescription,{children:d?.subject})]}),d&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"User"}),(0,a.jsx)("p",{className:"font-medium",children:d.username})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,a.jsx)(ey.Badge,{variant:"outline",children:d.status})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Priority"}),(0,a.jsx)(ey.Badge,{variant:N(d.priority),children:d.priority})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Category"}),(0,a.jsx)("p",{className:"font-medium",children:d.category||"N/A"})]})]}),(0,a.jsx)(h.Separator,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{children:"Conversation"}),(0,a.jsx)("div",{className:"border rounded-md p-4 space-y-4 max-h-96 overflow-y-auto",children:d.messages&&d.messages.length>0?d.messages.map(e=>(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"font-medium",children:e.sender}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,a.jsx)("p",{className:"text-sm",children:e.content}),(0,a.jsx)(h.Separator,{className:"mt-2"})]},e.id)):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages yet"})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"reply-message",children:"Reply"}),(0,a.jsx)(eN.Textarea,{id:"reply-message",placeholder:"Type your reply...",rows:4,"data-testid":"textarea-reply"}),(0,a.jsx)(x.Button,{onClick:()=>{let e=document.getElementById("reply-message")?.value;C.mutate({ticketId:d.id,message:e})},disabled:C.isPending,"data-testid":"button-send-reply",children:"Send Reply"})]}),(0,a.jsx)(h.Separator,{}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"assign-admin",children:"Assign to Admin"}),(0,a.jsxs)(eT.Select,{children:[(0,a.jsx)(eT.SelectTrigger,{id:"assign-admin","data-testid":"select-assign-admin",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select admin"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"admin1",children:"Admin 1"}),(0,a.jsx)(eT.SelectItem,{value:"admin2",children:"Admin 2"})]})]})]}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"update-status",children:"Update Status"}),(0,a.jsxs)(eT.Select,{defaultValue:d.status,onValueChange:e=>{y.mutate({ticketId:d.id,data:{status:e}})},children:[(0,a.jsx)(eT.SelectTrigger,{id:"update-status","data-testid":"select-update-status",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select status"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"open",children:"Open"}),(0,a.jsx)(eT.SelectItem,{value:"in_progress",children:"In Progress"}),(0,a.jsx)(eT.SelectItem,{value:"resolved",children:"Resolved"}),(0,a.jsx)(eT.SelectItem,{value:"closed",children:"Closed"})]})]})]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)(x.Button,{variant:"destructive",onClick:()=>f.mutate(d.id),disabled:f.isPending,"data-testid":"button-close-ticket",children:"Close Ticket"})}),d.tags&&d.tags.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{children:"Tags"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:d.tags.map((e,s)=>(0,a.jsx)(ey.Badge,{variant:"secondary",children:e},s))})]})]})]})})]})}function aK(){let[e,s]=(0,i.useState)("admin-actions"),[t,l]=(0,i.useState)("all"),[r,n]=(0,i.useState)("all"),[d,c]=(0,i.useState)("all"),[o,h]=(0,i.useState)(""),[u,p]=(0,i.useState)("all"),[g,v]=(0,i.useState)("all"),[b,y]=(0,i.useState)("all"),{data:C,isLoading:f}=(0,J.useQuery)({queryKey:["/api/admin/logs/admin-actions",{admin:t,actionType:r,targetType:d,search:o}]}),N=Array.isArray(C)?C:[],{data:T,isLoading:w}=(0,J.useQuery)({queryKey:["/api/admin/logs/security",{severity:u,eventType:b}]}),S=Array.isArray(T)?T:[],{data:k,isLoading:D}=(0,J.useQuery)({queryKey:["/api/admin/logs/performance",{metricType:g}]}),A=k??{aggregations:{avg:0,min:0,max:0},logs:[]},{data:F,isLoading:H}=(0,J.useQuery)({queryKey:["/api/admin/logs/system-events",{severity:u,eventType:b}]}),R=Array.isArray(F)?F:[],I=e=>{console.log(`Exporting logs as ${e}`)},B=e=>{switch(e){case"critical":case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Audit Logs"}),(0,a.jsxs)(eS.Tabs,{value:e,onValueChange:s,"data-testid":"tabs-logs",children:[(0,a.jsxs)(eS.TabsList,{className:"grid w-full grid-cols-4",children:[(0,a.jsx)(eS.TabsTrigger,{value:"admin-actions","data-testid":"tab-admin-actions",children:"Admin Actions"}),(0,a.jsx)(eS.TabsTrigger,{value:"security","data-testid":"tab-security-logs",children:"Security Logs"}),(0,a.jsx)(eS.TabsTrigger,{value:"performance","data-testid":"tab-performance-logs",children:"Performance Logs"}),(0,a.jsx)(eS.TabsTrigger,{value:"system","data-testid":"tab-system-events",children:"System Events"})]}),(0,a.jsxs)(eS.TabsContent,{value:"admin-actions",className:"space-y-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Filters & Search"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[(0,a.jsx)(m.Input,{placeholder:"Search logs...",value:o,onChange:e=>{let a=e.target.value;setTimeout(()=>h(a),300)},"data-testid":"input-search-logs"}),(0,a.jsxs)(eT.Select,{value:t,onValueChange:l,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-admin-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Admin User"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Admins"}),(0,a.jsx)(eT.SelectItem,{value:"admin1",children:"Admin 1"}),(0,a.jsx)(eT.SelectItem,{value:"admin2",children:"Admin 2"})]})]}),(0,a.jsxs)(eT.Select,{value:r,onValueChange:n,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-action-type-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Action Type"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Actions"}),(0,a.jsx)(eT.SelectItem,{value:"create",children:"Create"}),(0,a.jsx)(eT.SelectItem,{value:"update",children:"Update"}),(0,a.jsx)(eT.SelectItem,{value:"delete",children:"Delete"})]})]}),(0,a.jsxs)(eT.Select,{value:d,onValueChange:c,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-target-type-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Target Type"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Targets"}),(0,a.jsx)(eT.SelectItem,{value:"user",children:"User"}),(0,a.jsx)(eT.SelectItem,{value:"content",children:"Content"}),(0,a.jsx)(eT.SelectItem,{value:"settings",children:"Settings"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsx)(m.Input,{type:"date",placeholder:"Start Date",className:"w-full md:w-auto","data-testid":"input-start-date"}),(0,a.jsx)(m.Input,{type:"date",placeholder:"End Date",className:"w-full md:w-auto","data-testid":"input-end-date"}),(0,a.jsxs)("div",{className:"flex gap-2 ml-auto",children:[(0,a.jsxs)(x.Button,{variant:"outline",onClick:()=>I("csv"),"data-testid":"button-export-csv",children:[(0,a.jsx)(eI.Download,{className:"h-4 w-4 mr-1"}),"CSV"]}),(0,a.jsxs)(x.Button,{variant:"outline",onClick:()=>I("json"),"data-testid":"button-export-json",children:[(0,a.jsx)(eI.Download,{className:"h-4 w-4 mr-1"}),"JSON"]})]})]})]})]}),f?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(Z.Card,{"data-testid":"card-admin-logs",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Admin Action Logs (",N.length,")"]})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Timestamp"}),(0,a.jsx)(ee.TableHead,{children:"Admin"}),(0,a.jsx)(ee.TableHead,{children:"Action Type"}),(0,a.jsx)(ee.TableHead,{children:"Target"}),(0,a.jsx)(ee.TableHead,{children:"Details"}),(0,a.jsx)(ee.TableHead,{children:"IP Address"})]})}),(0,a.jsx)(ee.TableBody,{children:N.length>0?N.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`log-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:e.adminUsername}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"outline",children:e.actionType})}),(0,a.jsx)(ee.TableCell,{children:e.targetType}),(0,a.jsx)(ee.TableCell,{children:e.details}),(0,a.jsx)(ee.TableCell,{children:e.ipAddress})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No logs found"})})})]})})})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"security",className:"space-y-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Filters"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)(eT.Select,{value:u,onValueChange:p,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-security-severity-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Severity"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Severities"}),(0,a.jsx)(eT.SelectItem,{value:"critical",children:"Critical"}),(0,a.jsx)(eT.SelectItem,{value:"high",children:"High"}),(0,a.jsx)(eT.SelectItem,{value:"medium",children:"Medium"}),(0,a.jsx)(eT.SelectItem,{value:"low",children:"Low"})]})]}),(0,a.jsxs)(eT.Select,{value:b,onValueChange:y,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-security-event-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Event Type"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Events"}),(0,a.jsx)(eT.SelectItem,{value:"login",children:"Login"}),(0,a.jsx)(eT.SelectItem,{value:"access",children:"Access"}),(0,a.jsx)(eT.SelectItem,{value:"breach",children:"Breach"})]})]})]})})]}),w?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(Z.Card,{"data-testid":"card-security-logs",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Security Event Logs (",S.length,")"]})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Timestamp"}),(0,a.jsx)(ee.TableHead,{children:"Event Type"}),(0,a.jsx)(ee.TableHead,{children:"Severity"}),(0,a.jsx)(ee.TableHead,{children:"Description"}),(0,a.jsx)(ee.TableHead,{children:"User"}),(0,a.jsx)(ee.TableHead,{children:"IP Address"})]})}),(0,a.jsx)(ee.TableBody,{children:S.length>0?S.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`security-log-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:e.eventType}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:B(e.severity),children:e.severity})}),(0,a.jsx)(ee.TableCell,{children:e.description}),(0,a.jsx)(ee.TableCell,{children:e.username||"N/A"}),(0,a.jsx)(ee.TableCell,{children:e.ipAddress})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No security logs found"})})})]})})})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"performance",className:"space-y-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Filters"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)(eT.Select,{value:g,onValueChange:v,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-metric-type-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Metric Type"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Metrics"}),(0,a.jsx)(eT.SelectItem,{value:"cpu",children:"CPU"}),(0,a.jsx)(eT.SelectItem,{value:"memory",children:"Memory"}),(0,a.jsx)(eT.SelectItem,{value:"response_time",children:"Response Time"})]})]}),(0,a.jsx)(m.Input,{type:"date",placeholder:"Start Date","data-testid":"input-perf-start-date"}),(0,a.jsx)(m.Input,{type:"date",placeholder:"End Date","data-testid":"input-perf-end-date"})]})})]}),D?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-avg-metric",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Average"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-metric",children:A.aggregations?.avg||0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Average value"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-min-metric",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Minimum"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-min-metric",children:A.aggregations?.min||0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Minimum value"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-max-metric",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Maximum"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-max-metric",children:A.aggregations?.max||0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Maximum value"})]})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-performance-logs",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["Performance Metrics (",A.logs.length,")"]})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Timestamp"}),(0,a.jsx)(ee.TableHead,{children:"Metric Type"}),(0,a.jsx)(ee.TableHead,{children:"Value"}),(0,a.jsx)(ee.TableHead,{children:"Unit"}),(0,a.jsx)(ee.TableHead,{children:"Status"})]})}),(0,a.jsx)(ee.TableBody,{children:A.logs.length>0?A.logs.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`perf-log-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:e.metricType}),(0,a.jsx)(ee.TableCell,{children:e.value}),(0,a.jsx)(ee.TableCell,{children:e.unit}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"normal"===e.status?"secondary":"destructive",children:e.status})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No performance logs found"})})})]})})})]})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"system",className:"space-y-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Filters"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)(eT.Select,{value:b,onValueChange:y,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-system-event-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Event Type"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Events"}),(0,a.jsx)(eT.SelectItem,{value:"startup",children:"Startup"}),(0,a.jsx)(eT.SelectItem,{value:"shutdown",children:"Shutdown"}),(0,a.jsx)(eT.SelectItem,{value:"error",children:"Error"})]})]}),(0,a.jsxs)(eT.Select,{value:u,onValueChange:p,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-system-severity-filter",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Severity"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Severities"}),(0,a.jsx)(eT.SelectItem,{value:"critical",children:"Critical"}),(0,a.jsx)(eT.SelectItem,{value:"high",children:"High"}),(0,a.jsx)(eT.SelectItem,{value:"medium",children:"Medium"}),(0,a.jsx)(eT.SelectItem,{value:"low",children:"Low"})]})]})]})})]}),H?(0,a.jsx)(j.Skeleton,{className:"h-96"}):(0,a.jsxs)(Z.Card,{"data-testid":"card-system-events",children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{children:["System Events (",R.length,")"]})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Timestamp"}),(0,a.jsx)(ee.TableHead,{children:"Event Type"}),(0,a.jsx)(ee.TableHead,{children:"Severity"}),(0,a.jsx)(ee.TableHead,{children:"Description"}),(0,a.jsx)(ee.TableHead,{children:"Component"})]})}),(0,a.jsx)(ee.TableBody,{children:R.length>0?R.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`system-event-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:e.eventType}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:B(e.severity),children:e.severity})}),(0,a.jsx)(ee.TableCell,{children:e.description}),(0,a.jsx)(ee.TableCell,{children:e.component})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No system events found"})})})]})})})]})]})]})]})}let aE=(0,n.default)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);function aV(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)(!1),[l,r]=(0,i.useState)([70]),{data:n,isLoading:d}=(0,J.useQuery)({queryKey:["/api/admin/automation/rules"]}),c=Array.isArray(n)?n:[],{data:o,isLoading:h}=(0,J.useQuery)({queryKey:["/api/admin/ai/moderation-stats"]}),u=o||{accuracyRate:0,falsePositives:0,falseNegatives:0,timeSavedHours:0},{data:p,isLoading:g}=(0,J.useQuery)({queryKey:["/api/admin/ai/moderation-decisions"]}),v=Array.isArray(p)?p:[],{data:b,isLoading:y}=(0,J.useQuery)({queryKey:["/api/admin/ai/sentiment-distribution"]}),C=Array.isArray(b)?b:[],{data:f,isLoading:N}=(0,J.useQuery)({queryKey:["/api/admin/ai/spam-metrics"]}),T=f||{accuracy:0,blocked:0,flagged:0},{data:w,isLoading:S}=(0,J.useQuery)({queryKey:["/api/admin/ai/flagged-content"]}),k=Array.isArray(w)?w:[],D=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/automation/rules","POST",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/automation/rules"]}),e({title:"Rule created successfully"}),t(!1)}}),A=(0,ef.useMutation)({mutationFn:({id:e,enabled:a})=>(0,eM.apiRequest)(`/api/admin/automation/rules/${e}`,"PATCH",{enabled:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/automation/rules"]}),e({title:"Rule updated"})}}),F=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)(`/api/admin/automation/rules/${e}/execute`,"POST"),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/automation/rules"]}),e({title:"Rule executed successfully"})}}),H=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)(`/api/admin/ai/moderation-decisions/${e}/override`,"POST"),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/ai/moderation-decisions"]}),e({title:"Decision overridden"})}}),R=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/ai/spam-sensitivity","PATCH",{sensitivity:e}),onSuccess:()=>{e({title:"Sensitivity updated"})}}),I=["hsl(var(--primary))","hsl(var(--accent))","hsl(var(--muted))"];return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"AI & Automation"}),(0,a.jsxs)(eS.Tabs,{defaultValue:"automation",className:"space-y-4",children:[(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsx)(eS.TabsTrigger,{value:"automation","data-testid":"tab-automation",children:"Automation Rules"}),(0,a.jsx)(eS.TabsTrigger,{value:"moderation","data-testid":"tab-moderation",children:"Content Moderation AI"}),(0,a.jsx)(eS.TabsTrigger,{value:"spam","data-testid":"tab-spam",children:"Spam Detection"})]}),(0,a.jsxs)(eS.TabsContent,{value:"automation",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Automation Rules"}),(0,a.jsxs)(ew.Dialog,{open:s,onOpenChange:t,children:[(0,a.jsx)(ew.DialogTrigger,{asChild:!0,children:(0,a.jsx)(x.Button,{"data-testid":"button-create-rule",children:"Create Rule"})}),(0,a.jsxs)(ew.DialogContent,{className:"max-w-2xl",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Create Automation Rule"})}),(0,a.jsxs)("form",{onSubmit:a=>{a.preventDefault();let s=new FormData(a.currentTarget),t=s.get("triggerConfig"),i=s.get("actionConfig");try{JSON.parse(t),JSON.parse(i)}catch(a){e({title:"Invalid JSON in configuration",variant:"destructive"});return}D.mutate({name:s.get("name"),triggerType:s.get("triggerType"),triggerConfig:t,actionType:s.get("actionType"),actionConfig:i})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"name",children:"Rule Name"}),(0,a.jsx)(m.Input,{id:"name",name:"name",required:!0,"data-testid":"input-rule-name"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"triggerType",children:"Trigger Type"}),(0,a.jsxs)(eT.Select,{name:"triggerType",required:!0,children:[(0,a.jsx)(eT.SelectTrigger,{"data-testid":"select-trigger-type",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select trigger type"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"user_signup",children:"User Signup"}),(0,a.jsx)(eT.SelectItem,{value:"content_published",children:"Content Published"}),(0,a.jsx)(eT.SelectItem,{value:"time_based",children:"Time Based"}),(0,a.jsx)(eT.SelectItem,{value:"threshold_reached",children:"Threshold Reached"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"triggerConfig",children:"Trigger Configuration (JSON)"}),(0,a.jsx)(eN.Textarea,{id:"triggerConfig",name:"triggerConfig",placeholder:'{"key": "value"}',className:"font-mono text-sm",required:!0,"data-testid":"textarea-trigger-config"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"actionType",children:"Action Type"}),(0,a.jsxs)(eT.Select,{name:"actionType",required:!0,children:[(0,a.jsx)(eT.SelectTrigger,{"data-testid":"select-action-type",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select action type"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"send_email",children:"Send Email"}),(0,a.jsx)(eT.SelectItem,{value:"create_notification",children:"Create Notification"}),(0,a.jsx)(eT.SelectItem,{value:"award_coins",children:"Award Coins"}),(0,a.jsx)(eT.SelectItem,{value:"assign_badge",children:"Assign Badge"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"actionConfig",children:"Action Configuration (JSON)"}),(0,a.jsx)(eN.Textarea,{id:"actionConfig",name:"actionConfig",placeholder:'{"key": "value"}',className:"font-mono text-sm",required:!0,"data-testid":"textarea-action-config"})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{type:"submit",disabled:D.isPending,"data-testid":"button-submit-rule",children:D.isPending?"Creating...":"Create Rule"})})]})]})]})]}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:d?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Name"}),(0,a.jsx)(ee.TableHead,{children:"Trigger"}),(0,a.jsx)(ee.TableHead,{children:"Action"}),(0,a.jsx)(ee.TableHead,{children:"Executions"}),(0,a.jsx)(ee.TableHead,{children:"Last Executed"}),(0,a.jsx)(ee.TableHead,{children:"Enabled"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsxs)(ee.TableBody,{children:[c.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`rule-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{"data-testid":`rule-name-${e.id}`,children:e.name}),(0,a.jsx)(ee.TableCell,{children:e.triggerType}),(0,a.jsx)(ee.TableCell,{children:e.actionType}),(0,a.jsx)(ee.TableCell,{children:e.executionCount||0}),(0,a.jsx)(ee.TableCell,{children:e.lastExecutedAt?(0,er.formatDistanceToNow)(new Date(e.lastExecutedAt),{addSuffix:!0}):"Never"}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(aH.Switch,{checked:e.enabled,onCheckedChange:a=>A.mutate({id:e.id,enabled:a}),"data-testid":`switch-rule-${e.id}`})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>F.mutate(e.id),disabled:F.isPending,"data-testid":`button-execute-${e.id}`,children:[(0,a.jsx)(aE,{className:"w-3 h-3 mr-1"}),"Execute"]})})]},e.id)),0===c.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No automation rules created"})})]})]})})})})]}),(0,a.jsxs)(eS.TabsContent,{value:"moderation",className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Content Moderation AI"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:h?[void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s)):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-accuracy-rate",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Accuracy Rate"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-accuracy-rate",children:[u.accuracyRate,"%"]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-false-positives",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"False Positives"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-false-positives",children:u.falsePositives})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-false-negatives",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"False Negatives"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-false-negatives",children:u.falseNegatives})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-time-saved",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Time Saved"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-time-saved",children:[u.timeSavedHours,"h"]})})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Recent AI Decisions"})}),(0,a.jsx)(Z.CardContent,{children:g?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Content"}),(0,a.jsx)(ee.TableHead,{children:"Decision"}),(0,a.jsx)(ee.TableHead,{children:"Confidence"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsxs)(ee.TableBody,{children:[v.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{className:"max-w-xs truncate",children:e.contentPreview}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"approved"===e.decision?"default":"destructive",children:e.decision})}),(0,a.jsxs)(ee.TableCell,{children:[e.confidence,"%"]}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>H.mutate(e.id),"data-testid":`button-override-${e.id}`,children:"Override"})})]},e.id)),0===v.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No recent decisions"})})]})]})})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Sentiment Distribution"})}),(0,a.jsx)(Z.CardContent,{children:y?(0,a.jsx)(j.Skeleton,{className:"h-64"}):C.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ex.PieChart,{children:[(0,a.jsx)(em.Pie,{data:C,cx:"50%",cy:"50%",labelLine:!1,label:e=>e.name,outerRadius:80,fill:"hsl(var(--primary))",dataKey:"value",children:C.map((e,s)=>(0,a.jsx)(eh.Cell,{fill:I[s%I.length]},`cell-${s}`))}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eb.Legend,{})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"spam",className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Spam Detection"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:N?[void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s)):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-spam-accuracy",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Detection Accuracy"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-spam-accuracy",children:[T.accuracy,"%"]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-spam-blocked",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Spam Blocked"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-spam-blocked",children:T.blocked})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-spam-flagged",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Currently Flagged"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-spam-flagged",children:T.flagged})})]})]})}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Adjust Sensitivity"})}),(0,a.jsxs)(Z.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(aI.Label,{children:["Sensitivity Level: ",l[0],"%"]}),(0,a.jsx)(aR.Slider,{value:l,onValueChange:r,max:100,step:1,"data-testid":"slider-sensitivity"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Higher values will flag more content as potential spam"})]}),(0,a.jsx)(x.Button,{onClick:()=>R.mutate(l[0]),disabled:R.isPending,"data-testid":"button-update-sensitivity",children:"Update Sensitivity"})]})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Flagged Content"})}),(0,a.jsx)(Z.CardContent,{children:S?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Content"}),(0,a.jsx)(ee.TableHead,{children:"Spam Score"}),(0,a.jsx)(ee.TableHead,{children:"Author"}),(0,a.jsx)(ee.TableHead,{children:"Flagged At"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsxs)(ee.TableBody,{children:[k.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{className:"max-w-xs truncate",children:e.contentPreview}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:e.spamScore>80?"destructive":"secondary",children:[e.spamScore,"%"]})}),(0,a.jsx)(ee.TableCell,{children:e.authorUsername}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.flaggedAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-approve-${e.id}`,children:"Approve"})})]},e.id)),0===k.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No flagged content"})})]})]})})})]})]})]})]})}var a$=e.i(842009);function aU(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)(!1),[l,r]=(0,i.useState)(!1),[n,d]=(0,i.useState)("contributors"),[c,o]=(0,i.useState)("all-time"),{data:h,isLoading:u}=(0,J.useQuery)({queryKey:["/api/admin/gamification/badges"]}),p=Array.isArray(h)?h:[],{data:g,isLoading:v}=(0,J.useQuery)({queryKey:["/api/admin/gamification/achievements"]}),b=Array.isArray(g)?g:[],{data:y,isLoading:C}=(0,J.useQuery)({queryKey:["/api/admin/gamification/leaderboard",n,c]}),f=Array.isArray(y)?y:[],{data:N,isLoading:T}=(0,J.useQuery)({queryKey:["/api/admin/gamification/goals"]}),w=Array.isArray(N)?N:[],{data:S,isLoading:k}=(0,J.useQuery)({queryKey:["/api/admin/gamification/goal-completion"]}),D=Array.isArray(S)?S:[],A=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/gamification/badges","POST",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/gamification/badges"]}),e({title:"Badge created successfully"}),t(!1)}}),F=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/gamification/achievements","POST",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/gamification/achievements"]}),e({title:"Achievement created successfully"}),r(!1)}});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Gamification"}),(0,a.jsxs)(eS.Tabs,{defaultValue:"badges",className:"space-y-4",children:[(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsx)(eS.TabsTrigger,{value:"badges","data-testid":"tab-badges",children:"Badges"}),(0,a.jsx)(eS.TabsTrigger,{value:"achievements","data-testid":"tab-achievements",children:"Achievements"}),(0,a.jsx)(eS.TabsTrigger,{value:"leaderboards","data-testid":"tab-leaderboards",children:"Leaderboards"}),(0,a.jsx)(eS.TabsTrigger,{value:"goals","data-testid":"tab-goals",children:"Goals"})]}),(0,a.jsxs)(eS.TabsContent,{value:"badges",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Badges"}),(0,a.jsxs)(ew.Dialog,{open:s,onOpenChange:t,children:[(0,a.jsx)(ew.DialogTrigger,{asChild:!0,children:(0,a.jsx)(x.Button,{"data-testid":"button-create-badge",children:"Create Badge"})}),(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Create New Badge"})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);A.mutate({name:a.get("name"),description:a.get("description"),imageUrl:a.get("imageUrl"),rarity:a.get("rarity")})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"name",children:"Badge Name"}),(0,a.jsx)(m.Input,{id:"name",name:"name",required:!0,"data-testid":"input-badge-name"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"description",children:"Description"}),(0,a.jsx)(m.Input,{id:"description",name:"description",required:!0,"data-testid":"input-badge-description"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"imageUrl",children:"Image URL"}),(0,a.jsx)(m.Input,{id:"imageUrl",name:"imageUrl",type:"url",required:!0,"data-testid":"input-badge-image"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"rarity",children:"Rarity"}),(0,a.jsxs)(eT.Select,{name:"rarity",required:!0,children:[(0,a.jsx)(eT.SelectTrigger,{"data-testid":"select-badge-rarity",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select rarity"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"common",children:"Common"}),(0,a.jsx)(eT.SelectItem,{value:"rare",children:"Rare"}),(0,a.jsx)(eT.SelectItem,{value:"epic",children:"Epic"}),(0,a.jsx)(eT.SelectItem,{value:"legendary",children:"Legendary"})]})]})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{type:"submit",disabled:A.isPending,"data-testid":"button-submit-badge",children:A.isPending?"Creating...":"Create Badge"})})]})]})]})]}),u?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-48"},s))}):(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[p.map(e=>(0,a.jsxs)(Z.Card,{"data-testid":`badge-card-${e.id}`,children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center gap-4",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-muted rounded-lg flex items-center justify-center",children:e.imageUrl?(0,a.jsx)("img",{src:e.imageUrl,alt:e.name,className:"w-12 h-12"}):(0,a.jsx)(a$.Award,{className:"w-8 h-8"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(Z.CardTitle,{className:"text-lg","data-testid":`badge-name-${e.id}`,children:e.name}),(0,a.jsx)(ey.Badge,{variant:"secondary",children:e.rarity})]})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})}),(0,a.jsx)(Z.CardFooter,{className:"flex justify-between gap-2",children:(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"font-semibold",children:e.totalEarned||0})," earned"]})})]},e.id)),0===p.length&&(0,a.jsx)("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:"No badges created yet"})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"achievements",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Achievements"}),(0,a.jsxs)(ew.Dialog,{open:l,onOpenChange:r,children:[(0,a.jsx)(ew.DialogTrigger,{asChild:!0,children:(0,a.jsx)(x.Button,{"data-testid":"button-create-achievement",children:"Create Achievement"})}),(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Create New Achievement"})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);F.mutate({name:a.get("name"),description:a.get("description"),criteria:a.get("criteria"),rewardCoins:parseInt(a.get("rewardCoins"))})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"ach-name",children:"Achievement Name"}),(0,a.jsx)(m.Input,{id:"ach-name",name:"name",required:!0,"data-testid":"input-achievement-name"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"ach-description",children:"Description"}),(0,a.jsx)(m.Input,{id:"ach-description",name:"description",required:!0,"data-testid":"input-achievement-description"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"criteria",children:"Criteria"}),(0,a.jsx)(m.Input,{id:"criteria",name:"criteria",required:!0,"data-testid":"input-achievement-criteria"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"rewardCoins",children:"Reward Coins"}),(0,a.jsx)(m.Input,{id:"rewardCoins",name:"rewardCoins",type:"number",required:!0,"data-testid":"input-achievement-reward"})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{type:"submit",disabled:F.isPending,"data-testid":"button-submit-achievement",children:F.isPending?"Creating...":"Create Achievement"})})]})]})]})]}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:v?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Name"}),(0,a.jsx)(ee.TableHead,{children:"Description"}),(0,a.jsx)(ee.TableHead,{children:"Criteria"}),(0,a.jsx)(ee.TableHead,{children:"Reward"}),(0,a.jsx)(ee.TableHead,{children:"Completion Rate"})]})}),(0,a.jsxs)(ee.TableBody,{children:[b.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`achievement-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{className:"font-medium","data-testid":`achievement-name-${e.id}`,children:e.name}),(0,a.jsx)(ee.TableCell,{children:e.description}),(0,a.jsx)(ee.TableCell,{children:e.criteria}),(0,a.jsxs)(ee.TableCell,{children:[e.rewardCoins," coins"]}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"secondary",children:[e.completionRate||0,"%"]})})]},e.id)),0===b.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No achievements created"})})]})]})})})})]}),(0,a.jsxs)(eS.TabsContent,{value:"leaderboards",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Leaderboards"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsxs)(eT.Select,{value:n,onValueChange:d,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-48","data-testid":"select-leaderboard-type",children:(0,a.jsx)(eT.SelectValue,{})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"contributors",children:"Top Contributors"}),(0,a.jsx)(eT.SelectItem,{value:"earners",children:"Top Earners"}),(0,a.jsx)(eT.SelectItem,{value:"uploaders",children:"Top Uploaders"})]})]}),(0,a.jsxs)(eT.Select,{value:c,onValueChange:o,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-40","data-testid":"select-time-period",children:(0,a.jsx)(eT.SelectValue,{})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"weekly",children:"Weekly"}),(0,a.jsx)(eT.SelectItem,{value:"monthly",children:"Monthly"}),(0,a.jsx)(eT.SelectItem,{value:"all-time",children:"All Time"})]})]})]})]}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:C?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[...Array(10)].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{className:"w-20",children:"Rank"}),(0,a.jsx)(ee.TableHead,{children:"User"}),(0,a.jsx)(ee.TableHead,{children:"Score"})]})}),(0,a.jsxs)(ee.TableBody,{children:[f.map((e,s)=>(0,a.jsxs)(ee.TableRow,{"data-testid":`leaderboard-${s}`,children:[(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s<3&&(0,a.jsx)(U.Trophy,{className:`w-4 h-4 ${0===s?"text-yellow-500":1===s?"text-gray-400":"text-amber-700"}`}),(0,a.jsxs)("span",{className:"font-semibold",children:["#",s+1]})]})}),(0,a.jsx)(ee.TableCell,{"data-testid":`leaderboard-user-${s}`,children:e.username}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{children:e.score})})]},e.id)),0===f.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:3,className:"text-center text-muted-foreground py-8",children:"No data available"})})]})]})})})})]}),(0,a.jsxs)(eS.TabsContent,{value:"goals",className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"User Goals Analytics"}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Goal Completion Rate"})}),(0,a.jsx)(Z.CardContent,{children:k?(0,a.jsx)(j.Skeleton,{className:"h-64"}):D.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(en.LineChart,{data:D,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"date"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(ed.Line,{type:"monotone",dataKey:"completionRate",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Top Goals by Participation"})}),(0,a.jsx)(Z.CardContent,{children:T?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):w.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ec.BarChart,{data:w,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"name"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eo.Bar,{dataKey:"participants",fill:"hsl(var(--primary))"})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]})]})}var aQ=e.i(778917);function aO(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)(""),[l,r]=(0,i.useState)(!1),[n,d]=(0,i.useState)(!1),[c,o]=(0,i.useState)(null),{data:h,isLoading:u}=(0,J.useQuery)({queryKey:["/api/admin/seo/content",s]}),p=Array.isArray(h)?h:[],{data:g,isLoading:v}=(0,J.useQuery)({queryKey:["/api/admin/seo/campaigns"]}),b=Array.isArray(g)?g:[],{data:y,isLoading:C}=(0,J.useQuery)({queryKey:["/api/admin/seo/campaign-stats"]}),f=y||{reach:0,conversions:0,roi:0},{data:N,isLoading:T}=(0,J.useQuery)({queryKey:["/api/admin/seo/search-rankings"]}),w=Array.isArray(N)?N:[],{data:S,isLoading:k}=(0,J.useQuery)({queryKey:["/api/admin/seo/top-queries"]}),D=Array.isArray(S)?S:[],{data:A,isLoading:F}=(0,J.useQuery)({queryKey:["/api/admin/seo/sitemap-status"]}),H=A||{totalUrls:0},I=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)(`/api/admin/seo/meta/${e.id}`,"PATCH",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/seo/content"]}),e({title:"Meta tags updated successfully"}),r(!1)}}),B=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/seo/campaigns","POST",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/seo/campaigns"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/seo/campaign-stats"]}),e({title:"Campaign created successfully"}),d(!1)}}),q=(0,ef.useMutation)({mutationFn:()=>(0,eM.apiRequest)("/api/admin/seo/sitemap/generate","POST"),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/seo/sitemap-status"]}),e({title:"Sitemap generated successfully"})}});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"SEO & Marketing"}),(0,a.jsxs)(eS.Tabs,{defaultValue:"meta",className:"space-y-4",children:[(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsx)(eS.TabsTrigger,{value:"meta","data-testid":"tab-meta",children:"Meta Tags"}),(0,a.jsx)(eS.TabsTrigger,{value:"campaigns","data-testid":"tab-campaigns",children:"Campaigns"}),(0,a.jsx)(eS.TabsTrigger,{value:"analytics","data-testid":"tab-seo-analytics",children:"SEO Analytics"})]}),(0,a.jsxs)(eS.TabsContent,{value:"meta",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Meta Tags Management"}),(0,a.jsxs)("div",{className:"relative w-full md:w-auto md:min-w-80",children:[(0,a.jsx)(Q.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,a.jsx)(m.Input,{placeholder:"Search content...",value:s,onChange:e=>t(e.target.value),className:"pl-10","data-testid":"input-search-content"})]})]}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:u?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Title"}),(0,a.jsx)(ee.TableHead,{children:"Type"}),(0,a.jsx)(ee.TableHead,{children:"Meta Title"}),(0,a.jsx)(ee.TableHead,{children:"Meta Description"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsxs)(ee.TableBody,{children:[p.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`content-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{className:"font-medium max-w-xs truncate","data-testid":`content-title-${e.id}`,children:e.title}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"secondary",children:e.type})}),(0,a.jsx)(ee.TableCell,{className:"max-w-xs truncate",children:e.metaTitle||"-"}),(0,a.jsx)(ee.TableCell,{className:"max-w-xs truncate",children:e.metaDescription||"-"}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>{o(e),r(!0)},"data-testid":`button-edit-meta-${e.id}`,children:"Edit Meta"})})]},e.id)),0===p.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No content found"})})]})]})})})}),(0,a.jsx)(ew.Dialog,{open:l,onOpenChange:r,children:(0,a.jsxs)(ew.DialogContent,{className:"max-w-2xl",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Edit Meta Tags"})}),c&&(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);I.mutate({id:c.id,title:a.get("title"),description:a.get("description"),keywords:a.get("keywords")})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"title",children:"Meta Title"}),(0,a.jsx)(m.Input,{id:"title",name:"title",defaultValue:c.metaTitle,maxLength:60,"data-testid":"input-meta-title"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Recommended: 50-60 characters"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"description",children:"Meta Description"}),(0,a.jsx)(eN.Textarea,{id:"description",name:"description",defaultValue:c.metaDescription,maxLength:160,rows:3,"data-testid":"textarea-meta-description"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Recommended: 150-160 characters"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"keywords",children:"Keywords (comma-separated)"}),(0,a.jsx)(m.Input,{id:"keywords",name:"keywords",defaultValue:c.metaKeywords,"data-testid":"input-meta-keywords"})]}),(0,a.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"Search Result Preview"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-sm text-blue-600 hover:underline cursor-pointer",children:c.metaTitle||c.title}),(0,a.jsx)("div",{className:"text-xs text-green-700",children:"https://yoforex.com/..."}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:c.metaDescription||"No description provided"})]})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{type:"submit",disabled:I.isPending,"data-testid":"button-save-meta",children:I.isPending?"Saving...":"Save Changes"})})]})]})})]}),(0,a.jsxs)(eS.TabsContent,{value:"campaigns",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Marketing Campaigns"}),(0,a.jsxs)(ew.Dialog,{open:n,onOpenChange:d,children:[(0,a.jsx)(ew.DialogTrigger,{asChild:!0,children:(0,a.jsx)(x.Button,{"data-testid":"button-create-campaign",children:"Create Campaign"})}),(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Create Marketing Campaign"})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);B.mutate({name:a.get("name"),description:a.get("description"),startDate:a.get("startDate"),endDate:a.get("endDate"),budget:parseFloat(a.get("budget"))})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"camp-name",children:"Campaign Name"}),(0,a.jsx)(m.Input,{id:"camp-name",name:"name",required:!0,"data-testid":"input-campaign-name"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"camp-description",children:"Description"}),(0,a.jsx)(eN.Textarea,{id:"camp-description",name:"description",required:!0,"data-testid":"textarea-campaign-description"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"startDate",children:"Start Date"}),(0,a.jsx)(m.Input,{id:"startDate",name:"startDate",type:"date",required:!0,"data-testid":"input-campaign-start"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"endDate",children:"End Date"}),(0,a.jsx)(m.Input,{id:"endDate",name:"endDate",type:"date",required:!0,"data-testid":"input-campaign-end"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"budget",children:"Budget ($)"}),(0,a.jsx)(m.Input,{id:"budget",name:"budget",type:"number",step:"0.01",required:!0,"data-testid":"input-campaign-budget"})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{type:"submit",disabled:B.isPending,"data-testid":"button-submit-campaign",children:B.isPending?"Creating...":"Create Campaign"})})]})]})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:C?[void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s)):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-campaign-reach",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Reach"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-campaign-reach",children:f.reach.toLocaleString()})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-campaign-conversions",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Conversions"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-campaign-conversions",children:f.conversions})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-campaign-roi",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"ROI"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-campaign-roi",children:[f.roi,"%"]})})]})]})}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:v?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Name"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Start Date"}),(0,a.jsx)(ee.TableHead,{children:"End Date"}),(0,a.jsx)(ee.TableHead,{children:"Budget"}),(0,a.jsx)(ee.TableHead,{children:"Performance"})]})}),(0,a.jsxs)(ee.TableBody,{children:[b.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`campaign-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{className:"font-medium","data-testid":`campaign-name-${e.id}`,children:e.name}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"active"===e.status?"default":"secondary",children:e.status})}),(0,a.jsx)(ee.TableCell,{children:new Date(e.startDate).toLocaleDateString()}),(0,a.jsx)(ee.TableCell,{children:new Date(e.endDate).toLocaleDateString()}),(0,a.jsxs)(ee.TableCell,{children:["$",e.budget.toLocaleString()]}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"outline",children:[e.performance||0,"% CTR"]})})]},e.id)),0===b.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No campaigns created"})})]})]})})})})]}),(0,a.jsxs)(eS.TabsContent,{value:"analytics",className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"SEO Analytics"}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Search Rankings"})}),(0,a.jsx)(Z.CardContent,{children:T?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Page"}),(0,a.jsx)(ee.TableHead,{children:"Keyword"}),(0,a.jsx)(ee.TableHead,{children:"Position"}),(0,a.jsx)(ee.TableHead,{children:"Change"})]})}),(0,a.jsxs)(ee.TableBody,{children:[w.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{className:"max-w-xs truncate",children:e.page}),(0,a.jsx)(ee.TableCell,{children:e.keyword}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"secondary",children:["#",e.position]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:(e.change??0)>0?"default":"destructive",children:[(e.change??0)>0?"+":"",e.change??0]})})]},e.id)),0===w.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No ranking data available"})})]})]})})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Top Search Queries"})}),(0,a.jsx)(Z.CardContent,{children:k?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Query"}),(0,a.jsx)(ee.TableHead,{children:"Impressions"}),(0,a.jsx)(ee.TableHead,{children:"Clicks"}),(0,a.jsx)(ee.TableHead,{children:"CTR"})]})}),(0,a.jsxs)(ee.TableBody,{children:[D.map((e,s)=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{className:"font-medium",children:e.query}),(0,a.jsx)(ee.TableCell,{children:e.impressions.toLocaleString()}),(0,a.jsx)(ee.TableCell,{children:e.clicks.toLocaleString()}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"outline",children:[e.ctr,"%"]})})]},s)),0===D.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No query data available"})})]})]})})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2",children:[(0,a.jsx)(Z.CardTitle,{children:"Sitemap Status"}),(0,a.jsxs)(x.Button,{onClick:()=>q.mutate(),disabled:q.isPending,"data-testid":"button-generate-sitemap",children:[(0,a.jsx)(R.FileText,{className:"w-4 h-4 mr-2"}),"Generate Sitemap"]})]}),(0,a.jsx)(Z.CardContent,{children:F?(0,a.jsx)(j.Skeleton,{className:"h-20"}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Last Generated:"}),(0,a.jsx)("span",{className:"font-medium",children:H.lastGenerated?(0,er.formatDistanceToNow)(new Date(H.lastGenerated),{addSuffix:!0}):"Never"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total URLs:"}),(0,a.jsx)(ey.Badge,{variant:"secondary",children:H.totalUrls})]}),H.sitemapUrl&&(0,a.jsx)("div",{className:"flex items-center gap-2 pt-2",children:(0,a.jsxs)("a",{href:H.sitemapUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:["View Sitemap ",(0,a.jsx)(aQ.ExternalLink,{className:"w-3 h-3"})]})})]})})]})]})]})]})}var az=e.i(877148),aW=e.i(834161);let aG=(0,n.default)("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]),a_=(0,n.default)("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),aY=[{id:"user.created",label:"User Created"},{id:"user.updated",label:"User Updated"},{id:"content.published",label:"Content Published"},{id:"content.deleted",label:"Content Deleted"},{id:"transaction.completed",label:"Transaction Completed"},{id:"comment.posted",label:"Comment Posted"}];function aX(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)(!1),[l,r]=(0,i.useState)(!1),[n,d]=(0,i.useState)(null),[c,o]=(0,i.useState)([]),[h,u]=(0,i.useState)("all"),[p,g]=(0,i.useState)("all"),[v,b]=(0,i.useState)("all"),{data:y,isLoading:C}=(0,J.useQuery)({queryKey:["/api/admin/integrations/api-keys"]}),f=Array.isArray(y)?y:[],{data:N,isLoading:T}=(0,J.useQuery)({queryKey:["/api/admin/integrations/webhooks"]}),w=Array.isArray(N)?N:[],{data:S,isLoading:k}=(0,J.useQuery)({queryKey:["/api/admin/integrations/event-logs",h,p,v]}),D=Array.isArray(S)?S:[],A=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/integrations/api-keys","POST",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/api-keys"]}),e({title:"API key created successfully"}),t(!1)}}),F=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)(`/api/admin/integrations/api-keys/${e}/revoke`,"DELETE"),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/api-keys"]}),e({title:"API key revoked"}),d(null)}}),H=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/integrations/webhooks","POST",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/webhooks"]}),e({title:"Webhook created successfully"}),r(!1),o([])}}),R=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)(`/api/admin/integrations/webhooks/${e}/test`,"POST"),onSuccess:()=>{e({title:"Test webhook sent"})}}),I=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)(`/api/admin/integrations/event-logs/${e}/retry`,"POST"),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/event-logs"]}),e({title:"Event retry initiated"})}});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"API & Integrations"}),(0,a.jsxs)(eS.Tabs,{defaultValue:"api-keys",className:"space-y-4",children:[(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsx)(eS.TabsTrigger,{value:"api-keys","data-testid":"tab-api-keys",children:"API Keys"}),(0,a.jsx)(eS.TabsTrigger,{value:"webhooks","data-testid":"tab-webhooks",children:"Webhooks"}),(0,a.jsx)(eS.TabsTrigger,{value:"event-logs","data-testid":"tab-event-logs",children:"Event Logs"})]}),(0,a.jsxs)(eS.TabsContent,{value:"api-keys",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"API Keys"}),(0,a.jsxs)(ew.Dialog,{open:s,onOpenChange:t,children:[(0,a.jsx)(ew.DialogTrigger,{asChild:!0,children:(0,a.jsxs)(x.Button,{"data-testid":"button-create-api-key",children:[(0,a.jsx)(aW.Key,{className:"w-4 h-4 mr-2"}),"Create API Key"]})}),(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Create API Key"})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);A.mutate({name:a.get("name"),permissions:a.get("permissions"),rateLimit:parseInt(a.get("rateLimit"))})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"key-name",children:"Name"}),(0,a.jsx)(m.Input,{id:"key-name",name:"name",required:!0,"data-testid":"input-api-key-name"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"permissions",children:"Permissions"}),(0,a.jsxs)(eT.Select,{name:"permissions",required:!0,children:[(0,a.jsx)(eT.SelectTrigger,{"data-testid":"select-api-key-permissions",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select permissions"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"read",children:"Read Only"}),(0,a.jsx)(eT.SelectItem,{value:"write",children:"Read & Write"}),(0,a.jsx)(eT.SelectItem,{value:"admin",children:"Admin"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"rateLimit",children:"Rate Limit (requests/hour)"}),(0,a.jsx)(m.Input,{id:"rateLimit",name:"rateLimit",type:"number",defaultValue:"1000",required:!0,"data-testid":"input-api-key-rate-limit"})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{type:"submit",disabled:A.isPending,"data-testid":"button-submit-api-key",children:A.isPending?"Creating...":"Create API Key"})})]})]})]})]}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:C?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Name"}),(0,a.jsx)(ee.TableHead,{children:"Key"}),(0,a.jsx)(ee.TableHead,{children:"Permissions"}),(0,a.jsx)(ee.TableHead,{children:"Rate Limit"}),(0,a.jsx)(ee.TableHead,{children:"Last Used"}),(0,a.jsx)(ee.TableHead,{children:"Usage"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsxs)(ee.TableBody,{children:[f.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`api-key-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{className:"font-medium","data-testid":`api-key-name-${e.id}`,children:e.name}),(0,a.jsxs)(ee.TableCell,{className:"font-mono text-xs",children:[e.key.substring(0,12),"...",e.key.substring(e.key.length-4)]}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"outline",children:e.permissions})}),(0,a.jsxs)(ee.TableCell,{children:[e.rateLimit,"/hr"]}),(0,a.jsx)(ee.TableCell,{children:e.lastUsedAt?(0,er.formatDistanceToNow)(new Date(e.lastUsedAt),{addSuffix:!0}):"Never"}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"secondary",children:[e.usageCount||0," requests"]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"destructive",onClick:()=>d(e.id),"data-testid":`button-revoke-${e.id}`,children:"Revoke"})})]},e.id)),0===f.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No API keys created"})})]})]})})})}),(0,a.jsx)(az.AlertDialog,{open:!!n,onOpenChange:e=>!e&&d(null),children:(0,a.jsxs)(az.AlertDialogContent,{children:[(0,a.jsxs)(az.AlertDialogHeader,{children:[(0,a.jsx)(az.AlertDialogTitle,{children:"Revoke API Key"}),(0,a.jsx)(az.AlertDialogDescription,{children:"Are you sure you want to revoke this API key? This action cannot be undone and will immediately invalidate the key."})]}),(0,a.jsxs)(az.AlertDialogFooter,{children:[(0,a.jsx)(az.AlertDialogCancel,{"data-testid":"button-cancel-revoke",children:"Cancel"}),(0,a.jsx)(az.AlertDialogAction,{onClick:()=>n&&F.mutate(n),"data-testid":"button-confirm-revoke",children:"Revoke"})]})]})})]}),(0,a.jsxs)(eS.TabsContent,{value:"webhooks",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Webhooks"}),(0,a.jsxs)(ew.Dialog,{open:l,onOpenChange:r,children:[(0,a.jsx)(ew.DialogTrigger,{asChild:!0,children:(0,a.jsxs)(x.Button,{"data-testid":"button-create-webhook",children:[(0,a.jsx)(aG,{className:"w-4 h-4 mr-2"}),"Create Webhook"]})}),(0,a.jsxs)(ew.DialogContent,{className:"max-w-2xl",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Create Webhook"})}),(0,a.jsxs)("form",{onSubmit:a=>{a.preventDefault();let s=new FormData(a.currentTarget);0===c.length?e({title:"Please select at least one event",variant:"destructive"}):H.mutate({url:s.get("url"),events:c,secret:s.get("secret")})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"url",children:"Webhook URL"}),(0,a.jsx)(m.Input,{id:"url",name:"url",type:"url",placeholder:"https://example.com/webhook",required:!0,"data-testid":"input-webhook-url"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{children:"Events"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2 p-4 border rounded-lg",children:aY.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eE.Checkbox,{id:e.id,checked:c.includes(e.id),onCheckedChange:a=>{o(a?[...c,e.id]:c.filter(a=>a!==e.id))},"data-testid":`checkbox-event-${e.id}`}),(0,a.jsx)(aI.Label,{htmlFor:e.id,className:"text-sm cursor-pointer",children:e.label})]},e.id))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"secret",children:"Secret (optional)"}),(0,a.jsx)(m.Input,{id:"secret",name:"secret",placeholder:"Webhook signing secret","data-testid":"input-webhook-secret"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Used to verify webhook authenticity"})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{type:"submit",disabled:H.isPending,"data-testid":"button-submit-webhook",children:H.isPending?"Creating...":"Create Webhook"})})]})]})]})]}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:T?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"URL"}),(0,a.jsx)(ee.TableHead,{children:"Events"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Success"}),(0,a.jsx)(ee.TableHead,{children:"Failures"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsxs)(ee.TableBody,{children:[w.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`webhook-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{className:"font-mono text-xs max-w-xs truncate","data-testid":`webhook-url-${e.id}`,children:e.url}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.events?.slice(0,2).map(e=>(0,a.jsx)(ey.Badge,{variant:"secondary",className:"text-xs",children:e},e)),(e.events?.length??0)>2&&(0,a.jsxs)(ey.Badge,{variant:"secondary",className:"text-xs",children:["+",(e.events?.length??0)-2]})]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:e.active?"default":"secondary",children:e.active?"Active":"Inactive"})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"outline",children:e.successCount||0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:(e.failureCount??0)>0?"destructive":"outline",children:e.failureCount||0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>R.mutate(e.id),disabled:R.isPending,"data-testid":`button-test-webhook-${e.id}`,children:"Test"})})]},e.id)),0===w.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No webhooks configured"})})]})]})})})})]}),(0,a.jsxs)(eS.TabsContent,{value:"event-logs",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Event Logs"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsxs)(eT.Select,{value:h,onValueChange:u,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-48","data-testid":"select-filter-webhook",children:(0,a.jsx)(eT.SelectValue,{placeholder:"All Webhooks"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Webhooks"}),w.map(e=>(0,a.jsxs)(eT.SelectItem,{value:e.id,children:[e.url.substring(0,30),"..."]},e.id))]})]}),(0,a.jsxs)(eT.Select,{value:p,onValueChange:g,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-48","data-testid":"select-filter-event-type",children:(0,a.jsx)(eT.SelectValue,{placeholder:"All Events"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Events"}),aY.map(e=>(0,a.jsx)(eT.SelectItem,{value:e.id,children:e.label},e.id))]})]}),(0,a.jsxs)(eT.Select,{value:v,onValueChange:b,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-40","data-testid":"select-filter-status",children:(0,a.jsx)(eT.SelectValue,{placeholder:"All Status"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Status"}),(0,a.jsx)(eT.SelectItem,{value:"success",children:"Success"}),(0,a.jsx)(eT.SelectItem,{value:"failed",children:"Failed"}),(0,a.jsx)(eT.SelectItem,{value:"pending",children:"Pending"})]})]})]})]}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:k?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[...Array(10)].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Event Type"}),(0,a.jsx)(ee.TableHead,{children:"Webhook"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Response"}),(0,a.jsx)(ee.TableHead,{children:"Timestamp"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsxs)(ee.TableBody,{children:[D.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"secondary",children:e.eventType})}),(0,a.jsx)(ee.TableCell,{className:"font-mono text-xs max-w-xs truncate",children:e.webhookUrl}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"success"===e.status?"default":"failed"===e.status?"destructive":"secondary",children:e.status})}),(0,a.jsx)(ee.TableCell,{className:"max-w-xs truncate",children:e.response||"-"}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:"failed"===e.status&&(0,a.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>I.mutate(e.id),disabled:I.isPending,"data-testid":`button-retry-${e.id}`,children:[(0,a.jsx)(a_,{className:"w-3 h-3 mr-1"}),"Retry"]})})]},e.id)),0===D.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No event logs found"})})]})]})})})})]})]})]})}var aJ=e.i(245423);let aZ=["hsl(var(--primary))","hsl(var(--accent))","hsl(var(--muted))","hsl(var(--destructive))"];function a0(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)("all"),{data:l,isLoading:r}=(0,J.useQuery)({queryKey:["/api/admin/mobile/notification-history"]}),n=Array.isArray(l)?l:[],{data:d,isLoading:c}=(0,J.useQuery)({queryKey:["/api/admin/mobile/app-versions"]}),o=Array.isArray(d)?d:[],{data:h,isLoading:u}=(0,J.useQuery)({queryKey:["/api/admin/mobile/version-distribution"]}),p=Array.isArray(h)?h:[],{data:g,isLoading:v}=(0,J.useQuery)({queryKey:["/api/admin/mobile/device-types"]}),b=Array.isArray(g)?g:[],{data:y,isLoading:C}=(0,J.useQuery)({queryKey:["/api/admin/mobile/os-distribution"]}),f=Array.isArray(y)?y:[],{data:N,isLoading:T}=(0,J.useQuery)({queryKey:["/api/admin/mobile/browser-distribution"]}),w=Array.isArray(N)?N:[],{data:S,isLoading:k}=(0,J.useQuery)({queryKey:["/api/admin/mobile/screen-resolutions"]}),D=Array.isArray(S)?S:[],A=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/mobile/send-notification","POST",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/mobile/notification-history"]}),e({title:"Notification sent successfully"})}}),F=(0,ef.useMutation)({mutationFn:({id:e,forceUpdate:a})=>(0,eM.apiRequest)(`/api/admin/mobile/app-versions/${e}/force-update`,"PATCH",{forceUpdate:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/mobile/app-versions"]}),e({title:"Force update setting updated"})}});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Mobile & Push Notifications"}),(0,a.jsxs)(eS.Tabs,{defaultValue:"push",className:"space-y-4",children:[(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsx)(eS.TabsTrigger,{value:"push","data-testid":"tab-push",children:"Push Notifications"}),(0,a.jsx)(eS.TabsTrigger,{value:"versions","data-testid":"tab-versions",children:"App Versions"}),(0,a.jsx)(eS.TabsTrigger,{value:"analytics","data-testid":"tab-device-analytics",children:"Device Analytics"})]}),(0,a.jsxs)(eS.TabsContent,{value:"push",className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Send Push Notification"}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"pt-6",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);A.mutate({title:a.get("title"),body:a.get("body"),targetType:s,targetValue:a.get("targetValue")})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"title",children:"Notification Title"}),(0,a.jsx)(m.Input,{id:"title",name:"title",required:!0,"data-testid":"input-notification-title"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"body",children:"Notification Body"}),(0,a.jsx)(eN.Textarea,{id:"body",name:"body",rows:3,required:!0,"data-testid":"textarea-notification-body"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{children:"Target"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eE.Checkbox,{id:"target-all",checked:"all"===s,onCheckedChange:()=>t("all"),"data-testid":"checkbox-target-all"}),(0,a.jsx)(aI.Label,{htmlFor:"target-all",className:"cursor-pointer",children:"All Users"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eE.Checkbox,{id:"target-segments",checked:"segments"===s,onCheckedChange:()=>t("segments"),"data-testid":"checkbox-target-segments"}),(0,a.jsx)(aI.Label,{htmlFor:"target-segments",className:"cursor-pointer",children:"Specific Segments"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(eE.Checkbox,{id:"target-users",checked:"users"===s,onCheckedChange:()=>t("users"),"data-testid":"checkbox-target-users"}),(0,a.jsx)(aI.Label,{htmlFor:"target-users",className:"cursor-pointer",children:"Specific User IDs"})]})]})]}),("segments"===s||"users"===s)&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"targetValue",children:"segments"===s?"Segment Names (comma-separated)":"User IDs (comma-separated)"}),(0,a.jsx)(m.Input,{id:"targetValue",name:"targetValue",placeholder:"segments"===s?"premium, active-traders":"user-123, user-456","data-testid":"input-target-value"})]}),(0,a.jsxs)(x.Button,{type:"submit",disabled:A.isPending,"data-testid":"button-send-notification",children:[(0,a.jsx)(aJ.Bell,{className:"w-4 h-4 mr-2"}),A.isPending?"Sending...":"Send Notification"]})]})})}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Notification History"})}),(0,a.jsx)(Z.CardContent,{children:r?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Title"}),(0,a.jsx)(ee.TableHead,{children:"Target"}),(0,a.jsx)(ee.TableHead,{children:"Delivered"}),(0,a.jsx)(ee.TableHead,{children:"Opened"}),(0,a.jsx)(ee.TableHead,{children:"CTR"}),(0,a.jsx)(ee.TableHead,{children:"Sent At"})]})}),(0,a.jsxs)(ee.TableBody,{children:[n.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{className:"font-medium max-w-xs truncate",children:e.title}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"secondary",children:e.targetType})}),(0,a.jsx)(ee.TableCell,{children:e.deliveredCount}),(0,a.jsx)(ee.TableCell,{children:e.openedCount}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"outline",children:[e.ctr,"%"]})}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.sentAt),{addSuffix:!0})})]},e.id)),0===n.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No notifications sent yet"})})]})]})})})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"versions",className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"App Versions"}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:c?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Version"}),(0,a.jsx)(ee.TableHead,{children:"Platform"}),(0,a.jsx)(ee.TableHead,{children:"Release Date"}),(0,a.jsx)(ee.TableHead,{children:"Users"}),(0,a.jsx)(ee.TableHead,{children:"Force Update"})]})}),(0,a.jsxs)(ee.TableBody,{children:[o.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`version-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{className:"font-medium",children:e.version}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"secondary",children:e.platform})}),(0,a.jsx)(ee.TableCell,{children:new Date(e.releaseDate).toLocaleDateString()}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"outline",children:[e.userCount," users"]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(aH.Switch,{checked:e.forceUpdate,onCheckedChange:a=>F.mutate({id:e.id,forceUpdate:a}),"data-testid":`switch-force-update-${e.id}`})})]},e.id)),0===o.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No app versions found"})})]})]})})})}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"User Distribution by Version"})}),(0,a.jsx)(Z.CardContent,{children:u?(0,a.jsx)(j.Skeleton,{className:"h-64"}):p.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ex.PieChart,{children:[(0,a.jsx)(em.Pie,{data:p,cx:"50%",cy:"50%",labelLine:!1,label:e=>`v${e.version}: ${e.percentage}%`,outerRadius:80,fill:"hsl(var(--primary))",dataKey:"count",children:p.map((e,s)=>(0,a.jsx)(eh.Cell,{fill:aZ[s%aZ.length]},`cell-${s}`))}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eb.Legend,{})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"analytics",className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Device Analytics"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Device Types"})}),(0,a.jsx)(Z.CardContent,{children:v?(0,a.jsx)(j.Skeleton,{className:"h-64"}):b.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ex.PieChart,{children:[(0,a.jsx)(em.Pie,{data:b,cx:"50%",cy:"50%",labelLine:!1,label:e=>`${e.name}: ${e.percentage}%`,outerRadius:80,fill:"hsl(var(--primary))",dataKey:"value",children:b.map((e,s)=>(0,a.jsx)(eh.Cell,{fill:aZ[s%aZ.length]},`cell-${s}`))}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eb.Legend,{})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"OS Distribution"})}),(0,a.jsx)(Z.CardContent,{children:C?(0,a.jsx)(j.Skeleton,{className:"h-64"}):f.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ec.BarChart,{data:f,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"name"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eo.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Browser Distribution"})}),(0,a.jsx)(Z.CardContent,{children:T?(0,a.jsx)(j.Skeleton,{className:"h-64"}):w.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ec.BarChart,{data:w,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"name"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eo.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Screen Resolutions"})}),(0,a.jsx)(Z.CardContent,{children:k?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-8"},s))}):D.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Resolution"}),(0,a.jsx)(ee.TableHead,{children:"Users"}),(0,a.jsx)(ee.TableHead,{children:"Percentage"})]})}),(0,a.jsx)(ee.TableBody,{children:D.map((e,s)=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{className:"font-medium",children:e.resolution}),(0,a.jsx)(ee.TableCell,{children:e.count}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"secondary",children:[e.percentage,"%"]})})]},s))})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]})]})]})}let a2=(0,n.default)("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]),a1=(0,n.default)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);function a4(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)(!1),[l,r]=(0,i.useState)(!1),{data:n,isLoading:d}=(0,J.useQuery)({queryKey:["/api/admin/performance/system-metrics"]}),c=n||{cpu:0,memory:0,diskIO:0,network:0},{data:o,isLoading:h}=(0,J.useQuery)({queryKey:["/api/admin/performance/response-time"]}),u=Array.isArray(o)?o:[],{data:p,isLoading:g}=(0,J.useQuery)({queryKey:["/api/admin/performance/throughput"]}),v=Array.isArray(p)?p:[],{data:b,isLoading:y}=(0,J.useQuery)({queryKey:["/api/admin/performance/alerts"]}),C=Array.isArray(b)?b:[],{data:f,isLoading:N}=(0,J.useQuery)({queryKey:["/api/admin/performance/alert-history"]}),T=Array.isArray(f)?f:[],{data:w,isLoading:S}=(0,J.useQuery)({queryKey:["/api/admin/performance/slow-queries"]}),k=Array.isArray(w)?w:[],{data:D,isLoading:A}=(0,J.useQuery)({queryKey:["/api/admin/performance/database-metrics"]}),F=D||{avgQueryTime:0,activeConnections:0,maxConnections:0,poolUsage:0},{data:H,isLoading:R}=(0,J.useQuery)({queryKey:["/api/admin/performance/query-histogram"]}),I=Array.isArray(H)?H:[],{data:B,isLoading:q}=(0,J.useQuery)({queryKey:["/api/admin/performance/cache-stats"]}),L=B||{hitRate:0,hits:0,misses:0,size:0,keyCount:0},{data:P,isLoading:M}=(0,J.useQuery)({queryKey:["/api/admin/performance/cached-keys"]}),K=Array.isArray(P)?P:[],E=(0,ef.useMutation)({mutationFn:()=>(0,eM.apiRequest)("/api/admin/performance/record-metric","POST"),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/performance/system-metrics"]}),e({title:"Metric recorded"})}}),V=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/performance/alerts","POST",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/performance/alerts"]}),e({title:"Alert threshold configured"}),t(!1)}}),$=(0,ef.useMutation)({mutationFn:()=>(0,eM.apiRequest)("/api/admin/performance/cache/clear","DELETE"),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/performance/cache-stats"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/performance/cached-keys"]}),e({title:"Cache cleared successfully"}),r(!1)}});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Performance Monitor"}),(0,a.jsxs)(eS.Tabs,{defaultValue:"metrics",className:"space-y-4",children:[(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsx)(eS.TabsTrigger,{value:"metrics","data-testid":"tab-metrics",children:"Metrics"}),(0,a.jsx)(eS.TabsTrigger,{value:"alerts","data-testid":"tab-alerts",children:"Alerts"}),(0,a.jsx)(eS.TabsTrigger,{value:"database","data-testid":"tab-database",children:"Database Performance"}),(0,a.jsx)(eS.TabsTrigger,{value:"cache","data-testid":"tab-cache",children:"Cache Stats"})]}),(0,a.jsxs)(eS.TabsContent,{value:"metrics",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"System Metrics"}),(0,a.jsxs)(x.Button,{onClick:()=>E.mutate(),disabled:E.isPending,"data-testid":"button-record-metric",children:[(0,a.jsx)(W.Activity,{className:"w-4 h-4 mr-2"}),"Record Metric"]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:d?[void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s)):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-cpu",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"CPU Usage"}),(0,a.jsx)(a2,{className:"w-4 h-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-cpu-usage",children:[c.cpu,"%"]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-memory",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Memory Usage"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-memory-usage",children:[c.memory,"%"]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-disk",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Disk I/O"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-disk-io",children:[c.diskIO," MB/s"]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-network",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Network"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-network",children:[c.network," MB/s"]})})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Response Time (Last 24 Hours)"})}),(0,a.jsx)(Z.CardContent,{children:h?(0,a.jsx)(j.Skeleton,{className:"h-64"}):u.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(en.LineChart,{data:u,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"time"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(ed.Line,{type:"monotone",dataKey:"responseTime",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Throughput (Requests/Second)"})}),(0,a.jsx)(Z.CardContent,{children:g?(0,a.jsx)(j.Skeleton,{className:"h-64"}):v.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(en.LineChart,{data:v,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"time"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(ed.Line,{type:"monotone",dataKey:"rps",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"alerts",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Performance Alerts"}),(0,a.jsxs)(ew.Dialog,{open:s,onOpenChange:t,children:[(0,a.jsx)(ew.DialogTrigger,{asChild:!0,children:(0,a.jsx)(x.Button,{"data-testid":"button-configure-alert",children:"Configure Alert"})}),(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Configure Alert Threshold"})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);V.mutate({metricType:a.get("metricType"),threshold:parseFloat(a.get("threshold")),condition:a.get("condition")})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"metricType",children:"Metric Type"}),(0,a.jsx)(m.Input,{id:"metricType",name:"metricType",required:!0,"data-testid":"input-metric-type"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"threshold",children:"Threshold Value"}),(0,a.jsx)(m.Input,{id:"threshold",name:"threshold",type:"number",step:"0.01",required:!0,"data-testid":"input-threshold"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"condition",children:"Condition"}),(0,a.jsx)(m.Input,{id:"condition",name:"condition",placeholder:"e.g., greater than",required:!0,"data-testid":"input-condition"})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{type:"submit",disabled:V.isPending,"data-testid":"button-submit-alert",children:V.isPending?"Configuring...":"Configure Alert"})})]})]})]})]}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:y?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Metric"}),(0,a.jsx)(ee.TableHead,{children:"Condition"}),(0,a.jsx)(ee.TableHead,{children:"Threshold"}),(0,a.jsx)(ee.TableHead,{children:"Current Value"}),(0,a.jsx)(ee.TableHead,{children:"Status"})]})}),(0,a.jsxs)(ee.TableBody,{children:[C.map(e=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{className:"font-medium",children:e.metricType}),(0,a.jsx)(ee.TableCell,{children:e.condition}),(0,a.jsx)(ee.TableCell,{children:e.threshold}),(0,a.jsx)(ee.TableCell,{children:e.currentValue}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:e.triggered?"destructive":"default",children:e.triggered?"Triggered":"OK"})})]},e.id)),0===C.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No alerts configured"})})]})]})})})}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Alert History"})}),(0,a.jsx)(Z.CardContent,{children:N?(0,a.jsx)(j.Skeleton,{className:"h-64"}):T.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ec.BarChart,{data:T,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"date"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eo.Bar,{dataKey:"count",fill:"hsl(var(--destructive))"})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No alert history"})})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"database",className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Database Performance"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:A?[void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s)):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-query-time",children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Avg Query Time"}),(0,a.jsx)(a1,{className:"w-4 h-4 text-muted-foreground"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-query-time",children:[F.avgQueryTime,"ms"]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-connections",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Active Connections"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-connections",children:[F.activeConnections," / ",F.maxConnections]})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-pool-usage",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Pool Usage"})}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-pool-usage",children:[F.poolUsage,"%"]})})]})]})}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Slow Queries"})}),(0,a.jsx)(Z.CardContent,{children:S?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Query"}),(0,a.jsx)(ee.TableHead,{children:"Execution Time"}),(0,a.jsx)(ee.TableHead,{children:"Calls"}),(0,a.jsx)(ee.TableHead,{children:"Last Run"})]})}),(0,a.jsxs)(ee.TableBody,{children:[k.map((e,s)=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{className:"font-mono text-xs max-w-md truncate",children:e.query}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"destructive",children:[e.executionTime,"ms"]})}),(0,a.jsx)(ee.TableCell,{children:e.callCount}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.lastRun),{addSuffix:!0})})]},s)),0===k.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No slow queries detected"})})]})]})})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Query Execution Time Histogram"})}),(0,a.jsx)(Z.CardContent,{children:R?(0,a.jsx)(j.Skeleton,{className:"h-64"}):I.length>0?(0,a.jsx)(ev.ResponsiveContainer,{width:"100%",height:250,children:(0,a.jsxs)(ec.BarChart,{data:I,children:[(0,a.jsx)(ep.CartesianGrid,{strokeDasharray:"3 3"}),(0,a.jsx)(eu.XAxis,{dataKey:"range"}),(0,a.jsx)(ej.YAxis,{}),(0,a.jsx)(eg.Tooltip,{}),(0,a.jsx)(eo.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,a.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]}),(0,a.jsxs)(eS.TabsContent,{value:"cache",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Cache Statistics"}),(0,a.jsxs)(x.Button,{variant:"destructive",onClick:()=>r(!0),"data-testid":"button-clear-cache",children:[(0,a.jsx)(eX.Trash2,{className:"w-4 h-4 mr-2"}),"Clear Cache"]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:q?[void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-32"},s)):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-hit-rate",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Cache Hit Rate"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-hit-rate",children:[L.hitRate,"%"]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[L.hits," hits / ",L.misses," misses"]})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-cache-size",children:[(0,a.jsx)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Cache Size"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-cache-size",children:[L.size," MB"]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[L.keyCount," keys stored"]})]})]})]})}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Most Cached Keys"})}),(0,a.jsx)(Z.CardContent,{children:M?(0,a.jsx)("div",{className:"space-y-2",children:[...Array(10)].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Key"}),(0,a.jsx)(ee.TableHead,{children:"Hits"}),(0,a.jsx)(ee.TableHead,{children:"Size"}),(0,a.jsx)(ee.TableHead,{children:"TTL"})]})}),(0,a.jsxs)(ee.TableBody,{children:[K.map((e,s)=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{className:"font-mono text-xs max-w-md truncate",children:e.key}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"secondary",children:e.hits})}),(0,a.jsxs)(ee.TableCell,{children:[e.size," KB"]}),(0,a.jsxs)(ee.TableCell,{children:[e.ttl,"s"]})]},s)),0===K.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No cached keys"})})]})]})})})]})]})]}),(0,a.jsx)(az.AlertDialog,{open:l,onOpenChange:r,children:(0,a.jsxs)(az.AlertDialogContent,{children:[(0,a.jsxs)(az.AlertDialogHeader,{children:[(0,a.jsx)(az.AlertDialogTitle,{children:"Clear Cache"}),(0,a.jsx)(az.AlertDialogDescription,{children:"Are you sure you want to clear the entire cache? This action cannot be undone and may temporarily affect performance."})]}),(0,a.jsxs)(az.AlertDialogFooter,{children:[(0,a.jsx)(az.AlertDialogCancel,{children:"Cancel"}),(0,a.jsx)(az.AlertDialogAction,{onClick:()=>$.mutate(),className:"bg-destructive hover:bg-destructive/90",children:"Clear Cache"})]})]})})]})}var a3=e.i(569074),a5=e.i(473708);let a6=(0,n.default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function a8(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)(""),[l,r]=(0,i.useState)("all"),[n,d]=(0,i.useState)(!1),[c,o]=(0,i.useState)(null),[h,u]=(0,i.useState)(null),[p,g]=(0,i.useState)(""),[v,b]=(0,i.useState)(""),[y,C]=(0,i.useState)(!1),[f,N]=(0,i.useState)(null),{data:T,isLoading:w}=(0,J.useQuery)({queryKey:["/api/admin/content-studio/media",s,l]}),S=Array.isArray(T)?T:[],{data:k,isLoading:D}=(0,J.useQuery)({queryKey:["/api/admin/content-studio/revisions",p,v],enabled:!!p&&!!v}),A=Array.isArray(k)?k:[],F=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/content-studio/media/upload","POST",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/media"]}),e({title:"Media uploaded successfully"})}}),H=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)(`/api/admin/content-studio/media/${e.id}`,"PATCH",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/media"]}),e({title:"Media updated successfully"}),d(!1)}}),I=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)(`/api/admin/content-studio/media/${e}`,"DELETE"),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/media"]}),e({title:"Media deleted successfully"}),o(null)}}),B=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)(`/api/admin/content-studio/revisions/${e}/restore`,"POST"),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/revisions"]}),e({title:"Revision restored successfully"}),C(!1)}});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Content Studio"}),(0,a.jsxs)(eS.Tabs,{defaultValue:"media",className:"space-y-4",children:[(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsx)(eS.TabsTrigger,{value:"media","data-testid":"tab-media",children:"Media Library"}),(0,a.jsx)(eS.TabsTrigger,{value:"revisions","data-testid":"tab-revisions",children:"Content Revisions"})]}),(0,a.jsxs)(eS.TabsContent,{value:"media",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Media Library"}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)(m.Input,{placeholder:"Search files...",value:s,onChange:e=>t(e.target.value),className:"w-64","data-testid":"input-search-media"}),(0,a.jsxs)(eT.Select,{value:l,onValueChange:r,children:[(0,a.jsx)(eT.SelectTrigger,{className:"w-40","data-testid":"select-file-type",children:(0,a.jsx)(eT.SelectValue,{})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"all",children:"All Types"}),(0,a.jsx)(eT.SelectItem,{value:"images",children:"Images"}),(0,a.jsx)(eT.SelectItem,{value:"documents",children:"Documents"}),(0,a.jsx)(eT.SelectItem,{value:"videos",children:"Videos"})]})]}),(0,a.jsx)(x.Button,{asChild:!0,"data-testid":"button-upload-media",children:(0,a.jsxs)("label",{className:"cursor-pointer",children:[(0,a.jsx)(a3.Upload,{className:"w-4 h-4 mr-2"}),"Upload File",(0,a.jsx)("input",{type:"file",className:"hidden",onChange:e=>{let a=e.target.files?.[0];if(a){let e=new FormData;e.append("file",a),F.mutate(e)}},accept:"image/*,video/*,.pdf,.doc,.docx"})]})})]})]}),w?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-64"},s))}):(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[S.map(e=>{var s;return(0,a.jsxs)(Z.Card,{"data-testid":`media-card-${e.id}`,children:[(0,a.jsx)(Z.CardHeader,{className:"p-0",children:(0,a.jsx)("div",{className:"aspect-video bg-muted rounded-t-lg flex items-center justify-center overflow-hidden",children:e.type?.startsWith("image/")?(0,a.jsx)("img",{src:e.url,alt:e.altText||e.filename,className:"w-full h-full object-cover"}):(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[(s=e.type).startsWith("image/")?(0,a.jsx)(a5.Image,{className:"w-4 h-4"}):s.startsWith("video/")?(0,a.jsx)(a6,{className:"w-4 h-4"}):(0,a.jsx)(R.FileText,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-xs",children:e.type})]})})}),(0,a.jsxs)(Z.CardContent,{className:"pt-4 space-y-2",children:[(0,a.jsx)("div",{className:"font-medium truncate","data-testid":`media-filename-${e.id}`,children:e.filename}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:e.tags?.map((e,s)=>(0,a.jsx)(ey.Badge,{variant:"secondary",className:"text-xs",children:e},s))}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Used ",e.usageCount||0," times"]})]}),(0,a.jsxs)(Z.CardFooter,{className:"flex justify-between gap-2",children:[(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>{u(e),d(!0)},"data-testid":`button-edit-media-${e.id}`,children:"Edit"}),(0,a.jsx)(x.Button,{size:"sm",variant:"destructive",onClick:()=>o(e.id),"data-testid":`button-delete-media-${e.id}`,children:(0,a.jsx)(eX.Trash2,{className:"w-3 h-3"})})]})]},e.id)}),0===S.length&&(0,a.jsx)("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:"No media files found"})]}),(0,a.jsx)(ew.Dialog,{open:n,onOpenChange:d,children:(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Edit Media"})}),h&&(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget),s=a.get("tags").split(",").map(e=>e.trim()).filter(Boolean);H.mutate({id:h?.id,altText:a.get("altText"),tags:s})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"altText",children:"Alt Text"}),(0,a.jsx)(m.Input,{id:"altText",name:"altText",defaultValue:h.altText,"data-testid":"input-alt-text"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"tags",children:"Tags (comma-separated)"}),(0,a.jsx)(m.Input,{id:"tags",name:"tags",defaultValue:h.tags?.join(", "),placeholder:"tag1, tag2, tag3","data-testid":"input-tags"})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{type:"submit",disabled:H.isPending,"data-testid":"button-save-media",children:H.isPending?"Saving...":"Save Changes"})})]})]})}),(0,a.jsx)(az.AlertDialog,{open:!!c,onOpenChange:e=>!e&&o(null),children:(0,a.jsxs)(az.AlertDialogContent,{children:[(0,a.jsxs)(az.AlertDialogHeader,{children:[(0,a.jsx)(az.AlertDialogTitle,{children:"Delete Media"}),(0,a.jsx)(az.AlertDialogDescription,{children:"Are you sure you want to delete this media file? This action cannot be undone."})]}),(0,a.jsxs)(az.AlertDialogFooter,{children:[(0,a.jsx)(az.AlertDialogCancel,{"data-testid":"button-cancel-delete",children:"Cancel"}),(0,a.jsx)(az.AlertDialogAction,{onClick:()=>c&&I.mutate(c),"data-testid":"button-confirm-delete",children:"Delete"})]})]})})]}),(0,a.jsxs)(eS.TabsContent,{value:"revisions",className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Content Revisions"}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"pt-6 space-y-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"contentType",children:"Content Type"}),(0,a.jsxs)(eT.Select,{value:p,onValueChange:g,children:[(0,a.jsx)(eT.SelectTrigger,{"data-testid":"select-content-type",children:(0,a.jsx)(eT.SelectValue,{placeholder:"Select type"})}),(0,a.jsxs)(eT.SelectContent,{children:[(0,a.jsx)(eT.SelectItem,{value:"thread",children:"Thread"}),(0,a.jsx)(eT.SelectItem,{value:"comment",children:"Comment"}),(0,a.jsx)(eT.SelectItem,{value:"content",children:"Content"}),(0,a.jsx)(eT.SelectItem,{value:"user",children:"User Profile"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"contentId",children:"Content ID"}),(0,a.jsx)(m.Input,{id:"contentId",value:v,onChange:e=>b(e.target.value),placeholder:"Enter content ID","data-testid":"input-content-id"})]})]})})}),p&&v&&(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsx)(Z.CardTitle,{children:"Revision History"})}),(0,a.jsx)(Z.CardContent,{children:D?(0,a.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Revision #"}),(0,a.jsx)(ee.TableHead,{children:"Changed By"}),(0,a.jsx)(ee.TableHead,{children:"Changed Fields"}),(0,a.jsx)(ee.TableHead,{children:"Timestamp"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsxs)(ee.TableBody,{children:[A.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`revision-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"secondary",children:["#",e.revisionNumber]})}),(0,a.jsx)(ee.TableCell,{children:e.changedBy}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:e.changedFields?.map((e,s)=>(0,a.jsx)(ey.Badge,{variant:"outline",className:"text-xs",children:e},s))})}),(0,a.jsx)(ee.TableCell,{children:(0,er.formatDistanceToNow)(new Date(e.timestamp),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(x.Button,{size:"sm",variant:"outline","data-testid":`button-view-diff-${e.id}`,children:[(0,a.jsx)(eO.Eye,{className:"w-3 h-3 mr-1"}),"View Diff"]}),(0,a.jsx)(x.Button,{size:"sm",variant:"default",onClick:()=>{N(e),C(!0)},"data-testid":`button-restore-${e.id}`,children:"Restore"})]})})]},e.id)),0===A.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No revisions found"})})]})]})})})]}),(0,a.jsx)(az.AlertDialog,{open:y,onOpenChange:C,children:(0,a.jsxs)(az.AlertDialogContent,{children:[(0,a.jsxs)(az.AlertDialogHeader,{children:[(0,a.jsx)(az.AlertDialogTitle,{children:"Restore Revision"}),(0,a.jsxs)(az.AlertDialogDescription,{children:["Are you sure you want to restore this revision? This will overwrite the current content with revision #",f?.revisionNumber,"."]})]}),(0,a.jsxs)(az.AlertDialogFooter,{children:[(0,a.jsx)(az.AlertDialogCancel,{"data-testid":"button-cancel-restore",children:"Cancel"}),(0,a.jsx)(az.AlertDialogAction,{onClick:()=>f&&B.mutate(f.id),"data-testid":"button-confirm-restore",children:"Restore"})]})]})})]})]})]})}let a7=(0,n.default)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);function a9(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)(!1),[l,r]=(0,i.useState)(!1),[n,d]=(0,i.useState)(!1),[c,o]=(0,i.useState)(null),[h,u]=(0,i.useState)([0]),{data:p,isLoading:g}=(0,J.useQuery)({queryKey:["/api/admin/testing/ab-tests"]}),v=Array.isArray(p)?p:[],{data:b,isLoading:y}=(0,J.useQuery)({queryKey:["/api/admin/testing/feature-flags"]}),C=Array.isArray(b)?b:[],f=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/testing/ab-tests","POST",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),e({title:"A/B test created successfully"}),t(!1)}}),N=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)(`/api/admin/testing/ab-tests/${e}/start`,"POST"),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),e({title:"Test started"})}}),T=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)(`/api/admin/testing/ab-tests/${e}/stop`,"POST"),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),e({title:"Test stopped"})}}),w=(0,ef.useMutation)({mutationFn:({testId:e,variantId:a})=>(0,eM.apiRequest)(`/api/admin/testing/ab-tests/${e}/winner`,"POST",{variantId:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),e({title:"Winner declared"})}}),S=(0,ef.useMutation)({mutationFn:e=>(0,eM.apiRequest)("/api/admin/testing/feature-flags","POST",e),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/testing/feature-flags"]}),e({title:"Feature flag created successfully"}),r(!1)}}),k=(0,ef.useMutation)({mutationFn:({id:e,enabled:a})=>(0,eM.apiRequest)(`/api/admin/testing/feature-flags/${e}/toggle`,"PATCH",{enabled:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/testing/feature-flags"]}),e({title:"Feature flag updated"})}}),D=(0,ef.useMutation)({mutationFn:({id:e,rollout:a})=>(0,eM.apiRequest)(`/api/admin/testing/feature-flags/${e}/rollout`,"PATCH",{rollout:a}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/testing/feature-flags"]}),e({title:"Rollout percentage updated"}),d(!1)}});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Testing & Experiments"}),(0,a.jsxs)(eS.Tabs,{defaultValue:"ab-tests",className:"space-y-4",children:[(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsx)(eS.TabsTrigger,{value:"ab-tests","data-testid":"tab-ab-tests",children:"A/B Tests"}),(0,a.jsx)(eS.TabsTrigger,{value:"feature-flags","data-testid":"tab-feature-flags",children:"Feature Flags"})]}),(0,a.jsxs)(eS.TabsContent,{value:"ab-tests",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"A/B Tests"}),(0,a.jsxs)(ew.Dialog,{open:s,onOpenChange:t,children:[(0,a.jsx)(ew.DialogTrigger,{asChild:!0,children:(0,a.jsx)(x.Button,{"data-testid":"button-create-test",children:"Create A/B Test"})}),(0,a.jsxs)(ew.DialogContent,{className:"max-w-2xl",children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Create A/B Test"})}),(0,a.jsxs)("form",{onSubmit:a=>{a.preventDefault();let s=new FormData(a.currentTarget),t=s.get("variants"),i=s.get("trafficAllocation");try{let e=JSON.parse(t),a=JSON.parse(i);f.mutate({name:s.get("name"),description:s.get("description"),variants:e,trafficAllocation:a})}catch(a){e({title:"Invalid JSON format",variant:"destructive"})}},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"test-name",children:"Test Name"}),(0,a.jsx)(m.Input,{id:"test-name",name:"name",required:!0,"data-testid":"input-test-name"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"test-description",children:"Description"}),(0,a.jsx)(eN.Textarea,{id:"test-description",name:"description",required:!0,"data-testid":"textarea-test-description"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"variants",children:"Variants (JSON Array)"}),(0,a.jsx)(eN.Textarea,{id:"variants",name:"variants",placeholder:'[{"id": "A", "name": "Control"}, {"id": "B", "name": "Variant B"}]',className:"font-mono text-sm",rows:3,required:!0,"data-testid":"textarea-variants"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"trafficAllocation",children:"Traffic Allocation (JSON Object)"}),(0,a.jsx)(eN.Textarea,{id:"trafficAllocation",name:"trafficAllocation",placeholder:'{"A": 50, "B": 50}',className:"font-mono text-sm",rows:2,required:!0,"data-testid":"textarea-traffic-allocation"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Percentages should add up to 100"})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{type:"submit",disabled:f.isPending,"data-testid":"button-submit-test",children:f.isPending?"Creating...":"Create Test"})})]})]})]})]}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:g?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Name"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"Variants"}),(0,a.jsx)(ee.TableHead,{children:"Traffic"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsxs)(ee.TableBody,{children:[v.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`test-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{className:"font-medium","data-testid":`test-name-${e.id}`,children:e.name}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(ey.Badge,{variant:"running"===e.status?"default":"completed"===e.status?"secondary":"outline",children:e.status})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:e.variants.map(e=>(0,a.jsx)(ey.Badge,{variant:"outline",className:"text-xs",children:e.name},e.id))})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)("div",{className:"text-xs",children:Object.entries(e.trafficAllocation).map(([e,s])=>(0,a.jsxs)("div",{children:[e,": ",s,"%"]},e))})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)("div",{className:"flex gap-2",children:["draft"===e.status&&(0,a.jsxs)(x.Button,{size:"sm",variant:"default",onClick:()=>N.mutate(e.id),disabled:N.isPending,"data-testid":`button-start-${e.id}`,children:[(0,a.jsx)(aE,{className:"w-3 h-3 mr-1"}),"Start"]}),"running"===e.status&&(0,a.jsxs)(x.Button,{size:"sm",variant:"destructive",onClick:()=>T.mutate(e.id),disabled:T.isPending,"data-testid":`button-stop-${e.id}`,children:[(0,a.jsx)(a7,{className:"w-3 h-3 mr-1"}),"Stop"]})]})})]},e.id)),0===v.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No A/B tests created"})})]})]})})})}),v.filter(e=>"running"===e.status||"completed"===e.status).map(e=>(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between gap-2",children:[(0,a.jsxs)(Z.CardTitle,{children:["Results: ",e.name]}),"completed"===e.status&&e.winner&&(0,a.jsxs)(ey.Badge,{variant:"default",children:[(0,a.jsx)(U.Trophy,{className:"w-3 h-3 mr-1"}),"Winner: ",e.winner]})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Variant"}),(0,a.jsx)(ee.TableHead,{children:"Impressions"}),(0,a.jsx)(ee.TableHead,{children:"Conversions"}),(0,a.jsx)(ee.TableHead,{children:"Conversion Rate"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsx)(ee.TableBody,{children:(e.results||[]).map(s=>(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableCell,{className:"font-medium",children:s.variantName}),(0,a.jsx)(ee.TableCell,{children:s.impressions}),(0,a.jsx)(ee.TableCell,{children:s.conversions}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"secondary",children:[s.conversionRate,"%"]})}),(0,a.jsx)(ee.TableCell,{children:"running"===e.status&&!e.winner&&(0,a.jsx)(x.Button,{size:"sm",variant:"default",onClick:()=>w.mutate({testId:e.id,variantId:s.variantId}),disabled:w.isPending,"data-testid":`button-declare-winner-${s.variantId}`,children:"Declare Winner"})})]},s.variantId))})]})})})]},`results-${e.id}`))]}),(0,a.jsxs)(eS.TabsContent,{value:"feature-flags",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Feature Flags"}),(0,a.jsxs)(ew.Dialog,{open:l,onOpenChange:r,children:[(0,a.jsx)(ew.DialogTrigger,{asChild:!0,children:(0,a.jsx)(x.Button,{"data-testid":"button-create-flag",children:"Create Feature Flag"})}),(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Create Feature Flag"})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget),s=a.get("targetUsers").split(",").map(e=>e.trim()).filter(Boolean);S.mutate({key:a.get("key"),name:a.get("name"),description:a.get("description"),enabled:!1,rollout:0,targetUsers:s})},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"flag-key",children:"Flag Key"}),(0,a.jsx)(m.Input,{id:"flag-key",name:"key",placeholder:"new_feature_enabled",required:!0,"data-testid":"input-flag-key"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"flag-name",children:"Flag Name"}),(0,a.jsx)(m.Input,{id:"flag-name",name:"name",required:!0,"data-testid":"input-flag-name"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"flag-description",children:"Description"}),(0,a.jsx)(eN.Textarea,{id:"flag-description",name:"description","data-testid":"textarea-flag-description"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(aI.Label,{htmlFor:"targetUsers",children:"Target Users (comma-separated IDs, optional)"}),(0,a.jsx)(eN.Textarea,{id:"targetUsers",name:"targetUsers",placeholder:"user-123, user-456","data-testid":"textarea-target-users"})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{type:"submit",disabled:S.isPending,"data-testid":"button-submit-flag",children:S.isPending?"Creating...":"Create Flag"})})]})]})]})]}),(0,a.jsx)(Z.Card,{children:(0,a.jsx)(Z.CardContent,{className:"p-0",children:y?(0,a.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(j.Skeleton,{className:"h-12"},s))}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Flag Key"}),(0,a.jsx)(ee.TableHead,{children:"Name"}),(0,a.jsx)(ee.TableHead,{children:"Enabled"}),(0,a.jsx)(ee.TableHead,{children:"Rollout %"}),(0,a.jsx)(ee.TableHead,{children:"Target Users"}),(0,a.jsx)(ee.TableHead,{children:"Actions"})]})}),(0,a.jsxs)(ee.TableBody,{children:[C.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`flag-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{className:"font-mono text-sm","data-testid":`flag-key-${e.id}`,children:e.key}),(0,a.jsx)(ee.TableCell,{className:"font-medium",children:e.name}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(aH.Switch,{checked:e.enabled,onCheckedChange:a=>k.mutate({id:e.id,enabled:a}),"data-testid":`switch-flag-${e.id}`})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"secondary",children:[e.rollout,"%"]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsxs)(ey.Badge,{variant:"outline",children:[e.targetUsers.length," users"]})}),(0,a.jsx)(ee.TableCell,{children:(0,a.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>{o(e),u([e.rollout]),d(!0)},"data-testid":`button-rollout-${e.id}`,children:"Adjust Rollout"})})]},e.id)),0===C.length&&(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No feature flags created"})})]})]})})})}),(0,a.jsx)(ew.Dialog,{open:n,onOpenChange:d,children:(0,a.jsxs)(ew.DialogContent,{children:[(0,a.jsx)(ew.DialogHeader,{children:(0,a.jsx)(ew.DialogTitle,{children:"Adjust Rollout Percentage"})}),c&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(aI.Label,{children:["Rollout: ",h[0],"%"]}),(0,a.jsx)(aR.Slider,{value:h,onValueChange:u,max:100,step:1,"data-testid":"slider-rollout"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Percentage of users who will see this feature"})]}),(0,a.jsx)(ew.DialogFooter,{children:(0,a.jsx)(x.Button,{onClick:()=>D.mutate({id:c.id,rollout:h[0]}),disabled:D.isPending,"data-testid":"button-save-rollout",children:D.isPending?"Saving...":"Save"})})]})]})})]})]})]})}e.i(247167);let se=(0,n.default)("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]),sa=[{url:"/",type:"Homepage",schemaTypes:["Organization","WebSite"],status:"valid"},{url:"/category/trading-strategies/martingale-strategy",type:"Thread (Forum)",schemaTypes:["DiscussionForumPosting","BreadcrumbList","Comment"],status:"valid"},{url:"/category/expert-advisors/mt4/trend-ea",type:"Product (Marketplace)",schemaTypes:["Product","AggregateRating","Review","BreadcrumbList"],status:"valid"},{url:"/user/forex_newbie423",type:"Profile",schemaTypes:["Person"],status:"valid"},{url:"/category/forex-education/beginner-guide",type:"Article/Blog",schemaTypes:["Article","BreadcrumbList"],status:"warning",warning:"Consider adding author image for rich results"}],ss=[{id:"1",url:"/",pageType:"Homepage",status:"valid",errorCount:0,warningCount:0,timestamp:new Date().toISOString()},{id:"2",url:"/thread/best-scalping-ea",pageType:"Article",status:"valid",errorCount:0,warningCount:1,timestamp:new Date(Date.now()-3e5).toISOString(),details:"Missing recommended property: image dimensions"},{id:"3",url:"/content/invalid-product",pageType:"Product",status:"invalid",errorCount:2,warningCount:0,timestamp:new Date(Date.now()-6e5).toISOString(),details:"Missing required properties: price, availability"}];function st(){let[e,s]=(0,i.useState)(""),[t,l]=(0,i.useState)(""),[r,n]=(0,i.useState)([]),[d,c]=(0,i.useState)(!1),{data:o}=(0,J.useQuery)({queryKey:["/api/admin/schema/stats"],refetchInterval:6e4}),{data:u}=(0,J.useQuery)({queryKey:["/api/admin/schema/logs"],refetchInterval:3e4}),j=(0,ef.useMutation)({mutationFn:async()=>await (0,eM.apiRequest)("POST","/api/admin/schema/validate-all",{}),onSuccess:()=>{eM.queryClient.invalidateQueries({queryKey:["/api/admin/schema/stats"]}),eM.queryClient.invalidateQueries({queryKey:["/api/admin/schema/logs"]})}}),p=async e=>{c(!0);try{let a=await (0,eM.apiRequest)("POST","/api/admin/schema/validate",{url:e}),s=await a.json();n([s,...r.slice(0,9)])}catch(e){console.error("Validation error:",e)}finally{c(!1)}},g=e=>{switch(e){case"valid":return(0,a.jsx)(at.CheckCircle2,{className:"w-4 h-4 text-green-600"});case"invalid":return(0,a.jsx)(eQ,{className:"w-4 h-4 text-red-600"});case"warning":return(0,a.jsx)(ez.AlertTriangle,{className:"w-4 h-4 text-yellow-600"})}},v=e=>(0,a.jsxs)(ey.Badge,{variant:{valid:"default",invalid:"destructive",warning:"outline"}[e],className:"gap-1",children:[g(e),e.toUpperCase()]});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Schema Validation Dashboard"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"Real-time monitoring and validation of Schema.org JSON-LD structured data across all pages"})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Total Pages"}),(0,a.jsx)(se,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:o?.totalPages||sa.length}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"With schema markup"})]})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Valid Schemas"}),(0,a.jsx)(at.CheckCircle2,{className:"h-4 w-4 text-green-600"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:o?.validPages||5}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[o?Math.round(o.validPages/o.totalPages*100):83,"% success rate"]})]})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Warnings"}),(0,a.jsx)(ez.AlertTriangle,{className:"h-4 w-4 text-yellow-600"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:o?.warningPages||1}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Need attention"})]})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Errors"}),(0,a.jsx)(eQ,{className:"h-4 w-4 text-red-600"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:o?.invalidPages||0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Require fixes"})]})]})]}),(0,a.jsxs)(eS.Tabs,{defaultValue:"overview",className:"space-y-4",children:[(0,a.jsxs)(eS.TabsList,{children:[(0,a.jsx)(eS.TabsTrigger,{value:"overview",children:"Overview"}),(0,a.jsx)(eS.TabsTrigger,{value:"validator",children:"Live Validator"}),(0,a.jsx)(eS.TabsTrigger,{value:"logs",children:"Validation Logs"}),(0,a.jsx)(eS.TabsTrigger,{value:"schema-types",children:"Schema Types"})]}),(0,a.jsxs)(eS.TabsContent,{value:"overview",className:"space-y-4",children:[(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsxs)(Z.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(W.Activity,{className:"w-5 h-5"}),"Page Validation Status"]}),(0,a.jsx)(Z.CardDescription,{children:"Current schema validation status for all pages"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Last validation: ",o?.lastValidationRun||"Just now"]}),(0,a.jsxs)(x.Button,{onClick:()=>j.mutate(),disabled:j.isPending,size:"sm",className:"gap-2",children:[(0,a.jsx)(e_.RefreshCw,{className:`w-4 h-4 ${j.isPending?"animate-spin":""}`}),"Validate All Pages"]})]}),(0,a.jsx)(eV.ScrollArea,{className:"h-[400px]",children:(0,a.jsx)("div",{className:"space-y-2",children:sa.map((e,t)=>{let i=ss.find(a=>a.url===e.url),r=i?.status||"valid";return(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium",children:e.url}),(0,a.jsx)(ey.Badge,{variant:"secondary",className:"text-xs",children:e.type})]}),(0,a.jsx)("div",{className:"flex gap-1",children:e.schemaTypes.map((e,s)=>(0,a.jsx)(ey.Badge,{variant:"outline",className:"text-xs",children:e},s))}),i?.details&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:i.details})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[v(r),(0,a.jsxs)(x.Button,{variant:"ghost",size:"sm",onClick:()=>{l(e.url),s(e.url)},className:"gap-1",children:[(0,a.jsx)(eO.Eye,{className:"w-4 h-4"}),"View"]})]})]},t)})})})]})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsx)(Z.CardHeader,{children:(0,a.jsxs)(Z.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(O.Zap,{className:"w-5 h-5"}),"Quick Testing Tools"]})}),(0,a.jsxs)(Z.CardContent,{className:"grid gap-3 md:grid-cols-2",children:[(0,a.jsxs)(x.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://search.google.com/test/rich-results","_blank"),children:[(0,a.jsx)(aQ.ExternalLink,{className:"w-4 h-4"}),"Google Rich Results Test"]}),(0,a.jsxs)(x.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://validator.schema.org/","_blank"),children:[(0,a.jsx)(aQ.ExternalLink,{className:"w-4 h-4"}),"Schema.org Validator"]}),(0,a.jsxs)(x.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://search.google.com/search-console","_blank"),children:[(0,a.jsx)(aQ.ExternalLink,{className:"w-4 h-4"}),"Google Search Console"]}),(0,a.jsxs)(x.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://json-ld.org/playground/","_blank"),children:[(0,a.jsx)(aQ.ExternalLink,{className:"w-4 h-4"}),"JSON-LD Playground"]})]})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsx)(Z.CardTitle,{className:"text-lg",children:"Schema Type Distribution"}),(0,a.jsx)(Z.CardDescription,{children:"Number of pages by schema type"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm",children:"DiscussionForumPosting"}),(0,a.jsx)(ey.Badge,{variant:"secondary",children:"Threads"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm",children:"Product"}),(0,a.jsx)(ey.Badge,{variant:"secondary",children:"Marketplace"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm",children:"Person"}),(0,a.jsx)(ey.Badge,{variant:"secondary",children:"Profiles"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm",children:"Article/BlogPosting"}),(0,a.jsx)(ey.Badge,{variant:"secondary",children:"Content"})]})]})})]}),(0,a.jsxs)(Z.Card,{className:"col-span-full",children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsxs)(Z.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(Q.Search,{className:"h-5 w-5"}),"Google Rich Results Testing"]}),(0,a.jsx)(Z.CardDescription,{children:"Test your schemas with Google's official validation tools"})]}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Rich Results Test"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Test how Google sees your structured data"}),(0,a.jsxs)("a",{href:"https://search.google.com/test/rich-results",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:underline","data-testid":"link-google-rich-results",children:["Open Rich Results Test ",(0,a.jsx)(aQ.ExternalLink,{className:"h-3 w-3"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:"Schema Markup Validator"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Validate your JSON-LD against Schema.org standards"}),(0,a.jsxs)("a",{href:"https://validator.schema.org/",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:underline","data-testid":"link-schema-validator",children:["Open Schema Validator ",(0,a.jsx)(aQ.ExternalLink,{className:"h-3 w-3"})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:"Quick Test URLs"}),(0,a.jsx)("div",{className:"grid gap-2",children:[{type:"Thread",url:"/category/trading-strategies/best-scalping-ea"},{type:"Marketplace",url:"/category/expert-advisors/trend-ea"},{type:"Profile",url:"/user/forex_newbie423"}].map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:e.type}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>{let a=`${window.location.origin}${e.url}`,s=`https://search.google.com/test/rich-results?url=${encodeURIComponent(a)}`;window.open(s,"_blank")},"data-testid":`button-test-google-${e.type.toLowerCase()}`,children:["Test in Google ",(0,a.jsx)(aQ.ExternalLink,{className:"h-3 w-3 ml-1"})]}),(0,a.jsx)(x.Button,{variant:"ghost",size:"sm",onClick:()=>navigator.clipboard.writeText(`${window.location.origin}${e.url}`),"data-testid":`button-copy-url-${e.type.toLowerCase()}`,children:"Copy URL"})]})]},e.type))})]})]})]}),(0,a.jsxs)(Z.Card,{className:"col-span-full",children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsxs)(Z.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(R.FileText,{className:"h-5 w-5"}),"Validation Logs"]}),(0,a.jsx)(Z.CardDescription,{children:"Recent schema validation events and errors"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-950 rounded",children:[(0,a.jsx)(at.CheckCircle2,{className:"h-4 w-4 text-green-600"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"All schemas validated successfully"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Last check: Just now"})]})]}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground text-center py-4",children:"No validation errors detected"})]})})]}),(0,a.jsxs)(Z.Card,{className:"col-span-full",children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsx)(Z.CardTitle,{children:"Schema.org 2025 Compliance Checklist"}),(0,a.jsx)(Z.CardDescription,{children:"Ensure all schemas meet the latest standards"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"space-y-3",children:[{item:'All schemas use @context: "https://schema.org"',status:!0},{item:"Required properties present for each type",status:!0},{item:"Publisher includes Organization with logo",status:!0},{item:"Dates in ISO 8601 format",status:!0},{item:"Images include proper dimensions",status:!1,note:"Optional but recommended"},{item:"Videos use ISO 8601 duration format",status:!0}].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[e.status?(0,a.jsx)(at.CheckCircle2,{className:"h-5 w-5 text-green-600 mt-0.5"}):(0,a.jsx)(ea.AlertCircle,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:e.item}),e.note&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:e.note})]})]},s))})})]})]}),(0,a.jsx)(eS.TabsContent,{value:"validator",className:"space-y-4",children:(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsx)(Z.CardTitle,{children:"Live Schema Validator"}),(0,a.jsx)(Z.CardDescription,{children:"Test and validate schema markup for any page URL"})]}),(0,a.jsxs)(Z.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(aI.Label,{htmlFor:"test-url",children:"Page URL"}),(0,a.jsx)(m.Input,{id:"test-url",placeholder:"/thread/best-scalping-ea",value:t,onChange:e=>l(e.target.value)})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsxs)(x.Button,{onClick:()=>p(t),disabled:!t||d,className:"gap-2",children:[(0,a.jsx)(Q.Search,{className:"w-4 h-4"}),"Validate"]})})]}),r.length>0&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(h.Separator,{}),(0,a.jsx)("div",{className:"text-sm font-medium",children:"Validation Results"}),(0,a.jsx)(eV.ScrollArea,{className:"h-[500px]",children:(0,a.jsx)("div",{className:"space-y-4",children:r.map((e,s)=>(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(Z.CardTitle,{className:"text-base",children:e.url}),v(e.isValid?"valid":"invalid")]}),(0,a.jsxs)(Z.CardDescription,{children:["Schema Type: ",e.schemaType," â¢ Page Type: ",e.pageType]})]}),(0,a.jsxs)(Z.CardContent,{className:"space-y-3",children:[e.errors.length>0&&(0,a.jsxs)(e$.Alert,{variant:"destructive",children:[(0,a.jsx)(ez.AlertTriangle,{className:"h-4 w-4"}),(0,a.jsx)(e$.AlertTitle,{children:"Errors Found"}),(0,a.jsx)(e$.AlertDescription,{children:(0,a.jsx)("ul",{className:"list-disc list-inside space-y-1",children:e.errors.map((e,s)=>(0,a.jsx)("li",{className:"text-sm",children:e},s))})})]}),e.warnings.length>0&&(0,a.jsxs)(e$.Alert,{children:[(0,a.jsx)(ez.AlertTriangle,{className:"h-4 w-4"}),(0,a.jsx)(e$.AlertTitle,{children:"Warnings"}),(0,a.jsx)(e$.AlertDescription,{children:(0,a.jsx)("ul",{className:"list-disc list-inside space-y-1",children:e.warnings.map((e,s)=>(0,a.jsx)("li",{className:"text-sm",children:e},s))})})]}),e.isValid&&0===e.errors.length&&(0,a.jsxs)(e$.Alert,{children:[(0,a.jsx)(at.CheckCircle2,{className:"h-4 w-4 text-green-600"}),(0,a.jsx)(e$.AlertTitle,{children:"Schema Valid"}),(0,a.jsx)(e$.AlertDescription,{children:"All required properties present and valid"})]}),(0,a.jsxs)("details",{className:"border rounded-lg p-3",children:[(0,a.jsxs)("summary",{className:"cursor-pointer font-medium text-sm flex items-center gap-2",children:[(0,a.jsx)(Y.Code,{className:"w-4 h-4"}),"View Schema JSON"]}),(0,a.jsx)("pre",{className:"mt-3 text-xs bg-muted p-3 rounded overflow-x-auto",children:JSON.stringify(e.schema,null,2)})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>{window.open(`https://search.google.com/test/rich-results?url=${encodeURIComponent("http://localhost:3000"+e.url)}`,"_blank")},children:[(0,a.jsx)(aQ.ExternalLink,{className:"w-3 h-3"}),"Test in Google"]}),(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>{window.open(`https://validator.schema.org/#url=${encodeURIComponent("http://localhost:3000"+e.url)}`,"_blank")},children:[(0,a.jsx)(aQ.ExternalLink,{className:"w-3 h-3"}),"Schema.org Validator"]})]})]})]},s))})})]})]})]})}),(0,a.jsx)(eS.TabsContent,{value:"logs",className:"space-y-4",children:(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsxs)(Z.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(a1,{className:"w-5 h-5"}),"Validation History"]}),(0,a.jsx)(Z.CardDescription,{children:"Historical log of all schema validation runs"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)(eV.ScrollArea,{className:"h-[500px]",children:(0,a.jsx)("div",{className:"space-y-2",children:(u||ss).map(e=>(0,a.jsxs)("div",{className:"flex items-start justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[g(e.status),(0,a.jsx)("span",{className:"font-medium",children:e.url}),(0,a.jsx)(ey.Badge,{variant:"secondary",className:"text-xs",children:e.pageType})]}),e.details&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.details}),(0,a.jsxs)("div",{className:"flex gap-4 text-xs text-muted-foreground",children:[(0,a.jsxs)("span",{children:["Errors: ",e.errorCount]}),(0,a.jsxs)("span",{children:["Warnings: ",e.warningCount]}),(0,a.jsx)("span",{children:new Date(e.timestamp).toLocaleString()})]})]}),v(e.status)]},e.id))})})})]})}),(0,a.jsx)(eS.TabsContent,{value:"schema-types",className:"space-y-4",children:(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsxs)(Z.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(L.TrendingUp,{className:"w-5 h-5"}),"Schema Type Distribution"]}),(0,a.jsx)(Z.CardDescription,{children:"Overview of schema types implemented across the platform"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsx)("div",{className:"space-y-4",children:[{type:"Organization",count:1,validCount:1,description:"Company information on homepage"},{type:"WebSite",count:1,validCount:1,description:"Site-wide search capability"},{type:"Article",count:15,validCount:14,description:"Forum threads and blog posts"},{type:"Product",count:10,validCount:10,description:"Marketplace EA listings"},{type:"BreadcrumbList",count:25,validCount:25,description:"Navigation breadcrumbs"},{type:"ProfilePage",count:15,validCount:15,description:"User profile pages"},{type:"LocalBusiness",count:7,validCount:7,description:"Broker listings"}].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.type}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]}),(0,a.jsxs)("div",{className:"text-right space-y-1",children:[(0,a.jsxs)("div",{className:"text-sm font-medium",children:[e.validCount,"/",e.count," valid"]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[Math.round(e.validCount/e.count*100),"% success rate"]})]})]},s))})})]})})]})]})}let si=(0,n.default)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);function sl(){let{toast:e}=(0,ek.useToast)(),[s,t]=(0,i.useState)(!1),{data:l,isLoading:r}=(0,J.useQuery)({queryKey:["/api/admin/sitemap/status"],refetchInterval:3e4}),n=(0,ef.useMutation)({mutationFn:async()=>(t(!0),(await (0,eM.apiRequest)("POST","/api/admin/sitemap/generate",{})).json()),onSuccess:a=>{t(!1),eM.queryClient.invalidateQueries({queryKey:["/api/admin/sitemap/status"]}),e({title:"Sitemap Generated Successfully!",description:`${a.urlCount} URLs added. Submitted to search engines.`})},onError:a=>{t(!1),e({title:"Failed to Generate Sitemap",description:a instanceof Error?a.message:"Unknown error",variant:"destructive"})}});return r?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(j.Skeleton,{className:"h-10 w-64"}),(0,a.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:[1,2,3].map(e=>(0,a.jsx)(j.Skeleton,{className:"h-32"},e))})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Sitemap Management"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Automated sitemap generation and search engine submission"})]}),(0,a.jsx)(x.Button,{onClick:()=>n.mutate(),disabled:s,size:"lg","data-testid":"button-generate-sitemap",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e_.RefreshCw,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e_.RefreshCw,{className:"w-4 h-4 mr-2"}),"Generate Now"]})})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsxs)(Z.Card,{"data-testid":"card-last-generation",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-3",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Last Generation"})}),(0,a.jsx)(Z.CardContent,{children:l?.lastGeneration?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-url-count",children:[l.lastGeneration.urlCount," URLs"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,er.formatDistanceToNow)(new Date(l.lastGeneration.createdAt),{addSuffix:!0})})]}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Never generated"})})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-automation-status",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-3",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Automation Status"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(at.CheckCircle2,{className:"w-5 h-5 text-green-600"}),(0,a.jsx)("span",{className:"font-semibold",children:"Active"})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Runs daily at 2:00 AM"})]})]}),(0,a.jsxs)(Z.Card,{"data-testid":"card-sitemap-url",children:[(0,a.jsx)(Z.CardHeader,{className:"pb-3",children:(0,a.jsx)(Z.CardTitle,{className:"text-sm font-medium",children:"Sitemap URL"})}),(0,a.jsxs)(Z.CardContent,{children:[(0,a.jsxs)("a",{href:"/sitemap.xml",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline flex items-center gap-1","data-testid":"link-sitemap-xml",children:["/sitemap.xml",(0,a.jsx)(aQ.ExternalLink,{className:"w-3 h-3"})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Public sitemap file"})]})]})]}),l?.lastError&&(0,a.jsxs)(e$.Alert,{variant:"destructive","data-testid":"alert-last-error",children:[(0,a.jsx)(ez.AlertTriangle,{className:"h-4 w-4"}),(0,a.jsxs)(e$.AlertDescription,{children:[(0,a.jsx)("strong",{children:"Last Error:"})," ",l.lastError.errorMessage,(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs",children:(0,er.formatDistanceToNow)(new Date(l.lastError.createdAt),{addSuffix:!0})})]})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsx)(Z.CardTitle,{children:"Recent Activity"}),(0,a.jsx)(Z.CardDescription,{children:"Last 20 sitemap operations"})]}),(0,a.jsx)(Z.CardContent,{children:(0,a.jsxs)(ee.Table,{children:[(0,a.jsx)(ee.TableHeader,{children:(0,a.jsxs)(ee.TableRow,{children:[(0,a.jsx)(ee.TableHead,{children:"Action"}),(0,a.jsx)(ee.TableHead,{children:"Status"}),(0,a.jsx)(ee.TableHead,{children:"URLs"}),(0,a.jsx)(ee.TableHead,{children:"Submitted To"}),(0,a.jsx)(ee.TableHead,{children:"Time"}),(0,a.jsx)(ee.TableHead,{children:"Details"})]})}),(0,a.jsx)(ee.TableBody,{children:l?.recentLogs&&l.recentLogs.length>0?l.recentLogs.map(e=>(0,a.jsxs)(ee.TableRow,{"data-testid":`row-log-${e.id}`,children:[(0,a.jsx)(ee.TableCell,{children:(e=>{switch(e){case"generate":return(0,a.jsxs)(ey.Badge,{variant:"outline",children:[(0,a.jsx)(R.FileText,{className:"w-3 h-3 mr-1"}),"Generate"]});case"submit_google":return(0,a.jsxs)(ey.Badge,{variant:"outline",children:[(0,a.jsx)(si,{className:"w-3 h-3 mr-1"}),"Google"]});case"submit_indexnow":return(0,a.jsxs)(ey.Badge,{variant:"outline",children:[(0,a.jsx)(si,{className:"w-3 h-3 mr-1"}),"IndexNow"]});default:return(0,a.jsx)(ey.Badge,{variant:"outline",children:e})}})(e.action)}),(0,a.jsx)(ee.TableCell,{children:(e=>{switch(e){case"success":return(0,a.jsxs)(ey.Badge,{variant:"default",className:"bg-green-600",children:[(0,a.jsx)(at.CheckCircle2,{className:"w-3 h-3 mr-1"}),"Success"]});case"error":return(0,a.jsxs)(ey.Badge,{variant:"destructive",children:[(0,a.jsx)(eQ,{className:"w-3 h-3 mr-1"}),"Error"]});case"pending":return(0,a.jsxs)(ey.Badge,{variant:"secondary",children:[(0,a.jsx)(eW.Clock,{className:"w-3 h-3 mr-1"}),"Pending"]});default:return(0,a.jsx)(ey.Badge,{children:e})}})(e.status)}),(0,a.jsx)(ee.TableCell,{children:e.urlCount||"-"}),(0,a.jsx)(ee.TableCell,{children:e.submittedTo||"-"}),(0,a.jsx)(ee.TableCell,{className:"text-sm text-muted-foreground",children:(0,er.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,a.jsx)(ee.TableCell,{className:"text-sm text-muted-foreground",children:e.errorMessage?(0,a.jsx)("span",{className:"text-red-600 truncate max-w-xs block",children:e.errorMessage}):(0,a.jsx)("span",{className:"text-green-600",children:"OK"})})]},e.id)):(0,a.jsx)(ee.TableRow,{children:(0,a.jsx)(ee.TableCell,{colSpan:6,className:"text-center text-muted-foreground",children:'No activity yet. Click "Generate Now" to create your first sitemap.'})})})]})})]}),(0,a.jsxs)(Z.Card,{children:[(0,a.jsxs)(Z.CardHeader,{children:[(0,a.jsx)(Z.CardTitle,{children:"Setup Instructions"}),(0,a.jsx)(Z.CardDescription,{children:"Configure your environment for optimal search engine submission"})]}),(0,a.jsxs)(Z.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"1. IndexNow API Key (Bing & Yandex)"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Generate an API key and set ",(0,a.jsx)("code",{className:"bg-muted px-1 py-0.5 rounded",children:"INDEXNOW_API_KEY"})," environment variable."]}),(0,a.jsxs)("a",{href:"https://www.bing.com/indexnow/getstarted",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline inline-flex items-center gap-1",children:["Get IndexNow Key ",(0,a.jsx)(aQ.ExternalLink,{className:"w-3 h-3"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"2. Add Sitemap to robots.txt"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Add this line to your ",(0,a.jsx)("code",{className:"bg-muted px-1 py-0.5 rounded",children:"/public/robots.txt"}),":"]}),(0,a.jsx)("code",{className:"block bg-muted px-3 py-2 rounded text-sm",children:"Sitemap: https://yoforex.net/sitemap.xml"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"3. Verify in Search Console"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Submit your sitemap manually in"," ",(0,a.jsx)("a",{href:"https://search.google.com/search-console",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google Search Console"})," ","and"," ",(0,a.jsx)("a",{href:"https://www.bing.com/webmasters",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Bing Webmaster Tools"}),"."]})]})]})]})]})}let sr=[{id:"overview",icon:F.BarChart3,label:"Overview",path:"/admin"},{id:"users",icon:H.Users,label:"Users",path:"/admin/users"},{id:"content",icon:R.FileText,label:"Content",path:"/admin/content"},{id:"marketplace",icon:I.Store,label:"Marketplace",path:"/admin/marketplace"},{id:"brokers",icon:B,label:"Brokers",path:"/admin/brokers"},{id:"finance",icon:q.DollarSign,label:"Finance",path:"/admin/finance"},{id:"analytics",icon:L.TrendingUp,label:"Analytics",path:"/admin/analytics"},{id:"ai-automation",icon:$,label:"AI & Automation",path:"/admin/ai-automation"},{id:"gamification",icon:U.Trophy,label:"Gamification",path:"/admin/gamification"},{id:"seo-marketing",icon:Q.Search,label:"SEO & Marketing",path:"/admin/seo-marketing"},{id:"sitemap",icon:R.FileText,label:"Sitemap",path:"/admin/sitemap"},{id:"schema-validation",icon:Y.Code,label:"Schema Validation",path:"/admin/schema-validation"},{id:"integrations",icon:O.Zap,label:"API & Integrations",path:"/admin/integrations"},{id:"mobile",icon:z.Smartphone,label:"Mobile & Push",path:"/admin/mobile"},{id:"performance",icon:W.Activity,label:"Performance",path:"/admin/performance"},{id:"content-studio",icon:G.Folder,label:"Content Studio",path:"/admin/content-studio"},{id:"testing",icon:_,label:"Testing",path:"/admin/testing"},{id:"settings",icon:P.Settings,label:"Settings",path:"/admin/settings"},{id:"security",icon:M.Shield,label:"Security",path:"/admin/security"},{id:"communications",icon:K.Mail,label:"Communications",path:"/admin/communications"},{id:"support",icon:E.HelpCircle,label:"Support",path:"/admin/support"},{id:"logs",icon:V,label:"Audit Logs",path:"/admin/logs"}];function sn(){let e=(0,t.usePathname)();return(0,a.jsx)(y,{children:(0,a.jsx)(f,{children:(0,a.jsxs)(N,{children:[(0,a.jsx)(T,{children:"Admin Dashboard"}),(0,a.jsx)(w,{children:(0,a.jsx)(S,{children:sr.map(t=>{let i=e===t.path;return(0,a.jsx)(k,{children:(0,a.jsx)(A,{asChild:!0,isActive:i,children:(0,a.jsxs)(s.default,{href:t.path,"data-testid":`nav-${t.id}`,children:[(0,a.jsx)(t.icon,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:t.label})]})})},t.id)})})})]})})})}function sd(){let e=(0,t.usePathname)();return(0,a.jsx)(b,{style:{"--sidebar-width":"16rem","--sidebar-width-icon":"3rem"},children:(0,a.jsxs)("div",{className:"flex h-screen w-full",children:[(0,a.jsx)(sn,{}),(0,a.jsxs)("div",{className:"flex flex-col flex-1",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between p-4 border-b gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(C,{"data-testid":"button-sidebar-toggle"}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"})]}),(0,a.jsx)(X.ThemeToggle,{})]}),(0,a.jsx)("main",{className:"flex-1 overflow-auto p-6",children:(()=>{switch(e){case"/admin/users":return(0,a.jsx)(eK,{});case"/admin/content":return(0,a.jsx)(eZ,{});case"/admin/marketplace":return(0,a.jsx)(aa,{});case"/admin/brokers":return(0,a.jsx)(ao,{});case"/admin/finance":return(0,a.jsx)(aS,{});case"/admin/analytics":return(0,a.jsx)(aF,{});case"/admin/ai-automation":return(0,a.jsx)(aV,{});case"/admin/gamification":return(0,a.jsx)(aU,{});case"/admin/seo-marketing":return(0,a.jsx)(aO,{});case"/admin/sitemap":return(0,a.jsx)(sl,{});case"/admin/schema-validation":return(0,a.jsx)(st,{});case"/admin/integrations":return(0,a.jsx)(aX,{});case"/admin/mobile":return(0,a.jsx)(a0,{});case"/admin/performance":return(0,a.jsx)(a4,{});case"/admin/content-studio":return(0,a.jsx)(a8,{});case"/admin/testing":return(0,a.jsx)(a9,{});case"/admin/settings":return(0,a.jsx)(aB,{});case"/admin/security":return(0,a.jsx)(aq,{});case"/admin/communications":return(0,a.jsx)(aP,{});case"/admin/support":return(0,a.jsx)(aM,{});case"/admin/logs":return(0,a.jsx)(aK,{});default:return(0,a.jsx)(eC,{})}})()})]})]})})}e.s(["AdminDashboardClient",()=>sd],564541)}]);