(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87945,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(448020);let i=a.forwardRef(({className:e,...a},i)=>(0,t.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:i,...a}));i.displayName="Textarea",e.s(["Textarea",()=>i])},840176,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(981140),i=e.i(30030),r=e.i(842727),n=e.i(296626),l=e.i(248425),d=e.i(586318),o=e.i(369340),c=e.i(610772),u="Tabs",[m,x]=(0,i.createContextScope)(u,[r.createRovingFocusGroupScope]),h=(0,r.createRovingFocusGroupScope)(),[p,f]=m(u),v=a.forwardRef((e,a)=>{let{__scopeTabs:s,value:i,onValueChange:r,defaultValue:n,orientation:u="horizontal",dir:m,activationMode:x="automatic",...h}=e,f=(0,d.useDirection)(m),[v,b]=(0,o.useControllableState)({prop:i,onChange:r,defaultProp:n});return(0,t.jsx)(p,{scope:s,baseId:(0,c.useId)(),value:v,onValueChange:b,orientation:u,dir:f,activationMode:x,children:(0,t.jsx)(l.Primitive.div,{dir:f,"data-orientation":u,...h,ref:a})})});v.displayName=u;var b="TabsList",g=a.forwardRef((e,a)=>{let{__scopeTabs:s,loop:i=!0,...n}=e,d=f(b,s),o=h(s);return(0,t.jsx)(r.Root,{asChild:!0,...o,orientation:d.orientation,dir:d.dir,loop:i,children:(0,t.jsx)(l.Primitive.div,{role:"tablist","aria-orientation":d.orientation,...n,ref:a})})});g.displayName=b;var j="TabsTrigger",w=a.forwardRef((e,a)=>{let{__scopeTabs:i,value:n,disabled:d=!1,...o}=e,c=f(j,i),u=h(i),m=k(c.baseId,n),x=C(c.baseId,n),p=n===c.value;return(0,t.jsx)(r.Item,{asChild:!0,...u,focusable:!d,active:p,children:(0,t.jsx)(l.Primitive.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":x,"data-state":p?"active":"inactive","data-disabled":d?"":void 0,disabled:d,id:m,...o,ref:a,onMouseDown:(0,s.composeEventHandlers)(e.onMouseDown,e=>{d||0!==e.button||!1!==e.ctrlKey?e.preventDefault():c.onValueChange(n)}),onKeyDown:(0,s.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&c.onValueChange(n)}),onFocus:(0,s.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==c.activationMode;p||d||!e||c.onValueChange(n)})})})});w.displayName=j;var y="TabsContent",N=a.forwardRef((e,s)=>{let{__scopeTabs:i,value:r,forceMount:d,children:o,...c}=e,u=f(y,i),m=k(u.baseId,r),x=C(u.baseId,r),h=r===u.value,p=a.useRef(h);return a.useEffect(()=>{let e=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,t.jsx)(n.Presence,{present:d||h,children:({present:a})=>(0,t.jsx)(l.Primitive.div,{"data-state":h?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":m,hidden:!a,id:x,tabIndex:0,...c,ref:s,style:{...e.style,animationDuration:p.current?"0s":void 0},children:a&&o})})});function k(e,t){return`${e}-trigger-${t}`}function C(e,t){return`${e}-content-${t}`}N.displayName=y;var R=e.i(448020);let T=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(g,{ref:s,className:(0,R.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...a}));T.displayName=g.displayName;let S=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(w,{ref:s,className:(0,R.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...a}));S.displayName=w.displayName;let B=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)(N,{ref:s,className:(0,R.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...a}));B.displayName=N.displayName,e.s(["Tabs",()=>v,"TabsContent",()=>B,"TabsList",()=>T,"TabsTrigger",()=>S],840176)},63209,e=>{"use strict";let t=(0,e.i(475254).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},878894,e=>{"use strict";let t=(0,e.i(475254).default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>t],878894)},778917,e=>{"use strict";let t=(0,e.i(475254).default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);e.s(["ExternalLink",()=>t],778917)},581418,e=>{"use strict";let t=(0,e.i(475254).default)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["ShieldCheck",()=>t],581418)},400417,e=>{"use strict";let t=(0,e.i(475254).default)("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]);e.s(["ThumbsUp",()=>t],400417)},997970,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(266027),i=e.i(954616),r=e.i(501831),n=e.i(18148),l=e.i(297801),d=e.i(353501),o=e.i(42422),c=e.i(635321),u=e.i(407398),m=e.i(30656),x=e.i(840176),h=e.i(87945),p=e.i(615683),f=e.i(870273),v=e.i(581418),b=e.i(878894),g=e.i(25652),j=e.i(778917),w=e.i(400417);let y=(0,e.i(475254).default)("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);var N=e.i(63209),k=e.i(522016);function C({slug:e,initialBroker:C,initialReviews:R}){let{toast:T}=(0,p.useToast)(),{user:S,isAuthenticated:B}=(0,n.useAuth)(),{requireAuth:$,AuthPrompt:q}=(0,l.useAuthPrompt)("write a broker review"),[E,P]=(0,a.useState)("all-reviews"),[A,M]=(0,a.useState)(0),[I,D]=(0,a.useState)(""),[F,V]=(0,a.useState)(""),{data:H}=(0,s.useQuery)({queryKey:["/api/brokers/slug",e],initialData:C}),{data:K}=(0,s.useQuery)({queryKey:["/api/brokers",H?.id,"reviews"],initialData:R,enabled:!!H?.id}),L=(0,i.useMutation)({mutationFn:async()=>{if(!S?.id)throw Error("You must be logged in to review");if(!H?.id)throw Error("Broker not loaded");if(0===A)throw Error("Please select a rating");if(!I.trim())throw Error("Please enter a review title");if(!F.trim()||F.length<50)throw Error("Review must be at least 50 characters");return(await (0,r.apiRequest)("POST","/api/broker-reviews",{brokerId:H.id,userId:S.id,rating:A,reviewTitle:I.trim(),reviewBody:F.trim(),isScamReport:!1})).json()},onSuccess:()=>{H?.id&&(r.queryClient.invalidateQueries({queryKey:["/api/brokers",H.id,"reviews"]}),r.queryClient.invalidateQueries({queryKey:["/api/brokers/slug",e]})),M(0),D(""),V(""),T({title:"Review submitted!",description:"Your review is pending approval."})},onError:e=>{T({title:"Review failed",description:e.message,variant:"destructive"})}}),U=(0,i.useMutation)({mutationFn:async e=>{if(!S?.id)throw Error("You must be logged in");return(await (0,r.apiRequest)("POST",`/api/broker-reviews/${e}/helpful`,{userId:S.id})).json()},onSuccess:()=>{H?.id&&r.queryClient.invalidateQueries({queryKey:["/api/brokers",H.id,"reviews"]}),T({title:"Marked as helpful",description:"Thank you for your feedback."})},onError:e=>{T({title:"Failed",description:e.message,variant:"destructive"})}}),z=e=>(0,t.jsx)("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(a=>(0,t.jsx)(f.Star,{className:`h-4 w-4 ${a<=e?"fill-primary text-primary":"text-muted-foreground"}`},a))});if(!H)return(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(d.default,{}),(0,t.jsx)("main",{className:"container max-w-6xl mx-auto px-4 py-8",children:(0,t.jsx)(c.Card,{children:(0,t.jsxs)(c.CardContent,{className:"p-8 text-center",children:[(0,t.jsx)(N.AlertCircle,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Broker Not Found"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"The broker you're looking for doesn't exist or has been removed."}),(0,t.jsx)(k.default,{href:"/brokers",children:(0,t.jsx)(u.Button,{children:"Back to Broker Directory"})})]})})}),(0,t.jsx)(o.default,{})]});let Q=(K||[]).filter(e=>"scam-reports"!==E||e.isScamReport);return(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)(d.default,{}),(0,t.jsxs)("main",{className:"container max-w-6xl mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)(k.default,{href:"/brokers",children:(0,t.jsx)(u.Button,{variant:"ghost",size:"sm",className:"mb-4","data-testid":"button-back-to-directory",children:"‚Üê Back to Directory"})}),(0,t.jsx)(c.Card,{children:(0,t.jsx)(c.CardContent,{className:"p-8",children:(0,t.jsxs)("div",{className:"flex items-start gap-6",children:[(0,t.jsx)("div",{className:"w-24 h-24 rounded-md bg-muted flex items-center justify-center flex-shrink-0",children:H.logoUrl?(0,t.jsx)("img",{src:H.logoUrl,alt:H.name,className:"w-full h-full object-cover rounded-md"}):(0,t.jsx)(g.TrendingUp,{className:"h-12 w-12 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold","data-testid":"text-broker-name",children:H.name}),H.isVerified&&(0,t.jsxs)(m.Badge,{variant:"default",className:"flex items-center gap-1","data-testid":"badge-verified",children:[(0,t.jsx)(v.ShieldCheck,{className:"h-3 w-3"}),"Verified"]}),H.scamReportCount>10&&(0,t.jsxs)(m.Badge,{variant:"destructive",className:"flex items-center gap-1","data-testid":"badge-scam-alert",children:[(0,t.jsx)(b.AlertTriangle,{className:"h-3 w-3"}),"High Scam Reports"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,t.jsx)("div",{"data-testid":"rating-stars",children:z(Math.round(H.overallRating))}),(0,t.jsx)("span",{className:"font-semibold","data-testid":"text-rating",children:H.overallRating.toFixed(1)}),(0,t.jsxs)("span",{className:"text-muted-foreground","data-testid":"text-review-count",children:["(",H.reviewCount," reviews)"]}),H.scamReportCount>0&&(0,t.jsxs)("span",{className:"text-destructive text-sm","data-testid":"text-scam-count",children:[H.scamReportCount," scam reports"]})]}),(0,t.jsxs)("div",{className:"space-y-2 mb-4",children:[H.yearFounded&&(0,t.jsxs)("p",{className:"text-sm","data-testid":"text-founded",children:[(0,t.jsx)("strong",{children:"Founded:"})," ",H.yearFounded]}),(0,t.jsxs)("p",{className:"text-sm","data-testid":"text-regulation",children:[(0,t.jsx)("strong",{children:"Regulation:"})," ",H.regulationSummary||"Not specified"]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[H.websiteUrl&&(0,t.jsx)(u.Button,{asChild:!0,"data-testid":"button-visit-website",children:(0,t.jsxs)("a",{href:H.websiteUrl,target:"_blank",rel:"noopener noreferrer",children:["Visit Website ",(0,t.jsx)(j.ExternalLink,{className:"ml-2 h-4 w-4"})]})}),(0,t.jsx)(u.Button,{variant:"outline","data-testid":"button-write-review",onClick:()=>{let e=document.getElementById("review-form");e&&e.scrollIntoView({behavior:"smooth"})},children:"Write a Review"})]})]})]})})})]}),(0,t.jsxs)(x.Tabs,{value:E,onValueChange:P,children:[(0,t.jsxs)(x.TabsList,{className:"grid w-full grid-cols-2 mb-6",children:[(0,t.jsxs)(x.TabsTrigger,{value:"all-reviews","data-testid":"tab-all-reviews",children:["All Reviews (",H.reviewCount,")"]}),(0,t.jsxs)(x.TabsTrigger,{value:"scam-reports","data-testid":"tab-scam-reports",children:["Scam Reports (",H.scamReportCount,")"]})]}),(0,t.jsxs)(x.TabsContent,{value:E,className:"space-y-4",children:[B&&(0,t.jsxs)(c.Card,{id:"review-form",children:[(0,t.jsx)(c.CardHeader,{children:(0,t.jsx)(c.CardTitle,{children:"Write a Review"})}),(0,t.jsxs)(c.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Rating"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>M(e),className:"focus:outline-none","data-testid":`star-rating-${e}`,children:(0,t.jsx)(f.Star,{className:`h-8 w-8 ${e<=A?"fill-yellow-500 text-yellow-500":"text-muted-foreground"}`})},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Review Title"}),(0,t.jsx)("input",{type:"text",placeholder:"Brief summary of your experience",value:I,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border rounded-md","data-testid":"input-review-title"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Your Review"}),(0,t.jsx)(h.Textarea,{placeholder:"Share your experience with this broker... (minimum 50 characters)",value:F,onChange:e=>V(e.target.value),className:"min-h-32","data-testid":"input-review-body"}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[F.length," / 50 minimum characters"]})]}),(0,t.jsx)(u.Button,{onClick:()=>$(()=>L.mutate()),disabled:L.isPending||0===A||!I.trim()||F.length<50,"data-testid":"button-submit-review",children:L.isPending?"Submitting...":"Submit Review"})]})]}),!B&&(0,t.jsx)(c.Card,{children:(0,t.jsxs)(c.CardContent,{className:"p-6 text-center",children:[(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"Please log in to write a review"}),(0,t.jsx)(u.Button,{onClick:()=>$(()=>{}),children:"Log In to Review"})]})}),Q.map(e=>(0,t.jsxs)(c.Card,{"data-testid":`card-review-${e.id}`,children:[(0,t.jsx)(c.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("h3",{className:"font-semibold text-lg","data-testid":`text-review-title-${e.id}`,children:e.reviewTitle}),e.isScamReport&&(0,t.jsxs)(m.Badge,{variant:"destructive",className:"flex items-center gap-1","data-testid":`badge-scam-report-${e.id}`,children:[(0,t.jsx)(b.AlertTriangle,{className:"h-3 w-3"}),"Scam Report"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,t.jsx)("span",{"data-testid":`text-reviewer-name-${e.id}`,children:e.userName}),(0,t.jsx)("span",{children:"‚Ä¢"}),(0,t.jsxs)("span",{"data-testid":`text-reviewer-reputation-${e.id}`,children:[e.userReputation," reputation"]}),(0,t.jsx)("span",{children:"‚Ä¢"}),(0,t.jsx)("span",{"data-testid":`text-review-date-${e.id}`,children:new Date(e.datePosted).toLocaleDateString()})]})]}),(0,t.jsx)("div",{"data-testid":`rating-stars-${e.id}`,children:z(e.rating)})]})}),(0,t.jsxs)(c.CardContent,{children:[(0,t.jsx)("p",{className:"text-sm mb-4 whitespace-pre-wrap","data-testid":`text-review-body-${e.id}`,children:e.reviewBody}),(0,t.jsxs)("div",{className:"flex items-center gap-4 pt-4 border-t",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Was this helpful?"}),(0,t.jsxs)(u.Button,{size:"sm",variant:"ghost",className:"gap-2","data-testid":`button-helpful-${e.id}`,onClick:()=>$(()=>U.mutate(e.id)),disabled:U.isPending,children:[(0,t.jsx)(w.ThumbsUp,{className:"h-4 w-4"}),(0,t.jsx)("span",{"data-testid":`text-helpful-count-${e.id}`,children:e.helpfulCount})]}),(0,t.jsx)(u.Button,{size:"sm",variant:"ghost",className:"gap-2","data-testid":`button-not-helpful-${e.id}`,children:(0,t.jsx)(y,{className:"h-4 w-4"})})]})]})]},e.id)),0===Q.length&&(0,t.jsx)(c.Card,{children:(0,t.jsxs)(c.CardContent,{className:"p-12 text-center",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"scam-reports"===E?"No scam reports for this broker.":"No reviews yet. Be the first to review this broker!"}),(0,t.jsx)(u.Button,{className:"mt-4","data-testid":"button-write-first-review",onClick:()=>{P("all-reviews");let e=document.getElementById("review-form");e&&e.scrollIntoView({behavior:"smooth"})},children:"Write a Review"})]})})]})]})]}),(0,t.jsx)(o.default,{}),(0,t.jsx)(q,{})]})}e.s(["default",()=>C],997970)}]);