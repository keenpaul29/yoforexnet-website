(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,42920,95265,31245,3615,87373,37668,95052,77668,56629,40600,73609,36581,63008,49e3,91932,65061,19217,7285,37040,5408,77309,86590,56734,58008,36725,88017,10632,e=>{"use strict";var a=e.i(75254);let s=(0,a.default)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);e.s(["Building",()=>s],42920);let t=(0,a.default)("FileChartColumn",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 18v-1",key:"zg0ygc"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"M16 18v-3",key:"j5jt4h"}]]);e.s(["FileBarChart2",()=>t],95265);let l=(0,a.default)("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);e.s(["Bot",()=>l],31245);let i=(0,a.default)("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);e.s(["TestTube",()=>i],3615);var r=e.i(18050),n=e.i(71645),d=e.i(18566),c=e.i(50121),o=e.i(35321),x=e.i(7398),m=e.i(51737),h=e.i(4997);function u({children:e}){let a=(0,d.useRouter)(),[s,t]=(0,n.useState)(!0),[l,i]=(0,n.useState)(!1),[u,j]=(0,n.useState)(null);return((0,n.useEffect)(()=>{!async function(){try{let e=await fetch("/api/me");if(!e.ok)return void j("not-authenticated");let a=await e.json();if("admin"!==a.role&&"moderator"!==a.role&&"superadmin"!==a.role)return void j("not-admin");i(!0)}catch(e){console.error("Auth check failed:",e),j("not-authenticated")}finally{t(!1)}}()},[a]),s)?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)(c.Skeleton,{className:"h-8 w-48 mx-auto"}),(0,r.jsx)(c.Skeleton,{className:"h-4 w-64 mx-auto"})]})}):"not-authenticated"===u?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background p-4",children:(0,r.jsxs)(o.Card,{className:"max-w-md w-full",children:[(0,r.jsxs)(o.CardHeader,{className:"text-center",children:[(0,r.jsx)("div",{className:"mx-auto mb-4 w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:(0,r.jsx)(h.LogIn,{className:"h-6 w-6 text-primary"})}),(0,r.jsx)(o.CardTitle,{children:"Authentication Required"}),(0,r.jsx)(o.CardDescription,{children:"You must be logged in to access the admin dashboard."})]}),(0,r.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(x.Button,{className:"w-full",asChild:!0,children:(0,r.jsx)("a",{href:"/api/login",children:"Sign In with Replit"})}),(0,r.jsx)(x.Button,{className:"w-full",variant:"outline",onClick:()=>a.push("/"),children:"Go to Home"})]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"After signing in, contact an administrator to grant you admin access."})]})]})}):"not-admin"===u?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background p-4",children:(0,r.jsxs)(o.Card,{className:"max-w-md w-full",children:[(0,r.jsxs)(o.CardHeader,{className:"text-center",children:[(0,r.jsx)("div",{className:"mx-auto mb-4 w-12 h-12 bg-destructive/10 rounded-full flex items-center justify-center",children:(0,r.jsx)(m.ShieldAlert,{className:"h-6 w-6 text-destructive"})}),(0,r.jsx)(o.CardTitle,{children:"Access Denied"}),(0,r.jsx)(o.CardDescription,{children:"You don't have admin privileges to access this area."})]}),(0,r.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,r.jsx)("div",{className:"p-4 bg-muted rounded-lg",children:(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"This area is restricted to administrators only. If you believe you should have access, please contact a system administrator."})}),(0,r.jsx)(x.Button,{className:"w-full",variant:"outline",onClick:()=>a.push("/"),children:"Go to Home"})]})]})}):l?(0,r.jsx)(r.Fragment,{children:e}):null}e.s(["AdminAuthCheck",()=>u],87373);var j=e.i(66027),p=e.i(35251),g=e.i(61911),v=e.i(78583),b=e.i(12426),y=e.i(63209),C=e.i(79002),f=e.i(43553),N=e.i(25652),T=e.i(86311),w=e.i(417),S=e.i(21218),k=e.i(9637),D=e.i(29228),A=e.i(55706),F=e.i(9694),H=e.i(80942),R=e.i(33808),I=e.i(38814),B=e.i(22787),q=e.i(85183),L=e.i(93230),P=e.i(72526),M=e.i(34239),K=e.i(44098),E=e.i(59559),V=e.i(30656),$=e.i(22016);function U(){let{data:e,isLoading:a}=(0,j.useQuery)({queryKey:["/api/admin/overview/stats"],refetchInterval:3e4}),s=e||{users:{total:0,new24h:0,online:0,dailyRegistrations:0,premiumMembers:0},content:{total:0,new24h:0,avgPostsPerUser:0},revenue:{total:0,today:0},moderation:{pending:0,reports:0}},{data:t,isLoading:l}=(0,j.useQuery)({queryKey:["/api/admin/overview/engagement-metrics"],refetchInterval:3e4}),i=t||{dailyActiveUsers:0,postsToday:0,commentsToday:0,likesToday:0},{data:n,isLoading:d}=(0,j.useQuery)({queryKey:["/api/admin/overview/revenue-breakdown"],refetchInterval:6e4}),x=n||{stripe:0,crypto:0,total:0},{data:m,isLoading:h}=(0,j.useQuery)({queryKey:["/api/admin/overview/top-content"],refetchInterval:6e4}),u=Array.isArray(m)?m:[],{data:U,isLoading:Q}=(0,j.useQuery)({queryKey:["/api/admin/overview/top-users"],refetchInterval:6e4}),O=Array.isArray(U)?U:[],{data:z,isLoading:W}=(0,j.useQuery)({queryKey:["/api/admin/overview/activity-feed"],refetchInterval:15e3}),G=Array.isArray(z)?z:[],{data:_,isLoading:Y}=(0,j.useQuery)({queryKey:["/api/admin/overview/user-growth"],refetchInterval:6e4}),X=Array.isArray(_)?_:[],{data:J,isLoading:Z}=(0,j.useQuery)({queryKey:["/api/admin/overview/content-trend"],refetchInterval:6e4}),ee=Array.isArray(J)?J:[],ea=[{name:"Stripe",value:x.stripe,fill:"hsl(var(--primary))"},{name:"Crypto",value:x.crypto,fill:"hsl(var(--chart-2))"}];return a?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(c.Skeleton,{className:"h-10 w-64"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(8)].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a))})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Overview Dashboard"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-total-users",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Users"}),(0,r.jsx)(g.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-users",children:s.users.total}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",s.users.new24h," in last 24h"]})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-total-content",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Content"}),(0,r.jsx)(v.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-content",children:s.content.total}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",s.content.new24h," in last 24h"]})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-total-revenue",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Revenue"}),(0,r.jsx)(b.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-total-revenue",children:["$",s.revenue.total]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+$",s.revenue.today," today"]})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-pending-moderation",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Pending Moderation"}),(0,r.jsx)(y.AlertCircle,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-pending-moderation",children:s.moderation.pending}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[s.moderation.reports," reports"]})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-online-users",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Online Users"}),(0,r.jsx)(g.Users,{className:"h-4 w-4 text-green-500"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-online-users",children:s.users.online}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Active in last 15min"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-daily-registrations",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Daily Registrations"}),(0,r.jsx)(C.UserPlus,{className:"h-4 w-4 text-blue-500"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-daily-registrations",children:s.users.dailyRegistrations}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Registered today"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-premium-members",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Premium Members"}),(0,r.jsx)(f.Crown,{className:"h-4 w-4 text-amber-500"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-premium-members",children:s.users.premiumMembers}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Level 5 and above"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-avg-posts-user",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Avg Posts/User"}),(0,r.jsx)(N.TrendingUp,{className:"h-4 w-4 text-purple-500"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-posts-user",children:(s.content.avgPostsPerUser||0).toFixed(1)}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Per user average"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4","data-testid":"section-engagement-metrics",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-dau",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"DAU"}),(0,r.jsx)(S.Activity,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-xl font-bold","data-testid":"text-dau",children:i.dailyActiveUsers})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-posts-today",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Posts Today"}),(0,r.jsx)(v.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-xl font-bold","data-testid":"text-posts-today",children:i.postsToday})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-comments-today",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Comments Today"}),(0,r.jsx)(T.MessageSquare,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-xl font-bold","data-testid":"text-comments-today",children:i.commentsToday})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-likes-today",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Likes Today"}),(0,r.jsx)(w.ThumbsUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-xl font-bold","data-testid":"text-likes-today",children:i.likesToday})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-user-growth-chart",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"User Growth (Last 7 Days)"})}),(0,r.jsx)(o.CardContent,{children:Y?(0,r.jsx)(c.Skeleton,{className:"h-64"}):X.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(D.LineChart,{data:X,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"date"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(A.Line,{type:"monotone",dataKey:"users",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-content-trend-chart",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Content Trend (Last 7 Days)"})}),(0,r.jsx)(o.CardContent,{children:Z?(0,r.jsx)(c.Skeleton,{className:"h-64"}):ee.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(F.BarChart,{data:ee,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"date"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(H.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-revenue-breakdown-chart",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Revenue Breakdown"})}),(0,r.jsx)(o.CardContent,{children:d?(0,r.jsx)(c.Skeleton,{className:"h-64"}):x.total>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(R.PieChart,{children:[(0,r.jsx)(I.Pie,{data:ea,cx:"50%",cy:"50%",labelLine:!1,label:e=>`${e.name}: $${e.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:ea.map((e,a)=>(0,r.jsx)(B.Cell,{fill:e.fill},`cell-${a}`))}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(E.Legend,{})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No revenue data"})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-top-content",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Top Content"})}),(0,r.jsx)(o.CardContent,{children:h?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):u.length>0?(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{"data-testid":"table-top-content",children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{className:"w-12",children:"#"}),(0,r.jsx)(p.TableHead,{children:"Title"}),(0,r.jsx)(p.TableHead,{children:"Author"}),(0,r.jsx)(p.TableHead,{children:"Views"})]})}),(0,r.jsx)(p.TableBody,{children:u.map((e,a)=>(0,r.jsxs)(p.TableRow,{"data-testid":`row-top-content-${e.id}`,children:[(0,r.jsx)(p.TableCell,{className:"font-medium",children:a+1}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)($.default,{href:`/thread/${e.slug}`,className:"text-primary hover:underline","data-testid":`link-content-${e.id}`,children:e.title})}),(0,r.jsx)(p.TableCell,{children:e.author}),(0,r.jsx)(p.TableCell,{children:e.views})]},e.id))})]})}):(0,r.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No content data"})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-top-users",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Top Users Leaderboard"})}),(0,r.jsx)(o.CardContent,{children:Q?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):O.length>0?(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{"data-testid":"table-top-users",children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{className:"w-12",children:"#"}),(0,r.jsx)(p.TableHead,{children:"Username"}),(0,r.jsx)(p.TableHead,{children:"Rep"}),(0,r.jsx)(p.TableHead,{children:"Coins"}),(0,r.jsx)(p.TableHead,{children:"Posts"})]})}),(0,r.jsx)(p.TableBody,{children:O.map((e,a)=>(0,r.jsxs)(p.TableRow,{"data-testid":`row-top-user-${e.id}`,children:[(0,r.jsx)(p.TableCell,{className:"font-medium",children:a+1}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)($.default,{href:`/user/${e.username}`,className:"text-primary hover:underline","data-testid":`link-user-${e.id}`,children:e.username})}),(0,r.jsx)(p.TableCell,{children:e.reputation}),(0,r.jsx)(p.TableCell,{children:e.coinBalance}),(0,r.jsx)(p.TableCell,{children:e.totalPosts})]},e.id))})]})}):(0,r.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No user data"})})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-activity-feed",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Recent Admin Activity"})}),(0,r.jsx)(o.CardContent,{children:W?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):G.length>0?(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Admin"}),(0,r.jsx)(p.TableHead,{children:"Action"}),(0,r.jsx)(p.TableHead,{children:"Target"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Time"})]})}),(0,r.jsx)(p.TableBody,{children:G.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`activity-${e.id}`,children:[(0,r.jsx)(p.TableCell,{"data-testid":`activity-admin-${e.id}`,children:e.adminUsername||"System"}),(0,r.jsx)(p.TableCell,{"data-testid":`activity-action-${e.id}`,children:e.actionType}),(0,r.jsx)(p.TableCell,{"data-testid":`activity-target-${e.id}`,children:e.targetType}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"success"===e.status?"default":"destructive",children:e.status})}),(0,r.jsx)(p.TableCell,{"data-testid":`activity-time-${e.id}`,children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]},e.id))})]})}):(0,r.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No recent activity"})})]})]})}e.s(["default",()=>U],37668);var Q=e.i(54616),O=e.i(29085),z=e.i(87945),W=e.i(85024),G=e.i(79196),_=e.i(40176),Y=e.i(15683),X=e.i(79966),J=e.i(70682),Z=e.i(55436),ee=e.i(23622);let ea=(0,a.default)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);var es=e.i(75822),et=e.i(40160),el=e.i(73375),ei=e.i(63059),er=e.i(98919),en=e.i(87316),ed=e.i(45919),ec=e.i(1831);function eo(){let[e,a]=(0,n.useState)(""),[s,t]=(0,n.useState)("all"),[l,i]=(0,n.useState)("all"),[d,m]=(0,n.useState)("createdAt"),[h,u]=(0,n.useState)("desc"),[v,b]=(0,n.useState)(1),[y,C]=(0,n.useState)(25),[f,T]=(0,n.useState)(null),[w,S]=(0,n.useState)(!1),[D,A]=(0,n.useState)(!1),[F,H]=(0,n.useState)(),[R,I]=(0,n.useState)(""),[B,q]=(0,n.useState)(""),[L,P]=(0,n.useState)(""),{toast:M}=(0,Y.useToast)(),{data:K,isLoading:E}=(0,j.useQuery)({queryKey:["/api/admin/users",{search:e,role:s,status:l,sortBy:d,sortOrder:h,page:v,limit:y}]}),U=K?.users||[],eo=K?.totalPages||1,ex=K?.total||0,{data:em}=(0,j.useQuery)({queryKey:["/api/admin/users/stats",{search:e,role:s,status:l}],queryFn:()=>{let a=new URLSearchParams;e&&a.append("search",e),"all"!==s&&a.append("role",s),"all"!==l&&a.append("status",l);let t=a.toString();return fetch(`/api/admin/users/stats${t?"?"+t:""}`).then(e=>e.json())}}),eh=em||{total:0,avgReputation:0,avgCoins:0,bannedCount:0},{data:eu}=(0,j.useQuery)({queryKey:["/api/admin/users",f?.id,"activity"],queryFn:()=>fetch(`/api/admin/users/${f?.id}/activity`).then(e=>e.json()),enabled:!!f}),ej=eu||{totalThreads:0,totalReplies:0,totalContent:0,coinsEarned:0,coinsSpent:0,accountAge:0},{data:ep}=(0,j.useQuery)({queryKey:["/api/admin/users",f?.id,"posts"],queryFn:()=>fetch(`/api/admin/users/${f?.id}/posts`).then(e=>e.json()),enabled:!!f}),eg=Array.isArray(ep)?ep:[],{data:ev}=(0,j.useQuery)({queryKey:["/api/admin/users",f?.id,"coin-history"],queryFn:()=>fetch(`/api/admin/users/${f?.id}/coin-history`).then(e=>e.json()),enabled:!!f}),eb=Array.isArray(ev)?ev:[],ey=(0,Q.useMutation)({mutationFn:async({userId:e,reason:a})=>(0,ec.apiRequest)("POST",`/api/admin/users/${e}/ban`,{reason:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),M({title:"User banned successfully"}),T(null)},onError:()=>{M({title:"Failed to ban user",variant:"destructive"})}}),eC=(0,Q.useMutation)({mutationFn:async({userId:e,suspendedUntil:a,reason:s})=>(0,ec.apiRequest)("POST",`/api/admin/users/${e}/suspend`,{suspendedUntil:a,reason:s}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),M({title:"User suspended successfully"}),S(!1),H(void 0),I(""),T(null)},onError:()=>{M({title:"Failed to suspend user",variant:"destructive"})}}),ef=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("POST",`/api/admin/users/${e}/activate`,{}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),M({title:"User activated successfully"}),T(null)},onError:()=>{M({title:"Failed to activate user",variant:"destructive"})}}),eN=(0,Q.useMutation)({mutationFn:async({userId:e,role:a,reason:s})=>(0,ec.apiRequest)("POST",`/api/admin/users/${e}/role`,{role:a,reason:s}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),M({title:"User role changed successfully"}),A(!1),q(""),P(""),T(null)},onError:()=>{M({title:"Failed to change user role",variant:"destructive"})}}),eT=(0,Q.useMutation)({mutationFn:async({userId:e,amount:a,reason:s})=>(0,ec.apiRequest)("POST",`/api/admin/users/${e}/adjust-coins`,{amount:a,reason:s}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),M({title:"Coins adjusted successfully"})},onError:()=>{M({title:"Failed to adjust coins",variant:"destructive"})}}),ew=async()=>{try{let a=new URLSearchParams({search:e,role:s,status:l,sortBy:d,sortOrder:h}),t=await fetch(`/api/admin/users/export/csv?${a}`);if(!t.ok)throw Error("Export failed");let i=await t.blob(),r=window.URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=`users-export-${new Date().toISOString()}.csv`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(r),document.body.removeChild(n),M({title:"Users exported successfully"})}catch(e){M({title:"Failed to export users",variant:"destructive"})}};return E?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(c.Skeleton,{className:"h-10 w-64"}),(0,r.jsx)(c.Skeleton,{className:"h-96"})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"User Management"}),(0,r.jsxs)(x.Button,{onClick:ew,variant:"outline","data-testid":"button-export-users",children:[(0,r.jsx)(et.Download,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4","data-testid":"section-user-stats",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-total-users-stat",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Users"}),(0,r.jsx)(g.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-users-stat",children:eh.total})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-avg-reputation",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Avg Reputation"}),(0,r.jsx)(N.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-reputation",children:(eh.avgReputation||0).toFixed(0)})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-avg-coins",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Avg Coins"}),(0,r.jsx)(es.Coins,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-coins",children:(eh.avgCoins||0).toFixed(0)})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-banned-count",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Banned/Suspended"}),(0,r.jsx)(ee.Ban,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-banned-count",children:eh.bannedCount})})]})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Search & Filters"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(Z.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(O.Input,{placeholder:"Search by username or email...",value:e,onChange:e=>a(e.target.value),className:"pl-9","data-testid":"input-user-search"})]}),(0,r.jsxs)(W.Select,{value:s,onValueChange:t,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-role-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Filter by role"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Roles"}),(0,r.jsx)(W.SelectItem,{value:"member",children:"Member"}),(0,r.jsx)(W.SelectItem,{value:"moderator",children:"Moderator"}),(0,r.jsx)(W.SelectItem,{value:"admin",children:"Admin"})]})]}),(0,r.jsxs)(W.Select,{value:l,onValueChange:i,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-status-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Filter by status"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Status"}),(0,r.jsx)(W.SelectItem,{value:"active",children:"Active"}),(0,r.jsx)(W.SelectItem,{value:"suspended",children:"Suspended"}),(0,r.jsx)(W.SelectItem,{value:"banned",children:"Banned"})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsxs)(W.Select,{value:d,onValueChange:m,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-sort-by",children:(0,r.jsx)(W.SelectValue,{placeholder:"Sort by"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"username",children:"Username"}),(0,r.jsx)(W.SelectItem,{value:"email",children:"Email"}),(0,r.jsx)(W.SelectItem,{value:"coinBalance",children:"Coins"}),(0,r.jsx)(W.SelectItem,{value:"reputation",children:"Reputation"}),(0,r.jsx)(W.SelectItem,{value:"createdAt",children:"Created At"}),(0,r.jsx)(W.SelectItem,{value:"lastActive",children:"Last Active"})]})]}),(0,r.jsxs)(W.Select,{value:h,onValueChange:u,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-sort-order",children:(0,r.jsx)(W.SelectValue,{placeholder:"Sort order"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"asc",children:"Ascending"}),(0,r.jsx)(W.SelectItem,{value:"desc",children:"Descending"})]})]})]})]})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Users (",ex,")"]})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"User"}),(0,r.jsx)(p.TableHead,{children:"Email"}),(0,r.jsx)(p.TableHead,{children:"Role"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Coins"}),(0,r.jsx)(p.TableHead,{children:"Joined"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:U.length>0?U.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`user-row-${e.id}`,children:[(0,r.jsx)(p.TableCell,{"data-testid":`user-name-${e.id}`,children:e.username}),(0,r.jsx)(p.TableCell,{children:e.email}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"outline",children:e.role})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"active"===e.status?"default":"destructive",children:e.status})}),(0,r.jsx)(p.TableCell,{"data-testid":`user-coins-${e.id}`,children:e.coinBalance}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>T(e),"data-testid":`button-view-user-${e.id}`,children:[(0,r.jsx)(ea,{className:"h-4 w-4 mr-1"}),"View"]}),"active"===e.status?(0,r.jsxs)(x.Button,{size:"sm",variant:"destructive",onClick:()=>ey.mutate({userId:e.id,reason:"Manual ban"}),"data-testid":`button-ban-user-${e.id}`,children:[(0,r.jsx)(ee.Ban,{className:"h-4 w-4 mr-1"}),"Ban"]}):(0,r.jsxs)(x.Button,{size:"sm",variant:"default",onClick:()=>ef.mutate(e.id),"data-testid":`button-activate-user-${e.id}`,children:[(0,r.jsx)(ea,{className:"h-4 w-4 mr-1"}),"Activate"]})]})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No users found"})})})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Items per page:"}),(0,r.jsxs)(W.Select,{value:y.toString(),onValueChange:e=>C(parseInt(e)),children:[(0,r.jsx)(W.SelectTrigger,{className:"w-20","data-testid":"select-items-per-page",children:(0,r.jsx)(W.SelectValue,{})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"10",children:"10"}),(0,r.jsx)(W.SelectItem,{value:"25",children:"25"}),(0,r.jsx)(W.SelectItem,{value:"50",children:"50"}),(0,r.jsx)(W.SelectItem,{value:"100",children:"100"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>b(e=>Math.max(1,e-1)),disabled:1===v,"data-testid":"button-previous-page",children:[(0,r.jsx)(el.ChevronLeft,{className:"h-4 w-4 mr-1"}),"Previous"]}),(0,r.jsxs)("span",{className:"text-sm","data-testid":"text-page-info",children:["Page ",v," of ",eo]}),(0,r.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>b(e=>Math.min(eo,e+1)),disabled:v===eo,"data-testid":"button-next-page",children:["Next",(0,r.jsx)(ei.ChevronRight,{className:"h-4 w-4 ml-1"})]})]})]})]})]}),(0,r.jsx)(G.Dialog,{open:!!f,onOpenChange:e=>!e&&T(null),children:(0,r.jsxs)(G.DialogContent,{className:"max-w-3xl max-h-[80vh] overflow-y-auto","data-testid":"modal-user-detail",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsxs)(G.DialogTitle,{children:["User Details: ",f?.username]}),(0,r.jsx)(G.DialogDescription,{children:"Comprehensive user information and management"})]}),f&&(0,r.jsxs)(_.Tabs,{defaultValue:"profile",className:"w-full",children:[(0,r.jsxs)(_.TabsList,{className:"grid w-full grid-cols-4",children:[(0,r.jsx)(_.TabsTrigger,{value:"profile","data-testid":"tab-profile",children:"Profile"}),(0,r.jsx)(_.TabsTrigger,{value:"activity","data-testid":"tab-activity",children:"Activity"}),(0,r.jsx)(_.TabsTrigger,{value:"posts","data-testid":"tab-posts",children:"Posts"}),(0,r.jsx)(_.TabsTrigger,{value:"coin-history","data-testid":"tab-coin-history",children:"Coin History"})]}),(0,r.jsxs)(_.TabsContent,{value:"profile",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Username"}),(0,r.jsx)("p",{className:"font-medium",children:f.username})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Email"}),(0,r.jsx)("p",{className:"font-medium",children:f.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Role"}),(0,r.jsx)(V.Badge,{variant:"outline",children:f.role})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,r.jsx)(V.Badge,{variant:"active"===f.status?"default":"destructive",children:f.status})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Coin Balance"}),(0,r.jsx)("p",{className:"font-medium",children:f.coinBalance})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Reputation"}),(0,r.jsx)("p",{className:"font-medium",children:f.reputation})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Level"}),(0,r.jsx)("p",{className:"font-medium",children:f.level||0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Created At"}),(0,r.jsx)("p",{className:"font-medium",children:(0,k.formatDistanceToNow)(new Date(f.createdAt),{addSuffix:!0})})]}),f.lastActive&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Last Active"}),(0,r.jsx)("p",{className:"font-medium",children:(0,k.formatDistanceToNow)(new Date(f.lastActive),{addSuffix:!0})})]}),f.suspendedUntil&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Suspended Until"}),(0,r.jsx)("p",{className:"font-medium",children:(0,ed.format)(new Date(f.suspendedUntil),"PPP")})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap pt-4",children:[(0,r.jsxs)(x.Button,{onClick:()=>{S(!0)},variant:"outline",disabled:"active"!==f.status,children:[(0,r.jsx)(en.Calendar,{className:"h-4 w-4 mr-1"}),"Suspend"]}),(0,r.jsxs)(x.Button,{onClick:()=>{A(!0)},variant:"outline",children:[(0,r.jsx)(er.Shield,{className:"h-4 w-4 mr-1"}),"Change Role"]}),(0,r.jsxs)(x.Button,{onClick:()=>{eT.mutate({userId:f.id,amount:100,reason:"Admin adjustment"})},variant:"outline",children:[(0,r.jsx)(es.Coins,{className:"h-4 w-4 mr-1"}),"Add 100 Coins"]})]})]}),(0,r.jsx)(_.TabsContent,{value:"activity",className:"space-y-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm",children:"Total Threads"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("p",{className:"text-2xl font-bold",children:ej.totalThreads})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm",children:"Total Replies"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("p",{className:"text-2xl font-bold",children:ej.totalReplies})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm",children:"Content Published"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("p",{className:"text-2xl font-bold",children:ej.totalContent})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm",children:"Coins Earned"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("p",{className:"text-2xl font-bold",children:ej.coinsEarned})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm",children:"Coins Spent"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("p",{className:"text-2xl font-bold",children:ej.coinsSpent})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm",children:"Account Age"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[ej.accountAge," days"]})})]})]})}),(0,r.jsx)(_.TabsContent,{value:"posts",children:eg.length>0?(0,r.jsx)("div",{className:"space-y-2",children:eg.map(e=>(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"pt-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)($.default,{href:`/thread/${e.slug}`,className:"text-primary hover:underline font-medium",children:e.title}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["thread"===e.type?"Thread":"Reply"," · ",(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})]})]}),void 0!==e.views&&(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.views," views"]})]})})},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No posts yet"})}),(0,r.jsx)(_.TabsContent,{value:"coin-history",children:eb.length>0?(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Date"}),(0,r.jsx)(p.TableHead,{children:"Type"}),(0,r.jsx)(p.TableHead,{children:"Amount"}),(0,r.jsx)(p.TableHead,{children:"Description"}),(0,r.jsx)(p.TableHead,{children:"Balance"})]})}),(0,r.jsx)(p.TableBody,{children:eb.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"earn"===e.type||"recharge"===e.type?"default":"secondary",children:e.type})}),(0,r.jsxs)(p.TableCell,{className:e.amount>0?"text-green-600":"text-red-600",children:[e.amount>0?"+":"",e.amount]}),(0,r.jsx)(p.TableCell,{children:e.description}),(0,r.jsx)(p.TableCell,{children:e.balance})]},e.id))})]})}):(0,r.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No coin history"})})]})]})}),(0,r.jsx)(G.Dialog,{open:w,onOpenChange:S,children:(0,r.jsxs)(G.DialogContent,{"data-testid":"dialog-suspend-user",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Suspend User"}),(0,r.jsxs)(G.DialogDescription,{children:["Temporarily suspend ",f?.username,"'s account"]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Suspended Until"}),(0,r.jsxs)(J.Popover,{children:[(0,r.jsx)(J.PopoverTrigger,{asChild:!0,children:(0,r.jsxs)(x.Button,{variant:"outline",className:"w-full justify-start text-left font-normal mt-2","data-testid":"input-suspended-until",children:[(0,r.jsx)(en.Calendar,{className:"mr-2 h-4 w-4"}),F?(0,ed.format)(F,"PPP"):(0,r.jsx)("span",{children:"Pick a date"})]})}),(0,r.jsx)(J.PopoverContent,{className:"w-auto p-0",children:(0,r.jsx)(X.Calendar,{mode:"single",selected:F,onSelect:H,initialFocus:!0})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Reason"}),(0,r.jsx)(z.Textarea,{placeholder:"Enter suspension reason...",value:R,onChange:e=>I(e.target.value),className:"mt-2","data-testid":"input-suspend-reason"})]})]}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),(0,r.jsx)(x.Button,{onClick:()=>{f&&F&&eC.mutate({userId:f.id,suspendedUntil:F.toISOString(),reason:R})},disabled:!F||eC.isPending,"data-testid":"button-suspend-confirm",children:eC.isPending?"Suspending...":"Suspend User"})]})]})}),(0,r.jsx)(G.Dialog,{open:D,onOpenChange:A,children:(0,r.jsxs)(G.DialogContent,{"data-testid":"dialog-change-role",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Change User Role"}),(0,r.jsxs)(G.DialogDescription,{children:["Change the role for ",f?.username]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"New Role"}),(0,r.jsxs)(W.Select,{value:B,onValueChange:q,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full mt-2","data-testid":"select-new-role",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select new role"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"member",children:"Member"}),(0,r.jsx)(W.SelectItem,{value:"moderator",children:"Moderator"}),(0,r.jsx)(W.SelectItem,{value:"admin",children:"Admin"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Reason (Optional)"}),(0,r.jsx)(z.Textarea,{placeholder:"Enter reason for role change...",value:L,onChange:e=>P(e.target.value),className:"mt-2","data-testid":"input-role-change-reason"})]})]}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),(0,r.jsx)(x.Button,{onClick:()=>{f&&B&&eN.mutate({userId:f.id,role:B,reason:L})},disabled:!B||eN.isPending,"data-testid":"button-change-role-confirm",children:eN.isPending?"Changing...":"Change Role"})]})]})})]})}e.s(["default",()=>eo],95052);var ex=e.i(10320),em=e.i(16759),eh=e.i(32486),eu=e.i(69638);let ej=(0,a.default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var ep=e.i(86536),eg=e.i(78894),ev=e.i(3116),eb=e.i(84614),ey=e.i(16715);let eC=(0,a.default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var ef=e.i(27612),eN=e.i(44793);function eT(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)("all"),[t,l]=(0,n.useState)(1),[i,d]=(0,n.useState)(20),[m,h]=(0,n.useState)([]),[u,g]=(0,n.useState)("pending"),[b,y]=(0,n.useState)(1),[C,f]=(0,n.useState)(20),[T,w]=(0,n.useState)(100),[S,D]=(0,n.useState)("all"),[A,F]=(0,n.useState)(!1),[H,R]=(0,n.useState)(null),[I,B]=(0,n.useState)(!1),[q,L]=(0,n.useState)(null),[P,M]=(0,n.useState)(""),[K,E]=(0,n.useState)(!1),[$,U]=(0,n.useState)(!1),[X,J]=(0,n.useState)(null),[Z,ea]=(0,n.useState)(null),[es,et]=(0,n.useState)(!1),[en,eo]=(0,n.useState)(""),[eT,ew]=(0,n.useState)(!1),[eS,ek]=(0,n.useState)(7),[eD,eA]=(0,n.useState)(""),[eF,eH]=(0,n.useState)(null),[eR,eI]=(0,n.useState)(!1),[eB,eq]=(0,n.useState)(""),[eL,eP]=(0,n.useState)(!1),[eM,eK]=(0,n.useState)(null),[eE,eV]=(0,n.useState)(!1),[e$,eU]=(0,n.useState)(!1),[eQ,eO]=(0,n.useState)(""),{data:ez,isLoading:eW}=(0,j.useQuery)({queryKey:["/api/moderation/queue",{type:a,page:t,perPage:i}],refetchInterval:3e4}),{data:eG}=(0,j.useQuery)({queryKey:["/api/moderation/queue/count"],refetchInterval:3e4}),{data:e_,isLoading:eY}=(0,j.useQuery)({queryKey:["/api/moderation/reported",{status:u,page:b,perPage:C}],refetchInterval:3e4}),{data:eX}=(0,j.useQuery)({queryKey:["/api/moderation/reported/count"],refetchInterval:3e4}),{data:eJ,isLoading:eZ}=(0,j.useQuery)({queryKey:["/api/moderation/history",{limit:T,moderatorId:"all"!==S?S:void 0}],refetchInterval:!1}),{data:e0,isLoading:e2}=(0,j.useQuery)({queryKey:["/api/moderation/stats"],refetchInterval:6e4}),e4=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("POST",`/api/moderation/${e}/approve`,{}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),e({title:"Content approved successfully"}),h([])},onError:()=>{e({title:"Failed to approve content",variant:"destructive"})}}),e1=(0,Q.useMutation)({mutationFn:async({contentId:e,reason:a,deletePermanently:s})=>(0,ec.apiRequest)("POST",`/api/moderation/${e}/reject`,{reason:a,deletePermanently:s}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),e({title:"Content rejected successfully"}),B(!1),M(""),E(!1),L(null),F(!1),h([])},onError:()=>{e({title:"Failed to reject content",variant:"destructive"})}}),e3=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("POST","/api/moderation/bulk-approve",{contentIds:e}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),e({title:`Successfully approved ${m.length} items`}),h([]),eV(!1)},onError:()=>{e({title:"Failed to approve selected items",variant:"destructive"})}}),e6=(0,Q.useMutation)({mutationFn:async({contentIds:e,reason:a})=>(0,ec.apiRequest)("POST","/api/moderation/bulk-reject",{contentIds:e,reason:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),e({title:`Successfully rejected ${m.length} items`}),h([]),eU(!1),eO("")},onError:()=>{e({title:"Failed to reject selected items",variant:"destructive"})}}),e5=(0,Q.useMutation)({mutationFn:async({reportId:e,reason:a})=>(0,ec.apiRequest)("POST",`/api/moderation/report/${e}/dismiss`,{reason:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/moderation/reported"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/reported/count"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),e({title:"Report dismissed successfully"}),et(!1),eo(""),U(!1)},onError:()=>{e({title:"Failed to dismiss report",variant:"destructive"})}}),e8=(0,Q.useMutation)({mutationFn:async({reportId:e,action:a,reason:s,suspendDays:t})=>(0,ec.apiRequest)("POST",`/api/moderation/report/${e}/action`,{action:a,reason:s,suspendDays:t}),onSuccess:(a,s)=>{ec.queryClient.invalidateQueries({queryKey:["/api/moderation/reported"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/reported/count"]}),ec.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]});let t="delete"===s.action?"deleted":"warn"===s.action?"warned":"suspend"===s.action?"suspended":"banned";e({title:`Author ${t} successfully`}),U(!1),ew(!1),eI(!1),eA(""),eq(""),eP(!1)},onError:()=>{e({title:"Failed to take action",variant:"destructive"})}}),e7=async a=>{try{let e=await fetch(`/api/moderation/${a}/details`),s=await e.json();R(s),F(!0)}catch(a){e({title:"Failed to load content details",variant:"destructive"})}},e9=async a=>{try{let e=await fetch(`/api/moderation/report/${a}`),s=await e.json();J(s),ea(a),U(!0)}catch(a){e({title:"Failed to load report details",variant:"destructive"})}},ae=e=>{L(e),B(!0)},aa=(e,a)=>e.length<=a?e:e.substring(0,a)+"...",as=ez?.items||[],at=e_?.items||[],al=eJ||[],ai=as.length>0&&m.length===as.length;return m.length>0&&(m.length,as.length),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Content Moderation"})}),(0,r.jsxs)(_.Tabs,{defaultValue:"queue",className:"space-y-4",children:[(0,r.jsxs)(_.TabsList,{children:[(0,r.jsxs)(_.TabsTrigger,{value:"queue","data-testid":"tab-moderation-queue",children:["Moderation Queue",eG&&eG.pending>0&&(0,r.jsx)(V.Badge,{variant:"destructive",className:"ml-2",children:eG.pending})]}),(0,r.jsxs)(_.TabsTrigger,{value:"reported","data-testid":"tab-reported-content",children:["Reported Content",eX&&eX.pending>0&&(0,r.jsx)(V.Badge,{variant:"destructive",className:"ml-2",children:eX.pending})]}),(0,r.jsx)(_.TabsTrigger,{value:"history","data-testid":"tab-moderation-history",children:"Moderation History"}),(0,r.jsx)(_.TabsTrigger,{value:"stats","data-testid":"tab-moderation-stats",children:"Statistics"})]}),(0,r.jsxs)(_.TabsContent,{value:"queue",className:"space-y-4",children:[(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,r.jsx)(o.CardTitle,{children:"Content Type"}),(0,r.jsx)(_.Tabs,{value:a,onValueChange:s,className:"w-auto",children:(0,r.jsxs)(_.TabsList,{children:[(0,r.jsx)(_.TabsTrigger,{value:"all","data-testid":"filter-content-type-all",children:"All"}),(0,r.jsx)(_.TabsTrigger,{value:"thread","data-testid":"filter-content-type-thread",children:"Threads"}),(0,r.jsx)(_.TabsTrigger,{value:"reply","data-testid":"filter-content-type-reply",children:"Replies"})]})})]})})}),m.length>0&&(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsxs)(x.Button,{onClick:()=>{0===m.length||m.length>100||eV(!0)},disabled:0===m.length||m.length>100||e3.isPending,"data-testid":"button-bulk-approve",children:[(0,r.jsx)(eu.CheckCircle,{className:"h-4 w-4 mr-2"}),"Approve Selected (",m.length,")"]}),(0,r.jsxs)(x.Button,{variant:"destructive",onClick:()=>{0===m.length||m.length>100||eU(!0)},disabled:0===m.length||m.length>100||e6.isPending,"data-testid":"button-bulk-reject",children:[(0,r.jsx)(ej,{className:"h-4 w-4 mr-2"}),"Reject Selected (",m.length,")"]}),m.length>100&&(0,r.jsx)(eh.Alert,{className:"flex-1",children:(0,r.jsx)(eh.AlertDescription,{children:"Maximum 100 items can be selected for bulk actions"})})]})})}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Pending Content (",ez?.total||0,")"]})}),(0,r.jsxs)(o.CardContent,{children:[eW?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-16"},a))}):0===as.length?(0,r.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No pending items in queue"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{"data-testid":"table-moderation-queue",children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{className:"w-12",children:(0,r.jsx)(ex.Checkbox,{checked:ai,onCheckedChange:e=>{e?h((ez?.items||[]).map(e=>e.id)):h([])},"data-testid":"checkbox-select-all"})}),(0,r.jsx)(p.TableHead,{children:"Content Preview"}),(0,r.jsx)(p.TableHead,{children:"Author"}),(0,r.jsx)(p.TableHead,{children:"Category"}),(0,r.jsx)(p.TableHead,{children:"Submitted"}),(0,r.jsx)(p.TableHead,{children:"Word Count"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:as.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(ex.Checkbox,{checked:m.includes(e.id),onCheckedChange:a=>{var s;return s=e.id,void(a?h([...m,s]):h(m.filter(e=>e!==s)))},"data-testid":`checkbox-select-${e.id}`})}),(0,r.jsx)(p.TableCell,{className:"max-w-md",children:(0,r.jsxs)("div",{className:"space-y-1",children:[e.title&&(0,r.jsx)("div",{className:"font-medium",children:aa(e.title,50)}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:aa(e.body,100)}),(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)(V.Badge,{variant:"outline",children:e.type}),e.hasLinks&&(0,r.jsx)(V.Badge,{variant:"secondary",children:"Links"}),e.hasImages&&(0,r.jsx)(V.Badge,{variant:"secondary",children:"Images"})]})]})}),(0,r.jsxs)(p.TableCell,{children:["@",e.authorUsername]}),(0,r.jsx)(p.TableCell,{children:"thread"===e.type?e.categoryName:e.threadTitle}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:e.wordCount}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsxs)(x.Button,{size:"sm",variant:"ghost",onClick:()=>e7(e.id),"data-testid":`button-view-details-${e.id}`,children:[(0,r.jsx)(ep.Eye,{className:"h-4 w-4 mr-1"}),"View"]}),(0,r.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>e4.mutate(e.id),disabled:e4.isPending,"data-testid":`button-approve-${e.id}`,children:[(0,r.jsx)(eu.CheckCircle,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,r.jsxs)(x.Button,{size:"sm",variant:"destructive",onClick:()=>ae(e.id),"data-testid":`button-reject-${e.id}`,children:[(0,r.jsx)(ej,{className:"h-4 w-4 mr-1"}),"Reject"]})]})})]},e.id))})]})}),ez&&ez.pages>1&&(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4 mt-4 flex-wrap",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Items per page:"}),(0,r.jsxs)(W.Select,{value:i.toString(),onValueChange:e=>d(Number(e)),children:[(0,r.jsx)(W.SelectTrigger,{className:"w-20",children:(0,r.jsx)(W.SelectValue,{})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"10",children:"10"}),(0,r.jsx)(W.SelectItem,{value:"20",children:"20"}),(0,r.jsx)(W.SelectItem,{value:"50",children:"50"}),(0,r.jsx)(W.SelectItem,{value:"100",children:"100"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>l(e=>Math.max(1,e-1)),disabled:1===t,children:[(0,r.jsx)(el.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,r.jsxs)("span",{className:"text-sm",children:["Page ",t," of ",ez.pages]}),(0,r.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>l(e=>Math.min(ez.pages,e+1)),disabled:t===ez.pages,children:["Next",(0,r.jsx)(ei.ChevronRight,{className:"h-4 w-4"})]})]})]})]})]})]}),(0,r.jsxs)(_.TabsContent,{value:"reported",className:"space-y-4",children:[(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,r.jsx)(o.CardTitle,{children:"Filter by Status"}),(0,r.jsxs)(W.Select,{value:u,onValueChange:g,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-48",children:(0,r.jsx)(W.SelectValue,{})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"pending",children:"Pending"}),(0,r.jsx)(W.SelectItem,{value:"resolved",children:"Resolved"}),(0,r.jsx)(W.SelectItem,{value:"dismissed",children:"Dismissed"})]})]})]})})}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Reported Content (",e_?.total||0,")"]})}),(0,r.jsxs)(o.CardContent,{children:[eY?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-16"},a))}):0===at.length?(0,r.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No reported content found"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{"data-testid":"table-reported-content",children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Content Preview"}),(0,r.jsx)(p.TableHead,{children:"Author"}),(0,r.jsx)(p.TableHead,{children:"Reports"}),(0,r.jsx)(p.TableHead,{children:"Reasons"}),(0,r.jsx)(p.TableHead,{children:"First Reported"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:at.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{className:"max-w-md",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-sm",children:aa(e.contentPreview,100)}),(0,r.jsx)(V.Badge,{variant:"outline",children:e.contentType})]})}),(0,r.jsxs)(p.TableCell,{children:["@",e.authorUsername]}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"destructive",children:e.reportCount})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.reasons.slice(0,3).map((e,a)=>(0,r.jsx)(V.Badge,{variant:"secondary",children:e},a)),e.reasons.length>3&&(0,r.jsxs)(V.Badge,{variant:"secondary",children:["+",e.reasons.length-3]})]})}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.firstReportedAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"pending"===e.status?"destructive":"resolved"===e.status?"default":"secondary",children:e.status})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsxs)(x.Button,{size:"sm",variant:"ghost",onClick:()=>e9(e.contentId),children:[(0,r.jsx)(ep.Eye,{className:"h-4 w-4 mr-1"}),"View Details"]}),"pending"===e.status&&(0,r.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>e9(e.contentId),"data-testid":`button-take-action-${e.contentId}`,children:[(0,r.jsx)(er.Shield,{className:"h-4 w-4 mr-1"}),"Take Action"]})]})})]},e.contentId))})]})}),e_&&e_.pages>1&&(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4 mt-4 flex-wrap",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Items per page:"}),(0,r.jsxs)(W.Select,{value:C.toString(),onValueChange:e=>f(Number(e)),children:[(0,r.jsx)(W.SelectTrigger,{className:"w-20",children:(0,r.jsx)(W.SelectValue,{})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"10",children:"10"}),(0,r.jsx)(W.SelectItem,{value:"20",children:"20"}),(0,r.jsx)(W.SelectItem,{value:"50",children:"50"}),(0,r.jsx)(W.SelectItem,{value:"100",children:"100"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>y(e=>Math.max(1,e-1)),disabled:1===b,children:[(0,r.jsx)(el.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,r.jsxs)("span",{className:"text-sm",children:["Page ",b," of ",e_.pages]}),(0,r.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>y(e=>Math.min(e_.pages,e+1)),disabled:b===e_.pages,children:["Next",(0,r.jsx)(ei.ChevronRight,{className:"h-4 w-4"})]})]})]})]})]})]}),(0,r.jsxs)(_.TabsContent,{value:"history",className:"space-y-4",children:[(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,r.jsx)(o.CardTitle,{children:"Filters"}),(0,r.jsxs)("div",{className:"flex gap-4 flex-wrap",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm",children:"Moderator:"}),(0,r.jsxs)(W.Select,{value:S,onValueChange:D,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-48","data-testid":"select-moderator-filter",children:(0,r.jsx)(W.SelectValue,{})}),(0,r.jsx)(W.SelectContent,{children:(0,r.jsx)(W.SelectItem,{value:"all",children:"All Moderators"})})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm",children:"Limit:"}),(0,r.jsxs)(W.Select,{value:T.toString(),onValueChange:e=>w(Number(e)),children:[(0,r.jsx)(W.SelectTrigger,{className:"w-32",children:(0,r.jsx)(W.SelectValue,{})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"50",children:"50"}),(0,r.jsx)(W.SelectItem,{value:"100",children:"100"}),(0,r.jsx)(W.SelectItem,{value:"200",children:"200"}),(0,r.jsx)(W.SelectItem,{value:"500",children:"500"})]})]})]}),(0,r.jsxs)(x.Button,{variant:"outline",onClick:()=>ec.queryClient.invalidateQueries({queryKey:["/api/moderation/history"]}),children:[(0,r.jsx)(ey.RefreshCw,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]})})}),(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsx)(o.CardTitle,{children:"Moderation History"}),(0,r.jsx)(o.CardDescription,{children:"Read-only log of recent moderation actions"})]}),(0,r.jsx)(o.CardContent,{children:eZ?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):0===al.length?(0,r.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No moderation history available"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{"data-testid":"table-history",children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Timestamp"}),(0,r.jsx)(p.TableHead,{children:"Moderator"}),(0,r.jsx)(p.TableHead,{children:"Action"}),(0,r.jsx)(p.TableHead,{children:"Content"}),(0,r.jsx)(p.TableHead,{children:"Reason"})]})}),(0,r.jsx)(p.TableBody,{children:al.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{children:(0,ed.format)(new Date(e.createdAt),"MMM d, yyyy HH:mm")}),(0,r.jsxs)(p.TableCell,{children:["@",e.moderatorUsername]}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"approve"===e.actionType?"default":"reject"===e.actionType?"destructive":"secondary",children:e.actionType})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-sm",children:aa(e.contentTitle,50)}),(0,r.jsx)(V.Badge,{variant:"outline",children:e.contentType})]})}),(0,r.jsx)(p.TableCell,{className:"max-w-md",children:e.reason?aa(e.reason,100):"-"})]},e.id))})]})})})]})]}),(0,r.jsx)(_.TabsContent,{value:"stats",className:"space-y-4",children:e2?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(8)].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a))}):e0?(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-today-approved",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Today Approved"}),(0,r.jsx)(eu.CheckCircle,{className:"h-4 w-4 text-green-500"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold",children:e0.todayApproved})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-today-rejected",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Today Rejected"}),(0,r.jsx)(ej,{className:"h-4 w-4 text-red-500"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold",children:e0.todayRejected})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-today-reports-handled",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Today Reports Handled"}),(0,r.jsx)(eg.AlertTriangle,{className:"h-4 w-4 text-orange-500"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold",children:e0.todayReportsHandled})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-total-moderated-today",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Moderated Today"}),(0,r.jsx)(N.TrendingUp,{className:"h-4 w-4 text-blue-500"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold",children:e0.totalModeratedToday})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-avg-response-time",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Avg Response Time"}),(0,r.jsx)(ev.Clock,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[e0.avgResponseTimeMinutes,"m"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Average time to first action"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-most-active-moderator",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Most Active Moderator"}),(0,r.jsx)(eb.User,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-lg font-bold",children:["@",e0.mostActiveModerator||"N/A"]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-pending-under-1hr",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Pending < 1hr"}),(0,r.jsx)(v.FileText,{className:"h-4 w-4 text-green-500"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:e0.pendingUnderOneHour}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Fresh submissions"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-pending-over-24hrs",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Pending > 24hrs"}),(0,r.jsx)(eg.AlertTriangle,{className:"h-4 w-4 text-red-500"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:e0.pendingOverTwentyFourHours}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Urgent - needs attention"})]})]})]}):null})]}),(0,r.jsx)(G.Dialog,{open:A,onOpenChange:F,children:(0,r.jsxs)(G.DialogContent,{className:"max-w-4xl max-h-[90vh]","data-testid":"dialog-content-details",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsxs)(G.DialogTitle,{children:["Review Content - ",H?.type==="thread"?"Thread":"Reply"]})}),(0,r.jsx)(em.ScrollArea,{className:"max-h-[calc(90vh-150px)]",children:H&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Content"}),H.title&&(0,r.jsx)("h4",{className:"text-lg font-bold mb-2",children:H.title}),(0,r.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:H.body})]}),H.parentThread&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Parent Thread"}),(0,r.jsx)("div",{className:"p-3 bg-muted rounded-lg",children:(0,r.jsx)("p",{className:"text-sm",children:H.parentThread.title})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Author Information"}),(0,r.jsxs)("div",{className:"flex items-start gap-4 p-4 bg-muted rounded-lg",children:[(0,r.jsx)(eN.Avatar,{children:(0,r.jsx)(eN.AvatarFallback,{children:H.author.username[0].toUpperCase()})}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"font-medium",children:["@",H.author.username]}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:H.author.role})]}),(0,r.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Reputation:"})," ",(0,r.jsx)("span",{className:"font-medium",children:H.author.reputation})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Member since:"})," ",(0,r.jsx)("span",{className:"font-medium",children:(0,ed.format)(new Date(H.author.createdAt),"MMM d, yyyy")})]})]}),H.author.badges&&H.author.badges.length>0&&(0,r.jsx)("div",{className:"flex gap-1 flex-wrap",children:H.author.badges.map((e,a)=>(0,r.jsx)(V.Badge,{variant:"secondary",children:e},a))})]})]})]}),H.recentPosts.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Author's Recent Posts"}),(0,r.jsx)("div",{className:"space-y-2",children:H.recentPosts.map(e=>(0,r.jsx)("div",{className:"p-3 bg-muted rounded-lg text-sm",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-medium",children:e.title}),(0,r.jsx)("div",{className:"text-muted-foreground",children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,r.jsx)(V.Badge,{variant:"outline",children:e.type})]})},e.id))})]}),H.warnings.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2 text-orange-600",children:"Warning History"}),(0,r.jsx)("div",{className:"space-y-2",children:H.warnings.map((e,a)=>(0,r.jsxs)("div",{className:"p-3 bg-orange-50 dark:bg-orange-950/20 rounded-lg text-sm border border-orange-200 dark:border-orange-800",children:[(0,r.jsx)("div",{className:"font-medium",children:e.reason}),(0,r.jsxs)("div",{className:"text-muted-foreground",children:["By @",e.moderator," • ",(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})]})]},a))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Metadata"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 p-4 bg-muted rounded-lg text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Created:"})," ",(0,ed.format)(new Date(H.metadata.createdAt),"MMM d, yyyy HH:mm")]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Word Count:"})," ",H.metadata.wordCount]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Has Links:"})," ",H.metadata.hasLinks?"Yes":"No"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Has Images:"})," ",H.metadata.hasImages?"Yes":"No"]}),H.metadata.category&&(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Category:"})," ",H.metadata.category]})]})]})]})}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{variant:"ghost",onClick:()=>F(!1),children:"Close"}),(0,r.jsxs)(x.Button,{variant:"outline",onClick:()=>{H&&e4.mutate(H.id)},children:[(0,r.jsx)(eu.CheckCircle,{className:"h-4 w-4 mr-2"}),"Approve"]}),(0,r.jsxs)(x.Button,{variant:"destructive",onClick:()=>{H&&ae(H.id)},children:[(0,r.jsx)(ej,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]})}),(0,r.jsx)(G.Dialog,{open:I,onOpenChange:B,children:(0,r.jsxs)(G.DialogContent,{"data-testid":"dialog-reject-content",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Reject Content"}),(0,r.jsx)(G.DialogDescription,{children:"Please provide a reason for rejecting this content"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,r.jsx)(z.Textarea,{value:P,onChange:e=>M(e.target.value),placeholder:"Enter reason for rejection...",className:"min-h-24","data-testid":"textarea-reason"}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[P.length,"/500 characters"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(ex.Checkbox,{checked:K,onCheckedChange:e=>E(e),id:"delete-permanently"}),(0,r.jsx)("label",{htmlFor:"delete-permanently",className:"text-sm cursor-pointer",children:"Delete permanently"})]})]}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{variant:"ghost",onClick:()=>B(!1),children:"Cancel"}),(0,r.jsx)(x.Button,{variant:"destructive",onClick:()=>{!q||!P||P.length<10||P.length>500?e({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):e1.mutate({contentId:q,reason:P,deletePermanently:K})},disabled:e1.isPending||P.length<10||P.length>500,children:"Reject"})]})]})}),(0,r.jsx)(G.Dialog,{open:$,onOpenChange:U,children:(0,r.jsxs)(G.DialogContent,{className:"max-w-4xl max-h-[90vh]","data-testid":"dialog-report-details",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Report Details"})}),(0,r.jsx)(em.ScrollArea,{className:"max-h-[calc(90vh-150px)]",children:X&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Content"}),X.content.title&&(0,r.jsx)("h4",{className:"text-lg font-bold mb-2",children:X.content.title}),(0,r.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:X.content.body})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-semibold mb-2",children:["Reports (",X.reports.length,")"]}),(0,r.jsx)("div",{className:"space-y-3",children:X.reports.map((e,a)=>(0,r.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"font-medium",children:["@",e.reporterUsername]}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,r.jsx)(V.Badge,{variant:"destructive",children:e.reason})]}),e.description&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]},a))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold mb-2",children:"Author Information"}),(0,r.jsx)("div",{className:"p-4 bg-muted rounded-lg",children:(0,r.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Username:"})," ",(0,r.jsxs)("span",{className:"font-medium",children:["@",X.author.username]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Reputation:"})," ",(0,r.jsx)("span",{className:"font-medium",children:X.author.reputation})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Role:"})," ",(0,r.jsx)("span",{className:"font-medium",children:X.author.role})]})]})})]})]})}),(0,r.jsxs)(G.DialogFooter,{className:"flex-wrap gap-2",children:[(0,r.jsx)(x.Button,{variant:"ghost",onClick:()=>U(!1),children:"Close"}),(0,r.jsx)(x.Button,{variant:"secondary",onClick:()=>{et(!0)},children:"Dismiss Report"}),(0,r.jsxs)(x.Button,{variant:"destructive",onClick:()=>{Z&&e8.mutate({reportId:Z,action:"delete",reason:"Content deleted by moderator"})},children:[(0,r.jsx)(ef.Trash2,{className:"h-4 w-4 mr-2"}),"Delete Content"]}),(0,r.jsxs)(x.Button,{variant:"outline",onClick:()=>{Z&&e8.mutate({reportId:Z,action:"warn",reason:"Warning issued for reported content"})},className:"border-yellow-500 text-yellow-600 hover:bg-yellow-50 dark:hover:bg-yellow-950/20",children:[(0,r.jsx)(eg.AlertTriangle,{className:"h-4 w-4 mr-2"}),"Warn Author"]}),(0,r.jsxs)(x.Button,{variant:"outline",onClick:()=>{X&&(eH(X.author.username),ew(!0))},className:"border-orange-500 text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-950/20",children:[(0,r.jsx)(eC,{className:"h-4 w-4 mr-2"}),"Suspend Author"]}),(0,r.jsxs)(x.Button,{variant:"destructive",onClick:()=>{X&&(eK(X.author.username),eI(!0))},children:[(0,r.jsx)(ee.Ban,{className:"h-4 w-4 mr-2"}),"Ban Author"]})]})]})}),(0,r.jsx)(G.Dialog,{open:es,onOpenChange:et,children:(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Dismiss Report"}),(0,r.jsx)(G.DialogDescription,{children:"Optionally provide a reason for dismissing this report"})]}),(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (optional, max 500 characters)"}),(0,r.jsx)(z.Textarea,{value:en,onChange:e=>eo(e.target.value),placeholder:"Enter reason for dismissal...",className:"min-h-24"})]})}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{variant:"ghost",onClick:()=>et(!1),children:"Cancel"}),(0,r.jsx)(x.Button,{onClick:()=>{Z&&e5.mutate({reportId:Z,reason:en||void 0})},disabled:e5.isPending,children:"Dismiss Report"})]})]})}),(0,r.jsx)(G.Dialog,{open:eT,onOpenChange:ew,children:(0,r.jsxs)(G.DialogContent,{"data-testid":"dialog-suspend-author",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Suspend Author"}),(0,r.jsx)(G.DialogDescription,{children:"Temporarily suspend this user's account"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Suspend Days (1-365)"}),(0,r.jsx)(O.Input,{type:"number",min:1,max:365,value:eS,onChange:e=>ek(Number(e.target.value)),"data-testid":"input-suspend-days"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,r.jsx)(z.Textarea,{value:eD,onChange:e=>eA(e.target.value),placeholder:"Enter reason for suspension...",className:"min-h-24","data-testid":"textarea-reason"})]})]}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{variant:"ghost",onClick:()=>ew(!1),children:"Cancel"}),(0,r.jsx)(x.Button,{variant:"destructive",onClick:()=>{!Z||!eD||eD.length<10||eD.length>500?e({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):eS<1||eS>365?e({title:"Suspend days must be between 1 and 365",variant:"destructive"}):e8.mutate({reportId:Z,action:"suspend",reason:eD,suspendDays:eS})},disabled:e8.isPending||eD.length<10||eD.length>500||eS<1||eS>365,children:"Suspend User"})]})]})}),(0,r.jsx)(G.Dialog,{open:eR,onOpenChange:eI,children:(0,r.jsxs)(G.DialogContent,{"data-testid":"dialog-ban-author",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Ban Author"}),(0,r.jsx)(G.DialogDescription,{children:"Permanently ban this user from the platform"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)(eh.Alert,{variant:"destructive",children:[(0,r.jsx)(eg.AlertTriangle,{className:"h-4 w-4"}),(0,r.jsx)(eh.AlertDescription,{children:"This action is permanent and cannot be undone."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,r.jsx)(z.Textarea,{value:eB,onChange:e=>eq(e.target.value),placeholder:"Enter reason for ban...",className:"min-h-24","data-testid":"textarea-reason"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(ex.Checkbox,{checked:eL,onCheckedChange:e=>eP(e),id:"ban-confirm"}),(0,r.jsx)("label",{htmlFor:"ban-confirm",className:"text-sm cursor-pointer",children:"I understand this is permanent"})]})]}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{variant:"ghost",onClick:()=>eI(!1),children:"Cancel"}),(0,r.jsx)(x.Button,{variant:"destructive",onClick:()=>{!Z||!eB||eB.length<10||eB.length>500?e({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):eL?e8.mutate({reportId:Z,action:"ban",reason:eB}):e({title:"Please confirm that you understand this action is permanent",variant:"destructive"})},disabled:e8.isPending||!eL||eB.length<10||eB.length>500,children:"Ban User"})]})]})}),(0,r.jsx)(G.Dialog,{open:eE,onOpenChange:eV,children:(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Approve Selected Items"}),(0,r.jsxs)(G.DialogDescription,{children:["Are you sure you want to approve ",m.length," items?"]})]}),(0,r.jsxs)(eh.Alert,{children:[(0,r.jsx)(eg.AlertTriangle,{className:"h-4 w-4"}),(0,r.jsx)(eh.AlertDescription,{children:"This action cannot be undone."})]}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{variant:"ghost",onClick:()=>eV(!1),children:"Cancel"}),(0,r.jsx)(x.Button,{onClick:()=>{e3.mutate(m)},disabled:e3.isPending,children:"Approve All"})]})]})}),(0,r.jsx)(G.Dialog,{open:e$,onOpenChange:eU,children:(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Reject Selected Items"}),(0,r.jsxs)(G.DialogDescription,{children:["Reject ",m.length," selected items"]})]}),(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,r.jsx)(z.Textarea,{value:eQ,onChange:e=>eO(e.target.value),placeholder:"This reason will apply to all selected items...",className:"min-h-24","data-testid":"textarea-reason"})]})}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{variant:"ghost",onClick:()=>eU(!1),children:"Cancel"}),(0,r.jsx)(x.Button,{variant:"destructive",onClick:()=>{!eQ||eQ.length<10||eQ.length>500?e({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):e6.mutate({contentIds:m,reason:eQ})},disabled:e6.isPending||eQ.length<10||eQ.length>500,children:"Reject All"})]})]})})]})}e.s(["default",()=>eT],77668);var ew=e.i(53145),eS=e.i(94814),ek=e.i(43004),eD=e.i(82403),eA=e.i(88844),eF=e.i(70273),eH=e.i(7233);let eR=ek.z.object({type:ek.z.enum(["ea","indicator","article","source_code"]),title:ek.z.string().min(10,"Title must be at least 10 characters").max(120),description:ek.z.string().min(300,"Description must be at least 300 characters"),category:ek.z.string().min(1,"Category is required"),priceCoins:ek.z.number().min(0).max(1e4),isFree:ek.z.boolean(),platform:ek.z.enum(["MT4","MT5","Both"]).optional(),version:ek.z.string().optional(),tags:ek.z.string().optional(),license:ek.z.string().optional(),minDeposit:ek.z.number().optional(),hedging:ek.z.boolean().optional(),changelog:ek.z.string().optional()});function eI({trigger:e}){let{toast:a}=(0,Y.useToast)(),[s,t]=(0,n.useState)(!1),[l,i]=(0,n.useState)([]),d=(0,ew.useForm)({resolver:(0,eS.zodResolver)(eR),defaultValues:{type:"ea",title:"",description:"",category:"",priceCoins:0,isFree:!0,platform:"MT4",version:"1.0",tags:"",license:"Standard",minDeposit:void 0,hedging:!1,changelog:""}}),c=(0,Q.useMutation)({mutationFn:async e=>{let a=e.tags?e.tags.split(",").map(e=>e.trim()).filter(Boolean):[],s={...e,tags:a,status:"approved",files:[],images:[]};return(await (0,ec.apiRequest)("POST","/api/admin/content",s)).json()},onSuccess:()=>{a({title:"Content Created!",description:"The marketplace content has been successfully added."}),d.reset(),i([]),t(!1),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/revenue-chart"]}),ec.queryClient.invalidateQueries({queryKey:["/api/content"]})},onError:e=>{a({variant:"destructive",title:"Failed to Create Content",description:e.message||"Could not create marketplace content. Please try again."})}}),o=["Expert Advisors","Indicators","Scripts","Templates","Trading Systems","Libraries","Utilities","Educational"],m=["Scalping","Day Trading","Swing Trading","Grid","Martingale","Breakout","Trend Following","Mean Reversion","News Trading","High Frequency","Performance Report"],h=d.watch("isFree");return(0,n.useEffect)(()=>{h&&d.setValue("priceCoins",0)},[h,d]),(0,r.jsxs)(G.Dialog,{open:s,onOpenChange:t,children:[(0,r.jsx)(G.DialogTrigger,{asChild:!0,children:e||(0,r.jsxs)(x.Button,{"data-testid":"button-add-content",children:[(0,r.jsx)(eH.Plus,{className:"h-4 w-4 mr-2"}),"Add Content"]})}),(0,r.jsxs)(G.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Add Marketplace Content"}),(0,r.jsx)(G.DialogDescription,{children:"Create new marketplace content (EA, Indicator, Article, or Source Code). All fields marked with * are required."})]}),(0,r.jsx)(eD.Form,{...d,children:(0,r.jsxs)("form",{onSubmit:d.handleSubmit(e=>{c.mutate(e)}),className:"space-y-6",children:[(0,r.jsx)(eD.FormField,{control:d.control,name:"type",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Content Type *"}),(0,r.jsxs)(W.Select,{onValueChange:e.onChange,value:e.value,children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(W.SelectTrigger,{"data-testid":"select-content-type",children:(0,r.jsx)(W.SelectValue,{})})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"ea",children:"Expert Advisor (EA)"}),(0,r.jsx)(W.SelectItem,{value:"indicator",children:"Indicator"}),(0,r.jsx)(W.SelectItem,{value:"article",children:"Article"}),(0,r.jsx)(W.SelectItem,{value:"source_code",children:"Source Code"})]})]}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:d.control,name:"title",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Title *"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{placeholder:"e.g., Gold Scalper Pro EA v2.5",...e,"data-testid":"input-content-title"})}),(0,r.jsxs)(eD.FormDescription,{children:[e.value.length,"/120 characters"]}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:d.control,name:"description",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Description *"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(z.Textarea,{placeholder:"Detailed description of the content, features, benefits, and usage instructions...",className:"min-h-[150px]",...e,"data-testid":"textarea-content-description"})}),(0,r.jsxs)(eD.FormDescription,{children:[e.value.length," characters (minimum 300)"]}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:d.control,name:"category",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Category *"}),(0,r.jsxs)(W.Select,{onValueChange:e.onChange,value:e.value||void 0,children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(W.SelectTrigger,{"data-testid":"select-category",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select a category..."})})}),(0,r.jsx)(W.SelectContent,{children:o.map(e=>(0,r.jsx)(W.SelectItem,{value:e,children:e},e))})]}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:d.control,name:"platform",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Platform"}),(0,r.jsxs)(W.Select,{onValueChange:e.onChange,value:e.value||void 0,children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(W.SelectTrigger,{"data-testid":"select-platform",children:(0,r.jsx)(W.SelectValue,{})})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"MT4",children:"MT4"}),(0,r.jsx)(W.SelectItem,{value:"MT5",children:"MT5"}),(0,r.jsx)(W.SelectItem,{value:"Both",children:"Both MT4 & MT5"})]})]}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(eD.FormField,{control:d.control,name:"isFree",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(ex.Checkbox,{checked:e.value,onCheckedChange:e.onChange,"data-testid":"checkbox-is-free"})}),(0,r.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,r.jsx)(eD.FormLabel,{children:"Free Content"}),(0,r.jsx)(eD.FormDescription,{children:"Check if this content is free"})]})]})}),(0,r.jsx)(eD.FormField,{control:d.control,name:"priceCoins",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Price (Coins) *"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{type:"number",min:0,max:1e4,disabled:h,...e,onChange:a=>e.onChange(parseInt(a.target.value)||0),"data-testid":"input-price-coins"})}),(0,r.jsx)(eD.FormDescription,{children:"0-10,000 coins"}),(0,r.jsx)(eD.FormMessage,{})]})})]}),(0,r.jsx)(eD.FormField,{control:d.control,name:"tags",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Tags"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mb-3",children:m.map(e=>(0,r.jsx)(V.Badge,{variant:l.includes(e)?"default":"outline",className:"cursor-pointer",onClick:()=>{let a;i(a=l.includes(e)?l.filter(a=>a!==e):[...l,e]),d.setValue("tags",a.join(", "))},"data-testid":`tag-${e.toLowerCase().replace(/\s+/g,"-")}`,children:e},e))}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{placeholder:"Or enter custom tags separated by commas...",...e,"data-testid":"input-tags"})}),(0,r.jsx)(eD.FormDescription,{children:"Click tags above or enter custom tags separated by commas (max 8)"}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(eD.FormField,{control:d.control,name:"version",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Version"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{placeholder:"e.g., 1.0, 2.5.1",...e,"data-testid":"input-version"})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:d.control,name:"license",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"License"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{placeholder:"e.g., Standard, Extended, GPL",...e,"data-testid":"input-license"})}),(0,r.jsx)(eD.FormMessage,{})]})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(eD.FormField,{control:d.control,name:"minDeposit",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Minimum Deposit"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{type:"number",placeholder:"e.g., 100",...e,onChange:a=>e.onChange(a.target.value?parseInt(a.target.value):void 0),value:e.value||"","data-testid":"input-min-deposit"})}),(0,r.jsx)(eD.FormDescription,{children:"Minimum account balance required"}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:d.control,name:"hedging",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4 mt-2",children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(ex.Checkbox,{checked:e.value,onCheckedChange:e.onChange,"data-testid":"checkbox-hedging"})}),(0,r.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,r.jsx)(eD.FormLabel,{children:"Supports Hedging"}),(0,r.jsx)(eD.FormDescription,{children:"Check if this EA supports hedging"})]})]})})]}),(0,r.jsx)(eD.FormField,{control:d.control,name:"changelog",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Changelog"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(z.Textarea,{placeholder:"Version history and updates...",className:"min-h-[100px]",...e,"data-testid":"textarea-changelog"})}),(0,r.jsx)(eD.FormDescription,{children:"Document version changes and improvements"}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)(x.Button,{type:"submit",disabled:c.isPending,"data-testid":"button-submit-content",children:c.isPending?"Creating...":"Create Content"}),(0,r.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>{d.reset(),i([]),t(!1)},"data-testid":"button-cancel",children:"Cancel"})]})]})})]})]})}let eB=ek.z.object({reason:ek.z.string().min(10,"Reason must be at least 10 characters").max(500,"Reason must be less than 500 characters")}),eq=ek.z.object({durationDays:ek.z.number().min(1,"Duration must be at least 1 day").max(365,"Duration cannot exceed 365 days")});function eL(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)(""),[t,l]=(0,n.useState)(""),[i,d]=(0,n.useState)("all"),[m,h]=(0,n.useState)("all"),[u,g]=(0,n.useState)("all"),[v,y]=(0,n.useState)(1),[C,f]=(0,n.useState)(20),[T,w]=(0,n.useState)(null),[S,F]=(0,n.useState)(null),[H,R]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=setTimeout(()=>{l(a),y(1)},300);return()=>clearTimeout(e)},[a]),(0,n.useEffect)(()=>{y(1)},[i,m,u]);let I=new URLSearchParams({page:v.toString(),limit:C.toString(),...t&&{search:t},..."all"!==i&&{category:i},..."all"!==m&&{status:m},..."all"!==u&&{priceRange:u}}),{data:B,isLoading:E}=(0,j.useQuery)({queryKey:["/api/admin/marketplace/stats"]}),$=B||{totalItems:0,pendingItems:0,totalSales:0,salesThisWeek:0,totalRevenue:0,revenueThisWeek:0},{data:U,isLoading:_}=(0,j.useQuery)({queryKey:["/api/admin/marketplace/items",v,C,t,i,m,u],queryFn:async()=>{let e=await fetch(`/api/admin/marketplace/items?${I}`);if(!e.ok){let a=await e.json();return{items:Array.isArray(a)?a:[],totalItems:Array.isArray(a)?a.length:0,totalPages:1,currentPage:1,pageSize:Array.isArray(a)?a.length:20}}return e.json()}}),X=U?.items||[],J=U?.totalItems||0,Z=U?.totalPages||1,{data:ee,isLoading:ea}=(0,j.useQuery)({queryKey:["/api/admin/marketplace/top-selling"]}),es=Array.isArray(ee)?ee:[],{data:et,isLoading:el}=(0,j.useQuery)({queryKey:["/api/admin/marketplace/revenue-chart"]}),ei=Array.isArray(et)?et:[],{data:er,isLoading:en}=(0,j.useQuery)({queryKey:["/api/admin/marketplace/top-vendors"]}),ed=Array.isArray(er)?er:[],{data:eo,isLoading:ex}=(0,j.useQuery)({queryKey:["/api/admin/marketplace/items",T],enabled:!!T,queryFn:async()=>{let e=await fetch(`/api/admin/marketplace/items/${T}`);if(!e.ok)throw Error("Failed to fetch item details");return e.json()}}),em=(0,ew.useForm)({resolver:(0,eS.zodResolver)(eB),defaultValues:{reason:""}}),eh=(0,ew.useForm)({resolver:(0,eS.zodResolver)(eq),defaultValues:{durationDays:30}}),eg=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("POST",`/api/admin/marketplace/${e}/approve`,{}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-vendors"]}),e({title:"Item approved successfully"})},onError:()=>{e({title:"Failed to approve item",variant:"destructive"})}}),ev=(0,Q.useMutation)({mutationFn:async e=>{if(!S)throw Error("No item selected");return(0,ec.apiRequest)("POST",`/api/admin/marketplace/${S}/reject`,e)},onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-vendors"]}),F(null),e({title:"Item rejected successfully"}),em.reset()},onError:()=>{e({title:"Failed to reject item",variant:"destructive"})}}),eb=(0,Q.useMutation)({mutationFn:async e=>{if(!H)throw Error("No item selected");return(0,ec.apiRequest)("POST",`/api/admin/marketplace/${H}/feature`,e)},onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-vendors"]}),R(null),e({title:"Item featured successfully"}),eh.reset()},onError:()=>{e({title:"Failed to feature item",variant:"destructive"})}});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Marketplace Management"}),(0,r.jsx)(eI,{})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(O.Input,{placeholder:"Search by title or seller...",value:a,onChange:e=>s(e.target.value),"data-testid":"input-search-items"})}),(0,r.jsxs)(W.Select,{value:i,onValueChange:d,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-[200px]","data-testid":"select-category-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"All Categories"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Categories"}),(0,r.jsx)(W.SelectItem,{value:"Expert Advisors",children:"Expert Advisors"}),(0,r.jsx)(W.SelectItem,{value:"Indicators",children:"Indicators"}),(0,r.jsx)(W.SelectItem,{value:"Scripts",children:"Scripts"}),(0,r.jsx)(W.SelectItem,{value:"Templates",children:"Templates"})]})]}),(0,r.jsxs)(W.Select,{value:m,onValueChange:h,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-status-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"All Statuses"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Statuses"}),(0,r.jsx)(W.SelectItem,{value:"pending",children:"Pending"}),(0,r.jsx)(W.SelectItem,{value:"approved",children:"Approved"}),(0,r.jsx)(W.SelectItem,{value:"rejected",children:"Rejected"})]})]}),(0,r.jsxs)(W.Select,{value:u,onValueChange:g,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-price-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"All Prices"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Prices"}),(0,r.jsx)(W.SelectItem,{value:"free",children:"Free (0 coins)"}),(0,r.jsx)(W.SelectItem,{value:"low",children:"Low (1-100)"}),(0,r.jsx)(W.SelectItem,{value:"medium",children:"Medium (101-500)"}),(0,r.jsx)(W.SelectItem,{value:"high",children:"High (500+)"})]})]}),(0,r.jsx)(x.Button,{variant:"outline",onClick:()=>{s(""),d("all"),h("all"),g("all")},"data-testid":"button-clear-filters",children:"Clear Filters"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-total-items",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Items"}),(0,r.jsx)(eA.Package,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:E?(0,r.jsx)(c.Skeleton,{className:"h-8 w-20"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-items",children:$.totalItems}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[$.pendingItems," pending approval"]})]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-total-sales",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Sales"}),(0,r.jsx)(N.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:E?(0,r.jsx)(c.Skeleton,{className:"h-8 w-20"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-sales",children:$.totalSales}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",$.salesThisWeek," this week"]})]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-total-revenue",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Revenue"}),(0,r.jsx)(b.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:E?(0,r.jsx)(c.Skeleton,{className:"h-8 w-20"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-marketplace-revenue",children:["$",$.totalRevenue]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+$",$.revenueThisWeek," this week"]})]})})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-revenue-chart",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Revenue Trend (Last 30 Days)"})}),(0,r.jsx)(o.CardContent,{children:el?(0,r.jsx)(c.Skeleton,{className:"h-64"}):ei.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(D.LineChart,{data:ei,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"date"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(A.Line,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No revenue data available"})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-top-selling",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Top Selling Items"})}),(0,r.jsx)(o.CardContent,{children:ea?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):es.length>0?(0,r.jsx)("div",{className:"space-y-3",children:es.map((e,a)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"text-lg font-bold text-muted-foreground",children:["#",a+1]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:e.title}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.sales," sales"]})]})]}),(0,r.jsxs)(V.Badge,{children:[e.coinPrice," coins"]})]},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No sales data available"})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-top-vendors",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Top Vendors"})}),(0,r.jsx)(o.CardContent,{children:en?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):ed.length>0?(0,r.jsx)("div",{className:"space-y-3",children:ed.map((e,a)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"text-lg font-bold text-muted-foreground",children:["#",a+1]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:e.sellerUsername}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.totalSales," sales • ",e.itemCount," items"]})]})]}),(0,r.jsxs)(V.Badge,{children:[e.totalRevenue," coins earned"]})]},e.sellerId))}):(0,r.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No vendor data available"})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-marketplace-items",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Marketplace Items (",J,")"]})}),(0,r.jsx)(o.CardContent,{children:_?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-16"},a))}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Title"}),(0,r.jsx)(p.TableHead,{children:"Seller"}),(0,r.jsx)(p.TableHead,{children:"Price"}),(0,r.jsx)(p.TableHead,{children:"Sales"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Listed"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:X.length>0?X.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`item-row-${e.id}`,children:[(0,r.jsx)(p.TableCell,{"data-testid":`item-title-${e.id}`,children:e.title}),(0,r.jsx)(p.TableCell,{children:e.sellerUsername}),(0,r.jsxs)(p.TableCell,{children:[e.coinPrice," coins"]}),(0,r.jsx)(p.TableCell,{children:e.sales}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"approved"===e.status?"default":"secondary",children:e.status})}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsx)(x.Button,{size:"sm",variant:"ghost",onClick:()=>w(e.id),"data-testid":`button-view-item-${e.id}`,children:(0,r.jsx)(ep.Eye,{className:"h-4 w-4"})}),(0,r.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>eg.mutate(e.id),disabled:"approved"===e.status||eg.isPending,"data-testid":`button-approve-item-${e.id}`,children:[(0,r.jsx)(eu.CheckCircle,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,r.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>F(e.id),disabled:"rejected"===e.status,"data-testid":`button-reject-item-${e.id}`,children:[(0,r.jsx)(ej,{className:"h-4 w-4 mr-1"}),"Reject"]}),(0,r.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>R(e.id),disabled:"approved"!==e.status,"data-testid":`button-feature-item-${e.id}`,children:[(0,r.jsx)(eF.Star,{className:"h-4 w-4 mr-1"}),"Feature"]})]})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No marketplace items found"})})})]})}),J>0&&(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 px-2 py-4 border-t mt-4",children:[(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(v-1)*C+1,"-",Math.min(v*C,J)," of ",J," items"]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm",children:"Items per page:"}),(0,r.jsxs)(W.Select,{value:C.toString(),onValueChange:e=>f(parseInt(e)),children:[(0,r.jsx)(W.SelectTrigger,{className:"w-[80px]","data-testid":"select-page-size",children:(0,r.jsx)(W.SelectValue,{})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"10",children:"10"}),(0,r.jsx)(W.SelectItem,{value:"20",children:"20"}),(0,r.jsx)(W.SelectItem,{value:"50",children:"50"}),(0,r.jsx)(W.SelectItem,{value:"100",children:"100"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(x.Button,{variant:"outline",size:"sm",onClick:()=>y(1),disabled:1===v,"data-testid":"button-first-page",children:"First"}),(0,r.jsx)(x.Button,{variant:"outline",size:"sm",onClick:()=>y(v-1),disabled:1===v,"data-testid":"button-prev-page",children:"Previous"}),(0,r.jsxs)("span",{className:"text-sm",children:["Page ",v," of ",Z]}),(0,r.jsx)(x.Button,{variant:"outline",size:"sm",onClick:()=>y(v+1),disabled:v===Z,"data-testid":"button-next-page",children:"Next"}),(0,r.jsx)(x.Button,{variant:"outline",size:"sm",onClick:()=>y(Z),disabled:v===Z,"data-testid":"button-last-page",children:"Last"})]})]})]})]})})]}),(0,r.jsx)(G.Dialog,{open:null!==T,onOpenChange:()=>w(null),children:(0,r.jsxs)(G.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Item Details"})}),ex?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(c.Skeleton,{className:"h-20"}),(0,r.jsx)(c.Skeleton,{className:"h-20"}),(0,r.jsx)(c.Skeleton,{className:"h-32"})]}):eo?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Title"}),(0,r.jsx)("p",{className:"font-medium",children:eo.title})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Category"}),(0,r.jsx)("p",{className:"font-medium",children:eo.category})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Price"}),(0,r.jsxs)("p",{className:"font-medium",children:[eo.coinPrice," coins"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,r.jsx)(V.Badge,{children:eo.status})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Seller"}),(0,r.jsx)("p",{className:"font-medium",children:eo.sellerUsername})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Sales"}),(0,r.jsx)("p",{className:"font-medium",children:eo.sales})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Description"}),(0,r.jsx)("p",{className:"text-sm",children:eo.description})]}),eo.recentPurchases&&eo.recentPurchases.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium mb-2",children:"Recent Purchases"}),(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Buyer"}),(0,r.jsx)(p.TableHead,{children:"Price"}),(0,r.jsx)(p.TableHead,{children:"Date"})]})}),(0,r.jsx)(p.TableBody,{children:eo.recentPurchases.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{children:e.buyerUsername}),(0,r.jsxs)(p.TableCell,{children:[e.coins," coins"]}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.purchasedAt),{addSuffix:!0})})]},e.id))})]})]})]}):(0,r.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"Item not found"})]})}),(0,r.jsx)(G.Dialog,{open:null!==S,onOpenChange:()=>F(null),children:(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Reject Marketplace Item"}),(0,r.jsx)(G.DialogDescription,{children:"Please provide a reason for rejecting this item. The seller will see this reason."})]}),(0,r.jsx)(eD.Form,{...em,children:(0,r.jsxs)("form",{onSubmit:em.handleSubmit(e=>{ev.mutate(e)}),className:"space-y-4",children:[(0,r.jsx)(eD.FormField,{control:em.control,name:"reason",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Rejection Reason *"}),(0,r.jsxs)(W.Select,{onValueChange:a=>{"custom"!==a&&e.onChange(a)},children:[(0,r.jsx)(W.SelectTrigger,{"data-testid":"select-reject-reason",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select a reason..."})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"Poor description",children:"Poor description"}),(0,r.jsx)(W.SelectItem,{value:"Inappropriate content",children:"Inappropriate content"}),(0,r.jsx)(W.SelectItem,{value:"Duplicate listing",children:"Duplicate listing"}),(0,r.jsx)(W.SelectItem,{value:"Missing files",children:"Missing files"}),(0,r.jsx)(W.SelectItem,{value:"Price too high",children:"Price too high"}),(0,r.jsx)(W.SelectItem,{value:"custom",children:"Custom reason..."})]})]}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(z.Textarea,{placeholder:"Or enter a custom reason...",...e,"data-testid":"textarea-reject-reason",className:"min-h-[100px]"})}),(0,r.jsx)(eD.FormDescription,{children:"Minimum 10 characters"}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(x.Button,{type:"submit",disabled:ev.isPending,"data-testid":"button-confirm-reject",children:ev.isPending?"Rejecting...":"Reject Item"}),(0,r.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>F(null),children:"Cancel"})]})]})})]})}),(0,r.jsx)(G.Dialog,{open:null!==H,onOpenChange:()=>R(null),children:(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Feature Marketplace Item"}),(0,r.jsx)(G.DialogDescription,{children:"Featured items appear prominently on the marketplace homepage."})]}),(0,r.jsx)(eD.Form,{...eh,children:(0,r.jsxs)("form",{onSubmit:eh.handleSubmit(e=>{eb.mutate(e)}),className:"space-y-4",children:[(0,r.jsx)(eD.FormField,{control:eh.control,name:"durationDays",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Feature Duration (Days) *"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{type:"number",min:1,max:365,...e,onChange:a=>e.onChange(parseInt(a.target.value)||1),"data-testid":"input-feature-duration"})}),(0,r.jsx)(eD.FormDescription,{children:"How long should this item be featured? (1-365 days)"}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(x.Button,{type:"submit",disabled:eb.isPending,"data-testid":"button-confirm-feature",children:eb.isPending?"Featuring...":"Feature Item"}),(0,r.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>R(null),children:"Cancel"})]})]})})]})})]})}e.s(["default",()=>eL],56629);var eP=e.i(7486),eM=e.i(95468),eK=e.i(81418),eE=e.i(88511);let eV=ek.z.object({name:ek.z.string().min(1,"Name is required"),country:ek.z.string().optional(),regulation:ek.z.string().optional(),websiteUrl:ek.z.string().url("Must be a valid URL").optional(),minDeposit:ek.z.string().optional(),leverage:ek.z.string().optional(),platform:ek.z.string().optional(),spreadType:ek.z.string().optional(),minSpread:ek.z.string().optional()}),e$=ek.z.object({enabled:ek.z.boolean(),reason:ek.z.string().optional(),severity:ek.z.enum(["low","medium","high","critical"]).optional()}),eU=ek.z.object({reason:ek.z.string().min(10,"Reason must be at least 10 characters")});function eQ(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)("brokers"),[t,l]=(0,n.useState)(""),[i,d]=(0,n.useState)(""),[h,u]=(0,n.useState)("all"),[g,v]=(0,n.useState)("all"),[b,y]=(0,n.useState)("all"),[C,f]=(0,n.useState)(1),[N,w]=(0,n.useState)(20),[S,D]=(0,n.useState)(null),[A,F]=(0,n.useState)(null),[H,R]=(0,n.useState)(null),[I,B]=(0,n.useState)(null),[q,L]=(0,n.useState)(null),[P,M]=(0,n.useState)(null),[K,E]=(0,n.useState)(null),[$,U]=(0,n.useState)(!1),[X,J]=(0,n.useState)(!1),[ee,ea]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=setTimeout(()=>{d(t),f(1)},300);return()=>clearTimeout(e)},[t]),(0,n.useEffect)(()=>{f(1)},[h,g,b]);let{data:es,isLoading:et}=(0,j.useQuery)({queryKey:["/api/admin/brokers/stats"]}),el=es||{totalBrokers:0,verifiedBrokers:0,scamWarnings:0,totalReviews:0,pendingReviews:0,pendingScamReports:0},{data:ei,isLoading:er}=(0,j.useQuery)({queryKey:["/api/admin/brokers",i,h,g,b,C,N],queryFn:async()=>{let e=new URLSearchParams({page:C.toString(),pageSize:N.toString()});i&&e.set("search",i),"all"!==h&&e.set("country",h),"verified"===g&&e.set("isVerified","true"),"unverified"===g&&e.set("isVerified","false"),"scam_warning"===g&&e.set("scamWarning","true"),"all"!==b&&e.set("regulation",b);let a=await fetch(`/api/admin/brokers?${e.toString()}`);if(!a.ok)throw Error("Failed to fetch brokers");return a.json()},enabled:"brokers"===a}),en=ei?.items||[],ed=ei?.total||0,{data:eo,isLoading:em}=(0,j.useQuery)({queryKey:["/api/admin/scam-reports",C,N],queryFn:async()=>{let e=new URLSearchParams({page:C.toString(),pageSize:N.toString()}),a=await fetch(`/api/admin/scam-reports?${e.toString()}`);if(!a.ok)throw Error("Failed to fetch scam reports");return a.json()},enabled:"scam-reports"===a}),eh=eo?.items||[],eu=eo?.total||0,{data:ej,isLoading:ev}=(0,j.useQuery)({queryKey:["/api/admin/broker-reviews",C,N],queryFn:async()=>{let e=new URLSearchParams({page:C.toString(),pageSize:N.toString()}),a=await fetch(`/api/admin/broker-reviews?${e.toString()}`);if(!a.ok)throw Error("Failed to fetch reviews");return a.json()},enabled:"reviews"===a}),eb=ej?.items||[],ey=ej?.total||0,eC=(0,ew.useForm)({resolver:(0,eS.zodResolver)(eV),defaultValues:{name:"",country:"",regulation:"",websiteUrl:"",minDeposit:"",leverage:"",platform:"",spreadType:"",minSpread:""}}),eN=(0,ew.useForm)({resolver:(0,eS.zodResolver)(eV)}),eT=(0,ew.useForm)({resolver:(0,eS.zodResolver)(e$),defaultValues:{enabled:!0,reason:"",severity:"medium"}}),ek=(0,ew.useForm)({resolver:(0,eS.zodResolver)(eU),defaultValues:{reason:""}}),eA=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("POST","/api/brokers",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),U(!1),eC.reset(),e({title:"Broker added successfully"})},onError:()=>{e({title:"Failed to add broker",variant:"destructive"})}}),eH=(0,Q.useMutation)({mutationFn:async e=>{if(!A)throw Error("No broker selected");return(0,ec.apiRequest)("PATCH",`/api/admin/brokers/${A}`,e)},onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),F(null),e({title:"Broker updated successfully"})},onError:()=>{e({title:"Failed to update broker",variant:"destructive"})}}),eR=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("DELETE",`/api/admin/brokers/${e}`,{}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),R(null),J(!1),e({title:"Broker deleted successfully"})},onError:()=>{e({title:"Failed to delete broker",variant:"destructive"})}}),eI=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("POST",`/api/admin/brokers/${e}/verify`,{}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),B(null),ea(!1),e({title:"Broker verified successfully"})},onError:()=>{e({title:"Failed to verify broker",variant:"destructive"})}}),eB=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("POST",`/api/admin/brokers/${e}/unverify`,{}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),e({title:"Broker verification removed"})},onError:()=>{e({title:"Failed to unverify broker",variant:"destructive"})}}),eq=(0,Q.useMutation)({mutationFn:async e=>{if(!q)throw Error("No broker selected");return(0,ec.apiRequest)("POST",`/api/admin/brokers/${q}/scam-warning`,e)},onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),L(null),eT.reset(),e({title:"Scam warning updated successfully"})},onError:()=>{e({title:"Failed to update scam warning",variant:"destructive"})}}),eL=(0,Q.useMutation)({mutationFn:async({reportId:e,resolution:a})=>(0,ec.apiRequest)("POST",`/api/admin/scam-reports/${e}/resolve`,{resolution:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/scam-reports"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),M(null),e({title:"Scam report resolved"})},onError:()=>{e({title:"Failed to resolve scam report",variant:"destructive"})}}),eQ=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("POST",`/api/admin/broker-reviews/${e}/approve`,{}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/broker-reviews"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),E(null),e({title:"Review approved successfully"})},onError:()=>{e({title:"Failed to approve review",variant:"destructive"})}}),eO=(0,Q.useMutation)({mutationFn:async e=>{if(!K)throw Error("No review selected");return(0,ec.apiRequest)("POST",`/api/admin/broker-reviews/${K}/reject`,e)},onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/broker-reviews"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),E(null),ek.reset(),e({title:"Review rejected"})},onError:()=>{e({title:"Failed to reject review",variant:"destructive"})}}),ez=e=>{f(e),window.scrollTo({top:0,behavior:"smooth"})},eW=en.find(e=>e.id===S||e.id===A||e.id===H||e.id===I||e.id===q),eG=eh.find(e=>e.id===P),e_=eb.find(e=>e.id===K);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Broker Management"}),(0,r.jsx)(x.Button,{onClick:()=>U(!0),"data-testid":"button-add-broker",children:"+ Add Broker"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"stat-total-brokers",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Brokers"}),(0,r.jsx)(eP.Building2,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:et?(0,r.jsx)(c.Skeleton,{className:"h-8 w-20"}):(0,r.jsx)("div",{className:"text-2xl font-bold",children:el.totalBrokers})})]}),(0,r.jsxs)(o.Card,{"data-testid":"stat-verified-brokers",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Verified Brokers"}),(0,r.jsx)(eM.CheckCircle2,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:et?(0,r.jsx)(c.Skeleton,{className:"h-8 w-20"}):(0,r.jsx)("div",{className:"text-2xl font-bold",children:el.verifiedBrokers})})]}),(0,r.jsxs)(o.Card,{"data-testid":"stat-scam-warnings",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Scam Warnings"}),(0,r.jsx)(eg.AlertTriangle,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:et?(0,r.jsx)(c.Skeleton,{className:"h-8 w-20"}):(0,r.jsx)("div",{className:"text-2xl font-bold",children:el.scamWarnings})})]}),(0,r.jsxs)(o.Card,{"data-testid":"stat-total-reviews",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Reviews"}),(0,r.jsx)(T.MessageSquare,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:et?(0,r.jsx)(c.Skeleton,{className:"h-8 w-20"}):(0,r.jsx)("div",{className:"text-2xl font-bold",children:el.totalReviews})})]})]}),(0,r.jsxs)(_.Tabs,{value:a,onValueChange:s,className:"space-y-4",children:[(0,r.jsxs)(_.TabsList,{children:[(0,r.jsxs)(_.TabsTrigger,{value:"brokers","data-testid":"tab-brokers",children:["Brokers (",el.totalBrokers,")"]}),(0,r.jsxs)(_.TabsTrigger,{value:"scam-reports","data-testid":"tab-scam-reports",children:["Scam Reports (",el.pendingScamReports,")"]}),(0,r.jsxs)(_.TabsTrigger,{value:"reviews","data-testid":"tab-reviews",children:["Reviews (",el.totalReviews,")"]})]}),(0,r.jsxs)(_.TabsContent,{value:"brokers",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)(Z.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(O.Input,{placeholder:"Search by broker name...",value:t,onChange:e=>l(e.target.value),className:"pl-9","data-testid":"input-search-brokers"})]}),(0,r.jsxs)(W.Select,{value:h,onValueChange:u,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-country-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"All Countries"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Countries"}),(0,r.jsx)(W.SelectItem,{value:"USA",children:"USA"}),(0,r.jsx)(W.SelectItem,{value:"UK",children:"UK"}),(0,r.jsx)(W.SelectItem,{value:"Cyprus",children:"Cyprus"}),(0,r.jsx)(W.SelectItem,{value:"Australia",children:"Australia"})]})]}),(0,r.jsxs)(W.Select,{value:g,onValueChange:v,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-verification-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Verification"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All"}),(0,r.jsx)(W.SelectItem,{value:"verified",children:"Verified"}),(0,r.jsx)(W.SelectItem,{value:"unverified",children:"Unverified"}),(0,r.jsx)(W.SelectItem,{value:"scam_warning",children:"Scam Warning"})]})]}),(0,r.jsxs)(W.Select,{value:b,onValueChange:y,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-regulation-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Regulation"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All"}),(0,r.jsx)(W.SelectItem,{value:"FCA",children:"FCA"}),(0,r.jsx)(W.SelectItem,{value:"ASIC",children:"ASIC"}),(0,r.jsx)(W.SelectItem,{value:"CySEC",children:"CySEC"}),(0,r.jsx)(W.SelectItem,{value:"CFTC",children:"CFTC"})]})]}),(0,r.jsxs)(W.Select,{value:N.toString(),onValueChange:e=>w(parseInt(e)),children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-[120px]","data-testid":"select-page-size",children:(0,r.jsx)(W.SelectValue,{})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"10",children:"10 / page"}),(0,r.jsx)(W.SelectItem,{value:"20",children:"20 / page"}),(0,r.jsx)(W.SelectItem,{value:"50",children:"50 / page"}),(0,r.jsx)(W.SelectItem,{value:"100",children:"100 / page"})]})]}),(0,r.jsx)(x.Button,{variant:"outline",onClick:()=>{l(""),u("all"),v("all"),y("all")},"data-testid":"button-clear-filters",children:"Clear"})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Brokers (",ed,")"]})}),(0,r.jsx)(o.CardContent,{children:er?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-16"},a))}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Name"}),(0,r.jsx)(p.TableHead,{children:"Country"}),(0,r.jsx)(p.TableHead,{children:"Regulation"}),(0,r.jsx)(p.TableHead,{children:"Verified"}),(0,r.jsx)(p.TableHead,{children:"Reviews"}),(0,r.jsx)(p.TableHead,{children:"Rating"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:en.length>0?en.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`row-broker-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.name}),e.scamWarning&&(0,r.jsx)(V.Badge,{variant:"destructive",className:"text-xs",children:"Scam Warning"})]})})}),(0,r.jsx)(p.TableCell,{children:e.country||"-"}),(0,r.jsx)(p.TableCell,{children:e.regulation||"-"}),(0,r.jsx)(p.TableCell,{children:e.isVerified?(0,r.jsxs)(V.Badge,{variant:"default",children:[(0,r.jsx)(eM.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Verified"]}):(0,r.jsx)(V.Badge,{variant:"secondary",children:"Unverified"})}),(0,r.jsx)(p.TableCell,{children:e.reviewCount}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(eF.Star,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),(0,r.jsx)("span",{children:e.overallRating||0})]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"approved"===e.status?"default":"secondary",children:e.status})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsx)(x.Button,{size:"sm",variant:"ghost",onClick:()=>D(e.id),"data-testid":`button-view-broker-${e.id}`,children:(0,r.jsx)(ep.Eye,{className:"h-4 w-4"})}),(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>{F(e.id),eN.reset({name:e.name,country:e.country||"",regulation:e.regulation||""})},"data-testid":`button-edit-broker-${e.id}`,children:(0,r.jsx)(eE.Edit,{className:"h-4 w-4"})}),e.isVerified?(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eB.mutate(e.id),"data-testid":`button-unverify-broker-${e.id}`,children:"Unverify"}):(0,r.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>B(e.id),"data-testid":`button-verify-broker-${e.id}`,children:[(0,r.jsx)(eK.ShieldCheck,{className:"h-4 w-4 mr-1"}),"Verify"]}),(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>L(e.id),"data-testid":`button-scam-warning-${e.id}`,children:(0,r.jsx)(m.ShieldAlert,{className:"h-4 w-4"})}),(0,r.jsx)(x.Button,{size:"sm",variant:"destructive",onClick:()=>R(e.id),"data-testid":`button-delete-broker-${e.id}`,children:(0,r.jsx)(ef.Trash2,{className:"h-4 w-4"})})]})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"No brokers found"})})})]})}),ed>N&&(0,r.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(C-1)*N+1," to ",Math.min(C*N,ed)," of ",ed," brokers"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>ez(1),disabled:1===C,"data-testid":"button-first-page",children:"First"}),(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>ez(C-1),disabled:1===C,"data-testid":"button-prev-page",children:"Previous"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 px-4",children:[(0,r.jsx)(O.Input,{type:"number",min:1,max:Math.ceil(ed/N),value:C,onChange:e=>{let a=parseInt(e.target.value);a>=1&&a<=Math.ceil(ed/N)&&ez(a)},className:"w-16 text-center","data-testid":"input-page-number"}),(0,r.jsxs)("span",{className:"text-sm text-muted-foreground",children:["of ",Math.ceil(ed/N)]})]}),(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>ez(C+1),disabled:C>=Math.ceil(ed/N),"data-testid":"button-next-page",children:"Next"}),(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>ez(Math.ceil(ed/N)),disabled:C>=Math.ceil(ed/N),"data-testid":"button-last-page",children:"Last"})]})]})]})})]})]}),(0,r.jsx)(_.TabsContent,{value:"scam-reports",className:"space-y-4",children:(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Scam Reports (",eu,")"]})}),(0,r.jsx)(o.CardContent,{children:em?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-16"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Broker"}),(0,r.jsx)(p.TableHead,{children:"Reporter"}),(0,r.jsx)(p.TableHead,{children:"Severity"}),(0,r.jsx)(p.TableHead,{children:"Report"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Date"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:eh.length>0?eh.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`row-scam-report-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:e.brokerName}),(0,r.jsx)(p.TableCell,{children:e.username}),(0,r.jsx)(p.TableCell,{children:e.scamSeverity?(0,r.jsx)(V.Badge,{variant:"critical"===e.scamSeverity||"high"===e.scamSeverity?"destructive":"medium"===e.scamSeverity?"default":"secondary",children:e.scamSeverity}):"-"}),(0,r.jsx)(p.TableCell,{className:"max-w-xs truncate",children:e.reviewTitle}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"approved"===e.status?"default":"secondary",children:e.status})}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.datePosted),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>M(e.id),"data-testid":`button-view-report-${e.id}`,children:(0,r.jsx)(ep.Eye,{className:"h-4 w-4"})}),"pending"===e.status&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eL.mutate({reportId:e.id,resolution:"confirmed"}),disabled:eL.isPending,"data-testid":`button-confirm-scam-${e.id}`,children:"Confirm"}),(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eL.mutate({reportId:e.id,resolution:"dismissed"}),disabled:eL.isPending,"data-testid":`button-dismiss-scam-${e.id}`,children:"Dismiss"})]})]})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No scam reports found"})})})]})})})]})}),(0,r.jsx)(_.TabsContent,{value:"reviews",className:"space-y-4",children:(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Broker Reviews (",ey,")"]})}),(0,r.jsx)(o.CardContent,{children:ev?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-16"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Broker"}),(0,r.jsx)(p.TableHead,{children:"Reviewer"}),(0,r.jsx)(p.TableHead,{children:"Rating"}),(0,r.jsx)(p.TableHead,{children:"Review"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Date"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:eb.length>0?eb.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`row-review-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:e.brokerName}),(0,r.jsx)(p.TableCell,{children:e.username}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(eF.Star,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),(0,r.jsx)("span",{children:e.rating})]})}),(0,r.jsx)(p.TableCell,{className:"max-w-xs truncate",children:e.reviewTitle}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"approved"===e.status?"default":"secondary",children:e.status})}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.datePosted),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>E(e.id),"data-testid":`button-view-review-${e.id}`,children:(0,r.jsx)(ep.Eye,{className:"h-4 w-4"})}),"pending"===e.status&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>eQ.mutate(e.id),disabled:eQ.isPending,"data-testid":`button-approve-review-${e.id}`,children:"Approve"})})]})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No reviews found"})})})]})})})]})})]}),(0,r.jsx)(G.Dialog,{open:$,onOpenChange:U,children:(0,r.jsxs)(G.DialogContent,{"data-testid":"modal-add-broker",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Add New Broker"}),(0,r.jsx)(G.DialogDescription,{children:"Add a new broker to the directory"})]}),(0,r.jsx)(eD.Form,{...eC,children:(0,r.jsxs)("form",{onSubmit:eC.handleSubmit(e=>{eA.mutate(e)}),className:"space-y-4",children:[(0,r.jsx)(eD.FormField,{control:eC.control,name:"name",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Broker Name *"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{...e,"data-testid":"input-broker-name"})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:eC.control,name:"country",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Country"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{...e,"data-testid":"input-country"})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:eC.control,name:"regulation",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Regulation"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{...e,placeholder:"e.g., FCA, ASIC","data-testid":"input-regulation"})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:eC.control,name:"websiteUrl",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Website URL"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{...e,type:"url",placeholder:"https://...","data-testid":"input-website"})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>U(!1),children:"Cancel"}),(0,r.jsx)(x.Button,{type:"submit",disabled:eA.isPending,"data-testid":"button-submit-add-broker",children:"Add Broker"})]})]})})]})}),(0,r.jsx)(G.Dialog,{open:!!S,onOpenChange:()=>D(null),children:(0,r.jsxs)(G.DialogContent,{"data-testid":"modal-view-broker",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Broker Details"})}),eW&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),(0,r.jsx)("div",{className:"text-lg font-semibold",children:eW.name})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Country"}),(0,r.jsx)("div",{children:eW.country||"-"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Regulation"}),(0,r.jsx)("div",{children:eW.regulation||"-"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,r.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,r.jsx)(V.Badge,{variant:eW.isVerified?"default":"secondary",children:eW.isVerified?"Verified":"Unverified"}),eW.scamWarning&&(0,r.jsx)(V.Badge,{variant:"destructive",children:"Scam Warning"}),(0,r.jsx)(V.Badge,{children:eW.status})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Reviews & Rating"}),(0,r.jsxs)("div",{children:[eW.reviewCount," reviews • ",eW.overallRating,"/5 rating"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Scam Reports"}),(0,r.jsx)("div",{children:eW.scamReportCount})]})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{variant:"outline",onClick:()=>D(null),children:"Close"})})]})}),(0,r.jsx)(G.Dialog,{open:!!A,onOpenChange:()=>F(null),children:(0,r.jsxs)(G.DialogContent,{"data-testid":"modal-edit-broker",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Edit Broker"})}),(0,r.jsx)(eD.Form,{...eN,children:(0,r.jsxs)("form",{onSubmit:eN.handleSubmit(e=>{eH.mutate(e)}),className:"space-y-4",children:[(0,r.jsx)(eD.FormField,{control:eN.control,name:"name",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Broker Name *"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{...e})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:eN.control,name:"country",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Country"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{...e})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:eN.control,name:"regulation",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Regulation"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{...e})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>F(null),children:"Cancel"}),(0,r.jsx)(x.Button,{type:"submit",disabled:eH.isPending,children:"Save Changes"})]})]})})]})}),(0,r.jsx)(G.Dialog,{open:!!H,onOpenChange:()=>{R(null),J(!1)},children:(0,r.jsxs)(G.DialogContent,{"data-testid":"modal-delete-broker",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Delete Broker"}),(0,r.jsx)(G.DialogDescription,{children:"This will soft-delete the broker. Reviews will be preserved for audit trail."})]}),eW&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,r.jsx)("div",{className:"font-medium",children:eW.name}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[eW.reviewCount," reviews"]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(ex.Checkbox,{id:"delete-confirm",checked:X,onCheckedChange:e=>J(e),"data-testid":"checkbox-delete-confirm"}),(0,r.jsx)("label",{htmlFor:"delete-confirm",className:"text-sm font-medium cursor-pointer",children:"Yes, I want to delete this broker"})]})]}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{variant:"outline",onClick:()=>{R(null),J(!1)},children:"Cancel"}),(0,r.jsx)(x.Button,{variant:"destructive",disabled:!X||eR.isPending,onClick:()=>H&&eR.mutate(H),"data-testid":"button-confirm-delete",children:"Delete Broker"})]})]})}),(0,r.jsx)(G.Dialog,{open:!!I,onOpenChange:()=>{B(null),ea(!1)},children:(0,r.jsxs)(G.DialogContent,{"data-testid":"modal-verify-broker",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Verify Broker"}),(0,r.jsx)(G.DialogDescription,{children:"Mark this broker as verified after confirming they meet standards"})]}),eW&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,r.jsx)("div",{className:"font-medium",children:eW.name}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[eW.country," • ",eW.regulation]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(ex.Checkbox,{id:"verify-confirm",checked:ee,onCheckedChange:e=>ea(e),"data-testid":"checkbox-verify-confirm"}),(0,r.jsx)("label",{htmlFor:"verify-confirm",className:"text-sm font-medium cursor-pointer",children:"I've verified this broker meets our standards"})]})]}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{variant:"outline",onClick:()=>{B(null),ea(!1)},children:"Cancel"}),(0,r.jsxs)(x.Button,{disabled:!ee||eI.isPending,onClick:()=>I&&eI.mutate(I),"data-testid":"button-confirm-verify",children:[(0,r.jsx)(eK.ShieldCheck,{className:"h-4 w-4 mr-2"}),"Verify Broker"]})]})]})}),(0,r.jsx)(G.Dialog,{open:!!q,onOpenChange:()=>L(null),children:(0,r.jsxs)(G.DialogContent,{"data-testid":"modal-scam-warning",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Scam Warning"}),(0,r.jsx)(G.DialogDescription,{children:"Add or remove scam warning for this broker"})]}),(0,r.jsx)(eD.Form,{...eT,children:(0,r.jsxs)("form",{onSubmit:eT.handleSubmit(e=>{eq.mutate(e)}),className:"space-y-4",children:[(0,r.jsx)(eD.FormField,{control:eT.control,name:"enabled",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{className:"flex items-center justify-between rounded-lg border p-4",children:[(0,r.jsxs)("div",{className:"space-y-0.5",children:[(0,r.jsx)(eD.FormLabel,{className:"text-base",children:"Enable Scam Warning"}),(0,r.jsx)(eD.FormDescription,{children:"Mark this broker with a scam warning"})]}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(ex.Checkbox,{checked:e.value,onCheckedChange:e.onChange,"data-testid":"checkbox-enable-warning"})})]})}),(0,r.jsx)(eD.FormField,{control:eT.control,name:"severity",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Severity"}),(0,r.jsxs)(W.Select,{onValueChange:e.onChange,defaultValue:e.value,children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(W.SelectTrigger,{"data-testid":"select-severity",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select severity"})})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"low",children:"Low"}),(0,r.jsx)(W.SelectItem,{value:"medium",children:"Medium"}),(0,r.jsx)(W.SelectItem,{value:"high",children:"High"}),(0,r.jsx)(W.SelectItem,{value:"critical",children:"Critical"})]})]}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:eT.control,name:"reason",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Reason"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(z.Textarea,{...e,rows:3,"data-testid":"textarea-warning-reason"})}),(0,r.jsx)(eD.FormDescription,{children:"Optional explanation for the warning"}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>L(null),children:"Cancel"}),(0,r.jsx)(x.Button,{type:"submit",disabled:eq.isPending,children:"Save"})]})]})})]})}),(0,r.jsx)(G.Dialog,{open:!!P,onOpenChange:()=>M(null),children:(0,r.jsxs)(G.DialogContent,{className:"max-w-2xl","data-testid":"modal-view-scam-report",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Scam Report Details"})}),eG&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Broker"}),(0,r.jsx)("div",{className:"font-semibold",children:eG.brokerName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Reporter"}),(0,r.jsx)("div",{children:eG.username})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Severity"}),(0,r.jsx)(V.Badge,{variant:"critical"===eG.scamSeverity||"high"===eG.scamSeverity?"destructive":"default",children:eG.scamSeverity||"Not specified"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Title"}),(0,r.jsx)("div",{children:eG.reviewTitle})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Report"}),(0,r.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:eG.reviewBody})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,r.jsx)(V.Badge,{children:eG.status})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Submitted"}),(0,r.jsx)("div",{children:(0,k.formatDistanceToNow)(new Date(eG.datePosted),{addSuffix:!0})})]})]}),(0,r.jsxs)(G.DialogFooter,{children:[eG?.status==="pending"&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Button,{variant:"outline",onClick:()=>P&&eL.mutate({reportId:P,resolution:"dismissed"}),disabled:eL.isPending,"data-testid":"button-dismiss-report",children:"Dismiss Report"}),(0,r.jsx)(x.Button,{onClick:()=>P&&eL.mutate({reportId:P,resolution:"confirmed"}),disabled:eL.isPending,"data-testid":"button-confirm-report",children:"Confirm Scam"})]}),eG?.status!=="pending"&&(0,r.jsx)(x.Button,{variant:"outline",onClick:()=>M(null),children:"Close"})]})]})}),(0,r.jsx)(G.Dialog,{open:!!K,onOpenChange:()=>E(null),children:(0,r.jsxs)(G.DialogContent,{className:"max-w-2xl","data-testid":"modal-view-review",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Review Details"})}),e_&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Broker"}),(0,r.jsx)("div",{className:"font-semibold",children:e_.brokerName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Reviewer"}),(0,r.jsx)("div",{children:e_.username})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Rating"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(eF.Star,{className:`h-4 w-4 ${a<e_.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},a)),(0,r.jsxs)("span",{className:"ml-2",children:[e_.rating,"/5"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Title"}),(0,r.jsx)("div",{children:e_.reviewTitle})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Review"}),(0,r.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:e_.reviewBody})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,r.jsx)(V.Badge,{children:e_.status})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Submitted"}),(0,r.jsx)("div",{children:(0,k.formatDistanceToNow)(new Date(e_.datePosted),{addSuffix:!0})})]}),"pending"===e_.status&&(0,r.jsx)(eD.Form,{...ek,children:(0,r.jsxs)("form",{onSubmit:ek.handleSubmit(e=>{eO.mutate(e)}),className:"space-y-4 pt-4 border-t",children:[(0,r.jsx)(eD.FormField,{control:ek.control,name:"reason",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Rejection Reason (if rejecting)"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(z.Textarea,{...e,rows:3,placeholder:"Explain why this review is being rejected...","data-testid":"textarea-reject-reason"})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>e_&&eQ.mutate(e_.id),disabled:eQ.isPending,"data-testid":"button-approve-review",children:"Approve"}),(0,r.jsx)(x.Button,{type:"submit",variant:"destructive",disabled:eO.isPending,"data-testid":"button-reject-review",children:"Reject"})]})]})})]}),e_?.status!=="pending"&&(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{variant:"outline",onClick:()=>E(null),children:"Close"})})]})})]})}e.s(["default",()=>eQ],40600);var eO=e.i(35408);let ez=(0,a.default)("CircleArrowDown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]),eW=(0,a.default)("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);var eG=e.i(64030),e_=e.i(74886),eY=e.i(21416),eX=e.i(35684);function eJ(e,a){let s=e.getFullYear()-a.getFullYear()||e.getMonth()-a.getMonth()||e.getDate()-a.getDate()||e.getHours()-a.getHours()||e.getMinutes()-a.getMinutes()||e.getSeconds()-a.getSeconds()||e.getMilliseconds()-a.getMilliseconds();return s<0?-1:s>0?1:s}let eZ={coinPurchases:"hsl(var(--primary))",subscriptions:"hsl(142, 76%, 36%)",marketplace:"hsl(262, 83%, 58%)",other:"hsl(var(--muted))"},e0=ek.z.object({adminNotes:ek.z.string().optional(),verified:ek.z.boolean().refine(e=>!0===e,{message:"You must verify all conditions before approving"})}),e2=ek.z.object({reason:ek.z.enum(["insufficient_balance","invalid_wallet","suspicious_activity","verification_required","other"]),detailedReason:ek.z.string().min(10,"Please provide a detailed reason (minimum 10 characters)"),notifyUser:ek.z.boolean().default(!0)}),e4=ek.z.object({transactionId:ek.z.string().min(1,"Transaction ID is required"),notes:ek.z.string().optional(),confirmed:ek.z.boolean().refine(e=>!0===e,{message:"You must confirm payment has been sent"})}),e1=ek.z.object({dateFrom:ek.z.string().optional(),dateTo:ek.z.string().optional(),types:ek.z.array(ek.z.string()).min(1,"Select at least one transaction type"),format:ek.z.enum(["csv"]).default("csv"),includeNotes:ek.z.boolean().default(!1)});function e3(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function e6(e){switch(e?.toLowerCase()){case"completed":return"default";case"pending":return"secondary";case"failed":return"destructive";default:return"outline"}}function e5(e){switch(e?.toLowerCase()){case"coin purchase":return"default";case"subscription":return"secondary";case"marketplace":default:return"outline";case"withdrawal":return"destructive"}}function e8(){var e;let[a,s]=(0,n.useState)("30d"),{toast:t}=(0,Y.useToast)(),[l,i]=(0,n.useState)(null),[d,m]=(0,n.useState)(null),[h,u]=(0,n.useState)(null),[g,v]=(0,n.useState)(null),[y,C]=(0,n.useState)(null),[f,T]=(0,n.useState)(!1),{data:w,isLoading:S}=(0,j.useQuery)({queryKey:["/api/admin/finance/overview",a]}),F=w??{totalRevenue:0,revenueGrowth:0,pendingWithdrawals:0,pendingWithdrawalCount:0,totalTransactions:0,transactionsToday:0},{data:H,isLoading:$}=(0,j.useQuery)({queryKey:["/api/admin/finance/transactions/recent",{limit:20,period:a}]}),U=Array.isArray(H)?H:[],{data:_,isLoading:X}=(0,j.useQuery)({queryKey:["/api/admin/finance/withdrawals/pending"]}),J=Array.isArray(_)?_:[],{data:Z,isLoading:ee}=(0,j.useQuery)({queryKey:["/api/admin/finance/revenue/trend",{period:a}]}),ea=Array.isArray(Z)?Z:[],{data:es,isLoading:el}=(0,j.useQuery)({queryKey:["/api/admin/finance/revenue/by-source",{period:a}]}),ei=Array.isArray(es)?es:[],{data:er}=(0,j.useQuery)({queryKey:["/api/admin/finance/withdrawals",g||l||d||h],enabled:!!(g||l||d||h),queryFn:async()=>{let e=g||l||d||h,a=J.find(a=>a.id===e);if(a)return a;let s=await fetch(`/api/admin/finance/withdrawals/${e}`);if(!s.ok)throw Error("Failed to fetch withdrawal");return s.json()}}),{data:en}=(0,j.useQuery)({queryKey:["/api/admin/finance/transactions",y],enabled:!!y,queryFn:async()=>{let e=U.find(e=>e.id===y);if(e)return e;let a=await fetch(`/api/admin/finance/transactions/${y}`);if(!a.ok)throw Error("Failed to fetch transaction");return a.json()}}),eo=(0,ew.useForm)({resolver:(0,eS.zodResolver)(e0),defaultValues:{adminNotes:"",verified:!1}}),em=(0,ew.useForm)({resolver:(0,eS.zodResolver)(e2),defaultValues:{reason:"other",detailedReason:"",notifyUser:!0}}),eh=(0,ew.useForm)({resolver:(0,eS.zodResolver)(e4),defaultValues:{transactionId:"",notes:"",confirmed:!1}}),ev=(0,ew.useForm)({resolver:(0,eS.zodResolver)(e1),defaultValues:{types:[],format:"csv",includeNotes:!1}}),eb=(0,Q.useMutation)({mutationFn:async e=>{if(!l)throw Error("No withdrawal selected");return(0,ec.apiRequest)("POST",`/api/admin/finance/withdrawals/${l}/approve`,e)},onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/finance"]}),i(null),eo.reset(),t({title:"Withdrawal approved successfully"})},onError:()=>{t({title:"Failed to approve withdrawal",variant:"destructive"})}}),ey=(0,Q.useMutation)({mutationFn:async e=>{if(!d)throw Error("No withdrawal selected");return(0,ec.apiRequest)("POST",`/api/admin/finance/withdrawals/${d}/reject`,e)},onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/finance"]}),m(null),em.reset(),t({title:"Withdrawal rejected successfully"})},onError:()=>{t({title:"Failed to reject withdrawal",variant:"destructive"})}}),eC=(0,Q.useMutation)({mutationFn:async e=>{if(!h)throw Error("No withdrawal selected");return(0,ec.apiRequest)("POST",`/api/admin/finance/withdrawals/${h}/complete`,e)},onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/finance"]}),u(null),eh.reset(),t({title:"Withdrawal marked as completed"})},onError:()=>{t({title:"Failed to complete withdrawal",variant:"destructive"})}}),ef=(0,Q.useMutation)({mutationFn:async e=>{let a=new URLSearchParams;e.dateFrom&&a.set("dateFrom",e.dateFrom),e.dateTo&&a.set("dateTo",e.dateTo),e.types.forEach(e=>a.append("types",e)),a.set("format",e.format),a.set("includeNotes",e.includeNotes.toString());let s=await fetch(`/api/admin/finance/transactions/export?${a.toString()}`);if(!s.ok)throw Error("Export failed");let t=await s.blob(),l=window.URL.createObjectURL(t),i=document.createElement("a");i.href=l,i.download=`transactions-${(0,ed.format)(new Date,"yyyy-MM-dd")}.csv`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(l)},onSuccess:()=>{T(!1),ev.reset(),t({title:"Transactions exported successfully"})},onError:()=>{t({title:"Failed to export transactions",variant:"destructive"})}});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold","data-testid":"title-finance-management",children:"Finance Management"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(W.Select,{value:a,onValueChange:s,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-48","data-testid":"select-period-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select period"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"today",children:"Today"}),(0,r.jsx)(W.SelectItem,{value:"7d",children:"Last 7 Days"}),(0,r.jsx)(W.SelectItem,{value:"30d",children:"Last 30 Days"}),(0,r.jsx)(W.SelectItem,{value:"90d",children:"Last 90 Days"}),(0,r.jsx)(W.SelectItem,{value:"year",children:"This Year"}),(0,r.jsx)(W.SelectItem,{value:"all",children:"All Time"})]})]}),(0,r.jsxs)(x.Button,{variant:"outline",onClick:()=>T(!0),"data-testid":"button-export-transactions",children:[(0,r.jsx)(et.Download,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-total-revenue",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Revenue"}),(0,r.jsx)(b.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:S?(0,r.jsx)(c.Skeleton,{className:"h-8 w-24"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-finance-revenue",children:e3(F.totalRevenue)}),(0,r.jsxs)("p",{className:`text-xs flex items-center gap-1 ${F.revenueGrowth>=0?"text-green-600":"text-red-600"}`,children:[F.revenueGrowth>=0?(0,r.jsx)(N.TrendingUp,{className:"h-3 w-3"}):(0,r.jsx)(eO.TrendingDown,{className:"h-3 w-3"}),F.revenueGrowth>=0?"+":"",F.revenueGrowth,"% vs last period"]})]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-pending-withdrawals",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Pending Withdrawals"}),(0,r.jsx)(ez,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:S?(0,r.jsx)(c.Skeleton,{className:"h-8 w-24"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:`text-2xl font-bold ${F.pendingWithdrawalCount>0?"text-orange-600":""}`,"data-testid":"text-pending-withdrawals",children:e3(F.pendingWithdrawals)}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[F.pendingWithdrawalCount," ",1===F.pendingWithdrawalCount?"request":"requests"]})]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-total-transactions",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Transactions"}),(0,r.jsx)(eW,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:S?(0,r.jsx)(c.Skeleton,{className:"h-8 w-24"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-transactions",children:(e=F.totalTransactions,new Intl.NumberFormat("en-US").format(e))}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[F.transactionsToday," today"]})]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-top-earner",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Top Earner"}),(0,r.jsx)(eG.Trophy,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:S?(0,r.jsx)(c.Skeleton,{className:"h-8 w-24"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[F.topEarner?.avatarUrl&&(0,r.jsxs)(eN.Avatar,{className:"h-6 w-6",children:[(0,r.jsx)(eN.AvatarImage,{src:F.topEarner.avatarUrl}),(0,r.jsx)(eN.AvatarFallback,{children:F.topEarner.username?.[0]?.toUpperCase()})]}),(0,r.jsx)("div",{className:"text-lg font-bold truncate",children:F.topEarner?.username||"N/A"})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e3(F.topEarner?.earnings||0)," earned"]})]})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-revenue-trend",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Revenue Trend"})}),(0,r.jsx)(o.CardContent,{children:ee?(0,r.jsx)(c.Skeleton,{className:"h-64"}):ea.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(D.LineChart,{data:ea,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"date"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{formatter:e=>e3(Number(e))}),(0,r.jsx)(A.Line,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3}})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No revenue data available"})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-revenue-by-source",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Revenue by Source"})}),(0,r.jsx)(o.CardContent,{children:el?(0,r.jsx)(c.Skeleton,{className:"h-64"}):ei.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(R.PieChart,{children:[(0,r.jsx)(I.Pie,{data:ei,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:60,label:e=>`${e.name}: ${e3(e.value)}`,children:ei.map((e,a)=>{let s=e.name.toLowerCase().replace(/\s+/g,"");return(0,r.jsx)(B.Cell,{fill:eZ[s]||eZ.other},`cell-${a}`)})}),(0,r.jsx)(M.Tooltip,{formatter:e=>e3(Number(e))}),(0,r.jsx)(E.Legend,{})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No source data available"})})]})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Pending Withdrawals (",J.length,")"]})}),(0,r.jsx)(o.CardContent,{children:X?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-16"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"User"}),(0,r.jsx)(p.TableHead,{children:"Amount"}),(0,r.jsx)(p.TableHead,{children:"Method"}),(0,r.jsx)(p.TableHead,{children:"Wallet"}),(0,r.jsx)(p.TableHead,{children:"Requested"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:J.length>0?J.map(e=>{var a,s;let l,n,d,c,o,h,u=(a=new Date,s=new Date(e.createdAt),l=(0,eX.toDate)(a),d=eJ(l,n=(0,eX.toDate)(s)),c=Math.abs((0,eY.differenceInCalendarDays)(l,n)),l.setDate(l.getDate()-d*c),o=Number(eJ(l,n)===-d),0==(h=d*(c-o))?0:h);return(0,r.jsxs)(p.TableRow,{"data-testid":`withdrawal-row-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(eN.Avatar,{className:"h-8 w-8",children:[(0,r.jsx)(eN.AvatarImage,{src:e.avatarUrl}),(0,r.jsx)(eN.AvatarFallback,{children:e.username?.[0]?.toUpperCase()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.username}),u>7&&(0,r.jsxs)(V.Badge,{variant:"destructive",className:"text-xs mt-1",children:[(0,r.jsx)(eg.AlertTriangle,{className:"h-3 w-3 mr-1"}),"Urgent"]})]})]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)("span",{className:"font-bold","data-testid":`withdrawal-amount-${e.id}`,children:e3(e.amount)})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"outline",children:e.method||"USDT"})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2 max-w-xs",children:[(0,r.jsx)("span",{className:"truncate",children:e.walletAddress||"N/A"}),e.walletAddress&&(0,r.jsx)(x.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>{var a;return a=e.walletAddress,void(navigator.clipboard.writeText(a),t({title:"Copied to clipboard"}))},children:(0,r.jsx)(e_.Copy,{className:"h-3 w-3"})})]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm",children:(0,ed.format)(new Date(e.createdAt),"MMM dd, yyyy HH:mm")}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsxs)(x.Button,{size:"sm",variant:"outline",className:"bg-green-50 hover:bg-green-100 text-green-700 border-green-200",onClick:()=>i(e.id),"data-testid":`approve-withdrawal-${e.id}`,children:[(0,r.jsx)(eu.CheckCircle,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,r.jsxs)(x.Button,{size:"sm",variant:"outline",className:"bg-red-50 hover:bg-red-100 text-red-700 border-red-200",onClick:()=>m(e.id),"data-testid":`reject-withdrawal-${e.id}`,children:[(0,r.jsx)(ej,{className:"h-4 w-4 mr-1"}),"Reject"]}),(0,r.jsx)(x.Button,{size:"sm",variant:"ghost",onClick:()=>v(e.id),"data-testid":`view-withdrawal-${e.id}`,children:(0,r.jsx)(ep.Eye,{className:"h-4 w-4"})})]})})]},e.id)}):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No pending withdrawals"})})})]})})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between",children:(0,r.jsxs)(o.CardTitle,{children:["Recent Transactions (",U.length,")"]})}),(0,r.jsx)(o.CardContent,{children:$?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-16"},a))}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"User"}),(0,r.jsx)(p.TableHead,{children:"Type"}),(0,r.jsx)(p.TableHead,{children:"Amount"}),(0,r.jsx)(p.TableHead,{children:"Method"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Date"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:U.length>0?U.map(e=>{let a=["coin purchase","subscription","marketplace"].includes(e.type?.toLowerCase()||"");return(0,r.jsxs)(p.TableRow,{"data-testid":`transaction-row-${e.id}`,className:"cursor-pointer hover:bg-muted/50",onClick:()=>C(e.id),children:[(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(eN.Avatar,{className:"h-8 w-8",children:[(0,r.jsx)(eN.AvatarImage,{src:e.avatarUrl}),(0,r.jsx)(eN.AvatarFallback,{children:e.username?.[0]?.toUpperCase()})]}),(0,r.jsx)("span",{className:"font-medium",children:e.username})]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:e5(e.type),children:e.type||"Unknown"})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("span",{className:`font-semibold ${a?"text-green-600":"text-red-600"}`,"data-testid":`transaction-amount-${e.id}`,children:[a?"+":"-",e3(e.amount)]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)("span",{className:"text-sm",children:e.method||"N/A"})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:e6(e.status||"pending"),children:e.status||"Pending"})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)("div",{className:"text-sm",children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"ghost",onClick:a=>{a.stopPropagation(),C(e.id)},"data-testid":`view-transaction-${e.id}`,children:(0,r.jsx)(ep.Eye,{className:"h-4 w-4"})})})]},e.id)}):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No recent transactions"})})})]})}),U.length>0&&(0,r.jsx)("div",{className:"mt-4 flex justify-center",children:(0,r.jsx)(x.Button,{variant:"outline",children:"View All Transactions"})})]})})]}),(0,r.jsx)(G.Dialog,{open:!!l,onOpenChange:e=>!e&&i(null),children:(0,r.jsxs)(G.DialogContent,{className:"max-w-2xl",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Approve Withdrawal Request"}),(0,r.jsx)(G.DialogDescription,{children:"Review and approve this withdrawal request"})]}),er&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[(0,r.jsxs)(eN.Avatar,{className:"h-12 w-12",children:[(0,r.jsx)(eN.AvatarImage,{src:er.avatarUrl}),(0,r.jsx)(eN.AvatarFallback,{children:er.username?.[0]?.toUpperCase()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:er.username}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Current Balance: ",e3(er.userBalance||0)]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Amount Requested"}),(0,r.jsx)("div",{className:"text-2xl font-bold",children:e3(er.amount)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Method"}),(0,r.jsx)("div",{className:"text-lg font-semibold",children:er.method||"USDT"})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Wallet Address"}),(0,r.jsx)("div",{className:"font-mono text-sm break-all",children:er.walletAddress||"N/A"})]})]}),(0,r.jsx)(eD.Form,{...eo,children:(0,r.jsxs)("form",{onSubmit:eo.handleSubmit(e=>eb.mutate(e)),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2 p-4 bg-green-50 dark:bg-green-950 rounded-lg",children:[(0,r.jsx)("div",{className:"font-medium mb-2",children:"Verification Checklist:"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,r.jsx)(eu.CheckCircle,{className:"h-4 w-4 text-green-600"}),(0,r.jsx)("span",{children:"User has sufficient balance"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,r.jsx)(eu.CheckCircle,{className:"h-4 w-4 text-green-600"}),(0,r.jsx)("span",{children:"Wallet address is valid"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,r.jsx)(eu.CheckCircle,{className:"h-4 w-4 text-green-600"}),(0,r.jsx)("span",{children:"No suspicious activity detected"})]})]}),(0,r.jsx)(eD.FormField,{control:eo.control,name:"adminNotes",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Admin Notes (Optional)"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(z.Textarea,{...e,placeholder:"Add any internal notes..."})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:eo.control,name:"verified",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(ex.Checkbox,{checked:e.value,onCheckedChange:e.onChange})}),(0,r.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,r.jsx)(eD.FormLabel,{children:"I confirm all verification checks have been completed"}),(0,r.jsx)(eD.FormMessage,{})]})]})}),(0,r.jsx)("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-950 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(eg.AlertTriangle,{className:"h-5 w-5 text-yellow-600 flex-shrink-0"}),(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("strong",{children:"Warning:"})," Amount will be deducted from user's balance immediately upon approval."]})]})}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>i(null),children:"Cancel"}),(0,r.jsx)(x.Button,{type:"submit",className:"bg-green-600 hover:bg-green-700",disabled:eb.isPending,children:eb.isPending?"Processing...":"Approve & Process"})]})]})})]})]})}),(0,r.jsx)(G.Dialog,{open:!!d,onOpenChange:e=>!e&&m(null),children:(0,r.jsxs)(G.DialogContent,{className:"max-w-2xl",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Reject Withdrawal Request"}),(0,r.jsx)(G.DialogDescription,{children:"Provide a reason for rejecting this withdrawal request"})]}),er&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[(0,r.jsxs)(eN.Avatar,{className:"h-12 w-12",children:[(0,r.jsx)(eN.AvatarImage,{src:er.avatarUrl}),(0,r.jsx)(eN.AvatarFallback,{children:er.username?.[0]?.toUpperCase()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:er.username}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Requested: ",e3(er.amount)]})]})]}),(0,r.jsx)(eD.Form,{...em,children:(0,r.jsxs)("form",{onSubmit:em.handleSubmit(e=>ey.mutate(e)),className:"space-y-4",children:[(0,r.jsx)(eD.FormField,{control:em.control,name:"reason",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Rejection Reason"}),(0,r.jsxs)(W.Select,{onValueChange:e.onChange,defaultValue:e.value,children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(W.SelectTrigger,{children:(0,r.jsx)(W.SelectValue,{placeholder:"Select a reason"})})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"insufficient_balance",children:"Insufficient Balance"}),(0,r.jsx)(W.SelectItem,{value:"invalid_wallet",children:"Invalid Wallet Details"}),(0,r.jsx)(W.SelectItem,{value:"suspicious_activity",children:"Suspicious Activity"}),(0,r.jsx)(W.SelectItem,{value:"verification_required",children:"Verification Required"}),(0,r.jsx)(W.SelectItem,{value:"other",children:"Other"})]})]}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:em.control,name:"detailedReason",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Detailed Reason (shown to user)"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(z.Textarea,{...e,placeholder:"Provide a clear explanation that will be shown to the user...",rows:4})}),(0,r.jsx)(eD.FormDescription,{children:"This message will be sent to the user, so please be clear and professional."}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:em.control,name:"notifyUser",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(ex.Checkbox,{checked:e.value,onCheckedChange:e.onChange})}),(0,r.jsx)("div",{className:"space-y-1 leading-none",children:(0,r.jsx)(eD.FormLabel,{children:"Notify user by email"})})]})}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>m(null),children:"Cancel"}),(0,r.jsx)(x.Button,{type:"submit",variant:"destructive",disabled:ey.isPending,children:ey.isPending?"Processing...":"Reject Request"})]})]})})]})]})}),(0,r.jsx)(G.Dialog,{open:!!h,onOpenChange:e=>!e&&u(null),children:(0,r.jsxs)(G.DialogContent,{className:"max-w-2xl",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Mark Withdrawal as Completed"}),(0,r.jsx)(G.DialogDescription,{children:"Confirm that payment has been successfully sent"})]}),er&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"User:"}),(0,r.jsx)("span",{className:"font-medium",children:er.username})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Amount:"}),(0,r.jsx)("span",{className:"font-bold",children:e3(er.amount)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Method:"}),(0,r.jsx)("span",{children:er.method||"USDT"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Wallet:"}),(0,r.jsx)("span",{className:"font-mono text-xs",children:er.walletAddress})]})]}),(0,r.jsx)(eD.Form,{...eh,children:(0,r.jsxs)("form",{onSubmit:eh.handleSubmit(e=>eC.mutate(e)),className:"space-y-4",children:[(0,r.jsx)(eD.FormField,{control:eh.control,name:"transactionId",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Transaction ID / Payment Reference *"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{...e,placeholder:"Enter transaction ID or payment reference"})}),(0,r.jsx)(eD.FormDescription,{children:"The transaction hash or payment reference from the payment gateway"}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:eh.control,name:"notes",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Additional Notes (Optional)"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(z.Textarea,{...e,placeholder:"Add any additional information..."})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:eh.control,name:"confirmed",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(ex.Checkbox,{checked:e.value,onCheckedChange:e.onChange})}),(0,r.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,r.jsx)(eD.FormLabel,{children:"I confirm that payment has been sent successfully"}),(0,r.jsx)(eD.FormMessage,{})]})]})}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>u(null),children:"Cancel"}),(0,r.jsx)(x.Button,{type:"submit",className:"bg-green-600 hover:bg-green-700",disabled:eC.isPending,children:eC.isPending?"Processing...":"Mark as Completed"})]})]})})]})]})}),(0,r.jsx)(G.Dialog,{open:!!y,onOpenChange:e=>!e&&C(null),children:(0,r.jsxs)(G.DialogContent,{className:"max-w-3xl",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Transaction Details"}),(0,r.jsx)(G.DialogDescription,{children:"Complete information about this transaction"})]}),en&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"col-span-2 p-4 bg-muted/50 rounded-lg",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Transaction ID"}),(0,r.jsx)("div",{className:"font-mono text-sm",children:en.id})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Type"}),(0,r.jsx)(V.Badge,{variant:e5(en.type),className:"mt-1",children:en.type})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Status"}),(0,r.jsx)(V.Badge,{variant:e6(en.status||"pending"),className:"mt-1",children:en.status||"Pending"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Amount"}),(0,r.jsx)("div",{className:"text-xl font-bold",children:e3(en.amount)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Payment Method"}),(0,r.jsx)("div",{className:"font-medium",children:en.method||"N/A"})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"User"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsxs)(eN.Avatar,{className:"h-8 w-8",children:[(0,r.jsx)(eN.AvatarImage,{src:en.avatarUrl}),(0,r.jsx)(eN.AvatarFallback,{children:en.username?.[0]?.toUpperCase()})]}),(0,r.jsx)("span",{className:"font-medium",children:en.username})]})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Date & Time"}),(0,r.jsx)("div",{children:(0,ed.format)(new Date(en.createdAt),"PPpp")}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,k.formatDistanceToNow)(new Date(en.createdAt),{addSuffix:!0})})]}),en.description&&(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Description"}),(0,r.jsx)("div",{className:"text-sm",children:en.description})]})]}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsxs)(x.Button,{variant:"outline",onClick:()=>{t({title:"Receipt download feature coming soon"})},children:[(0,r.jsx)(et.Download,{className:"h-4 w-4 mr-2"}),"Download Receipt"]}),(0,r.jsx)(x.Button,{onClick:()=>C(null),children:"Close"})]})]})]})}),(0,r.jsx)(G.Dialog,{open:f,onOpenChange:T,children:(0,r.jsxs)(G.DialogContent,{className:"max-w-2xl",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Export Transactions"}),(0,r.jsx)(G.DialogDescription,{children:"Select filters and export transactions to CSV"})]}),(0,r.jsx)(eD.Form,{...ev,children:(0,r.jsxs)("form",{onSubmit:ev.handleSubmit(e=>ef.mutate(e)),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(eD.FormField,{control:ev.control,name:"dateFrom",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"From Date"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{type:"date",...e})}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:ev.control,name:"dateTo",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"To Date"}),(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(O.Input,{type:"date",...e})}),(0,r.jsx)(eD.FormMessage,{})]})})]}),(0,r.jsx)(eD.FormField,{control:ev.control,name:"types",render:()=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Transaction Types"}),(0,r.jsx)("div",{className:"space-y-2",children:["Coin Purchases","Subscriptions","Marketplace","Withdrawals"].map(e=>(0,r.jsx)(eD.FormField,{control:ev.control,name:"types",render:({field:a})=>(0,r.jsxs)(eD.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(ex.Checkbox,{checked:a.value?.includes(e),onCheckedChange:s=>s?a.onChange([...a.value,e]):a.onChange(a.value?.filter(a=>a!==e))})}),(0,r.jsx)(eD.FormLabel,{className:"font-normal",children:e})]})},e))}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:ev.control,name:"format",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{children:[(0,r.jsx)(eD.FormLabel,{children:"Export Format"}),(0,r.jsxs)(W.Select,{onValueChange:e.onChange,defaultValue:e.value,children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(W.SelectTrigger,{children:(0,r.jsx)(W.SelectValue,{placeholder:"Select format"})})}),(0,r.jsx)(W.SelectContent,{children:(0,r.jsx)(W.SelectItem,{value:"csv",children:"CSV"})})]}),(0,r.jsx)(eD.FormMessage,{})]})}),(0,r.jsx)(eD.FormField,{control:ev.control,name:"includeNotes",render:({field:e})=>(0,r.jsxs)(eD.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,r.jsx)(eD.FormControl,{children:(0,r.jsx)(ex.Checkbox,{checked:e.value,onCheckedChange:e.onChange})}),(0,r.jsx)("div",{className:"space-y-1 leading-none",children:(0,r.jsx)(eD.FormLabel,{children:"Include detailed notes"})})]})}),(0,r.jsxs)(G.DialogFooter,{children:[(0,r.jsx)(x.Button,{type:"button",variant:"outline",onClick:()=>T(!1),children:"Cancel"}),(0,r.jsx)(x.Button,{type:"submit",disabled:ef.isPending,"data-testid":"button-export-submit",children:ef.isPending?"Exporting...":"Export"})]})]})})]})}),(0,r.jsx)(G.Dialog,{open:!!g,onOpenChange:e=>!e&&v(null),children:(0,r.jsxs)(G.DialogContent,{className:"max-w-2xl",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Withdrawal Details"})}),er&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"User"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsxs)(eN.Avatar,{className:"h-10 w-10",children:[(0,r.jsx)(eN.AvatarImage,{src:er.avatarUrl}),(0,r.jsx)(eN.AvatarFallback,{children:er.username?.[0]?.toUpperCase()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:er.username}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Balance: ",e3(er.userBalance||0)]})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Amount"}),(0,r.jsx)("div",{className:"text-2xl font-bold",children:e3(er.amount)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Method"}),(0,r.jsx)("div",{className:"font-medium",children:er.method||"USDT"})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Wallet Address"}),(0,r.jsx)("div",{className:"font-mono text-sm break-all bg-muted/50 p-2 rounded",children:er.walletAddress||"N/A"})]}),(0,r.jsxs)("div",{className:"col-span-2",children:[(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Requested"}),(0,r.jsx)("div",{children:(0,ed.format)(new Date(er.createdAt),"PPpp")}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,k.formatDistanceToNow)(new Date(er.createdAt),{addSuffix:!0})})]})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{onClick:()=>v(null),children:"Close"})})]})]})})]})}e.s(["default",()=>e8],73609);var e7=e.i(1725),e9=e.i(237);let ae=["hsl(var(--primary))","hsl(var(--secondary))","hsl(var(--accent))","hsl(var(--muted))","#8884d8","#82ca9d","#ffc658","#ff7c7c"];function aa(){let[e,a]=(0,n.useState)("users"),{data:s,isLoading:t}=(0,j.useQuery)({queryKey:["/api/admin/analytics/users"]}),l=s||{dau:0,mau:0,newUsers:0,churnRate:0,growthData:[],countryData:[],activeInactiveData:[]},{data:i,isLoading:d}=(0,j.useQuery)({queryKey:["/api/admin/analytics/content"]}),x=i||{trendData:[],typeDistribution:[],topCreators:[],qualityScores:[]},{data:m,isLoading:h}=(0,j.useQuery)({queryKey:["/api/admin/analytics/financial"]}),u=m||{revenueTrend:[],revenueBySource:[],topEarners:[],transactionVolume:[]},{data:g,isLoading:v}=(0,j.useQuery)({queryKey:["/api/admin/analytics/engagement"]}),b=g||{avgSessionDuration:"0m",bounceRate:0,pagesPerSession:0,heatmapData:[]};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Analytics & Reports"}),(0,r.jsxs)(_.Tabs,{value:e,onValueChange:a,"data-testid":"tabs-analytics",children:[(0,r.jsxs)(_.TabsList,{className:"grid w-full grid-cols-4",children:[(0,r.jsx)(_.TabsTrigger,{value:"users","data-testid":"tab-users",children:"Users"}),(0,r.jsx)(_.TabsTrigger,{value:"content","data-testid":"tab-content",children:"Content"}),(0,r.jsx)(_.TabsTrigger,{value:"financial","data-testid":"tab-financial",children:"Financial"}),(0,r.jsx)(_.TabsTrigger,{value:"engagement","data-testid":"tab-engagement",children:"Engagement"})]}),(0,r.jsx)(_.TabsContent,{value:"users",className:"space-y-4",children:t?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a))}),(0,r.jsx)(c.Skeleton,{className:"h-96"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-dau",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"DAU"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-dau",children:l.dau}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Daily Active Users"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-mau",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"MAU"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-mau",children:l.mau}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Monthly Active Users"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-new-users",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"New Users"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-new-users",children:l.newUsers}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Last 30 days"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-churn-rate",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Churn Rate"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-churn-rate",children:[l.churnRate,"%"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Monthly churn"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-user-growth",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"User Growth (Last 30 Days)"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(D.LineChart,{data:l.growthData,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"date"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(E.Legend,{}),(0,r.jsx)(A.Line,{type:"monotone",dataKey:"users",stroke:"hsl(var(--primary))",strokeWidth:2})]})})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-users-by-country",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Users by Country (Top 10)"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(F.BarChart,{data:l.countryData,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"country"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(H.Bar,{dataKey:"users",fill:"hsl(var(--primary))"})]})})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-active-inactive",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Active vs Inactive Users"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(R.PieChart,{children:[(0,r.jsx)(I.Pie,{data:l.activeInactiveData,cx:"50%",cy:"50%",labelLine:!1,label:e=>`${e.name}: ${e.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:l.activeInactiveData.map((e,a)=>(0,r.jsx)(B.Cell,{fill:ae[a%ae.length]},`cell-${a}`))}),(0,r.jsx)(M.Tooltip,{})]})})})]})]})]})}),(0,r.jsx)(_.TabsContent,{value:"content",className:"space-y-4",children:d?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(c.Skeleton,{className:"h-96"}),(0,r.jsx)(c.Skeleton,{className:"h-64"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-content-trend",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Content Creation Trend (Last 30 Days)"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(D.LineChart,{data:x.trendData,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"date"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(E.Legend,{}),(0,r.jsx)(A.Line,{type:"monotone",dataKey:"count",stroke:"hsl(var(--primary))",strokeWidth:2})]})})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-content-type-distribution",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Content Type Distribution"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(R.PieChart,{children:[(0,r.jsx)(I.Pie,{data:x.typeDistribution,cx:"50%",cy:"50%",labelLine:!1,label:e=>`${e.name}: ${e.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:x.typeDistribution.map((e,a)=>(0,r.jsx)(B.Cell,{fill:ae[a%ae.length]},`cell-${a}`))}),(0,r.jsx)(M.Tooltip,{})]})})})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-top-creators",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Top Content Creators"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Rank"}),(0,r.jsx)(p.TableHead,{children:"Creator"}),(0,r.jsx)(p.TableHead,{children:"Posts"}),(0,r.jsx)(p.TableHead,{children:"Views"}),(0,r.jsx)(p.TableHead,{children:"Avg Quality"})]})}),(0,r.jsx)(p.TableBody,{children:x.topCreators.length>0?x.topCreators.map((e,a)=>(0,r.jsxs)(p.TableRow,{"data-testid":`creator-${e.id}`,children:[(0,r.jsx)(p.TableCell,{"data-testid":`creator-rank-${e.id}`,children:a+1}),(0,r.jsx)(p.TableCell,{children:e.username}),(0,r.jsx)(p.TableCell,{children:e.posts}),(0,r.jsx)(p.TableCell,{children:e.views}),(0,r.jsx)(p.TableCell,{children:e.avgQuality?.toFixed(1)||"N/A"})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No data available"})})})]})})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-quality-scores",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Quality Scores Histogram"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(F.BarChart,{data:x.qualityScores,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"score"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(H.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})})})]})]})}),(0,r.jsx)(_.TabsContent,{value:"financial",className:"space-y-4",children:h?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(c.Skeleton,{className:"h-96"}),(0,r.jsx)(c.Skeleton,{className:"h-64"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-revenue-trend",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Revenue Trend (Last 30 Days)"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(e7.AreaChart,{data:u.revenueTrend,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"date"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(E.Legend,{}),(0,r.jsx)(e9.Area,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.6})]})})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-revenue-by-source",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Revenue by Source"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(R.PieChart,{children:[(0,r.jsx)(I.Pie,{data:u.revenueBySource,cx:"50%",cy:"50%",labelLine:!1,label:e=>`${e.name}: $${e.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:u.revenueBySource.map((e,a)=>(0,r.jsx)(B.Cell,{fill:ae[a%ae.length]},`cell-${a}`))}),(0,r.jsx)(M.Tooltip,{})]})})})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-top-earners",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Top Earners"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Rank"}),(0,r.jsx)(p.TableHead,{children:"User"}),(0,r.jsx)(p.TableHead,{children:"Total Earnings"}),(0,r.jsx)(p.TableHead,{children:"This Month"}),(0,r.jsx)(p.TableHead,{children:"Sales"})]})}),(0,r.jsx)(p.TableBody,{children:u.topEarners.length>0?u.topEarners.map((e,a)=>(0,r.jsxs)(p.TableRow,{"data-testid":`earner-${e.id}`,children:[(0,r.jsx)(p.TableCell,{"data-testid":`earner-rank-${e.id}`,children:a+1}),(0,r.jsx)(p.TableCell,{children:e.username}),(0,r.jsxs)(p.TableCell,{children:["$",e.totalEarnings]}),(0,r.jsxs)(p.TableCell,{children:["$",e.monthlyEarnings]}),(0,r.jsx)(p.TableCell,{children:e.sales})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No data available"})})})]})})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-transaction-volume",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Transaction Volume"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(F.BarChart,{data:u.transactionVolume,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"date"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(H.Bar,{dataKey:"volume",fill:"hsl(var(--primary))"})]})})})]})]})}),(0,r.jsx)(_.TabsContent,{value:"engagement",className:"space-y-4",children:v?(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a))})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-avg-session",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Avg Session Duration"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-session",children:b.avgSessionDuration}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Per user session"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-bounce-rate",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Bounce Rate"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-bounce-rate",children:[b.bounceRate,"%"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Single page visits"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-pages-per-session",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Pages Per Session"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-pages-per-session",children:b.pagesPerSession}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Average pages"})]})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-engagement-heatmap",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Engagement Heatmap (Hourly Activity)"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:300,children:(0,r.jsxs)(F.BarChart,{data:b.heatmapData,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"hour"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(E.Legend,{}),(0,r.jsx)(H.Bar,{dataKey:"activity",fill:"hsl(var(--primary))"})]})})})]})]})})]})]})}e.s(["default",()=>aa],36581);var as=e.i(45305),at=e.i(27876),al=e.i(93753);function ai(){let[e,a]=(0,n.useState)("general"),[s,t]=(0,n.useState)(""),{toast:l}=(0,Y.useToast)(),{data:i,isLoading:d}=(0,j.useQuery)({queryKey:["/api/admin/settings/general"]}),m=i||{siteName:"YoForex",siteDescription:"",maintenanceMode:!1,registrationEnabled:!0},{data:h,isLoading:u}=(0,j.useQuery)({queryKey:["/api/admin/settings/coin-economy"]}),g=h||{usdToCoinsRate:100,packages:[],minWithdrawal:1e3,withdrawalFee:5},{data:v,isLoading:b}=(0,j.useQuery)({queryKey:["/api/admin/settings/email-templates",{search:s}]}),y=Array.isArray(v)?v:[],{data:C,isLoading:f}=(0,j.useQuery)({queryKey:["/api/admin/settings/feature-flags"]}),N=Array.isArray(C)?C:[],{data:T,isLoading:w}=(0,j.useQuery)({queryKey:["/api/admin/settings/admin-roles"]}),S=Array.isArray(T)?T:[],k=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("PUT","/api/admin/settings/general",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/settings/general"]}),l({title:"Settings updated successfully"})},onError:()=>{l({title:"Failed to update settings",variant:"destructive"})}});(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("PUT","/api/admin/settings/coin-economy",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/settings/coin-economy"]}),l({title:"Coin settings updated successfully"})},onError:()=>{l({title:"Failed to update coin settings",variant:"destructive"})}});let D=(0,Q.useMutation)({mutationFn:async({flagId:e,enabled:a})=>(0,ec.apiRequest)("PUT",`/api/admin/settings/feature-flags/${e}`,{enabled:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/settings/feature-flags"]}),l({title:"Feature flag updated"})},onError:()=>{l({title:"Failed to update feature flag",variant:"destructive"})}});return(0,Q.useMutation)({mutationFn:async({userId:e,role:a})=>(0,ec.apiRequest)("POST","/api/admin/settings/admin-roles/grant",{userId:e,role:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/settings/admin-roles"]}),l({title:"Admin role granted successfully"})},onError:()=>{l({title:"Failed to grant admin role",variant:"destructive"})}}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"System Settings"}),(0,r.jsxs)(_.Tabs,{value:e,onValueChange:a,"data-testid":"tabs-settings",children:[(0,r.jsxs)(_.TabsList,{className:"grid w-full grid-cols-5",children:[(0,r.jsx)(_.TabsTrigger,{value:"general","data-testid":"tab-general",children:"General"}),(0,r.jsx)(_.TabsTrigger,{value:"coin-economy","data-testid":"tab-coin-economy",children:"Coin Economy"}),(0,r.jsx)(_.TabsTrigger,{value:"email-templates","data-testid":"tab-email-templates",children:"Email Templates"}),(0,r.jsx)(_.TabsTrigger,{value:"feature-flags","data-testid":"tab-feature-flags",children:"Feature Flags"}),(0,r.jsx)(_.TabsTrigger,{value:"admin-roles","data-testid":"tab-admin-roles",children:"Admin Roles"})]}),(0,r.jsx)(_.TabsContent,{value:"general",className:"space-y-4",children:d?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(o.Card,{"data-testid":"card-general-settings",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"General Settings"})}),(0,r.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"site-name",children:"Site Name"}),(0,r.jsx)(O.Input,{id:"site-name",defaultValue:m.siteName,"data-testid":"input-site-name"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"site-description",children:"Site Description"}),(0,r.jsx)(z.Textarea,{id:"site-description",defaultValue:m.siteDescription,"data-testid":"textarea-site-description"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(al.Label,{htmlFor:"maintenance-mode",children:"Maintenance Mode"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enable site maintenance mode"})]}),(0,r.jsx)(as.Switch,{id:"maintenance-mode",defaultChecked:m.maintenanceMode,"data-testid":"switch-maintenance-mode"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(al.Label,{htmlFor:"registration-enabled",children:"Registration Enabled"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Allow new user registrations"})]}),(0,r.jsx)(as.Switch,{id:"registration-enabled",defaultChecked:m.registrationEnabled,"data-testid":"switch-registration-enabled"})]}),(0,r.jsx)(x.Button,{onClick:()=>k.mutate(m),disabled:k.isPending,"data-testid":"button-save-general",children:"Save Changes"})]})]})}),(0,r.jsx)(_.TabsContent,{value:"coin-economy",className:"space-y-4",children:u?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.Card,{"data-testid":"card-exchange-rate",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Exchange Rate"})}),(0,r.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"usd-to-coins",children:"USD to Coins Rate"}),(0,r.jsx)(O.Input,{id:"usd-to-coins",type:"number",defaultValue:g.usdToCoinsRate,"data-testid":"input-usd-to-coins"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"1 USD = X coins"})]}),(0,r.jsx)(x.Button,{"data-testid":"button-save-exchange-rate",children:"Save Exchange Rate"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-recharge-packages",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Recharge Packages"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Package"}),(0,r.jsx)(p.TableHead,{children:"Coins"}),(0,r.jsx)(p.TableHead,{children:"Price (USD)"}),(0,r.jsx)(p.TableHead,{children:"Bonus"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:g.packages.length>0?g.packages.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`package-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:e.name}),(0,r.jsx)(p.TableCell,{children:e.coins}),(0,r.jsxs)(p.TableCell,{children:["$",e.price]}),(0,r.jsxs)(p.TableCell,{children:[e.bonus,"%"]}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-edit-package-${e.id}`,children:"Edit"})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No packages configured"})})})]})})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-withdrawal-settings",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Withdrawal Settings"})}),(0,r.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"min-withdrawal",children:"Minimum Withdrawal Amount"}),(0,r.jsx)(O.Input,{id:"min-withdrawal",type:"number",defaultValue:g.minWithdrawal,"data-testid":"input-min-withdrawal"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"withdrawal-fee",children:"Withdrawal Fee (%)"}),(0,r.jsx)(O.Input,{id:"withdrawal-fee",type:"number",defaultValue:g.withdrawalFee,"data-testid":"input-withdrawal-fee"})]}),(0,r.jsx)(x.Button,{"data-testid":"button-save-withdrawal",children:"Save Withdrawal Settings"})]})]})]})}),(0,r.jsxs)(_.TabsContent,{value:"email-templates",className:"space-y-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Search Templates"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(O.Input,{placeholder:"Search templates...",value:s,onChange:e=>t(e.target.value),"data-testid":"input-search-templates"})})]}),b?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(o.Card,{"data-testid":"card-email-templates",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Email Templates"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Name"}),(0,r.jsx)(p.TableHead,{children:"Subject"}),(0,r.jsx)(p.TableHead,{children:"Type"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:y.length>0?y.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`template-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:e.name}),(0,r.jsx)(p.TableCell,{children:e.subject}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"outline",children:e.type})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-edit-template-${e.id}`,children:"Edit"}),(0,r.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-preview-template-${e.id}`,children:"Preview"})]})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"No templates found"})})})]})})})]})]}),(0,r.jsx)(_.TabsContent,{value:"feature-flags",className:"space-y-4",children:f?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(o.Card,{"data-testid":"card-feature-flags",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Feature Flags"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Feature"}),(0,r.jsx)(p.TableHead,{children:"Description"}),(0,r.jsx)(p.TableHead,{children:"Enabled"}),(0,r.jsx)(p.TableHead,{children:"Rollout %"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:N.length>0?N.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`flag-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:e.name}),(0,r.jsx)(p.TableCell,{children:e.description}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(as.Switch,{checked:e.enabled,onCheckedChange:a=>D.mutate({flagId:e.id,enabled:a}),"data-testid":`switch-flag-${e.id}`})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)("div",{className:"w-24",children:(0,r.jsx)(at.Slider,{defaultValue:[e.rolloutPercentage],max:100,step:1,"data-testid":`slider-rollout-${e.id}`})})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-configure-flag-${e.id}`,children:"Configure"})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No feature flags configured"})})})]})})})]})}),(0,r.jsx)(_.TabsContent,{value:"admin-roles",className:"space-y-4",children:w?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(o.Card,{"data-testid":"card-admin-roles",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Admin Roles & Permissions"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"User"}),(0,r.jsx)(p.TableHead,{children:"Email"}),(0,r.jsx)(p.TableHead,{children:"Role"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:S.length>0?S.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`admin-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:e.username}),(0,r.jsx)(p.TableCell,{children:e.email}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{children:e.role})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-edit-permissions-${e.id}`,children:"Edit Permissions"}),(0,r.jsx)(x.Button,{size:"sm",variant:"destructive","data-testid":`button-revoke-admin-${e.id}`,children:"Revoke"})]})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"No admins found"})})})]})})})]})})]})]})}function ar(){let[e,a]=(0,n.useState)("security-events"),[s,t]=(0,n.useState)("all"),[l,i]=(0,n.useState)("all"),[d,m]=(0,n.useState)("all"),[h,u]=(0,n.useState)("active"),[g,v]=(0,n.useState)(null),{toast:b}=(0,Y.useToast)(),{data:y,isLoading:C}=(0,j.useQuery)({queryKey:["/api/admin/security/events",{type:s,severity:l,resolved:d}]}),f=Array.isArray(y)?y:[],{data:N,isLoading:T}=(0,j.useQuery)({queryKey:["/api/admin/security/ip-bans",{status:h}]}),w=Array.isArray(N)?N:[],{data:S,isLoading:F}=(0,j.useQuery)({queryKey:["/api/admin/security/performance-metrics"]}),H=S||{cpu:0,memory:0,disk:0,network:0,responseTimeData:[],errorRateData:[],dbQueryTime:{avg:0,min:0,max:0},alerts:[]},R=(0,Q.useMutation)({mutationFn:async({eventId:e,notes:a})=>(0,ec.apiRequest)("POST",`/api/admin/security/events/${e}/resolve`,{notes:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/security/events"]}),b({title:"Event resolved successfully"}),v(null)},onError:()=>{b({title:"Failed to resolve event",variant:"destructive"})}}),I=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("POST","/api/admin/security/ip-bans",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/security/ip-bans"]}),b({title:"IP banned successfully"})},onError:()=>{b({title:"Failed to ban IP",variant:"destructive"})}}),B=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("DELETE",`/api/admin/security/ip-bans/${e}`),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/security/ip-bans"]}),b({title:"IP unbanned successfully"})},onError:()=>{b({title:"Failed to unban IP",variant:"destructive"})}}),E=e=>{switch(e){case"critical":case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Security & Safety"}),(0,r.jsxs)(_.Tabs,{value:e,onValueChange:a,"data-testid":"tabs-security",children:[(0,r.jsxs)(_.TabsList,{className:"grid w-full grid-cols-3",children:[(0,r.jsx)(_.TabsTrigger,{value:"security-events","data-testid":"tab-security-events",children:"Security Events"}),(0,r.jsx)(_.TabsTrigger,{value:"ip-bans","data-testid":"tab-ip-bans",children:"IP Bans"}),(0,r.jsx)(_.TabsTrigger,{value:"performance","data-testid":"tab-performance",children:"Performance Metrics"})]}),(0,r.jsxs)(_.TabsContent,{value:"security-events",className:"space-y-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Filters"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsxs)(W.Select,{value:s,onValueChange:t,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-type-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Event Type"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Types"}),(0,r.jsx)(W.SelectItem,{value:"login_attempt",children:"Login Attempt"}),(0,r.jsx)(W.SelectItem,{value:"suspicious_activity",children:"Suspicious Activity"}),(0,r.jsx)(W.SelectItem,{value:"data_breach",children:"Data Breach"})]})]}),(0,r.jsxs)(W.Select,{value:l,onValueChange:i,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-severity-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Severity"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Severities"}),(0,r.jsx)(W.SelectItem,{value:"critical",children:"Critical"}),(0,r.jsx)(W.SelectItem,{value:"high",children:"High"}),(0,r.jsx)(W.SelectItem,{value:"medium",children:"Medium"}),(0,r.jsx)(W.SelectItem,{value:"low",children:"Low"})]})]}),(0,r.jsxs)(W.Select,{value:d,onValueChange:m,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-resolved-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Status"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Status"}),(0,r.jsx)(W.SelectItem,{value:"resolved",children:"Resolved"}),(0,r.jsx)(W.SelectItem,{value:"unresolved",children:"Unresolved"})]})]})]})})]}),C?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(o.Card,{"data-testid":"card-security-events",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Security Events (",f.length,")"]})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Timestamp"}),(0,r.jsx)(p.TableHead,{children:"Type"}),(0,r.jsx)(p.TableHead,{children:"Severity"}),(0,r.jsx)(p.TableHead,{children:"Description"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:f.length>0?f.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`event-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:e.type}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:E(e.severity),children:e.severity})}),(0,r.jsx)(p.TableCell,{children:e.description}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:e.resolved?"secondary":"default",children:e.resolved?"Resolved":"Unresolved"})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>v(e),"data-testid":`button-view-event-${e.id}`,children:e.resolved?"View":"Resolve"})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No security events found"})})})]})})})]}),(0,r.jsx)(G.Dialog,{open:!!g,onOpenChange:()=>v(null),children:(0,r.jsxs)(G.DialogContent,{"data-testid":"dialog-event-detail",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Security Event Details"}),(0,r.jsxs)(G.DialogDescription,{children:["Event ID: ",g?.id]})]}),g&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Type"}),(0,r.jsx)("p",{className:"font-medium",children:g.type})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Severity"}),(0,r.jsx)(V.Badge,{variant:E(g.severity),children:g.severity})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Description"}),(0,r.jsx)("p",{children:g.description})]}),!g.resolved&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"resolution-notes",children:"Resolution Notes"}),(0,r.jsx)(z.Textarea,{id:"resolution-notes",placeholder:"Enter resolution notes...","data-testid":"textarea-resolution-notes"}),(0,r.jsx)(x.Button,{onClick:()=>{let e=document.getElementById("resolution-notes")?.value;R.mutate({eventId:g.id,notes:e})},disabled:R.isPending,"data-testid":"button-resolve-event",children:"Resolve Event"})]})]})]})})]}),(0,r.jsxs)(_.TabsContent,{value:"ip-bans",className:"space-y-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Add IP Ban"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsx)(O.Input,{placeholder:"IP Address",id:"ban-ip-address","data-testid":"input-ban-ip-address"}),(0,r.jsx)(O.Input,{placeholder:"Reason",id:"ban-reason","data-testid":"input-ban-reason"}),(0,r.jsxs)(W.Select,{defaultValue:"permanent",children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-ban-duration",children:(0,r.jsx)(W.SelectValue,{placeholder:"Duration"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"permanent",children:"Permanent"}),(0,r.jsx)(W.SelectItem,{value:"7",children:"7 Days"}),(0,r.jsx)(W.SelectItem,{value:"30",children:"30 Days"})]})]}),(0,r.jsx)(x.Button,{onClick:()=>{let e=document.getElementById("ban-ip-address")?.value,a=document.getElementById("ban-reason")?.value;I.mutate({ipAddress:e,reason:a,duration:0})},disabled:I.isPending,"data-testid":"button-add-ban",children:"Add Ban"})]})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-4 space-y-0",children:[(0,r.jsx)(o.CardTitle,{children:"IP Bans"}),(0,r.jsxs)(W.Select,{value:h,onValueChange:u,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-48","data-testid":"select-ban-status-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Filter"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All"}),(0,r.jsx)(W.SelectItem,{value:"active",children:"Active"}),(0,r.jsx)(W.SelectItem,{value:"expired",children:"Expired"})]})]})]}),(0,r.jsx)(o.CardContent,{children:T?(0,r.jsx)(c.Skeleton,{className:"h-64"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"IP Address"}),(0,r.jsx)(p.TableHead,{children:"Reason"}),(0,r.jsx)(p.TableHead,{children:"Banned By"}),(0,r.jsx)(p.TableHead,{children:"Banned At"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:w.length>0?w.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`ban-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:e.ipAddress}),(0,r.jsx)(p.TableCell,{children:e.reason}),(0,r.jsx)(p.TableCell,{children:e.bannedBy}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:e.active?"destructive":"secondary",children:e.active?"Active":"Expired"})}),(0,r.jsx)(p.TableCell,{children:e.active&&(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>B.mutate(e.id),disabled:B.isPending,"data-testid":`button-unban-${e.id}`,children:"Unban"})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No IP bans found"})})})]})})})]})]}),(0,r.jsx)(_.TabsContent,{value:"performance",className:"space-y-4",children:F?(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a))})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-cpu",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"CPU Usage"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-cpu",children:[H.cpu,"%"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Current usage"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-memory",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Memory"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-memory",children:[H.memory,"%"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Used"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-disk",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Disk"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-disk",children:[H.disk,"%"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Used"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-network",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Network"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-network",children:[H.network," MB/s"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Throughput"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-response-time",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Response Time (Last 24 Hours)"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(D.LineChart,{data:H.responseTimeData,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"time"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(A.Line,{type:"monotone",dataKey:"responseTime",stroke:"hsl(var(--primary))",strokeWidth:2})]})})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-error-rate",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Error Rate"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(D.LineChart,{data:H.errorRateData,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"time"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(A.Line,{type:"monotone",dataKey:"errors",stroke:"hsl(var(--destructive))",strokeWidth:2})]})})})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-db-metrics",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Database Query Time Metrics"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Average"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[H.dbQueryTime.avg,"ms"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Min"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[H.dbQueryTime.min,"ms"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Max"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:[H.dbQueryTime.max,"ms"]})]})]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-performance-alerts",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Performance Alerts"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Alert"}),(0,r.jsx)(p.TableHead,{children:"Severity"}),(0,r.jsx)(p.TableHead,{children:"Time"})]})}),(0,r.jsx)(p.TableBody,{children:H.alerts.length>0?H.alerts.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{children:e.message}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:E(e.severity),children:e.severity})}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.time),{addSuffix:!0})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:3,className:"text-center py-8 text-muted-foreground",children:"No performance alerts"})})})]})})})]})]})})]})]})}e.s(["default",()=>ai],63008),e.s(["default",()=>ar],49e3);var an=e.i(96112);function ad(){let[e,a]=(0,n.useState)("announcements"),[s,t]=(0,n.useState)(!1),{toast:l}=(0,Y.useToast)(),{data:i,isLoading:d}=(0,j.useQuery)({queryKey:["/api/admin/communications/announcements"]}),m=Array.isArray(i)?i:[],{data:h,isLoading:u}=(0,j.useQuery)({queryKey:["/api/admin/communications/campaigns"]}),g=Array.isArray(h)?h:[],{data:v,isLoading:b}=(0,j.useQuery)({queryKey:["/api/admin/communications/campaign-stats"]}),y=v||{sent:0,opened:0,openRate:0,clicked:0,clickRate:0,bounced:0,bounceRate:0},C=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("POST","/api/admin/communications/announcements",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/communications/announcements"]}),l({title:"Announcement created successfully"}),t(!1)},onError:()=>{l({title:"Failed to create announcement",variant:"destructive"})}}),f=(0,Q.useMutation)({mutationFn:async({id:e,active:a})=>(0,ec.apiRequest)("PUT",`/api/admin/communications/announcements/${e}`,{active:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/communications/announcements"]}),l({title:"Announcement updated"})},onError:()=>{l({title:"Failed to update announcement",variant:"destructive"})}}),N=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("DELETE",`/api/admin/communications/announcements/${e}`),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/communications/announcements"]}),l({title:"Announcement deleted"})},onError:()=>{l({title:"Failed to delete announcement",variant:"destructive"})}});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Communications"}),(0,r.jsxs)(_.Tabs,{value:e,onValueChange:a,"data-testid":"tabs-communications",children:[(0,r.jsxs)(_.TabsList,{className:"grid w-full grid-cols-2",children:[(0,r.jsx)(_.TabsTrigger,{value:"announcements","data-testid":"tab-announcements",children:"Announcements"}),(0,r.jsx)(_.TabsTrigger,{value:"email-campaigns","data-testid":"tab-email-campaigns",children:"Email Campaigns"})]}),(0,r.jsxs)(_.TabsContent,{value:"announcements",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Announcements"}),(0,r.jsxs)(G.Dialog,{open:s,onOpenChange:t,children:[(0,r.jsx)(G.DialogTrigger,{asChild:!0,children:(0,r.jsx)(x.Button,{"data-testid":"button-create-announcement",children:"Create Announcement"})}),(0,r.jsxs)(G.DialogContent,{"data-testid":"dialog-create-announcement",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsx)(G.DialogTitle,{children:"Create Announcement"}),(0,r.jsx)(G.DialogDescription,{children:"Create a new announcement for your users"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"announcement-title",children:"Title"}),(0,r.jsx)(O.Input,{id:"announcement-title",placeholder:"Announcement title","data-testid":"input-announcement-title"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"announcement-content",children:"Content"}),(0,r.jsx)(z.Textarea,{id:"announcement-content",placeholder:"Announcement content",rows:4,"data-testid":"textarea-announcement-content"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"announcement-type",children:"Type"}),(0,r.jsxs)(W.Select,{defaultValue:"info",children:[(0,r.jsx)(W.SelectTrigger,{id:"announcement-type","data-testid":"select-announcement-type",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select type"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"info",children:"Info"}),(0,r.jsx)(W.SelectItem,{value:"warning",children:"Warning"}),(0,r.jsx)(W.SelectItem,{value:"success",children:"Success"}),(0,r.jsx)(W.SelectItem,{value:"error",children:"Error"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"announcement-audience",children:"Target Audience"}),(0,r.jsxs)(W.Select,{defaultValue:"all",children:[(0,r.jsx)(W.SelectTrigger,{id:"announcement-audience","data-testid":"select-announcement-audience",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select audience"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Users"}),(0,r.jsx)(W.SelectItem,{value:"premium",children:"Premium Users"}),(0,r.jsx)(W.SelectItem,{value:"free",children:"Free Users"}),(0,r.jsx)(W.SelectItem,{value:"sellers",children:"Sellers"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"announcement-display",children:"Display Type"}),(0,r.jsxs)(W.Select,{defaultValue:"banner",children:[(0,r.jsx)(W.SelectTrigger,{id:"announcement-display","data-testid":"select-announcement-display",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select display type"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"banner",children:"Banner"}),(0,r.jsx)(W.SelectItem,{value:"modal",children:"Modal"}),(0,r.jsx)(W.SelectItem,{value:"toast",children:"Toast"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"announcement-start",children:"Start Date"}),(0,r.jsx)(O.Input,{id:"announcement-start",type:"date","data-testid":"input-announcement-start"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"announcement-end",children:"End Date"}),(0,r.jsx)(O.Input,{id:"announcement-end",type:"date","data-testid":"input-announcement-end"})]})]}),(0,r.jsx)(x.Button,{onClick:()=>{let e=document.getElementById("announcement-title")?.value,a=document.getElementById("announcement-content")?.value;C.mutate({title:e,content:a,type:"info",audience:"all"})},disabled:C.isPending,"data-testid":"button-submit-announcement",children:"Create Announcement"})]})]})]})]}),d?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsx)(o.Card,{"data-testid":"card-announcements",children:(0,r.jsx)(o.CardContent,{className:"p-0",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Title"}),(0,r.jsx)(p.TableHead,{children:"Type"}),(0,r.jsx)(p.TableHead,{children:"Audience"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Views"}),(0,r.jsx)(p.TableHead,{children:"Clicks"}),(0,r.jsx)(p.TableHead,{children:"Created"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:m.length>0?m.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`announcement-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:e.title}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"outline",children:e.type})}),(0,r.jsx)(p.TableCell,{children:e.audience}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(as.Switch,{checked:e.active,onCheckedChange:a=>f.mutate({id:e.id,active:a}),"data-testid":`switch-announcement-${e.id}`})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(ep.Eye,{className:"h-4 w-4"}),e.views||0]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(an.MousePointer,{className:"h-4 w-4"}),e.clicks||0]})}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-edit-announcement-${e.id}`,children:"Edit"}),(0,r.jsx)(x.Button,{size:"sm",variant:"destructive",onClick:()=>N.mutate(e.id),disabled:N.isPending,"data-testid":`button-delete-announcement-${e.id}`,children:"Delete"})]})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No announcements found"})})})]})})})})]}),(0,r.jsxs)(_.TabsContent,{value:"email-campaigns",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Email Campaigns"}),(0,r.jsx)(x.Button,{"data-testid":"button-create-campaign",children:"Create Campaign"})]}),b?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a))}):(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-sent",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Sent"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-sent",children:y.sent}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Emails sent"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-opened",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Opened"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-opened",children:y.opened}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[y.openRate,"% open rate"]})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-clicked",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Clicked"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-clicked",children:y.clicked}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[y.clickRate,"% click rate"]})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-bounced",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Bounced"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-bounced",children:y.bounced}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[y.bounceRate,"% bounce rate"]})]})]})]}),u?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(o.Card,{"data-testid":"card-campaigns",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Recent Campaigns"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Name"}),(0,r.jsx)(p.TableHead,{children:"Subject"}),(0,r.jsx)(p.TableHead,{children:"Sent"}),(0,r.jsx)(p.TableHead,{children:"Opened"}),(0,r.jsx)(p.TableHead,{children:"Clicked"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Created"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:g.length>0?g.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`campaign-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:e.name}),(0,r.jsx)(p.TableCell,{children:e.subject}),(0,r.jsx)(p.TableCell,{children:e.sent||0}),(0,r.jsx)(p.TableCell,{children:e.opened||0}),(0,r.jsx)(p.TableCell,{children:e.clicked||0}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"sent"===e.status?"default":"secondary",children:e.status})}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-view-campaign-${e.id}`,children:"View Report"})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No campaigns found"})})})]})})})]})]})]})]})}e.s(["default",()=>ad],91932);var ac=e.i(52540);function ao(){let[e,a]=(0,n.useState)("all"),[s,t]=(0,n.useState)("all"),[l,i]=(0,n.useState)("all"),[d,m]=(0,n.useState)(null),{toast:h}=(0,Y.useToast)(),{data:u,isLoading:g}=(0,j.useQuery)({queryKey:["/api/admin/support/tickets",{status:e,priority:s,category:l}]}),v=Array.isArray(u)?u:[],{data:b,isLoading:y}=(0,j.useQuery)({queryKey:["/api/admin/support/stats"]}),C=b||{openTickets:0,avgResponseTime:"0h",avgResolutionTime:"0h",satisfactionScore:0},f=(0,Q.useMutation)({mutationFn:async({ticketId:e,data:a})=>(0,ec.apiRequest)("PUT",`/api/admin/support/tickets/${e}`,a),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/support/tickets"]}),h({title:"Ticket updated successfully"})},onError:()=>{h({title:"Failed to update ticket",variant:"destructive"})}}),N=(0,Q.useMutation)({mutationFn:async({ticketId:e,message:a})=>(0,ec.apiRequest)("POST",`/api/admin/support/tickets/${e}/reply`,{message:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/support/tickets"]}),h({title:"Reply sent successfully"})},onError:()=>{h({title:"Failed to send reply",variant:"destructive"})}}),T=(0,Q.useMutation)({mutationFn:async e=>(0,ec.apiRequest)("POST",`/api/admin/support/tickets/${e}/close`),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/support/tickets"]}),h({title:"Ticket closed"}),m(null)},onError:()=>{h({title:"Failed to close ticket",variant:"destructive"})}}),w=e=>{switch(e){case"urgent":case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Support & Tickets"}),y?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a))}):(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-open-tickets",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Open Tickets"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-open-tickets",children:C.openTickets}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Awaiting response"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-avg-response-time",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Avg Response Time"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-response-time",children:C.avgResponseTime}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Time to first response"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-avg-resolution-time",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Avg Resolution Time"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-resolution-time",children:C.avgResolutionTime}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Time to close"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-satisfaction-score",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Satisfaction Score"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-satisfaction-score",children:[C.satisfactionScore,"%"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"User satisfaction"})]})]})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Filters"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsxs)(W.Select,{value:e,onValueChange:a,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-status-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Status"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Status"}),(0,r.jsx)(W.SelectItem,{value:"open",children:"Open"}),(0,r.jsx)(W.SelectItem,{value:"in_progress",children:"In Progress"}),(0,r.jsx)(W.SelectItem,{value:"resolved",children:"Resolved"}),(0,r.jsx)(W.SelectItem,{value:"closed",children:"Closed"})]})]}),(0,r.jsxs)(W.Select,{value:s,onValueChange:t,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-priority-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Priority"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Priorities"}),(0,r.jsx)(W.SelectItem,{value:"urgent",children:"Urgent"}),(0,r.jsx)(W.SelectItem,{value:"high",children:"High"}),(0,r.jsx)(W.SelectItem,{value:"medium",children:"Medium"}),(0,r.jsx)(W.SelectItem,{value:"low",children:"Low"})]})]}),(0,r.jsxs)(W.Select,{value:l,onValueChange:i,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-category-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Category"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Categories"}),(0,r.jsx)(W.SelectItem,{value:"technical",children:"Technical"}),(0,r.jsx)(W.SelectItem,{value:"billing",children:"Billing"}),(0,r.jsx)(W.SelectItem,{value:"general",children:"General"})]})]})]})})]}),g?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(o.Card,{"data-testid":"card-tickets",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Support Tickets (",v.length,")"]})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Ticket #"}),(0,r.jsx)(p.TableHead,{children:"User"}),(0,r.jsx)(p.TableHead,{children:"Subject"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Priority"}),(0,r.jsx)(p.TableHead,{children:"Created"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:v.length>0?v.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`ticket-${e.id}`,children:[(0,r.jsxs)(p.TableCell,{children:["#",e.id]}),(0,r.jsx)(p.TableCell,{children:e.username}),(0,r.jsx)(p.TableCell,{children:e.subject}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"outline",children:e.status})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:w(e.priority),children:e.priority})}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>m(e),"data-testid":`button-view-ticket-${e.id}`,children:"View"})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No tickets found"})})})]})})})]}),(0,r.jsx)(G.Dialog,{open:!!d,onOpenChange:()=>m(null),children:(0,r.jsxs)(G.DialogContent,{className:"max-w-3xl","data-testid":"dialog-ticket-detail",children:[(0,r.jsxs)(G.DialogHeader,{children:[(0,r.jsxs)(G.DialogTitle,{children:["Ticket #",d?.id]}),(0,r.jsx)(G.DialogDescription,{children:d?.subject})]}),d&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"User"}),(0,r.jsx)("p",{className:"font-medium",children:d.username})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,r.jsx)(V.Badge,{variant:"outline",children:d.status})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Priority"}),(0,r.jsx)(V.Badge,{variant:w(d.priority),children:d.priority})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Category"}),(0,r.jsx)("p",{className:"font-medium",children:d.category||"N/A"})]})]}),(0,r.jsx)(ac.Separator,{}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{children:"Conversation"}),(0,r.jsx)("div",{className:"border rounded-md p-4 space-y-4 max-h-96 overflow-y-auto",children:d.messages&&d.messages.length>0?d.messages.map(e=>(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("p",{className:"font-medium",children:e.sender}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,r.jsx)("p",{className:"text-sm",children:e.content}),(0,r.jsx)(ac.Separator,{className:"mt-2"})]},e.id)):(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages yet"})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"reply-message",children:"Reply"}),(0,r.jsx)(z.Textarea,{id:"reply-message",placeholder:"Type your reply...",rows:4,"data-testid":"textarea-reply"}),(0,r.jsx)(x.Button,{onClick:()=>{let e=document.getElementById("reply-message")?.value;N.mutate({ticketId:d.id,message:e})},disabled:N.isPending,"data-testid":"button-send-reply",children:"Send Reply"})]}),(0,r.jsx)(ac.Separator,{}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"assign-admin",children:"Assign to Admin"}),(0,r.jsxs)(W.Select,{children:[(0,r.jsx)(W.SelectTrigger,{id:"assign-admin","data-testid":"select-assign-admin",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select admin"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"admin1",children:"Admin 1"}),(0,r.jsx)(W.SelectItem,{value:"admin2",children:"Admin 2"})]})]})]}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"update-status",children:"Update Status"}),(0,r.jsxs)(W.Select,{defaultValue:d.status,onValueChange:e=>{f.mutate({ticketId:d.id,data:{status:e}})},children:[(0,r.jsx)(W.SelectTrigger,{id:"update-status","data-testid":"select-update-status",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select status"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"open",children:"Open"}),(0,r.jsx)(W.SelectItem,{value:"in_progress",children:"In Progress"}),(0,r.jsx)(W.SelectItem,{value:"resolved",children:"Resolved"}),(0,r.jsx)(W.SelectItem,{value:"closed",children:"Closed"})]})]})]})]}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)(x.Button,{variant:"destructive",onClick:()=>T.mutate(d.id),disabled:T.isPending,"data-testid":"button-close-ticket",children:"Close Ticket"})}),d.tags&&d.tags.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{children:"Tags"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:d.tags.map((e,a)=>(0,r.jsx)(V.Badge,{variant:"secondary",children:e},a))})]})]})]})})]})}function ax(){let[e,a]=(0,n.useState)("admin-actions"),[s,t]=(0,n.useState)("all"),[l,i]=(0,n.useState)("all"),[d,m]=(0,n.useState)("all"),[h,u]=(0,n.useState)(""),[g,v]=(0,n.useState)("all"),[b,y]=(0,n.useState)("all"),[C,f]=(0,n.useState)("all"),{data:N,isLoading:T}=(0,j.useQuery)({queryKey:["/api/admin/logs/admin-actions",{admin:s,actionType:l,targetType:d,search:h}]}),w=Array.isArray(N)?N:[],{data:S,isLoading:D}=(0,j.useQuery)({queryKey:["/api/admin/logs/security",{severity:g,eventType:C}]}),A=Array.isArray(S)?S:[],{data:F,isLoading:H}=(0,j.useQuery)({queryKey:["/api/admin/logs/performance",{metricType:b}]}),R=F??{aggregations:{avg:0,min:0,max:0},logs:[]},{data:I,isLoading:B}=(0,j.useQuery)({queryKey:["/api/admin/logs/system-events",{severity:g,eventType:C}]}),q=Array.isArray(I)?I:[],L=e=>{console.log(`Exporting logs as ${e}`)},P=e=>{switch(e){case"critical":case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Audit Logs"}),(0,r.jsxs)(_.Tabs,{value:e,onValueChange:a,"data-testid":"tabs-logs",children:[(0,r.jsxs)(_.TabsList,{className:"grid w-full grid-cols-4",children:[(0,r.jsx)(_.TabsTrigger,{value:"admin-actions","data-testid":"tab-admin-actions",children:"Admin Actions"}),(0,r.jsx)(_.TabsTrigger,{value:"security","data-testid":"tab-security-logs",children:"Security Logs"}),(0,r.jsx)(_.TabsTrigger,{value:"performance","data-testid":"tab-performance-logs",children:"Performance Logs"}),(0,r.jsx)(_.TabsTrigger,{value:"system","data-testid":"tab-system-events",children:"System Events"})]}),(0,r.jsxs)(_.TabsContent,{value:"admin-actions",className:"space-y-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Filters & Search"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[(0,r.jsx)(O.Input,{placeholder:"Search logs...",value:h,onChange:e=>{let a=e.target.value;setTimeout(()=>u(a),300)},"data-testid":"input-search-logs"}),(0,r.jsxs)(W.Select,{value:s,onValueChange:t,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-admin-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Admin User"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Admins"}),(0,r.jsx)(W.SelectItem,{value:"admin1",children:"Admin 1"}),(0,r.jsx)(W.SelectItem,{value:"admin2",children:"Admin 2"})]})]}),(0,r.jsxs)(W.Select,{value:l,onValueChange:i,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-action-type-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Action Type"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Actions"}),(0,r.jsx)(W.SelectItem,{value:"create",children:"Create"}),(0,r.jsx)(W.SelectItem,{value:"update",children:"Update"}),(0,r.jsx)(W.SelectItem,{value:"delete",children:"Delete"})]})]}),(0,r.jsxs)(W.Select,{value:d,onValueChange:m,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-target-type-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Target Type"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Targets"}),(0,r.jsx)(W.SelectItem,{value:"user",children:"User"}),(0,r.jsx)(W.SelectItem,{value:"content",children:"Content"}),(0,r.jsx)(W.SelectItem,{value:"settings",children:"Settings"})]})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsx)(O.Input,{type:"date",placeholder:"Start Date",className:"w-full md:w-auto","data-testid":"input-start-date"}),(0,r.jsx)(O.Input,{type:"date",placeholder:"End Date",className:"w-full md:w-auto","data-testid":"input-end-date"}),(0,r.jsxs)("div",{className:"flex gap-2 ml-auto",children:[(0,r.jsxs)(x.Button,{variant:"outline",onClick:()=>L("csv"),"data-testid":"button-export-csv",children:[(0,r.jsx)(et.Download,{className:"h-4 w-4 mr-1"}),"CSV"]}),(0,r.jsxs)(x.Button,{variant:"outline",onClick:()=>L("json"),"data-testid":"button-export-json",children:[(0,r.jsx)(et.Download,{className:"h-4 w-4 mr-1"}),"JSON"]})]})]})]})]}),T?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(o.Card,{"data-testid":"card-admin-logs",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Admin Action Logs (",w.length,")"]})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Timestamp"}),(0,r.jsx)(p.TableHead,{children:"Admin"}),(0,r.jsx)(p.TableHead,{children:"Action Type"}),(0,r.jsx)(p.TableHead,{children:"Target"}),(0,r.jsx)(p.TableHead,{children:"Details"}),(0,r.jsx)(p.TableHead,{children:"IP Address"})]})}),(0,r.jsx)(p.TableBody,{children:w.length>0?w.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`log-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:e.adminUsername}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"outline",children:e.actionType})}),(0,r.jsx)(p.TableCell,{children:e.targetType}),(0,r.jsx)(p.TableCell,{children:e.details}),(0,r.jsx)(p.TableCell,{children:e.ipAddress})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No logs found"})})})]})})})]})]}),(0,r.jsxs)(_.TabsContent,{value:"security",className:"space-y-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Filters"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsxs)(W.Select,{value:g,onValueChange:v,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-security-severity-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Severity"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Severities"}),(0,r.jsx)(W.SelectItem,{value:"critical",children:"Critical"}),(0,r.jsx)(W.SelectItem,{value:"high",children:"High"}),(0,r.jsx)(W.SelectItem,{value:"medium",children:"Medium"}),(0,r.jsx)(W.SelectItem,{value:"low",children:"Low"})]})]}),(0,r.jsxs)(W.Select,{value:C,onValueChange:f,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-security-event-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Event Type"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Events"}),(0,r.jsx)(W.SelectItem,{value:"login",children:"Login"}),(0,r.jsx)(W.SelectItem,{value:"access",children:"Access"}),(0,r.jsx)(W.SelectItem,{value:"breach",children:"Breach"})]})]})]})})]}),D?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(o.Card,{"data-testid":"card-security-logs",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Security Event Logs (",A.length,")"]})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Timestamp"}),(0,r.jsx)(p.TableHead,{children:"Event Type"}),(0,r.jsx)(p.TableHead,{children:"Severity"}),(0,r.jsx)(p.TableHead,{children:"Description"}),(0,r.jsx)(p.TableHead,{children:"User"}),(0,r.jsx)(p.TableHead,{children:"IP Address"})]})}),(0,r.jsx)(p.TableBody,{children:A.length>0?A.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`security-log-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:e.eventType}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:P(e.severity),children:e.severity})}),(0,r.jsx)(p.TableCell,{children:e.description}),(0,r.jsx)(p.TableCell,{children:e.username||"N/A"}),(0,r.jsx)(p.TableCell,{children:e.ipAddress})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No security logs found"})})})]})})})]})]}),(0,r.jsxs)(_.TabsContent,{value:"performance",className:"space-y-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Filters"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsxs)(W.Select,{value:b,onValueChange:y,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-metric-type-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Metric Type"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Metrics"}),(0,r.jsx)(W.SelectItem,{value:"cpu",children:"CPU"}),(0,r.jsx)(W.SelectItem,{value:"memory",children:"Memory"}),(0,r.jsx)(W.SelectItem,{value:"response_time",children:"Response Time"})]})]}),(0,r.jsx)(O.Input,{type:"date",placeholder:"Start Date","data-testid":"input-perf-start-date"}),(0,r.jsx)(O.Input,{type:"date",placeholder:"End Date","data-testid":"input-perf-end-date"})]})})]}),H?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-avg-metric",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Average"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-metric",children:R.aggregations?.avg||0}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Average value"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-min-metric",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Minimum"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-min-metric",children:R.aggregations?.min||0}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Minimum value"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-max-metric",children:[(0,r.jsx)(o.CardHeader,{className:"pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Maximum"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-max-metric",children:R.aggregations?.max||0}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Maximum value"})]})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-performance-logs",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["Performance Metrics (",R.logs.length,")"]})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Timestamp"}),(0,r.jsx)(p.TableHead,{children:"Metric Type"}),(0,r.jsx)(p.TableHead,{children:"Value"}),(0,r.jsx)(p.TableHead,{children:"Unit"}),(0,r.jsx)(p.TableHead,{children:"Status"})]})}),(0,r.jsx)(p.TableBody,{children:R.logs.length>0?R.logs.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`perf-log-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:e.metricType}),(0,r.jsx)(p.TableCell,{children:e.value}),(0,r.jsx)(p.TableCell,{children:e.unit}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"normal"===e.status?"secondary":"destructive",children:e.status})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No performance logs found"})})})]})})})]})]})]}),(0,r.jsxs)(_.TabsContent,{value:"system",className:"space-y-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Filters"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,r.jsxs)(W.Select,{value:C,onValueChange:f,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-system-event-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Event Type"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Events"}),(0,r.jsx)(W.SelectItem,{value:"startup",children:"Startup"}),(0,r.jsx)(W.SelectItem,{value:"shutdown",children:"Shutdown"}),(0,r.jsx)(W.SelectItem,{value:"error",children:"Error"})]})]}),(0,r.jsxs)(W.Select,{value:g,onValueChange:v,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-system-severity-filter",children:(0,r.jsx)(W.SelectValue,{placeholder:"Severity"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Severities"}),(0,r.jsx)(W.SelectItem,{value:"critical",children:"Critical"}),(0,r.jsx)(W.SelectItem,{value:"high",children:"High"}),(0,r.jsx)(W.SelectItem,{value:"medium",children:"Medium"}),(0,r.jsx)(W.SelectItem,{value:"low",children:"Low"})]})]})]})})]}),B?(0,r.jsx)(c.Skeleton,{className:"h-96"}):(0,r.jsxs)(o.Card,{"data-testid":"card-system-events",children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{children:["System Events (",q.length,")"]})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Timestamp"}),(0,r.jsx)(p.TableHead,{children:"Event Type"}),(0,r.jsx)(p.TableHead,{children:"Severity"}),(0,r.jsx)(p.TableHead,{children:"Description"}),(0,r.jsx)(p.TableHead,{children:"Component"})]})}),(0,r.jsx)(p.TableBody,{children:q.length>0?q.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`system-event-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:e.eventType}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:P(e.severity),children:e.severity})}),(0,r.jsx)(p.TableCell,{children:e.description}),(0,r.jsx)(p.TableCell,{children:e.component})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No system events found"})})})]})})})]})]})]})]})}e.s(["default",()=>ao],65061),e.s(["default",()=>ax],19217);let am=(0,a.default)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);function ah(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)(!1),[t,l]=(0,n.useState)([70]),{data:i,isLoading:d}=(0,j.useQuery)({queryKey:["/api/admin/automation/rules"]}),m=Array.isArray(i)?i:[],{data:h,isLoading:u}=(0,j.useQuery)({queryKey:["/api/admin/ai/moderation-stats"]}),g=h||{accuracyRate:0,falsePositives:0,falseNegatives:0,timeSavedHours:0},{data:v,isLoading:b}=(0,j.useQuery)({queryKey:["/api/admin/ai/moderation-decisions"]}),y=Array.isArray(v)?v:[],{data:C,isLoading:f}=(0,j.useQuery)({queryKey:["/api/admin/ai/sentiment-distribution"]}),N=Array.isArray(C)?C:[],{data:T,isLoading:w}=(0,j.useQuery)({queryKey:["/api/admin/ai/spam-metrics"]}),S=T||{accuracy:0,blocked:0,flagged:0},{data:D,isLoading:A}=(0,j.useQuery)({queryKey:["/api/admin/ai/flagged-content"]}),F=Array.isArray(D)?D:[],H=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/automation/rules","POST",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/automation/rules"]}),e({title:"Rule created successfully"}),s(!1)}}),q=(0,Q.useMutation)({mutationFn:({id:e,enabled:a})=>(0,ec.apiRequest)(`/api/admin/automation/rules/${e}`,"PATCH",{enabled:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/automation/rules"]}),e({title:"Rule updated"})}}),L=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)(`/api/admin/automation/rules/${e}/execute`,"POST"),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/automation/rules"]}),e({title:"Rule executed successfully"})}}),P=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)(`/api/admin/ai/moderation-decisions/${e}/override`,"POST"),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/ai/moderation-decisions"]}),e({title:"Decision overridden"})}}),$=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/ai/spam-sensitivity","PATCH",{sensitivity:e}),onSuccess:()=>{e({title:"Sensitivity updated"})}}),U=["hsl(var(--primary))","hsl(var(--accent))","hsl(var(--muted))"];return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"AI & Automation"}),(0,r.jsxs)(_.Tabs,{defaultValue:"automation",className:"space-y-4",children:[(0,r.jsxs)(_.TabsList,{children:[(0,r.jsx)(_.TabsTrigger,{value:"automation","data-testid":"tab-automation",children:"Automation Rules"}),(0,r.jsx)(_.TabsTrigger,{value:"moderation","data-testid":"tab-moderation",children:"Content Moderation AI"}),(0,r.jsx)(_.TabsTrigger,{value:"spam","data-testid":"tab-spam",children:"Spam Detection"})]}),(0,r.jsxs)(_.TabsContent,{value:"automation",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Automation Rules"}),(0,r.jsxs)(G.Dialog,{open:a,onOpenChange:s,children:[(0,r.jsx)(G.DialogTrigger,{asChild:!0,children:(0,r.jsx)(x.Button,{"data-testid":"button-create-rule",children:"Create Rule"})}),(0,r.jsxs)(G.DialogContent,{className:"max-w-2xl",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Create Automation Rule"})}),(0,r.jsxs)("form",{onSubmit:a=>{a.preventDefault();let s=new FormData(a.currentTarget),t=s.get("triggerConfig"),l=s.get("actionConfig");try{JSON.parse(t),JSON.parse(l)}catch(a){e({title:"Invalid JSON in configuration",variant:"destructive"});return}H.mutate({name:s.get("name"),triggerType:s.get("triggerType"),triggerConfig:t,actionType:s.get("actionType"),actionConfig:l})},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"name",children:"Rule Name"}),(0,r.jsx)(O.Input,{id:"name",name:"name",required:!0,"data-testid":"input-rule-name"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"triggerType",children:"Trigger Type"}),(0,r.jsxs)(W.Select,{name:"triggerType",required:!0,children:[(0,r.jsx)(W.SelectTrigger,{"data-testid":"select-trigger-type",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select trigger type"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"user_signup",children:"User Signup"}),(0,r.jsx)(W.SelectItem,{value:"content_published",children:"Content Published"}),(0,r.jsx)(W.SelectItem,{value:"time_based",children:"Time Based"}),(0,r.jsx)(W.SelectItem,{value:"threshold_reached",children:"Threshold Reached"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"triggerConfig",children:"Trigger Configuration (JSON)"}),(0,r.jsx)(z.Textarea,{id:"triggerConfig",name:"triggerConfig",placeholder:'{"key": "value"}',className:"font-mono text-sm",required:!0,"data-testid":"textarea-trigger-config"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"actionType",children:"Action Type"}),(0,r.jsxs)(W.Select,{name:"actionType",required:!0,children:[(0,r.jsx)(W.SelectTrigger,{"data-testid":"select-action-type",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select action type"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"send_email",children:"Send Email"}),(0,r.jsx)(W.SelectItem,{value:"create_notification",children:"Create Notification"}),(0,r.jsx)(W.SelectItem,{value:"award_coins",children:"Award Coins"}),(0,r.jsx)(W.SelectItem,{value:"assign_badge",children:"Assign Badge"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"actionConfig",children:"Action Configuration (JSON)"}),(0,r.jsx)(z.Textarea,{id:"actionConfig",name:"actionConfig",placeholder:'{"key": "value"}',className:"font-mono text-sm",required:!0,"data-testid":"textarea-action-config"})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{type:"submit",disabled:H.isPending,"data-testid":"button-submit-rule",children:H.isPending?"Creating...":"Create Rule"})})]})]})]})]}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:d?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Name"}),(0,r.jsx)(p.TableHead,{children:"Trigger"}),(0,r.jsx)(p.TableHead,{children:"Action"}),(0,r.jsx)(p.TableHead,{children:"Executions"}),(0,r.jsx)(p.TableHead,{children:"Last Executed"}),(0,r.jsx)(p.TableHead,{children:"Enabled"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsxs)(p.TableBody,{children:[m.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`rule-${e.id}`,children:[(0,r.jsx)(p.TableCell,{"data-testid":`rule-name-${e.id}`,children:e.name}),(0,r.jsx)(p.TableCell,{children:e.triggerType}),(0,r.jsx)(p.TableCell,{children:e.actionType}),(0,r.jsx)(p.TableCell,{children:e.executionCount||0}),(0,r.jsx)(p.TableCell,{children:e.lastExecutedAt?(0,k.formatDistanceToNow)(new Date(e.lastExecutedAt),{addSuffix:!0}):"Never"}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(as.Switch,{checked:e.enabled,onCheckedChange:a=>q.mutate({id:e.id,enabled:a}),"data-testid":`switch-rule-${e.id}`})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>L.mutate(e.id),disabled:L.isPending,"data-testid":`button-execute-${e.id}`,children:[(0,r.jsx)(am,{className:"w-3 h-3 mr-1"}),"Execute"]})})]},e.id)),0===m.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No automation rules created"})})]})]})})})})]}),(0,r.jsxs)(_.TabsContent,{value:"moderation",className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Content Moderation AI"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:u?[void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a)):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.Card,{"data-testid":"card-accuracy-rate",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Accuracy Rate"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-accuracy-rate",children:[g.accuracyRate,"%"]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-false-positives",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"False Positives"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-false-positives",children:g.falsePositives})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-false-negatives",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"False Negatives"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-false-negatives",children:g.falseNegatives})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-time-saved",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Time Saved"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-time-saved",children:[g.timeSavedHours,"h"]})})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Recent AI Decisions"})}),(0,r.jsx)(o.CardContent,{children:b?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Content"}),(0,r.jsx)(p.TableHead,{children:"Decision"}),(0,r.jsx)(p.TableHead,{children:"Confidence"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsxs)(p.TableBody,{children:[y.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{className:"max-w-xs truncate",children:e.contentPreview}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"approved"===e.decision?"default":"destructive",children:e.decision})}),(0,r.jsxs)(p.TableCell,{children:[e.confidence,"%"]}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>P.mutate(e.id),"data-testid":`button-override-${e.id}`,children:"Override"})})]},e.id)),0===y.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No recent decisions"})})]})]})})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Sentiment Distribution"})}),(0,r.jsx)(o.CardContent,{children:f?(0,r.jsx)(c.Skeleton,{className:"h-64"}):N.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(R.PieChart,{children:[(0,r.jsx)(I.Pie,{data:N,cx:"50%",cy:"50%",labelLine:!1,label:e=>e.name,outerRadius:80,fill:"hsl(var(--primary))",dataKey:"value",children:N.map((e,a)=>(0,r.jsx)(B.Cell,{fill:U[a%U.length]},`cell-${a}`))}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(E.Legend,{})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]}),(0,r.jsxs)(_.TabsContent,{value:"spam",className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Spam Detection"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:w?[void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a)):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.Card,{"data-testid":"card-spam-accuracy",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Detection Accuracy"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-spam-accuracy",children:[S.accuracy,"%"]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-spam-blocked",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Spam Blocked"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-spam-blocked",children:S.blocked})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-spam-flagged",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Currently Flagged"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-spam-flagged",children:S.flagged})})]})]})}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Adjust Sensitivity"})}),(0,r.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(al.Label,{children:["Sensitivity Level: ",t[0],"%"]}),(0,r.jsx)(at.Slider,{value:t,onValueChange:l,max:100,step:1,"data-testid":"slider-sensitivity"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Higher values will flag more content as potential spam"})]}),(0,r.jsx)(x.Button,{onClick:()=>$.mutate(t[0]),disabled:$.isPending,"data-testid":"button-update-sensitivity",children:"Update Sensitivity"})]})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Flagged Content"})}),(0,r.jsx)(o.CardContent,{children:A?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Content"}),(0,r.jsx)(p.TableHead,{children:"Spam Score"}),(0,r.jsx)(p.TableHead,{children:"Author"}),(0,r.jsx)(p.TableHead,{children:"Flagged At"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsxs)(p.TableBody,{children:[F.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{className:"max-w-xs truncate",children:e.contentPreview}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:e.spamScore>80?"destructive":"secondary",children:[e.spamScore,"%"]})}),(0,r.jsx)(p.TableCell,{children:e.authorUsername}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.flaggedAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"outline","data-testid":`button-approve-${e.id}`,children:"Approve"})})]},e.id)),0===F.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No flagged content"})})]})]})})})]})]})]})]})}e.s(["default",()=>ah],7285);var au=e.i(42009);function aj(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)(!1),[t,l]=(0,n.useState)(!1),[i,d]=(0,n.useState)("contributors"),[m,h]=(0,n.useState)("all-time"),{data:u,isLoading:g}=(0,j.useQuery)({queryKey:["/api/admin/gamification/badges"]}),v=Array.isArray(u)?u:[],{data:b,isLoading:y}=(0,j.useQuery)({queryKey:["/api/admin/gamification/achievements"]}),C=Array.isArray(b)?b:[],{data:f,isLoading:N}=(0,j.useQuery)({queryKey:["/api/admin/gamification/leaderboard",i,m]}),T=Array.isArray(f)?f:[],{data:w,isLoading:S}=(0,j.useQuery)({queryKey:["/api/admin/gamification/goals"]}),k=Array.isArray(w)?w:[],{data:R,isLoading:I}=(0,j.useQuery)({queryKey:["/api/admin/gamification/goal-completion"]}),B=Array.isArray(R)?R:[],E=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/gamification/badges","POST",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/gamification/badges"]}),e({title:"Badge created successfully"}),s(!1)}}),$=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/gamification/achievements","POST",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/gamification/achievements"]}),e({title:"Achievement created successfully"}),l(!1)}});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Gamification"}),(0,r.jsxs)(_.Tabs,{defaultValue:"badges",className:"space-y-4",children:[(0,r.jsxs)(_.TabsList,{children:[(0,r.jsx)(_.TabsTrigger,{value:"badges","data-testid":"tab-badges",children:"Badges"}),(0,r.jsx)(_.TabsTrigger,{value:"achievements","data-testid":"tab-achievements",children:"Achievements"}),(0,r.jsx)(_.TabsTrigger,{value:"leaderboards","data-testid":"tab-leaderboards",children:"Leaderboards"}),(0,r.jsx)(_.TabsTrigger,{value:"goals","data-testid":"tab-goals",children:"Goals"})]}),(0,r.jsxs)(_.TabsContent,{value:"badges",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Badges"}),(0,r.jsxs)(G.Dialog,{open:a,onOpenChange:s,children:[(0,r.jsx)(G.DialogTrigger,{asChild:!0,children:(0,r.jsx)(x.Button,{"data-testid":"button-create-badge",children:"Create Badge"})}),(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Create New Badge"})}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);E.mutate({name:a.get("name"),description:a.get("description"),imageUrl:a.get("imageUrl"),rarity:a.get("rarity")})},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"name",children:"Badge Name"}),(0,r.jsx)(O.Input,{id:"name",name:"name",required:!0,"data-testid":"input-badge-name"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"description",children:"Description"}),(0,r.jsx)(O.Input,{id:"description",name:"description",required:!0,"data-testid":"input-badge-description"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"imageUrl",children:"Image URL"}),(0,r.jsx)(O.Input,{id:"imageUrl",name:"imageUrl",type:"url",required:!0,"data-testid":"input-badge-image"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"rarity",children:"Rarity"}),(0,r.jsxs)(W.Select,{name:"rarity",required:!0,children:[(0,r.jsx)(W.SelectTrigger,{"data-testid":"select-badge-rarity",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select rarity"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"common",children:"Common"}),(0,r.jsx)(W.SelectItem,{value:"rare",children:"Rare"}),(0,r.jsx)(W.SelectItem,{value:"epic",children:"Epic"}),(0,r.jsx)(W.SelectItem,{value:"legendary",children:"Legendary"})]})]})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{type:"submit",disabled:E.isPending,"data-testid":"button-submit-badge",children:E.isPending?"Creating...":"Create Badge"})})]})]})]})]}),g?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-48"},a))}):(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[v.map(e=>(0,r.jsxs)(o.Card,{"data-testid":`badge-card-${e.id}`,children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center gap-4",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-muted rounded-lg flex items-center justify-center",children:e.imageUrl?(0,r.jsx)("img",{src:e.imageUrl,alt:e.name,className:"w-12 h-12"}):(0,r.jsx)(au.Award,{className:"w-8 h-8"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(o.CardTitle,{className:"text-lg","data-testid":`badge-name-${e.id}`,children:e.name}),(0,r.jsx)(V.Badge,{variant:"secondary",children:e.rarity})]})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})}),(0,r.jsx)(o.CardFooter,{className:"flex justify-between gap-2",children:(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-semibold",children:e.totalEarned||0})," earned"]})})]},e.id)),0===v.length&&(0,r.jsx)("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:"No badges created yet"})]})]}),(0,r.jsxs)(_.TabsContent,{value:"achievements",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Achievements"}),(0,r.jsxs)(G.Dialog,{open:t,onOpenChange:l,children:[(0,r.jsx)(G.DialogTrigger,{asChild:!0,children:(0,r.jsx)(x.Button,{"data-testid":"button-create-achievement",children:"Create Achievement"})}),(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Create New Achievement"})}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);$.mutate({name:a.get("name"),description:a.get("description"),criteria:a.get("criteria"),rewardCoins:parseInt(a.get("rewardCoins"))})},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"ach-name",children:"Achievement Name"}),(0,r.jsx)(O.Input,{id:"ach-name",name:"name",required:!0,"data-testid":"input-achievement-name"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"ach-description",children:"Description"}),(0,r.jsx)(O.Input,{id:"ach-description",name:"description",required:!0,"data-testid":"input-achievement-description"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"criteria",children:"Criteria"}),(0,r.jsx)(O.Input,{id:"criteria",name:"criteria",required:!0,"data-testid":"input-achievement-criteria"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"rewardCoins",children:"Reward Coins"}),(0,r.jsx)(O.Input,{id:"rewardCoins",name:"rewardCoins",type:"number",required:!0,"data-testid":"input-achievement-reward"})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{type:"submit",disabled:$.isPending,"data-testid":"button-submit-achievement",children:$.isPending?"Creating...":"Create Achievement"})})]})]})]})]}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:y?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Name"}),(0,r.jsx)(p.TableHead,{children:"Description"}),(0,r.jsx)(p.TableHead,{children:"Criteria"}),(0,r.jsx)(p.TableHead,{children:"Reward"}),(0,r.jsx)(p.TableHead,{children:"Completion Rate"})]})}),(0,r.jsxs)(p.TableBody,{children:[C.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`achievement-${e.id}`,children:[(0,r.jsx)(p.TableCell,{className:"font-medium","data-testid":`achievement-name-${e.id}`,children:e.name}),(0,r.jsx)(p.TableCell,{children:e.description}),(0,r.jsx)(p.TableCell,{children:e.criteria}),(0,r.jsxs)(p.TableCell,{children:[e.rewardCoins," coins"]}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"secondary",children:[e.completionRate||0,"%"]})})]},e.id)),0===C.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No achievements created"})})]})]})})})})]}),(0,r.jsxs)(_.TabsContent,{value:"leaderboards",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Leaderboards"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsxs)(W.Select,{value:i,onValueChange:d,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-48","data-testid":"select-leaderboard-type",children:(0,r.jsx)(W.SelectValue,{})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"contributors",children:"Top Contributors"}),(0,r.jsx)(W.SelectItem,{value:"earners",children:"Top Earners"}),(0,r.jsx)(W.SelectItem,{value:"uploaders",children:"Top Uploaders"})]})]}),(0,r.jsxs)(W.Select,{value:m,onValueChange:h,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-40","data-testid":"select-time-period",children:(0,r.jsx)(W.SelectValue,{})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"weekly",children:"Weekly"}),(0,r.jsx)(W.SelectItem,{value:"monthly",children:"Monthly"}),(0,r.jsx)(W.SelectItem,{value:"all-time",children:"All Time"})]})]})]})]}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:N?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[...Array(10)].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{className:"w-20",children:"Rank"}),(0,r.jsx)(p.TableHead,{children:"User"}),(0,r.jsx)(p.TableHead,{children:"Score"})]})}),(0,r.jsxs)(p.TableBody,{children:[T.map((e,a)=>(0,r.jsxs)(p.TableRow,{"data-testid":`leaderboard-${a}`,children:[(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[a<3&&(0,r.jsx)(eG.Trophy,{className:`w-4 h-4 ${0===a?"text-yellow-500":1===a?"text-gray-400":"text-amber-700"}`}),(0,r.jsxs)("span",{className:"font-semibold",children:["#",a+1]})]})}),(0,r.jsx)(p.TableCell,{"data-testid":`leaderboard-user-${a}`,children:e.username}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{children:e.score})})]},e.id)),0===T.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:3,className:"text-center text-muted-foreground py-8",children:"No data available"})})]})]})})})})]}),(0,r.jsxs)(_.TabsContent,{value:"goals",className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"User Goals Analytics"}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Goal Completion Rate"})}),(0,r.jsx)(o.CardContent,{children:I?(0,r.jsx)(c.Skeleton,{className:"h-64"}):B.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(D.LineChart,{data:B,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"date"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(A.Line,{type:"monotone",dataKey:"completionRate",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Top Goals by Participation"})}),(0,r.jsx)(o.CardContent,{children:S?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):k.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(F.BarChart,{data:k,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"name"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(H.Bar,{dataKey:"participants",fill:"hsl(var(--primary))"})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]})]})}e.s(["default",()=>aj],37040);var ap=e.i(78917);function ag(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)(""),[t,l]=(0,n.useState)(!1),[i,d]=(0,n.useState)(!1),[m,h]=(0,n.useState)(null),{data:u,isLoading:g}=(0,j.useQuery)({queryKey:["/api/admin/seo/content",a]}),b=Array.isArray(u)?u:[],{data:y,isLoading:C}=(0,j.useQuery)({queryKey:["/api/admin/seo/campaigns"]}),f=Array.isArray(y)?y:[],{data:N,isLoading:T}=(0,j.useQuery)({queryKey:["/api/admin/seo/campaign-stats"]}),w=N||{reach:0,conversions:0,roi:0},{data:S,isLoading:D}=(0,j.useQuery)({queryKey:["/api/admin/seo/search-rankings"]}),A=Array.isArray(S)?S:[],{data:F,isLoading:H}=(0,j.useQuery)({queryKey:["/api/admin/seo/top-queries"]}),R=Array.isArray(F)?F:[],{data:I,isLoading:B}=(0,j.useQuery)({queryKey:["/api/admin/seo/sitemap-status"]}),q=I||{totalUrls:0},L=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)(`/api/admin/seo/meta/${e.id}`,"PATCH",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/seo/content"]}),e({title:"Meta tags updated successfully"}),l(!1)}}),P=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/seo/campaigns","POST",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/seo/campaigns"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/seo/campaign-stats"]}),e({title:"Campaign created successfully"}),d(!1)}}),M=(0,Q.useMutation)({mutationFn:()=>(0,ec.apiRequest)("/api/admin/seo/sitemap/generate","POST"),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/seo/sitemap-status"]}),e({title:"Sitemap generated successfully"})}});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"SEO & Marketing"}),(0,r.jsxs)(_.Tabs,{defaultValue:"meta",className:"space-y-4",children:[(0,r.jsxs)(_.TabsList,{children:[(0,r.jsx)(_.TabsTrigger,{value:"meta","data-testid":"tab-meta",children:"Meta Tags"}),(0,r.jsx)(_.TabsTrigger,{value:"campaigns","data-testid":"tab-campaigns",children:"Campaigns"}),(0,r.jsx)(_.TabsTrigger,{value:"analytics","data-testid":"tab-seo-analytics",children:"SEO Analytics"})]}),(0,r.jsxs)(_.TabsContent,{value:"meta",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Meta Tags Management"}),(0,r.jsxs)("div",{className:"relative w-full md:w-auto md:min-w-80",children:[(0,r.jsx)(Z.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,r.jsx)(O.Input,{placeholder:"Search content...",value:a,onChange:e=>s(e.target.value),className:"pl-10","data-testid":"input-search-content"})]})]}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:g?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Title"}),(0,r.jsx)(p.TableHead,{children:"Type"}),(0,r.jsx)(p.TableHead,{children:"Meta Title"}),(0,r.jsx)(p.TableHead,{children:"Meta Description"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsxs)(p.TableBody,{children:[b.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`content-${e.id}`,children:[(0,r.jsx)(p.TableCell,{className:"font-medium max-w-xs truncate","data-testid":`content-title-${e.id}`,children:e.title}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"secondary",children:e.type})}),(0,r.jsx)(p.TableCell,{className:"max-w-xs truncate",children:e.metaTitle||"-"}),(0,r.jsx)(p.TableCell,{className:"max-w-xs truncate",children:e.metaDescription||"-"}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>{h(e),l(!0)},"data-testid":`button-edit-meta-${e.id}`,children:"Edit Meta"})})]},e.id)),0===b.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No content found"})})]})]})})})}),(0,r.jsx)(G.Dialog,{open:t,onOpenChange:l,children:(0,r.jsxs)(G.DialogContent,{className:"max-w-2xl",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Edit Meta Tags"})}),m&&(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);L.mutate({id:m.id,title:a.get("title"),description:a.get("description"),keywords:a.get("keywords")})},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"title",children:"Meta Title"}),(0,r.jsx)(O.Input,{id:"title",name:"title",defaultValue:m.metaTitle,maxLength:60,"data-testid":"input-meta-title"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Recommended: 50-60 characters"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"description",children:"Meta Description"}),(0,r.jsx)(z.Textarea,{id:"description",name:"description",defaultValue:m.metaDescription,maxLength:160,rows:3,"data-testid":"textarea-meta-description"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Recommended: 150-160 characters"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"keywords",children:"Keywords (comma-separated)"}),(0,r.jsx)(O.Input,{id:"keywords",name:"keywords",defaultValue:m.metaKeywords,"data-testid":"input-meta-keywords"})]}),(0,r.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,r.jsx)("h4",{className:"font-semibold mb-2",children:"Search Result Preview"}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-sm text-blue-600 hover:underline cursor-pointer",children:m.metaTitle||m.title}),(0,r.jsx)("div",{className:"text-xs text-green-700",children:"https://yoforex.com/..."}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:m.metaDescription||"No description provided"})]})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{type:"submit",disabled:L.isPending,"data-testid":"button-save-meta",children:L.isPending?"Saving...":"Save Changes"})})]})]})})]}),(0,r.jsxs)(_.TabsContent,{value:"campaigns",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Marketing Campaigns"}),(0,r.jsxs)(G.Dialog,{open:i,onOpenChange:d,children:[(0,r.jsx)(G.DialogTrigger,{asChild:!0,children:(0,r.jsx)(x.Button,{"data-testid":"button-create-campaign",children:"Create Campaign"})}),(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Create Marketing Campaign"})}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);P.mutate({name:a.get("name"),description:a.get("description"),startDate:a.get("startDate"),endDate:a.get("endDate"),budget:parseFloat(a.get("budget"))})},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"camp-name",children:"Campaign Name"}),(0,r.jsx)(O.Input,{id:"camp-name",name:"name",required:!0,"data-testid":"input-campaign-name"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"camp-description",children:"Description"}),(0,r.jsx)(z.Textarea,{id:"camp-description",name:"description",required:!0,"data-testid":"textarea-campaign-description"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"startDate",children:"Start Date"}),(0,r.jsx)(O.Input,{id:"startDate",name:"startDate",type:"date",required:!0,"data-testid":"input-campaign-start"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"endDate",children:"End Date"}),(0,r.jsx)(O.Input,{id:"endDate",name:"endDate",type:"date",required:!0,"data-testid":"input-campaign-end"})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"budget",children:"Budget ($)"}),(0,r.jsx)(O.Input,{id:"budget",name:"budget",type:"number",step:"0.01",required:!0,"data-testid":"input-campaign-budget"})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{type:"submit",disabled:P.isPending,"data-testid":"button-submit-campaign",children:P.isPending?"Creating...":"Create Campaign"})})]})]})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:T?[void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a)):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.Card,{"data-testid":"card-campaign-reach",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Reach"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-campaign-reach",children:w.reach.toLocaleString()})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-campaign-conversions",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Conversions"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-campaign-conversions",children:w.conversions})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-campaign-roi",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"ROI"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-campaign-roi",children:[w.roi,"%"]})})]})]})}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:C?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Name"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Start Date"}),(0,r.jsx)(p.TableHead,{children:"End Date"}),(0,r.jsx)(p.TableHead,{children:"Budget"}),(0,r.jsx)(p.TableHead,{children:"Performance"})]})}),(0,r.jsxs)(p.TableBody,{children:[f.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`campaign-${e.id}`,children:[(0,r.jsx)(p.TableCell,{className:"font-medium","data-testid":`campaign-name-${e.id}`,children:e.name}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"active"===e.status?"default":"secondary",children:e.status})}),(0,r.jsx)(p.TableCell,{children:new Date(e.startDate).toLocaleDateString()}),(0,r.jsx)(p.TableCell,{children:new Date(e.endDate).toLocaleDateString()}),(0,r.jsxs)(p.TableCell,{children:["$",e.budget.toLocaleString()]}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"outline",children:[e.performance||0,"% CTR"]})})]},e.id)),0===f.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No campaigns created"})})]})]})})})})]}),(0,r.jsxs)(_.TabsContent,{value:"analytics",className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"SEO Analytics"}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Search Rankings"})}),(0,r.jsx)(o.CardContent,{children:D?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Page"}),(0,r.jsx)(p.TableHead,{children:"Keyword"}),(0,r.jsx)(p.TableHead,{children:"Position"}),(0,r.jsx)(p.TableHead,{children:"Change"})]})}),(0,r.jsxs)(p.TableBody,{children:[A.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{className:"max-w-xs truncate",children:e.page}),(0,r.jsx)(p.TableCell,{children:e.keyword}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"secondary",children:["#",e.position]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:(e.change??0)>0?"default":"destructive",children:[(e.change??0)>0?"+":"",e.change??0]})})]},e.id)),0===A.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No ranking data available"})})]})]})})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Top Search Queries"})}),(0,r.jsx)(o.CardContent,{children:H?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Query"}),(0,r.jsx)(p.TableHead,{children:"Impressions"}),(0,r.jsx)(p.TableHead,{children:"Clicks"}),(0,r.jsx)(p.TableHead,{children:"CTR"})]})}),(0,r.jsxs)(p.TableBody,{children:[R.map((e,a)=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{className:"font-medium",children:e.query}),(0,r.jsx)(p.TableCell,{children:e.impressions.toLocaleString()}),(0,r.jsx)(p.TableCell,{children:e.clicks.toLocaleString()}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"outline",children:[e.ctr,"%"]})})]},a)),0===R.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No query data available"})})]})]})})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2",children:[(0,r.jsx)(o.CardTitle,{children:"Sitemap Status"}),(0,r.jsxs)(x.Button,{onClick:()=>M.mutate(),disabled:M.isPending,"data-testid":"button-generate-sitemap",children:[(0,r.jsx)(v.FileText,{className:"w-4 h-4 mr-2"}),"Generate Sitemap"]})]}),(0,r.jsx)(o.CardContent,{children:B?(0,r.jsx)(c.Skeleton,{className:"h-20"}):(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Last Generated:"}),(0,r.jsx)("span",{className:"font-medium",children:q.lastGenerated?(0,k.formatDistanceToNow)(new Date(q.lastGenerated),{addSuffix:!0}):"Never"})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total URLs:"}),(0,r.jsx)(V.Badge,{variant:"secondary",children:q.totalUrls})]}),q.sitemapUrl&&(0,r.jsx)("div",{className:"flex items-center gap-2 pt-2",children:(0,r.jsxs)("a",{href:q.sitemapUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:["View Sitemap ",(0,r.jsx)(ap.ExternalLink,{className:"w-3 h-3"})]})})]})})]})]})]})]})}e.s(["default",()=>ag],5408);var av=e.i(77148),ab=e.i(34161);let ay=(0,a.default)("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]),aC=(0,a.default)("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),af=[{id:"user.created",label:"User Created"},{id:"user.updated",label:"User Updated"},{id:"content.published",label:"Content Published"},{id:"content.deleted",label:"Content Deleted"},{id:"transaction.completed",label:"Transaction Completed"},{id:"comment.posted",label:"Comment Posted"}];function aN(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)(!1),[t,l]=(0,n.useState)(!1),[i,d]=(0,n.useState)(null),[m,h]=(0,n.useState)([]),[u,g]=(0,n.useState)("all"),[v,b]=(0,n.useState)("all"),[y,C]=(0,n.useState)("all"),{data:f,isLoading:N}=(0,j.useQuery)({queryKey:["/api/admin/integrations/api-keys"]}),T=Array.isArray(f)?f:[],{data:w,isLoading:S}=(0,j.useQuery)({queryKey:["/api/admin/integrations/webhooks"]}),D=Array.isArray(w)?w:[],{data:A,isLoading:F}=(0,j.useQuery)({queryKey:["/api/admin/integrations/event-logs",u,v,y]}),H=Array.isArray(A)?A:[],R=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/integrations/api-keys","POST",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/api-keys"]}),e({title:"API key created successfully"}),s(!1)}}),I=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)(`/api/admin/integrations/api-keys/${e}/revoke`,"DELETE"),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/api-keys"]}),e({title:"API key revoked"}),d(null)}}),B=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/integrations/webhooks","POST",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/webhooks"]}),e({title:"Webhook created successfully"}),l(!1),h([])}}),q=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)(`/api/admin/integrations/webhooks/${e}/test`,"POST"),onSuccess:()=>{e({title:"Test webhook sent"})}}),L=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)(`/api/admin/integrations/event-logs/${e}/retry`,"POST"),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/event-logs"]}),e({title:"Event retry initiated"})}});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"API & Integrations"}),(0,r.jsxs)(_.Tabs,{defaultValue:"api-keys",className:"space-y-4",children:[(0,r.jsxs)(_.TabsList,{children:[(0,r.jsx)(_.TabsTrigger,{value:"api-keys","data-testid":"tab-api-keys",children:"API Keys"}),(0,r.jsx)(_.TabsTrigger,{value:"webhooks","data-testid":"tab-webhooks",children:"Webhooks"}),(0,r.jsx)(_.TabsTrigger,{value:"event-logs","data-testid":"tab-event-logs",children:"Event Logs"})]}),(0,r.jsxs)(_.TabsContent,{value:"api-keys",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"API Keys"}),(0,r.jsxs)(G.Dialog,{open:a,onOpenChange:s,children:[(0,r.jsx)(G.DialogTrigger,{asChild:!0,children:(0,r.jsxs)(x.Button,{"data-testid":"button-create-api-key",children:[(0,r.jsx)(ab.Key,{className:"w-4 h-4 mr-2"}),"Create API Key"]})}),(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Create API Key"})}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);R.mutate({name:a.get("name"),permissions:a.get("permissions"),rateLimit:parseInt(a.get("rateLimit"))})},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"key-name",children:"Name"}),(0,r.jsx)(O.Input,{id:"key-name",name:"name",required:!0,"data-testid":"input-api-key-name"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"permissions",children:"Permissions"}),(0,r.jsxs)(W.Select,{name:"permissions",required:!0,children:[(0,r.jsx)(W.SelectTrigger,{"data-testid":"select-api-key-permissions",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select permissions"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"read",children:"Read Only"}),(0,r.jsx)(W.SelectItem,{value:"write",children:"Read & Write"}),(0,r.jsx)(W.SelectItem,{value:"admin",children:"Admin"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"rateLimit",children:"Rate Limit (requests/hour)"}),(0,r.jsx)(O.Input,{id:"rateLimit",name:"rateLimit",type:"number",defaultValue:"1000",required:!0,"data-testid":"input-api-key-rate-limit"})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{type:"submit",disabled:R.isPending,"data-testid":"button-submit-api-key",children:R.isPending?"Creating...":"Create API Key"})})]})]})]})]}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:N?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Name"}),(0,r.jsx)(p.TableHead,{children:"Key"}),(0,r.jsx)(p.TableHead,{children:"Permissions"}),(0,r.jsx)(p.TableHead,{children:"Rate Limit"}),(0,r.jsx)(p.TableHead,{children:"Last Used"}),(0,r.jsx)(p.TableHead,{children:"Usage"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsxs)(p.TableBody,{children:[T.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`api-key-${e.id}`,children:[(0,r.jsx)(p.TableCell,{className:"font-medium","data-testid":`api-key-name-${e.id}`,children:e.name}),(0,r.jsxs)(p.TableCell,{className:"font-mono text-xs",children:[e.key.substring(0,12),"...",e.key.substring(e.key.length-4)]}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"outline",children:e.permissions})}),(0,r.jsxs)(p.TableCell,{children:[e.rateLimit,"/hr"]}),(0,r.jsx)(p.TableCell,{children:e.lastUsedAt?(0,k.formatDistanceToNow)(new Date(e.lastUsedAt),{addSuffix:!0}):"Never"}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"secondary",children:[e.usageCount||0," requests"]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"destructive",onClick:()=>d(e.id),"data-testid":`button-revoke-${e.id}`,children:"Revoke"})})]},e.id)),0===T.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No API keys created"})})]})]})})})}),(0,r.jsx)(av.AlertDialog,{open:!!i,onOpenChange:e=>!e&&d(null),children:(0,r.jsxs)(av.AlertDialogContent,{children:[(0,r.jsxs)(av.AlertDialogHeader,{children:[(0,r.jsx)(av.AlertDialogTitle,{children:"Revoke API Key"}),(0,r.jsx)(av.AlertDialogDescription,{children:"Are you sure you want to revoke this API key? This action cannot be undone and will immediately invalidate the key."})]}),(0,r.jsxs)(av.AlertDialogFooter,{children:[(0,r.jsx)(av.AlertDialogCancel,{"data-testid":"button-cancel-revoke",children:"Cancel"}),(0,r.jsx)(av.AlertDialogAction,{onClick:()=>i&&I.mutate(i),"data-testid":"button-confirm-revoke",children:"Revoke"})]})]})})]}),(0,r.jsxs)(_.TabsContent,{value:"webhooks",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Webhooks"}),(0,r.jsxs)(G.Dialog,{open:t,onOpenChange:l,children:[(0,r.jsx)(G.DialogTrigger,{asChild:!0,children:(0,r.jsxs)(x.Button,{"data-testid":"button-create-webhook",children:[(0,r.jsx)(ay,{className:"w-4 h-4 mr-2"}),"Create Webhook"]})}),(0,r.jsxs)(G.DialogContent,{className:"max-w-2xl",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Create Webhook"})}),(0,r.jsxs)("form",{onSubmit:a=>{a.preventDefault();let s=new FormData(a.currentTarget);0===m.length?e({title:"Please select at least one event",variant:"destructive"}):B.mutate({url:s.get("url"),events:m,secret:s.get("secret")})},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"url",children:"Webhook URL"}),(0,r.jsx)(O.Input,{id:"url",name:"url",type:"url",placeholder:"https://example.com/webhook",required:!0,"data-testid":"input-webhook-url"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{children:"Events"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2 p-4 border rounded-lg",children:af.map(e=>(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(ex.Checkbox,{id:e.id,checked:m.includes(e.id),onCheckedChange:a=>{h(a?[...m,e.id]:m.filter(a=>a!==e.id))},"data-testid":`checkbox-event-${e.id}`}),(0,r.jsx)(al.Label,{htmlFor:e.id,className:"text-sm cursor-pointer",children:e.label})]},e.id))})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"secret",children:"Secret (optional)"}),(0,r.jsx)(O.Input,{id:"secret",name:"secret",placeholder:"Webhook signing secret","data-testid":"input-webhook-secret"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Used to verify webhook authenticity"})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{type:"submit",disabled:B.isPending,"data-testid":"button-submit-webhook",children:B.isPending?"Creating...":"Create Webhook"})})]})]})]})]}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:S?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"URL"}),(0,r.jsx)(p.TableHead,{children:"Events"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Success"}),(0,r.jsx)(p.TableHead,{children:"Failures"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsxs)(p.TableBody,{children:[D.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`webhook-${e.id}`,children:[(0,r.jsx)(p.TableCell,{className:"font-mono text-xs max-w-xs truncate","data-testid":`webhook-url-${e.id}`,children:e.url}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.events?.slice(0,2).map(e=>(0,r.jsx)(V.Badge,{variant:"secondary",className:"text-xs",children:e},e)),(e.events?.length??0)>2&&(0,r.jsxs)(V.Badge,{variant:"secondary",className:"text-xs",children:["+",(e.events?.length??0)-2]})]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:e.active?"default":"secondary",children:e.active?"Active":"Inactive"})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"outline",children:e.successCount||0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:(e.failureCount??0)>0?"destructive":"outline",children:e.failureCount||0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>q.mutate(e.id),disabled:q.isPending,"data-testid":`button-test-webhook-${e.id}`,children:"Test"})})]},e.id)),0===D.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No webhooks configured"})})]})]})})})})]}),(0,r.jsxs)(_.TabsContent,{value:"event-logs",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Event Logs"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsxs)(W.Select,{value:u,onValueChange:g,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-48","data-testid":"select-filter-webhook",children:(0,r.jsx)(W.SelectValue,{placeholder:"All Webhooks"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Webhooks"}),D.map(e=>(0,r.jsxs)(W.SelectItem,{value:e.id,children:[e.url.substring(0,30),"..."]},e.id))]})]}),(0,r.jsxs)(W.Select,{value:v,onValueChange:b,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-48","data-testid":"select-filter-event-type",children:(0,r.jsx)(W.SelectValue,{placeholder:"All Events"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Events"}),af.map(e=>(0,r.jsx)(W.SelectItem,{value:e.id,children:e.label},e.id))]})]}),(0,r.jsxs)(W.Select,{value:y,onValueChange:C,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-40","data-testid":"select-filter-status",children:(0,r.jsx)(W.SelectValue,{placeholder:"All Status"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Status"}),(0,r.jsx)(W.SelectItem,{value:"success",children:"Success"}),(0,r.jsx)(W.SelectItem,{value:"failed",children:"Failed"}),(0,r.jsx)(W.SelectItem,{value:"pending",children:"Pending"})]})]})]})]}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:F?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[...Array(10)].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Event Type"}),(0,r.jsx)(p.TableHead,{children:"Webhook"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Response"}),(0,r.jsx)(p.TableHead,{children:"Timestamp"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsxs)(p.TableBody,{children:[H.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"secondary",children:e.eventType})}),(0,r.jsx)(p.TableCell,{className:"font-mono text-xs max-w-xs truncate",children:e.webhookUrl}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"success"===e.status?"default":"failed"===e.status?"destructive":"secondary",children:e.status})}),(0,r.jsx)(p.TableCell,{className:"max-w-xs truncate",children:e.response||"-"}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:"failed"===e.status&&(0,r.jsxs)(x.Button,{size:"sm",variant:"outline",onClick:()=>L.mutate(e.id),disabled:L.isPending,"data-testid":`button-retry-${e.id}`,children:[(0,r.jsx)(aC,{className:"w-3 h-3 mr-1"}),"Retry"]})})]},e.id)),0===H.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No event logs found"})})]})]})})})})]})]})]})}e.s(["default",()=>aN],77309);var aT=e.i(45423);let aw=["hsl(var(--primary))","hsl(var(--accent))","hsl(var(--muted))","hsl(var(--destructive))"];function aS(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)("all"),{data:t,isLoading:l}=(0,j.useQuery)({queryKey:["/api/admin/mobile/notification-history"]}),i=Array.isArray(t)?t:[],{data:d,isLoading:m}=(0,j.useQuery)({queryKey:["/api/admin/mobile/app-versions"]}),h=Array.isArray(d)?d:[],{data:u,isLoading:g}=(0,j.useQuery)({queryKey:["/api/admin/mobile/version-distribution"]}),v=Array.isArray(u)?u:[],{data:b,isLoading:y}=(0,j.useQuery)({queryKey:["/api/admin/mobile/device-types"]}),C=Array.isArray(b)?b:[],{data:f,isLoading:N}=(0,j.useQuery)({queryKey:["/api/admin/mobile/os-distribution"]}),T=Array.isArray(f)?f:[],{data:w,isLoading:S}=(0,j.useQuery)({queryKey:["/api/admin/mobile/browser-distribution"]}),D=Array.isArray(w)?w:[],{data:A,isLoading:$}=(0,j.useQuery)({queryKey:["/api/admin/mobile/screen-resolutions"]}),U=Array.isArray(A)?A:[],W=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/mobile/send-notification","POST",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/mobile/notification-history"]}),e({title:"Notification sent successfully"})}}),G=(0,Q.useMutation)({mutationFn:({id:e,forceUpdate:a})=>(0,ec.apiRequest)(`/api/admin/mobile/app-versions/${e}/force-update`,"PATCH",{forceUpdate:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/mobile/app-versions"]}),e({title:"Force update setting updated"})}});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Mobile & Push Notifications"}),(0,r.jsxs)(_.Tabs,{defaultValue:"push",className:"space-y-4",children:[(0,r.jsxs)(_.TabsList,{children:[(0,r.jsx)(_.TabsTrigger,{value:"push","data-testid":"tab-push",children:"Push Notifications"}),(0,r.jsx)(_.TabsTrigger,{value:"versions","data-testid":"tab-versions",children:"App Versions"}),(0,r.jsx)(_.TabsTrigger,{value:"analytics","data-testid":"tab-device-analytics",children:"Device Analytics"})]}),(0,r.jsxs)(_.TabsContent,{value:"push",className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Send Push Notification"}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"pt-6",children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let s=new FormData(e.currentTarget);W.mutate({title:s.get("title"),body:s.get("body"),targetType:a,targetValue:s.get("targetValue")})},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"title",children:"Notification Title"}),(0,r.jsx)(O.Input,{id:"title",name:"title",required:!0,"data-testid":"input-notification-title"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"body",children:"Notification Body"}),(0,r.jsx)(z.Textarea,{id:"body",name:"body",rows:3,required:!0,"data-testid":"textarea-notification-body"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{children:"Target"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(ex.Checkbox,{id:"target-all",checked:"all"===a,onCheckedChange:()=>s("all"),"data-testid":"checkbox-target-all"}),(0,r.jsx)(al.Label,{htmlFor:"target-all",className:"cursor-pointer",children:"All Users"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(ex.Checkbox,{id:"target-segments",checked:"segments"===a,onCheckedChange:()=>s("segments"),"data-testid":"checkbox-target-segments"}),(0,r.jsx)(al.Label,{htmlFor:"target-segments",className:"cursor-pointer",children:"Specific Segments"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(ex.Checkbox,{id:"target-users",checked:"users"===a,onCheckedChange:()=>s("users"),"data-testid":"checkbox-target-users"}),(0,r.jsx)(al.Label,{htmlFor:"target-users",className:"cursor-pointer",children:"Specific User IDs"})]})]})]}),("segments"===a||"users"===a)&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"targetValue",children:"segments"===a?"Segment Names (comma-separated)":"User IDs (comma-separated)"}),(0,r.jsx)(O.Input,{id:"targetValue",name:"targetValue",placeholder:"segments"===a?"premium, active-traders":"user-123, user-456","data-testid":"input-target-value"})]}),(0,r.jsxs)(x.Button,{type:"submit",disabled:W.isPending,"data-testid":"button-send-notification",children:[(0,r.jsx)(aT.Bell,{className:"w-4 h-4 mr-2"}),W.isPending?"Sending...":"Send Notification"]})]})})}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Notification History"})}),(0,r.jsx)(o.CardContent,{children:l?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Title"}),(0,r.jsx)(p.TableHead,{children:"Target"}),(0,r.jsx)(p.TableHead,{children:"Delivered"}),(0,r.jsx)(p.TableHead,{children:"Opened"}),(0,r.jsx)(p.TableHead,{children:"CTR"}),(0,r.jsx)(p.TableHead,{children:"Sent At"})]})}),(0,r.jsxs)(p.TableBody,{children:[i.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{className:"font-medium max-w-xs truncate",children:e.title}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"secondary",children:e.targetType})}),(0,r.jsx)(p.TableCell,{children:e.deliveredCount}),(0,r.jsx)(p.TableCell,{children:e.openedCount}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"outline",children:[e.ctr,"%"]})}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.sentAt),{addSuffix:!0})})]},e.id)),0===i.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No notifications sent yet"})})]})]})})})]})]}),(0,r.jsxs)(_.TabsContent,{value:"versions",className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"App Versions"}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:m?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Version"}),(0,r.jsx)(p.TableHead,{children:"Platform"}),(0,r.jsx)(p.TableHead,{children:"Release Date"}),(0,r.jsx)(p.TableHead,{children:"Users"}),(0,r.jsx)(p.TableHead,{children:"Force Update"})]})}),(0,r.jsxs)(p.TableBody,{children:[h.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`version-${e.id}`,children:[(0,r.jsx)(p.TableCell,{className:"font-medium",children:e.version}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"secondary",children:e.platform})}),(0,r.jsx)(p.TableCell,{children:new Date(e.releaseDate).toLocaleDateString()}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"outline",children:[e.userCount," users"]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(as.Switch,{checked:e.forceUpdate,onCheckedChange:a=>G.mutate({id:e.id,forceUpdate:a}),"data-testid":`switch-force-update-${e.id}`})})]},e.id)),0===h.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No app versions found"})})]})]})})})}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"User Distribution by Version"})}),(0,r.jsx)(o.CardContent,{children:g?(0,r.jsx)(c.Skeleton,{className:"h-64"}):v.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(R.PieChart,{children:[(0,r.jsx)(I.Pie,{data:v,cx:"50%",cy:"50%",labelLine:!1,label:e=>`v${e.version}: ${e.percentage}%`,outerRadius:80,fill:"hsl(var(--primary))",dataKey:"count",children:v.map((e,a)=>(0,r.jsx)(B.Cell,{fill:aw[a%aw.length]},`cell-${a}`))}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(E.Legend,{})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]}),(0,r.jsxs)(_.TabsContent,{value:"analytics",className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Device Analytics"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Device Types"})}),(0,r.jsx)(o.CardContent,{children:y?(0,r.jsx)(c.Skeleton,{className:"h-64"}):C.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(R.PieChart,{children:[(0,r.jsx)(I.Pie,{data:C,cx:"50%",cy:"50%",labelLine:!1,label:e=>`${e.name}: ${e.percentage}%`,outerRadius:80,fill:"hsl(var(--primary))",dataKey:"value",children:C.map((e,a)=>(0,r.jsx)(B.Cell,{fill:aw[a%aw.length]},`cell-${a}`))}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(E.Legend,{})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"OS Distribution"})}),(0,r.jsx)(o.CardContent,{children:N?(0,r.jsx)(c.Skeleton,{className:"h-64"}):T.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(F.BarChart,{data:T,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"name"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(H.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Browser Distribution"})}),(0,r.jsx)(o.CardContent,{children:S?(0,r.jsx)(c.Skeleton,{className:"h-64"}):D.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(F.BarChart,{data:D,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"name"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(H.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Screen Resolutions"})}),(0,r.jsx)(o.CardContent,{children:$?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-8"},a))}):U.length>0?(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Resolution"}),(0,r.jsx)(p.TableHead,{children:"Users"}),(0,r.jsx)(p.TableHead,{children:"Percentage"})]})}),(0,r.jsx)(p.TableBody,{children:U.map((e,a)=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{className:"font-medium",children:e.resolution}),(0,r.jsx)(p.TableCell,{children:e.count}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"secondary",children:[e.percentage,"%"]})})]},a))})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]})]})]})}e.s(["default",()=>aS],86590);let ak=(0,a.default)("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]),aD=(0,a.default)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);function aA(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)(!1),[t,l]=(0,n.useState)(!1),{data:i,isLoading:d}=(0,j.useQuery)({queryKey:["/api/admin/performance/system-metrics"]}),m=i||{cpu:0,memory:0,diskIO:0,network:0},{data:h,isLoading:u}=(0,j.useQuery)({queryKey:["/api/admin/performance/response-time"]}),g=Array.isArray(h)?h:[],{data:v,isLoading:b}=(0,j.useQuery)({queryKey:["/api/admin/performance/throughput"]}),y=Array.isArray(v)?v:[],{data:C,isLoading:f}=(0,j.useQuery)({queryKey:["/api/admin/performance/alerts"]}),N=Array.isArray(C)?C:[],{data:T,isLoading:w}=(0,j.useQuery)({queryKey:["/api/admin/performance/alert-history"]}),R=Array.isArray(T)?T:[],{data:I,isLoading:B}=(0,j.useQuery)({queryKey:["/api/admin/performance/slow-queries"]}),E=Array.isArray(I)?I:[],{data:$,isLoading:U}=(0,j.useQuery)({queryKey:["/api/admin/performance/database-metrics"]}),z=$||{avgQueryTime:0,activeConnections:0,maxConnections:0,poolUsage:0},{data:W,isLoading:X}=(0,j.useQuery)({queryKey:["/api/admin/performance/query-histogram"]}),J=Array.isArray(W)?W:[],{data:Z,isLoading:ee}=(0,j.useQuery)({queryKey:["/api/admin/performance/cache-stats"]}),ea=Z||{hitRate:0,hits:0,misses:0,size:0,keyCount:0},{data:es,isLoading:et}=(0,j.useQuery)({queryKey:["/api/admin/performance/cached-keys"]}),el=Array.isArray(es)?es:[],ei=(0,Q.useMutation)({mutationFn:()=>(0,ec.apiRequest)("/api/admin/performance/record-metric","POST"),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/performance/system-metrics"]}),e({title:"Metric recorded"})}}),er=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/performance/alerts","POST",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/performance/alerts"]}),e({title:"Alert threshold configured"}),s(!1)}}),en=(0,Q.useMutation)({mutationFn:()=>(0,ec.apiRequest)("/api/admin/performance/cache/clear","DELETE"),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/performance/cache-stats"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/performance/cached-keys"]}),e({title:"Cache cleared successfully"}),l(!1)}});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Performance Monitor"}),(0,r.jsxs)(_.Tabs,{defaultValue:"metrics",className:"space-y-4",children:[(0,r.jsxs)(_.TabsList,{children:[(0,r.jsx)(_.TabsTrigger,{value:"metrics","data-testid":"tab-metrics",children:"Metrics"}),(0,r.jsx)(_.TabsTrigger,{value:"alerts","data-testid":"tab-alerts",children:"Alerts"}),(0,r.jsx)(_.TabsTrigger,{value:"database","data-testid":"tab-database",children:"Database Performance"}),(0,r.jsx)(_.TabsTrigger,{value:"cache","data-testid":"tab-cache",children:"Cache Stats"})]}),(0,r.jsxs)(_.TabsContent,{value:"metrics",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"System Metrics"}),(0,r.jsxs)(x.Button,{onClick:()=>ei.mutate(),disabled:ei.isPending,"data-testid":"button-record-metric",children:[(0,r.jsx)(S.Activity,{className:"w-4 h-4 mr-2"}),"Record Metric"]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:d?[void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a)):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.Card,{"data-testid":"card-cpu",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"CPU Usage"}),(0,r.jsx)(ak,{className:"w-4 h-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-cpu-usage",children:[m.cpu,"%"]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-memory",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Memory Usage"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-memory-usage",children:[m.memory,"%"]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-disk",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Disk I/O"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-disk-io",children:[m.diskIO," MB/s"]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-network",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Network"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-network",children:[m.network," MB/s"]})})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Response Time (Last 24 Hours)"})}),(0,r.jsx)(o.CardContent,{children:u?(0,r.jsx)(c.Skeleton,{className:"h-64"}):g.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(D.LineChart,{data:g,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"time"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(A.Line,{type:"monotone",dataKey:"responseTime",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Throughput (Requests/Second)"})}),(0,r.jsx)(o.CardContent,{children:b?(0,r.jsx)(c.Skeleton,{className:"h-64"}):y.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(D.LineChart,{data:y,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"time"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(A.Line,{type:"monotone",dataKey:"rps",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]}),(0,r.jsxs)(_.TabsContent,{value:"alerts",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Performance Alerts"}),(0,r.jsxs)(G.Dialog,{open:a,onOpenChange:s,children:[(0,r.jsx)(G.DialogTrigger,{asChild:!0,children:(0,r.jsx)(x.Button,{"data-testid":"button-configure-alert",children:"Configure Alert"})}),(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Configure Alert Threshold"})}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget);er.mutate({metricType:a.get("metricType"),threshold:parseFloat(a.get("threshold")),condition:a.get("condition")})},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"metricType",children:"Metric Type"}),(0,r.jsx)(O.Input,{id:"metricType",name:"metricType",required:!0,"data-testid":"input-metric-type"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"threshold",children:"Threshold Value"}),(0,r.jsx)(O.Input,{id:"threshold",name:"threshold",type:"number",step:"0.01",required:!0,"data-testid":"input-threshold"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"condition",children:"Condition"}),(0,r.jsx)(O.Input,{id:"condition",name:"condition",placeholder:"e.g., greater than",required:!0,"data-testid":"input-condition"})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{type:"submit",disabled:er.isPending,"data-testid":"button-submit-alert",children:er.isPending?"Configuring...":"Configure Alert"})})]})]})]})]}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:f?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Metric"}),(0,r.jsx)(p.TableHead,{children:"Condition"}),(0,r.jsx)(p.TableHead,{children:"Threshold"}),(0,r.jsx)(p.TableHead,{children:"Current Value"}),(0,r.jsx)(p.TableHead,{children:"Status"})]})}),(0,r.jsxs)(p.TableBody,{children:[N.map(e=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{className:"font-medium",children:e.metricType}),(0,r.jsx)(p.TableCell,{children:e.condition}),(0,r.jsx)(p.TableCell,{children:e.threshold}),(0,r.jsx)(p.TableCell,{children:e.currentValue}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:e.triggered?"destructive":"default",children:e.triggered?"Triggered":"OK"})})]},e.id)),0===N.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No alerts configured"})})]})]})})})}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Alert History"})}),(0,r.jsx)(o.CardContent,{children:w?(0,r.jsx)(c.Skeleton,{className:"h-64"}):R.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(F.BarChart,{data:R,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"date"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(H.Bar,{dataKey:"count",fill:"hsl(var(--destructive))"})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No alert history"})})]})]}),(0,r.jsxs)(_.TabsContent,{value:"database",className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Database Performance"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:U?[void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a)):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.Card,{"data-testid":"card-query-time",children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Avg Query Time"}),(0,r.jsx)(aD,{className:"w-4 h-4 text-muted-foreground"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-query-time",children:[z.avgQueryTime,"ms"]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-connections",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Active Connections"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-connections",children:[z.activeConnections," / ",z.maxConnections]})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-pool-usage",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Pool Usage"})}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-pool-usage",children:[z.poolUsage,"%"]})})]})]})}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Slow Queries"})}),(0,r.jsx)(o.CardContent,{children:B?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Query"}),(0,r.jsx)(p.TableHead,{children:"Execution Time"}),(0,r.jsx)(p.TableHead,{children:"Calls"}),(0,r.jsx)(p.TableHead,{children:"Last Run"})]})}),(0,r.jsxs)(p.TableBody,{children:[E.map((e,a)=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{className:"font-mono text-xs max-w-md truncate",children:e.query}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"destructive",children:[e.executionTime,"ms"]})}),(0,r.jsx)(p.TableCell,{children:e.callCount}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.lastRun),{addSuffix:!0})})]},a)),0===E.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No slow queries detected"})})]})]})})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Query Execution Time Histogram"})}),(0,r.jsx)(o.CardContent,{children:X?(0,r.jsx)(c.Skeleton,{className:"h-64"}):J.length>0?(0,r.jsx)(K.ResponsiveContainer,{width:"100%",height:250,children:(0,r.jsxs)(F.BarChart,{data:J,children:[(0,r.jsx)(P.CartesianGrid,{strokeDasharray:"3 3"}),(0,r.jsx)(q.XAxis,{dataKey:"range"}),(0,r.jsx)(L.YAxis,{}),(0,r.jsx)(M.Tooltip,{}),(0,r.jsx)(H.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,r.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]}),(0,r.jsxs)(_.TabsContent,{value:"cache",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Cache Statistics"}),(0,r.jsxs)(x.Button,{variant:"destructive",onClick:()=>l(!0),"data-testid":"button-clear-cache",children:[(0,r.jsx)(ef.Trash2,{className:"w-4 h-4 mr-2"}),"Clear Cache"]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ee?[void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-32"},a)):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.Card,{"data-testid":"card-hit-rate",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Cache Hit Rate"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-hit-rate",children:[ea.hitRate,"%"]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[ea.hits," hits / ",ea.misses," misses"]})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-cache-size",children:[(0,r.jsx)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Cache Size"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-cache-size",children:[ea.size," MB"]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[ea.keyCount," keys stored"]})]})]})]})}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Most Cached Keys"})}),(0,r.jsx)(o.CardContent,{children:et?(0,r.jsx)("div",{className:"space-y-2",children:[...Array(10)].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Key"}),(0,r.jsx)(p.TableHead,{children:"Hits"}),(0,r.jsx)(p.TableHead,{children:"Size"}),(0,r.jsx)(p.TableHead,{children:"TTL"})]})}),(0,r.jsxs)(p.TableBody,{children:[el.map((e,a)=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{className:"font-mono text-xs max-w-md truncate",children:e.key}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"secondary",children:e.hits})}),(0,r.jsxs)(p.TableCell,{children:[e.size," KB"]}),(0,r.jsxs)(p.TableCell,{children:[e.ttl,"s"]})]},a)),0===el.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No cached keys"})})]})]})})})]})]})]}),(0,r.jsx)(av.AlertDialog,{open:t,onOpenChange:l,children:(0,r.jsxs)(av.AlertDialogContent,{children:[(0,r.jsxs)(av.AlertDialogHeader,{children:[(0,r.jsx)(av.AlertDialogTitle,{children:"Clear Cache"}),(0,r.jsx)(av.AlertDialogDescription,{children:"Are you sure you want to clear the entire cache? This action cannot be undone and may temporarily affect performance."})]}),(0,r.jsxs)(av.AlertDialogFooter,{children:[(0,r.jsx)(av.AlertDialogCancel,{children:"Cancel"}),(0,r.jsx)(av.AlertDialogAction,{onClick:()=>en.mutate(),className:"bg-destructive hover:bg-destructive/90",children:"Clear Cache"})]})]})})]})}e.s(["default",()=>aA],56734);var aF=e.i(69074),aH=e.i(73708);let aR=(0,a.default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function aI(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)(""),[t,l]=(0,n.useState)("all"),[i,d]=(0,n.useState)(!1),[m,h]=(0,n.useState)(null),[u,g]=(0,n.useState)(null),[b,y]=(0,n.useState)(""),[C,f]=(0,n.useState)(""),[N,T]=(0,n.useState)(!1),[w,S]=(0,n.useState)(null),{data:D,isLoading:A}=(0,j.useQuery)({queryKey:["/api/admin/content-studio/media",a,t]}),F=Array.isArray(D)?D:[],{data:H,isLoading:R}=(0,j.useQuery)({queryKey:["/api/admin/content-studio/revisions",b,C],enabled:!!b&&!!C}),I=Array.isArray(H)?H:[],B=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/content-studio/media/upload","POST",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/media"]}),e({title:"Media uploaded successfully"})}}),q=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)(`/api/admin/content-studio/media/${e.id}`,"PATCH",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/media"]}),e({title:"Media updated successfully"}),d(!1)}}),L=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)(`/api/admin/content-studio/media/${e}`,"DELETE"),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/media"]}),e({title:"Media deleted successfully"}),h(null)}}),P=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)(`/api/admin/content-studio/revisions/${e}/restore`,"POST"),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/revisions"]}),e({title:"Revision restored successfully"}),T(!1)}});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Content Studio"}),(0,r.jsxs)(_.Tabs,{defaultValue:"media",className:"space-y-4",children:[(0,r.jsxs)(_.TabsList,{children:[(0,r.jsx)(_.TabsTrigger,{value:"media","data-testid":"tab-media",children:"Media Library"}),(0,r.jsx)(_.TabsTrigger,{value:"revisions","data-testid":"tab-revisions",children:"Content Revisions"})]}),(0,r.jsxs)(_.TabsContent,{value:"media",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Media Library"}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsx)(O.Input,{placeholder:"Search files...",value:a,onChange:e=>s(e.target.value),className:"w-64","data-testid":"input-search-media"}),(0,r.jsxs)(W.Select,{value:t,onValueChange:l,children:[(0,r.jsx)(W.SelectTrigger,{className:"w-40","data-testid":"select-file-type",children:(0,r.jsx)(W.SelectValue,{})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"all",children:"All Types"}),(0,r.jsx)(W.SelectItem,{value:"images",children:"Images"}),(0,r.jsx)(W.SelectItem,{value:"documents",children:"Documents"}),(0,r.jsx)(W.SelectItem,{value:"videos",children:"Videos"})]})]}),(0,r.jsx)(x.Button,{asChild:!0,"data-testid":"button-upload-media",children:(0,r.jsxs)("label",{className:"cursor-pointer",children:[(0,r.jsx)(aF.Upload,{className:"w-4 h-4 mr-2"}),"Upload File",(0,r.jsx)("input",{type:"file",className:"hidden",onChange:e=>{let a=e.target.files?.[0];if(a){let e=new FormData;e.append("file",a),B.mutate(e)}},accept:"image/*,video/*,.pdf,.doc,.docx"})]})})]})]}),A?(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-64"},a))}):(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[F.map(e=>{var a;return(0,r.jsxs)(o.Card,{"data-testid":`media-card-${e.id}`,children:[(0,r.jsx)(o.CardHeader,{className:"p-0",children:(0,r.jsx)("div",{className:"aspect-video bg-muted rounded-t-lg flex items-center justify-center overflow-hidden",children:e.type?.startsWith("image/")?(0,r.jsx)("img",{src:e.url,alt:e.altText||e.filename,className:"w-full h-full object-cover"}):(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[(a=e.type).startsWith("image/")?(0,r.jsx)(aH.Image,{className:"w-4 h-4"}):a.startsWith("video/")?(0,r.jsx)(aR,{className:"w-4 h-4"}):(0,r.jsx)(v.FileText,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-xs",children:e.type})]})})}),(0,r.jsxs)(o.CardContent,{className:"pt-4 space-y-2",children:[(0,r.jsx)("div",{className:"font-medium truncate","data-testid":`media-filename-${e.id}`,children:e.filename}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:e.tags?.map((e,a)=>(0,r.jsx)(V.Badge,{variant:"secondary",className:"text-xs",children:e},a))}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Used ",e.usageCount||0," times"]})]}),(0,r.jsxs)(o.CardFooter,{className:"flex justify-between gap-2",children:[(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>{g(e),d(!0)},"data-testid":`button-edit-media-${e.id}`,children:"Edit"}),(0,r.jsx)(x.Button,{size:"sm",variant:"destructive",onClick:()=>h(e.id),"data-testid":`button-delete-media-${e.id}`,children:(0,r.jsx)(ef.Trash2,{className:"w-3 h-3"})})]})]},e.id)}),0===F.length&&(0,r.jsx)("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:"No media files found"})]}),(0,r.jsx)(G.Dialog,{open:i,onOpenChange:d,children:(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Edit Media"})}),u&&(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget),s=a.get("tags").split(",").map(e=>e.trim()).filter(Boolean);q.mutate({id:u?.id,altText:a.get("altText"),tags:s})},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"altText",children:"Alt Text"}),(0,r.jsx)(O.Input,{id:"altText",name:"altText",defaultValue:u.altText,"data-testid":"input-alt-text"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"tags",children:"Tags (comma-separated)"}),(0,r.jsx)(O.Input,{id:"tags",name:"tags",defaultValue:u.tags?.join(", "),placeholder:"tag1, tag2, tag3","data-testid":"input-tags"})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{type:"submit",disabled:q.isPending,"data-testid":"button-save-media",children:q.isPending?"Saving...":"Save Changes"})})]})]})}),(0,r.jsx)(av.AlertDialog,{open:!!m,onOpenChange:e=>!e&&h(null),children:(0,r.jsxs)(av.AlertDialogContent,{children:[(0,r.jsxs)(av.AlertDialogHeader,{children:[(0,r.jsx)(av.AlertDialogTitle,{children:"Delete Media"}),(0,r.jsx)(av.AlertDialogDescription,{children:"Are you sure you want to delete this media file? This action cannot be undone."})]}),(0,r.jsxs)(av.AlertDialogFooter,{children:[(0,r.jsx)(av.AlertDialogCancel,{"data-testid":"button-cancel-delete",children:"Cancel"}),(0,r.jsx)(av.AlertDialogAction,{onClick:()=>m&&L.mutate(m),"data-testid":"button-confirm-delete",children:"Delete"})]})]})})]}),(0,r.jsxs)(_.TabsContent,{value:"revisions",className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Content Revisions"}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"pt-6 space-y-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"contentType",children:"Content Type"}),(0,r.jsxs)(W.Select,{value:b,onValueChange:y,children:[(0,r.jsx)(W.SelectTrigger,{"data-testid":"select-content-type",children:(0,r.jsx)(W.SelectValue,{placeholder:"Select type"})}),(0,r.jsxs)(W.SelectContent,{children:[(0,r.jsx)(W.SelectItem,{value:"thread",children:"Thread"}),(0,r.jsx)(W.SelectItem,{value:"comment",children:"Comment"}),(0,r.jsx)(W.SelectItem,{value:"content",children:"Content"}),(0,r.jsx)(W.SelectItem,{value:"user",children:"User Profile"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"contentId",children:"Content ID"}),(0,r.jsx)(O.Input,{id:"contentId",value:C,onChange:e=>f(e.target.value),placeholder:"Enter content ID","data-testid":"input-content-id"})]})]})})}),b&&C&&(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsx)(o.CardTitle,{children:"Revision History"})}),(0,r.jsx)(o.CardContent,{children:R?(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Revision #"}),(0,r.jsx)(p.TableHead,{children:"Changed By"}),(0,r.jsx)(p.TableHead,{children:"Changed Fields"}),(0,r.jsx)(p.TableHead,{children:"Timestamp"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsxs)(p.TableBody,{children:[I.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`revision-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"secondary",children:["#",e.revisionNumber]})}),(0,r.jsx)(p.TableCell,{children:e.changedBy}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:e.changedFields?.map((e,a)=>(0,r.jsx)(V.Badge,{variant:"outline",className:"text-xs",children:e},a))})}),(0,r.jsx)(p.TableCell,{children:(0,k.formatDistanceToNow)(new Date(e.timestamp),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(x.Button,{size:"sm",variant:"outline","data-testid":`button-view-diff-${e.id}`,children:[(0,r.jsx)(ep.Eye,{className:"w-3 h-3 mr-1"}),"View Diff"]}),(0,r.jsx)(x.Button,{size:"sm",variant:"default",onClick:()=>{S(e),T(!0)},"data-testid":`button-restore-${e.id}`,children:"Restore"})]})})]},e.id)),0===I.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No revisions found"})})]})]})})})]}),(0,r.jsx)(av.AlertDialog,{open:N,onOpenChange:T,children:(0,r.jsxs)(av.AlertDialogContent,{children:[(0,r.jsxs)(av.AlertDialogHeader,{children:[(0,r.jsx)(av.AlertDialogTitle,{children:"Restore Revision"}),(0,r.jsxs)(av.AlertDialogDescription,{children:["Are you sure you want to restore this revision? This will overwrite the current content with revision #",w?.revisionNumber,"."]})]}),(0,r.jsxs)(av.AlertDialogFooter,{children:[(0,r.jsx)(av.AlertDialogCancel,{"data-testid":"button-cancel-restore",children:"Cancel"}),(0,r.jsx)(av.AlertDialogAction,{onClick:()=>w&&P.mutate(w.id),"data-testid":"button-confirm-restore",children:"Restore"})]})]})})]})]})]})}e.s(["default",()=>aI],58008);let aB=(0,a.default)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);function aq(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)(!1),[t,l]=(0,n.useState)(!1),[i,d]=(0,n.useState)(!1),[m,h]=(0,n.useState)(null),[u,g]=(0,n.useState)([0]),{data:v,isLoading:b}=(0,j.useQuery)({queryKey:["/api/admin/testing/ab-tests"]}),y=Array.isArray(v)?v:[],{data:C,isLoading:f}=(0,j.useQuery)({queryKey:["/api/admin/testing/feature-flags"]}),N=Array.isArray(C)?C:[],T=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/testing/ab-tests","POST",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),e({title:"A/B test created successfully"}),s(!1)}}),w=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)(`/api/admin/testing/ab-tests/${e}/start`,"POST"),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),e({title:"Test started"})}}),S=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)(`/api/admin/testing/ab-tests/${e}/stop`,"POST"),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),e({title:"Test stopped"})}}),k=(0,Q.useMutation)({mutationFn:({testId:e,variantId:a})=>(0,ec.apiRequest)(`/api/admin/testing/ab-tests/${e}/winner`,"POST",{variantId:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),e({title:"Winner declared"})}}),D=(0,Q.useMutation)({mutationFn:e=>(0,ec.apiRequest)("/api/admin/testing/feature-flags","POST",e),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/testing/feature-flags"]}),e({title:"Feature flag created successfully"}),l(!1)}}),A=(0,Q.useMutation)({mutationFn:({id:e,enabled:a})=>(0,ec.apiRequest)(`/api/admin/testing/feature-flags/${e}/toggle`,"PATCH",{enabled:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/testing/feature-flags"]}),e({title:"Feature flag updated"})}}),F=(0,Q.useMutation)({mutationFn:({id:e,rollout:a})=>(0,ec.apiRequest)(`/api/admin/testing/feature-flags/${e}/rollout`,"PATCH",{rollout:a}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/testing/feature-flags"]}),e({title:"Rollout percentage updated"}),d(!1)}});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Testing & Experiments"}),(0,r.jsxs)(_.Tabs,{defaultValue:"ab-tests",className:"space-y-4",children:[(0,r.jsxs)(_.TabsList,{children:[(0,r.jsx)(_.TabsTrigger,{value:"ab-tests","data-testid":"tab-ab-tests",children:"A/B Tests"}),(0,r.jsx)(_.TabsTrigger,{value:"feature-flags","data-testid":"tab-feature-flags",children:"Feature Flags"})]}),(0,r.jsxs)(_.TabsContent,{value:"ab-tests",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"A/B Tests"}),(0,r.jsxs)(G.Dialog,{open:a,onOpenChange:s,children:[(0,r.jsx)(G.DialogTrigger,{asChild:!0,children:(0,r.jsx)(x.Button,{"data-testid":"button-create-test",children:"Create A/B Test"})}),(0,r.jsxs)(G.DialogContent,{className:"max-w-2xl",children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Create A/B Test"})}),(0,r.jsxs)("form",{onSubmit:a=>{a.preventDefault();let s=new FormData(a.currentTarget),t=s.get("variants"),l=s.get("trafficAllocation");try{let e=JSON.parse(t),a=JSON.parse(l);T.mutate({name:s.get("name"),description:s.get("description"),variants:e,trafficAllocation:a})}catch(a){e({title:"Invalid JSON format",variant:"destructive"})}},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"test-name",children:"Test Name"}),(0,r.jsx)(O.Input,{id:"test-name",name:"name",required:!0,"data-testid":"input-test-name"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"test-description",children:"Description"}),(0,r.jsx)(z.Textarea,{id:"test-description",name:"description",required:!0,"data-testid":"textarea-test-description"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"variants",children:"Variants (JSON Array)"}),(0,r.jsx)(z.Textarea,{id:"variants",name:"variants",placeholder:'[{"id": "A", "name": "Control"}, {"id": "B", "name": "Variant B"}]',className:"font-mono text-sm",rows:3,required:!0,"data-testid":"textarea-variants"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"trafficAllocation",children:"Traffic Allocation (JSON Object)"}),(0,r.jsx)(z.Textarea,{id:"trafficAllocation",name:"trafficAllocation",placeholder:'{"A": 50, "B": 50}',className:"font-mono text-sm",rows:2,required:!0,"data-testid":"textarea-traffic-allocation"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Percentages should add up to 100"})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{type:"submit",disabled:T.isPending,"data-testid":"button-submit-test",children:T.isPending?"Creating...":"Create Test"})})]})]})]})]}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:b?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Name"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"Variants"}),(0,r.jsx)(p.TableHead,{children:"Traffic"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsxs)(p.TableBody,{children:[y.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`test-${e.id}`,children:[(0,r.jsx)(p.TableCell,{className:"font-medium","data-testid":`test-name-${e.id}`,children:e.name}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(V.Badge,{variant:"running"===e.status?"default":"completed"===e.status?"secondary":"outline",children:e.status})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:e.variants.map(e=>(0,r.jsx)(V.Badge,{variant:"outline",className:"text-xs",children:e.name},e.id))})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)("div",{className:"text-xs",children:Object.entries(e.trafficAllocation).map(([e,a])=>(0,r.jsxs)("div",{children:[e,": ",a,"%"]},e))})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)("div",{className:"flex gap-2",children:["draft"===e.status&&(0,r.jsxs)(x.Button,{size:"sm",variant:"default",onClick:()=>w.mutate(e.id),disabled:w.isPending,"data-testid":`button-start-${e.id}`,children:[(0,r.jsx)(am,{className:"w-3 h-3 mr-1"}),"Start"]}),"running"===e.status&&(0,r.jsxs)(x.Button,{size:"sm",variant:"destructive",onClick:()=>S.mutate(e.id),disabled:S.isPending,"data-testid":`button-stop-${e.id}`,children:[(0,r.jsx)(aB,{className:"w-3 h-3 mr-1"}),"Stop"]})]})})]},e.id)),0===y.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No A/B tests created"})})]})]})})})}),y.filter(e=>"running"===e.status||"completed"===e.status).map(e=>(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between gap-2",children:[(0,r.jsxs)(o.CardTitle,{children:["Results: ",e.name]}),"completed"===e.status&&e.winner&&(0,r.jsxs)(V.Badge,{variant:"default",children:[(0,r.jsx)(eG.Trophy,{className:"w-3 h-3 mr-1"}),"Winner: ",e.winner]})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Variant"}),(0,r.jsx)(p.TableHead,{children:"Impressions"}),(0,r.jsx)(p.TableHead,{children:"Conversions"}),(0,r.jsx)(p.TableHead,{children:"Conversion Rate"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsx)(p.TableBody,{children:(e.results||[]).map(a=>(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableCell,{className:"font-medium",children:a.variantName}),(0,r.jsx)(p.TableCell,{children:a.impressions}),(0,r.jsx)(p.TableCell,{children:a.conversions}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"secondary",children:[a.conversionRate,"%"]})}),(0,r.jsx)(p.TableCell,{children:"running"===e.status&&!e.winner&&(0,r.jsx)(x.Button,{size:"sm",variant:"default",onClick:()=>k.mutate({testId:e.id,variantId:a.variantId}),disabled:k.isPending,"data-testid":`button-declare-winner-${a.variantId}`,children:"Declare Winner"})})]},a.variantId))})]})})})]},`results-${e.id}`))]}),(0,r.jsxs)(_.TabsContent,{value:"feature-flags",className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Feature Flags"}),(0,r.jsxs)(G.Dialog,{open:t,onOpenChange:l,children:[(0,r.jsx)(G.DialogTrigger,{asChild:!0,children:(0,r.jsx)(x.Button,{"data-testid":"button-create-flag",children:"Create Feature Flag"})}),(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Create Feature Flag"})}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a=new FormData(e.currentTarget),s=a.get("targetUsers").split(",").map(e=>e.trim()).filter(Boolean);D.mutate({key:a.get("key"),name:a.get("name"),description:a.get("description"),enabled:!1,rollout:0,targetUsers:s})},className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"flag-key",children:"Flag Key"}),(0,r.jsx)(O.Input,{id:"flag-key",name:"key",placeholder:"new_feature_enabled",required:!0,"data-testid":"input-flag-key"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"flag-name",children:"Flag Name"}),(0,r.jsx)(O.Input,{id:"flag-name",name:"name",required:!0,"data-testid":"input-flag-name"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"flag-description",children:"Description"}),(0,r.jsx)(z.Textarea,{id:"flag-description",name:"description","data-testid":"textarea-flag-description"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(al.Label,{htmlFor:"targetUsers",children:"Target Users (comma-separated IDs, optional)"}),(0,r.jsx)(z.Textarea,{id:"targetUsers",name:"targetUsers",placeholder:"user-123, user-456","data-testid":"textarea-target-users"})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{type:"submit",disabled:D.isPending,"data-testid":"button-submit-flag",children:D.isPending?"Creating...":"Create Flag"})})]})]})]})]}),(0,r.jsx)(o.Card,{children:(0,r.jsx)(o.CardContent,{className:"p-0",children:f?(0,r.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,r.jsx)(c.Skeleton,{className:"h-12"},a))}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Flag Key"}),(0,r.jsx)(p.TableHead,{children:"Name"}),(0,r.jsx)(p.TableHead,{children:"Enabled"}),(0,r.jsx)(p.TableHead,{children:"Rollout %"}),(0,r.jsx)(p.TableHead,{children:"Target Users"}),(0,r.jsx)(p.TableHead,{children:"Actions"})]})}),(0,r.jsxs)(p.TableBody,{children:[N.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`flag-${e.id}`,children:[(0,r.jsx)(p.TableCell,{className:"font-mono text-sm","data-testid":`flag-key-${e.id}`,children:e.key}),(0,r.jsx)(p.TableCell,{className:"font-medium",children:e.name}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(as.Switch,{checked:e.enabled,onCheckedChange:a=>A.mutate({id:e.id,enabled:a}),"data-testid":`switch-flag-${e.id}`})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"secondary",children:[e.rollout,"%"]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsxs)(V.Badge,{variant:"outline",children:[e.targetUsers.length," users"]})}),(0,r.jsx)(p.TableCell,{children:(0,r.jsx)(x.Button,{size:"sm",variant:"outline",onClick:()=>{h(e),g([e.rollout]),d(!0)},"data-testid":`button-rollout-${e.id}`,children:"Adjust Rollout"})})]},e.id)),0===N.length&&(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No feature flags created"})})]})]})})})}),(0,r.jsx)(G.Dialog,{open:i,onOpenChange:d,children:(0,r.jsxs)(G.DialogContent,{children:[(0,r.jsx)(G.DialogHeader,{children:(0,r.jsx)(G.DialogTitle,{children:"Adjust Rollout Percentage"})}),m&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)(al.Label,{children:["Rollout: ",u[0],"%"]}),(0,r.jsx)(at.Slider,{value:u,onValueChange:g,max:100,step:1,"data-testid":"slider-rollout"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Percentage of users who will see this feature"})]}),(0,r.jsx)(G.DialogFooter,{children:(0,r.jsx)(x.Button,{onClick:()=>F.mutate({id:m.id,rollout:u[0]}),disabled:F.isPending,"data-testid":"button-save-rollout",children:F.isPending?"Saving...":"Save"})})]})]})})]})]})]})}e.s(["default",()=>aq],36725),e.i(47167);var aL=e.i(58472);let aP=(0,a.default)("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);var aM=e.i(39312);let aK=[{url:"/",type:"Homepage",schemaTypes:["Organization","WebSite"],status:"valid"},{url:"/category/trading-strategies/martingale-strategy",type:"Thread (Forum)",schemaTypes:["DiscussionForumPosting","BreadcrumbList","Comment"],status:"valid"},{url:"/category/expert-advisors/mt4/trend-ea",type:"Product (Marketplace)",schemaTypes:["Product","AggregateRating","Review","BreadcrumbList"],status:"valid"},{url:"/user/forex_newbie423",type:"Profile",schemaTypes:["Person"],status:"valid"},{url:"/category/forex-education/beginner-guide",type:"Article/Blog",schemaTypes:["Article","BreadcrumbList"],status:"warning",warning:"Consider adding author image for rich results"}],aE=[{id:"1",url:"/",pageType:"Homepage",status:"valid",errorCount:0,warningCount:0,timestamp:new Date().toISOString()},{id:"2",url:"/thread/best-scalping-ea",pageType:"Article",status:"valid",errorCount:0,warningCount:1,timestamp:new Date(Date.now()-3e5).toISOString(),details:"Missing recommended property: image dimensions"},{id:"3",url:"/content/invalid-product",pageType:"Product",status:"invalid",errorCount:2,warningCount:0,timestamp:new Date(Date.now()-6e5).toISOString(),details:"Missing required properties: price, availability"}];function aV(){let[e,a]=(0,n.useState)(""),[s,t]=(0,n.useState)(""),[l,i]=(0,n.useState)([]),[d,c]=(0,n.useState)(!1),{data:m}=(0,j.useQuery)({queryKey:["/api/admin/schema/stats"],refetchInterval:6e4}),{data:h}=(0,j.useQuery)({queryKey:["/api/admin/schema/logs"],refetchInterval:3e4}),u=(0,Q.useMutation)({mutationFn:async()=>await (0,ec.apiRequest)("POST","/api/admin/schema/validate-all",{}),onSuccess:()=>{ec.queryClient.invalidateQueries({queryKey:["/api/admin/schema/stats"]}),ec.queryClient.invalidateQueries({queryKey:["/api/admin/schema/logs"]})}}),p=async e=>{c(!0);try{let a=await (0,ec.apiRequest)("POST","/api/admin/schema/validate",{url:e}),s=await a.json();i([s,...l.slice(0,9)])}catch(e){console.error("Validation error:",e)}finally{c(!1)}},g=e=>{switch(e){case"valid":return(0,r.jsx)(eM.CheckCircle2,{className:"w-4 h-4 text-green-600"});case"invalid":return(0,r.jsx)(ej,{className:"w-4 h-4 text-red-600"});case"warning":return(0,r.jsx)(eg.AlertTriangle,{className:"w-4 h-4 text-yellow-600"})}},b=e=>(0,r.jsxs)(V.Badge,{variant:{valid:"default",invalid:"destructive",warning:"outline"}[e],className:"gap-1",children:[g(e),e.toUpperCase()]});return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Schema Validation Dashboard"}),(0,r.jsx)("p",{className:"text-muted-foreground mt-2",children:"Real-time monitoring and validation of Schema.org JSON-LD structured data across all pages"})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Pages"}),(0,r.jsx)(aP,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:m?.totalPages||aK.length}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"With schema markup"})]})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Valid Schemas"}),(0,r.jsx)(eM.CheckCircle2,{className:"h-4 w-4 text-green-600"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:m?.validPages||5}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[m?Math.round(m.validPages/m.totalPages*100):83,"% success rate"]})]})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Warnings"}),(0,r.jsx)(eg.AlertTriangle,{className:"h-4 w-4 text-yellow-600"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:m?.warningPages||1}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Need attention"})]})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Errors"}),(0,r.jsx)(ej,{className:"h-4 w-4 text-red-600"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-red-600",children:m?.invalidPages||0}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Require fixes"})]})]})]}),(0,r.jsxs)(_.Tabs,{defaultValue:"overview",className:"space-y-4",children:[(0,r.jsxs)(_.TabsList,{children:[(0,r.jsx)(_.TabsTrigger,{value:"overview",children:"Overview"}),(0,r.jsx)(_.TabsTrigger,{value:"validator",children:"Live Validator"}),(0,r.jsx)(_.TabsTrigger,{value:"logs",children:"Validation Logs"}),(0,r.jsx)(_.TabsTrigger,{value:"schema-types",children:"Schema Types"})]}),(0,r.jsxs)(_.TabsContent,{value:"overview",className:"space-y-4",children:[(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsxs)(o.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(S.Activity,{className:"w-5 h-5"}),"Page Validation Status"]}),(0,r.jsx)(o.CardDescription,{children:"Current schema validation status for all pages"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Last validation: ",m?.lastValidationRun||"Just now"]}),(0,r.jsxs)(x.Button,{onClick:()=>u.mutate(),disabled:u.isPending,size:"sm",className:"gap-2",children:[(0,r.jsx)(ey.RefreshCw,{className:`w-4 h-4 ${u.isPending?"animate-spin":""}`}),"Validate All Pages"]})]}),(0,r.jsx)(em.ScrollArea,{className:"h-[400px]",children:(0,r.jsx)("div",{className:"space-y-2",children:aK.map((e,s)=>{let l=aE.find(a=>a.url===e.url),i=l?.status||"valid";return(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,r.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium",children:e.url}),(0,r.jsx)(V.Badge,{variant:"secondary",className:"text-xs",children:e.type})]}),(0,r.jsx)("div",{className:"flex gap-1",children:e.schemaTypes.map((e,a)=>(0,r.jsx)(V.Badge,{variant:"outline",className:"text-xs",children:e},a))}),l?.details&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:l.details})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[b(i),(0,r.jsxs)(x.Button,{variant:"ghost",size:"sm",onClick:()=>{t(e.url),a(e.url)},className:"gap-1",children:[(0,r.jsx)(ep.Eye,{className:"w-4 h-4"}),"View"]})]})]},s)})})})]})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsx)(o.CardHeader,{children:(0,r.jsxs)(o.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(aM.Zap,{className:"w-5 h-5"}),"Quick Testing Tools"]})}),(0,r.jsxs)(o.CardContent,{className:"grid gap-3 md:grid-cols-2",children:[(0,r.jsxs)(x.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://search.google.com/test/rich-results","_blank"),children:[(0,r.jsx)(ap.ExternalLink,{className:"w-4 h-4"}),"Google Rich Results Test"]}),(0,r.jsxs)(x.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://validator.schema.org/","_blank"),children:[(0,r.jsx)(ap.ExternalLink,{className:"w-4 h-4"}),"Schema.org Validator"]}),(0,r.jsxs)(x.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://search.google.com/search-console","_blank"),children:[(0,r.jsx)(ap.ExternalLink,{className:"w-4 h-4"}),"Google Search Console"]}),(0,r.jsxs)(x.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://json-ld.org/playground/","_blank"),children:[(0,r.jsx)(ap.ExternalLink,{className:"w-4 h-4"}),"JSON-LD Playground"]})]})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsx)(o.CardTitle,{className:"text-lg",children:"Schema Type Distribution"}),(0,r.jsx)(o.CardDescription,{children:"Number of pages by schema type"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm",children:"DiscussionForumPosting"}),(0,r.jsx)(V.Badge,{variant:"secondary",children:"Threads"})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm",children:"Product"}),(0,r.jsx)(V.Badge,{variant:"secondary",children:"Marketplace"})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm",children:"Person"}),(0,r.jsx)(V.Badge,{variant:"secondary",children:"Profiles"})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm",children:"Article/BlogPosting"}),(0,r.jsx)(V.Badge,{variant:"secondary",children:"Content"})]})]})})]}),(0,r.jsxs)(o.Card,{className:"col-span-full",children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsxs)(o.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(Z.Search,{className:"h-5 w-5"}),"Google Rich Results Testing"]}),(0,r.jsx)(o.CardDescription,{children:"Test your schemas with Google's official validation tools"})]}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"font-medium",children:"Rich Results Test"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Test how Google sees your structured data"}),(0,r.jsxs)("a",{href:"https://search.google.com/test/rich-results",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:underline","data-testid":"link-google-rich-results",children:["Open Rich Results Test ",(0,r.jsx)(ap.ExternalLink,{className:"h-3 w-3"})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"font-medium",children:"Schema Markup Validator"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Validate your JSON-LD against Schema.org standards"}),(0,r.jsxs)("a",{href:"https://validator.schema.org/",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:underline","data-testid":"link-schema-validator",children:["Open Schema Validator ",(0,r.jsx)(ap.ExternalLink,{className:"h-3 w-3"})]})]})]}),(0,r.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,r.jsx)("h4",{className:"font-medium text-sm",children:"Quick Test URLs"}),(0,r.jsx)("div",{className:"grid gap-2",children:[{type:"Thread",url:"/category/trading-strategies/best-scalping-ea"},{type:"Marketplace",url:"/category/expert-advisors/trend-ea"},{type:"Profile",url:"/user/forex_newbie423"}].map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[(0,r.jsx)("span",{className:"text-sm font-medium",children:e.type}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>{let a=`${window.location.origin}${e.url}`,s=`https://search.google.com/test/rich-results?url=${encodeURIComponent(a)}`;window.open(s,"_blank")},"data-testid":`button-test-google-${e.type.toLowerCase()}`,children:["Test in Google ",(0,r.jsx)(ap.ExternalLink,{className:"h-3 w-3 ml-1"})]}),(0,r.jsx)(x.Button,{variant:"ghost",size:"sm",onClick:()=>navigator.clipboard.writeText(`${window.location.origin}${e.url}`),"data-testid":`button-copy-url-${e.type.toLowerCase()}`,children:"Copy URL"})]})]},e.type))})]})]})]}),(0,r.jsxs)(o.Card,{className:"col-span-full",children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsxs)(o.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(v.FileText,{className:"h-5 w-5"}),"Validation Logs"]}),(0,r.jsx)(o.CardDescription,{children:"Recent schema validation events and errors"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-950 rounded",children:[(0,r.jsx)(eM.CheckCircle2,{className:"h-4 w-4 text-green-600"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:"All schemas validated successfully"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Last check: Just now"})]})]}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground text-center py-4",children:"No validation errors detected"})]})})]}),(0,r.jsxs)(o.Card,{className:"col-span-full",children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsx)(o.CardTitle,{children:"Schema.org 2025 Compliance Checklist"}),(0,r.jsx)(o.CardDescription,{children:"Ensure all schemas meet the latest standards"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"space-y-3",children:[{item:'All schemas use @context: "https://schema.org"',status:!0},{item:"Required properties present for each type",status:!0},{item:"Publisher includes Organization with logo",status:!0},{item:"Dates in ISO 8601 format",status:!0},{item:"Images include proper dimensions",status:!1,note:"Optional but recommended"},{item:"Videos use ISO 8601 duration format",status:!0}].map((e,a)=>(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[e.status?(0,r.jsx)(eM.CheckCircle2,{className:"h-5 w-5 text-green-600 mt-0.5"}):(0,r.jsx)(y.AlertCircle,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:e.item}),e.note&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:e.note})]})]},a))})})]})]}),(0,r.jsx)(_.TabsContent,{value:"validator",className:"space-y-4",children:(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsx)(o.CardTitle,{children:"Live Schema Validator"}),(0,r.jsx)(o.CardDescription,{children:"Test and validate schema markup for any page URL"})]}),(0,r.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(al.Label,{htmlFor:"test-url",children:"Page URL"}),(0,r.jsx)(O.Input,{id:"test-url",placeholder:"/thread/best-scalping-ea",value:s,onChange:e=>t(e.target.value)})]}),(0,r.jsx)("div",{className:"flex items-end",children:(0,r.jsxs)(x.Button,{onClick:()=>p(s),disabled:!s||d,className:"gap-2",children:[(0,r.jsx)(Z.Search,{className:"w-4 h-4"}),"Validate"]})})]}),l.length>0&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(ac.Separator,{}),(0,r.jsx)("div",{className:"text-sm font-medium",children:"Validation Results"}),(0,r.jsx)(em.ScrollArea,{className:"h-[500px]",children:(0,r.jsx)("div",{className:"space-y-4",children:l.map((e,a)=>(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(o.CardTitle,{className:"text-base",children:e.url}),b(e.isValid?"valid":"invalid")]}),(0,r.jsxs)(o.CardDescription,{children:["Schema Type: ",e.schemaType," • Page Type: ",e.pageType]})]}),(0,r.jsxs)(o.CardContent,{className:"space-y-3",children:[e.errors.length>0&&(0,r.jsxs)(eh.Alert,{variant:"destructive",children:[(0,r.jsx)(eg.AlertTriangle,{className:"h-4 w-4"}),(0,r.jsx)(eh.AlertTitle,{children:"Errors Found"}),(0,r.jsx)(eh.AlertDescription,{children:(0,r.jsx)("ul",{className:"list-disc list-inside space-y-1",children:e.errors.map((e,a)=>(0,r.jsx)("li",{className:"text-sm",children:e},a))})})]}),e.warnings.length>0&&(0,r.jsxs)(eh.Alert,{children:[(0,r.jsx)(eg.AlertTriangle,{className:"h-4 w-4"}),(0,r.jsx)(eh.AlertTitle,{children:"Warnings"}),(0,r.jsx)(eh.AlertDescription,{children:(0,r.jsx)("ul",{className:"list-disc list-inside space-y-1",children:e.warnings.map((e,a)=>(0,r.jsx)("li",{className:"text-sm",children:e},a))})})]}),e.isValid&&0===e.errors.length&&(0,r.jsxs)(eh.Alert,{children:[(0,r.jsx)(eM.CheckCircle2,{className:"h-4 w-4 text-green-600"}),(0,r.jsx)(eh.AlertTitle,{children:"Schema Valid"}),(0,r.jsx)(eh.AlertDescription,{children:"All required properties present and valid"})]}),(0,r.jsxs)("details",{className:"border rounded-lg p-3",children:[(0,r.jsxs)("summary",{className:"cursor-pointer font-medium text-sm flex items-center gap-2",children:[(0,r.jsx)(aL.Code,{className:"w-4 h-4"}),"View Schema JSON"]}),(0,r.jsx)("pre",{className:"mt-3 text-xs bg-muted p-3 rounded overflow-x-auto",children:JSON.stringify(e.schema,null,2)})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(x.Button,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>{window.open(`https://search.google.com/test/rich-results?url=${encodeURIComponent("http://localhost:3000"+e.url)}`,"_blank")},children:[(0,r.jsx)(ap.ExternalLink,{className:"w-3 h-3"}),"Test in Google"]}),(0,r.jsxs)(x.Button,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>{window.open(`https://validator.schema.org/#url=${encodeURIComponent("http://localhost:3000"+e.url)}`,"_blank")},children:[(0,r.jsx)(ap.ExternalLink,{className:"w-3 h-3"}),"Schema.org Validator"]})]})]})]},a))})})]})]})]})}),(0,r.jsx)(_.TabsContent,{value:"logs",className:"space-y-4",children:(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsxs)(o.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(aD,{className:"w-5 h-5"}),"Validation History"]}),(0,r.jsx)(o.CardDescription,{children:"Historical log of all schema validation runs"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)(em.ScrollArea,{className:"h-[500px]",children:(0,r.jsx)("div",{className:"space-y-2",children:(h||aE).map(e=>(0,r.jsxs)("div",{className:"flex items-start justify-between p-4 border rounded-lg",children:[(0,r.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[g(e.status),(0,r.jsx)("span",{className:"font-medium",children:e.url}),(0,r.jsx)(V.Badge,{variant:"secondary",className:"text-xs",children:e.pageType})]}),e.details&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.details}),(0,r.jsxs)("div",{className:"flex gap-4 text-xs text-muted-foreground",children:[(0,r.jsxs)("span",{children:["Errors: ",e.errorCount]}),(0,r.jsxs)("span",{children:["Warnings: ",e.warningCount]}),(0,r.jsx)("span",{children:new Date(e.timestamp).toLocaleString()})]})]}),b(e.status)]},e.id))})})})]})}),(0,r.jsx)(_.TabsContent,{value:"schema-types",className:"space-y-4",children:(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsxs)(o.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(N.TrendingUp,{className:"w-5 h-5"}),"Schema Type Distribution"]}),(0,r.jsx)(o.CardDescription,{children:"Overview of schema types implemented across the platform"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsx)("div",{className:"space-y-4",children:[{type:"Organization",count:1,validCount:1,description:"Company information on homepage"},{type:"WebSite",count:1,validCount:1,description:"Site-wide search capability"},{type:"Article",count:15,validCount:14,description:"Forum threads and blog posts"},{type:"Product",count:10,validCount:10,description:"Marketplace EA listings"},{type:"BreadcrumbList",count:25,validCount:25,description:"Navigation breadcrumbs"},{type:"ProfilePage",count:15,validCount:15,description:"User profile pages"},{type:"LocalBusiness",count:7,validCount:7,description:"Broker listings"}].map((e,a)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,r.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,r.jsx)("div",{className:"font-medium",children:e.type}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]}),(0,r.jsxs)("div",{className:"text-right space-y-1",children:[(0,r.jsxs)("div",{className:"text-sm font-medium",children:[e.validCount,"/",e.count," valid"]}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:[Math.round(e.validCount/e.count*100),"% success rate"]})]})]},a))})})]})})]})]})}e.s(["default",()=>aV],88017);let a$=(0,a.default)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);function aU(){let{toast:e}=(0,Y.useToast)(),[a,s]=(0,n.useState)(!1),{data:t,isLoading:l}=(0,j.useQuery)({queryKey:["/api/admin/sitemap/status"],refetchInterval:3e4}),i=(0,Q.useMutation)({mutationFn:async()=>(s(!0),(await (0,ec.apiRequest)("POST","/api/admin/sitemap/generate",{})).json()),onSuccess:a=>{s(!1),ec.queryClient.invalidateQueries({queryKey:["/api/admin/sitemap/status"]}),e({title:"Sitemap Generated Successfully!",description:`${a.urlCount} URLs added. Submitted to search engines.`})},onError:a=>{s(!1),e({title:"Failed to Generate Sitemap",description:a instanceof Error?a.message:"Unknown error",variant:"destructive"})}});return l?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(c.Skeleton,{className:"h-10 w-64"}),(0,r.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:[1,2,3].map(e=>(0,r.jsx)(c.Skeleton,{className:"h-32"},e))})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"Sitemap Management"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Automated sitemap generation and search engine submission"})]}),(0,r.jsx)(x.Button,{onClick:()=>i.mutate(),disabled:a,size:"lg","data-testid":"button-generate-sitemap",children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ey.RefreshCw,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ey.RefreshCw,{className:"w-4 h-4 mr-2"}),"Generate Now"]})})]}),(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,r.jsxs)(o.Card,{"data-testid":"card-last-generation",children:[(0,r.jsx)(o.CardHeader,{className:"pb-3",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Last Generation"})}),(0,r.jsx)(o.CardContent,{children:t?.lastGeneration?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-url-count",children:[t.lastGeneration.urlCount," URLs"]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,k.formatDistanceToNow)(new Date(t.lastGeneration.createdAt),{addSuffix:!0})})]}):(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Never generated"})})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-automation-status",children:[(0,r.jsx)(o.CardHeader,{className:"pb-3",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Automation Status"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(eM.CheckCircle2,{className:"w-5 h-5 text-green-600"}),(0,r.jsx)("span",{className:"font-semibold",children:"Active"})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Runs daily at 2:00 AM"})]})]}),(0,r.jsxs)(o.Card,{"data-testid":"card-sitemap-url",children:[(0,r.jsx)(o.CardHeader,{className:"pb-3",children:(0,r.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Sitemap URL"})}),(0,r.jsxs)(o.CardContent,{children:[(0,r.jsxs)("a",{href:"/sitemap.xml",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline flex items-center gap-1","data-testid":"link-sitemap-xml",children:["/sitemap.xml",(0,r.jsx)(ap.ExternalLink,{className:"w-3 h-3"})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Public sitemap file"})]})]})]}),t?.lastError&&(0,r.jsxs)(eh.Alert,{variant:"destructive","data-testid":"alert-last-error",children:[(0,r.jsx)(eg.AlertTriangle,{className:"h-4 w-4"}),(0,r.jsxs)(eh.AlertDescription,{children:[(0,r.jsx)("strong",{children:"Last Error:"})," ",t.lastError.errorMessage,(0,r.jsx)("br",{}),(0,r.jsx)("span",{className:"text-xs",children:(0,k.formatDistanceToNow)(new Date(t.lastError.createdAt),{addSuffix:!0})})]})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsx)(o.CardTitle,{children:"Recent Activity"}),(0,r.jsx)(o.CardDescription,{children:"Last 20 sitemap operations"})]}),(0,r.jsx)(o.CardContent,{children:(0,r.jsxs)(p.Table,{children:[(0,r.jsx)(p.TableHeader,{children:(0,r.jsxs)(p.TableRow,{children:[(0,r.jsx)(p.TableHead,{children:"Action"}),(0,r.jsx)(p.TableHead,{children:"Status"}),(0,r.jsx)(p.TableHead,{children:"URLs"}),(0,r.jsx)(p.TableHead,{children:"Submitted To"}),(0,r.jsx)(p.TableHead,{children:"Time"}),(0,r.jsx)(p.TableHead,{children:"Details"})]})}),(0,r.jsx)(p.TableBody,{children:t?.recentLogs&&t.recentLogs.length>0?t.recentLogs.map(e=>(0,r.jsxs)(p.TableRow,{"data-testid":`row-log-${e.id}`,children:[(0,r.jsx)(p.TableCell,{children:(e=>{switch(e){case"generate":return(0,r.jsxs)(V.Badge,{variant:"outline",children:[(0,r.jsx)(v.FileText,{className:"w-3 h-3 mr-1"}),"Generate"]});case"submit_google":return(0,r.jsxs)(V.Badge,{variant:"outline",children:[(0,r.jsx)(a$,{className:"w-3 h-3 mr-1"}),"Google"]});case"submit_indexnow":return(0,r.jsxs)(V.Badge,{variant:"outline",children:[(0,r.jsx)(a$,{className:"w-3 h-3 mr-1"}),"IndexNow"]});default:return(0,r.jsx)(V.Badge,{variant:"outline",children:e})}})(e.action)}),(0,r.jsx)(p.TableCell,{children:(e=>{switch(e){case"success":return(0,r.jsxs)(V.Badge,{variant:"default",className:"bg-green-600",children:[(0,r.jsx)(eM.CheckCircle2,{className:"w-3 h-3 mr-1"}),"Success"]});case"error":return(0,r.jsxs)(V.Badge,{variant:"destructive",children:[(0,r.jsx)(ej,{className:"w-3 h-3 mr-1"}),"Error"]});case"pending":return(0,r.jsxs)(V.Badge,{variant:"secondary",children:[(0,r.jsx)(ev.Clock,{className:"w-3 h-3 mr-1"}),"Pending"]});default:return(0,r.jsx)(V.Badge,{children:e})}})(e.status)}),(0,r.jsx)(p.TableCell,{children:e.urlCount||"-"}),(0,r.jsx)(p.TableCell,{children:e.submittedTo||"-"}),(0,r.jsx)(p.TableCell,{className:"text-sm text-muted-foreground",children:(0,k.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})}),(0,r.jsx)(p.TableCell,{className:"text-sm text-muted-foreground",children:e.errorMessage?(0,r.jsx)("span",{className:"text-red-600 truncate max-w-xs block",children:e.errorMessage}):(0,r.jsx)("span",{className:"text-green-600",children:"OK"})})]},e.id)):(0,r.jsx)(p.TableRow,{children:(0,r.jsx)(p.TableCell,{colSpan:6,className:"text-center text-muted-foreground",children:'No activity yet. Click "Generate Now" to create your first sitemap.'})})})]})})]}),(0,r.jsxs)(o.Card,{children:[(0,r.jsxs)(o.CardHeader,{children:[(0,r.jsx)(o.CardTitle,{children:"Setup Instructions"}),(0,r.jsx)(o.CardDescription,{children:"Configure your environment for optimal search engine submission"})]}),(0,r.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold mb-2",children:"1. IndexNow API Key (Bing & Yandex)"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Generate an API key and set ",(0,r.jsx)("code",{className:"bg-muted px-1 py-0.5 rounded",children:"INDEXNOW_API_KEY"})," environment variable."]}),(0,r.jsxs)("a",{href:"https://www.bing.com/indexnow/getstarted",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline inline-flex items-center gap-1",children:["Get IndexNow Key ",(0,r.jsx)(ap.ExternalLink,{className:"w-3 h-3"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold mb-2",children:"2. Add Sitemap to robots.txt"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Add this line to your ",(0,r.jsx)("code",{className:"bg-muted px-1 py-0.5 rounded",children:"/public/robots.txt"}),":"]}),(0,r.jsx)("code",{className:"block bg-muted px-3 py-2 rounded text-sm",children:"Sitemap: https://yoforex.net/sitemap.xml"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold mb-2",children:"3. Verify in Search Console"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Submit your sitemap manually in"," ",(0,r.jsx)("a",{href:"https://search.google.com/search-console",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google Search Console"})," ","and"," ",(0,r.jsx)("a",{href:"https://www.bing.com/webmasters",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Bing Webmaster Tools"}),"."]})]})]})]})]})}e.s(["default",()=>aU],10632)}]);