{"version":3,"sources":["turbopack:///[project]/app/lib/api-config.ts","turbopack:///[project]/app/HomeClient.tsx/__nextjs-internal-proxy.mjs","turbopack:///[project]/app/page.tsx"],"sourcesContent":["/**\n * Centralized API Configuration\n * \n * This module provides runtime URL resolution for API calls across the application.\n * It eliminates hardcoded localhost URLs and uses environment variables for flexibility.\n * \n * Architecture:\n * - Development: Next.js (3000) + Express (3001)\n * - Production VPS: NGINX proxy (80/443) → Next.js (3000) + Express (3001)\n * - Production Replit: Single Next.js server (5000) with API routes\n */\n\n/**\n * Environment variable validation\n * Ensures required configuration is present at runtime\n * \n * PRODUCTION SAFETY: Throws errors for missing critical variables\n * DEVELOPMENT: Allows fallbacks with warnings\n */\nfunction validateEnv() {\n  const isProduction = process.env.NODE_ENV === 'production';\n\n  if (typeof window === 'undefined') {\n    // Server-side: require EXPRESS_URL in production\n    if (!process.env.EXPRESS_URL) {\n      if (isProduction) {\n        throw new Error(\n          '🚨 CRITICAL: EXPRESS_URL environment variable is required in production.\\n' +\n          'Please set it in your .env.production file.\\n' +\n          'Example: EXPRESS_URL=http://127.0.0.1:3001\\n' +\n          'For VPS deployment, see: VPS_DEPLOYMENT_GUIDE.md'\n        );\n      } else {\n        console.warn(\n          '⚠️  EXPRESS_URL not set, using development fallback: http://127.0.0.1:3001'\n        );\n      }\n    }\n  }\n\n  // NEXT_PUBLIC_SITE_URL is required in production for SEO, OG tags, canonical URLs\n  if (!process.env.NEXT_PUBLIC_SITE_URL) {\n    if (isProduction) {\n      throw new Error(\n        '🚨 CRITICAL: NEXT_PUBLIC_SITE_URL environment variable is required in production.\\n' +\n        'Please set it in your .env.production file.\\n' +\n        'Example: NEXT_PUBLIC_SITE_URL=https://yourdomain.com\\n' +\n        'This is used for SEO metadata, Open Graph tags, and canonical URLs.'\n      );\n    } else {\n      console.warn(\n        '⚠️  NEXT_PUBLIC_SITE_URL not set, using development fallback: http://localhost:3000'\n      );\n    }\n  }\n}\n\n// Run validation on module load\nvalidateEnv();\n\n/**\n * Get the API base URL for client-side requests\n * \n * @returns API base URL accessible from the browser\n * \n * Client-side behavior:\n * - Always returns empty string '' (uses relative URLs)\n * - Next.js rewrites handle /api/* → Express server routing\n * - No need for absolute URLs on client-side\n * \n * Server-side behavior:\n * - Returns internal API URL (e.g., http://127.0.0.1:3001)\n * - Used for server-to-server communication\n * \n * Usage in client components:\n * ```typescript\n * const apiUrl = getApiBaseUrl();\n * fetch(`${apiUrl}/api/stats`);  // Becomes: fetch('/api/stats')\n * ```\n */\nexport function getApiBaseUrl(): string {\n  // Client-side: use relative URLs (NGINX/Next.js rewrites handle routing)\n  if (typeof window !== 'undefined') {\n    return '';\n  }\n\n  // Server-side: Use getInternalApiUrl which has production safety checks\n  return getInternalApiUrl();\n}\n\n/**\n * Get the internal API URL for server-side requests\n * \n * @returns Internal API URL for server-to-server communication\n * \n * Usage in server components:\n * ```typescript\n * const apiUrl = getInternalApiUrl();\n * const response = await fetch(`${apiUrl}/api/stats`);\n * ```\n */\nexport function getInternalApiUrl(): string {\n  // Server-side only\n  if (typeof window !== 'undefined') {\n    throw new Error('getInternalApiUrl() can only be called server-side');\n  }\n\n  const isProduction = process.env.NODE_ENV === 'production';\n  const url = process.env.EXPRESS_URL;\n  \n  if (!url) {\n    if (isProduction) {\n      throw new Error(\n        'EXPRESS_URL must be set in production. ' +\n        'This is a critical configuration error that will prevent server-side API calls from working.'\n      );\n    }\n    // Development fallback only\n    const fallback = 'http://127.0.0.1:3001';\n    console.log(`[API Config] Using development fallback: ${fallback}`);\n    return fallback;\n  }\n  \n  console.log(`[API Config] Internal API URL: ${url}`);\n  return url;\n}\n\n/**\n * Get the public site URL\n * \n * @returns Public-facing site URL (for SEO, OG tags, etc.)\n * \n * Usage:\n * ```typescript\n * const siteUrl = getSiteUrl();\n * const canonical = `${siteUrl}/thread/${slug}`;\n * ```\n */\nexport function getSiteUrl(): string {\n  const isProduction = process.env.NODE_ENV === 'production';\n  const siteUrl = process.env.NEXT_PUBLIC_SITE_URL || process.env.VERCEL_URL;\n  \n  if (!siteUrl) {\n    if (isProduction) {\n      throw new Error(\n        'NEXT_PUBLIC_SITE_URL must be set in production. ' +\n        'This is required for SEO, canonical URLs, and Open Graph tags.'\n      );\n    }\n    // Development fallback\n    return 'http://localhost:3000';\n  }\n  \n  return siteUrl;\n}\n\n/**\n * Build a full API URL with path\n * \n * @param path - API endpoint path (e.g., '/api/stats')\n * @returns Full API URL\n * \n * Usage:\n * ```typescript\n * const url = buildApiUrl('/api/stats');\n * const response = await fetch(url);\n * ```\n */\nexport function buildApiUrl(path: string): string {\n  const base = getApiBaseUrl();\n  const cleanPath = path.startsWith('/') ? path : `/${path}`;\n  return base ? `${base}${cleanPath}` : cleanPath;\n}\n\n/**\n * Configuration object for easy access\n */\nexport const apiConfig = {\n  /**\n   * API base URL (client or server appropriate)\n   */\n  baseUrl: getApiBaseUrl(),\n\n  /**\n   * Public site URL\n   */\n  siteUrl: getSiteUrl(),\n\n  /**\n   * Whether we're in production mode\n   */\n  isProduction: process.env.NODE_ENV === 'production',\n\n  /**\n   * Whether we're in development mode\n   */\n  isDevelopment: process.env.NODE_ENV === 'development',\n\n  /**\n   * Express API URL (server-side only)\n   */\n  get expressUrl(): string {\n    if (typeof window !== 'undefined') {\n      throw new Error('expressUrl is only available server-side');\n    }\n    return getInternalApiUrl();\n  },\n} as const;\n\n/**\n * Type-safe environment variable access\n * \n * Note: NEXT_PUBLIC_EXPRESS_URL is not included as client-side code\n * uses relative URLs (/api/*) which are handled by Next.js rewrites.\n */\nexport const env = {\n  // Server-side only\n  EXPRESS_URL: process.env.EXPRESS_URL,\n  DATABASE_URL: process.env.DATABASE_URL,\n  SESSION_SECRET: process.env.SESSION_SECRET,\n\n  // Public (client-accessible)\n  NEXT_PUBLIC_SITE_URL: process.env.NEXT_PUBLIC_SITE_URL,\n\n  // Node environment\n  NODE_ENV: process.env.NODE_ENV,\n} as const;\n\n// Export helper for debugging\nexport function debugConfig() {\n  if (typeof window === 'undefined') {\n    console.log('🔧 API Configuration (Server-side):');\n    console.log('  - Express URL:', env.EXPRESS_URL || 'NOT SET (using fallback)');\n    console.log('  - Site URL:', getSiteUrl());\n    console.log('  - API Base:', getApiBaseUrl());\n  } else {\n    console.log('🔧 API Configuration (Client-side):');\n    console.log('  - Site URL:', env.NEXT_PUBLIC_SITE_URL || 'NOT SET');\n    console.log('  - API Base:', getApiBaseUrl());\n  }\n}\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/HomeClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/HomeClient.tsx\",\n    \"default\",\n);\n","import type { Metadata } from 'next';\nimport HomeClient from './HomeClient';\nimport { getInternalApiUrl } from './lib/api-config';\n\n// Enable ISR with 60-second revalidation\nexport const revalidate = 60;\n\n// Homepage metadata\nexport const metadata: Metadata = {\n  title: 'YoForex - Expert Advisor Forum & EA Marketplace',\n  description: 'Join 10,000+ forex traders. Download free EAs, share strategies, and earn coins. #1 MT4/MT5 EA community with verified backtests and live results.',\n  keywords: ['forex forum', 'EA marketplace', 'Expert Advisor', 'MT4', 'MT5', 'forex trading', 'algorithmic trading', 'free EAs', 'trading robots'],\n};\n\nasync function fetchData(url: string) {\n  const apiUrl = getInternalApiUrl();\n  const controller = new AbortController();\n  const timeout = setTimeout(() => controller.abort(), 10000); // 10s timeout\n  \n  try {\n    console.log(`[SSR Fetch] Fetching: ${apiUrl}${url}`);\n    const res = await fetch(`${apiUrl}${url}`, {\n      signal: controller.signal,\n      next: { revalidate: 60 },\n      headers: {\n        'Accept': 'application/json',\n      },\n    });\n    \n    clearTimeout(timeout);\n    \n    if (!res.ok) {\n      console.error(`[SSR Fetch] Failed ${url}: ${res.status}`);\n      return null;\n    }\n    \n    return await res.json();\n  } catch (error) {\n    clearTimeout(timeout);\n    console.error(`[SSR Fetch] Error ${url}:`, error);\n    return null;\n  }\n}\n\nexport default async function HomePage() {\n  // Parallel data fetching from Express API\n  const [stats, topCategories, threads] = await Promise.all([\n    fetchData('/api/stats'),\n    fetchData('/api/categories/tree/top?limit=6'),  // Fetch top 6 categories for homepage\n    fetchData('/api/threads'),\n  ]);\n\n  return (\n    <HomeClient \n      initialStats={stats}\n      initialCategories={topCategories}\n      initialThreads={threads}\n    />\n  );\n}\n"],"names":[],"mappings":"8UAqGO,SAAS,IAOd,IAAM,EAAA,wBAgBN,OADA,QAAQ,GAAG,CAAC,CAAC,+BAA+B,EAAE,EAAA,CAAK,EAC5C,CACT,CAtCS,IAmIO,QAAQ,GAAG,CAAC,YAAY,CACtB,QAAQ,GAAG,CAAC,cAAc,iECzN7B,CAAA,EADf,AACe,EADf,CAAA,CAAA,QACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,oRAAsR,EACnT,mDACA,+DAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,QACe,uBAAA,AAAuB,EAClC,WAAa,MAAU,AAAJ,MAAU,gQAAkQ,EAC/R,+BACA,wICJJ,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAYA,eAAe,EAAU,CAAW,EAClC,IAAM,EAAS,CAAA,EAAA,EAAA,iBAAA,AAAiB,IAC1B,EAAa,IAAI,gBACjB,EAAU,WAAW,IAAM,EAAW,KAAK,GAAI,KAErD,GAF6D,AAEzD,CACF,QAAQ,GAAG,CAAC,CAH6D,AAG5D,sBAAsB,EAAE,EAAA,EAAS,EAAA,CAAK,EACnD,IAAM,EAAM,MAAM,MAAM,CAAA,EAAG,EAAA,EAAS,EAAA,CAAK,CAAE,CACzC,OAAQ,EAAW,MAAM,CACzB,KAAM,CAAE,WAAY,EAAG,EACvB,QAAS,CACP,OAAU,kBACZ,CACF,GAIA,GAFA,aAAa,GAET,CAAC,EAAI,EAAE,CAET,CAFW,MACX,QAAQ,KAAK,CAAC,CAAC,mBAAmB,EAAE,EAAI,EAAE,EAAE,EAAI,MAAM,CAAA,CAAE,EACjD,KAGT,OAAO,MAAM,EAAI,IAAI,EACvB,CAAE,MAAO,EAAO,CAGd,OAFA,aAAa,GACb,QAAQ,KAAK,CAAC,CAAC,kBAAkB,EAAE,EAAI,CAAC,CAAC,CAAE,GACpC,IACT,CACF,CAEe,eAAe,IAE5B,GAAM,CAAC,EAAO,EAAe,EAAQ,CAAG,MAAM,QAAQ,GAAG,CAAC,CACxD,EAAU,cACV,EAAU,oCACV,EAAU,gBACX,EAED,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAU,CAAA,CACT,aAAc,EACd,kBAAmB,EACnB,eAAgB,GAGtB,mCAnDkC,CAChC,MAAO,kDACP,YAAa,qJACb,SAAU,CAAC,cAAe,iBAAkB,iBAAkB,MAAO,MAAO,gBAAiB,sBAAuB,WAAY,iBAAiB,AACnJ,iBAP0B","ignoreList":[1]}