{"version":3,"sources":["turbopack:///[project]/app/thread/[slug]/page.tsx"],"sourcesContent":["import type { Metadata } from 'next';\nimport { notFound, permanentRedirect } from 'next/navigation';\nimport type { ForumThread, ForumReply } from '@shared/schema';\nimport ThreadDetailClient from './ThreadDetailClient';\nimport { getThreadUrl } from '../../../lib/category-path';\n\ninterface PageProps {\n  params: Promise<{ slug: string }>;\n}\n\nasync function fetchData(url: string) {\n  try {\n    const expressUrl = process.env.NEXT_PUBLIC_EXPRESS_URL || 'http://localhost:5000';\n    const res = await fetch(`${expressUrl}${url}`, {\n      cache: 'no-store',\n      headers: {\n        'Accept': 'application/json',\n      },\n    });\n    \n    if (!res.ok) {\n      console.error(`Failed to fetch ${url}:`, res.status, res.statusText);\n      return null;\n    }\n    \n    return await res.json();\n  } catch (error) {\n    console.error(`Error fetching ${url}:`, error);\n    return null;\n  }\n}\n\nfunction stripHtml(html: string): string {\n  return html.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').trim();\n}\n\nfunction createExcerpt(html: string, maxLength: number = 155): string {\n  const text = stripHtml(html);\n  if (text.length <= maxLength) return text;\n  return text.substring(0, maxLength).trim() + '...';\n}\n\nexport async function generateMetadata({ params }: PageProps): Promise<Metadata> {\n  const { slug } = await params;\n  const thread: ForumThread | null = await fetchData(`/api/threads/slug/${slug}`);\n\n  if (!thread) {\n    return {\n      title: 'Thread Not Found - YoForex',\n      description: 'The thread you are looking for does not exist.',\n    };\n  }\n\n  const description = thread.metaDescription || createExcerpt(thread.body || '');\n  const title = `${thread.title} - YoForex Forum`;\n\n  return {\n    title,\n    description,\n    keywords: [\n      thread.categorySlug || 'forum',\n      'EA discussion',\n      'forex forum',\n      'expert advisor',\n      'trading discussion',\n      'MT4',\n      'MT5',\n    ],\n    openGraph: {\n      title,\n      description,\n      type: 'article',\n      url: `https://yoforex.com/thread/${slug}`,\n      siteName: 'YoForex',\n    },\n    twitter: {\n      card: 'summary_large_image',\n      title,\n      description,\n    },\n  };\n}\n\nexport default async function ThreadDetailPage({ params }: PageProps) {\n  const { slug } = await params;\n  \n  // Fetch thread data from Express API\n  const thread: ForumThread | null = await fetchData(`/api/threads/slug/${slug}`);\n  \n  // Return 404 if thread doesn't exist\n  if (!thread) {\n    notFound();\n  }\n  \n  // Generate hierarchical URL and perform permanent redirect (308 for SEO)\n  // Note: Next.js uses 308 (not 301) for permanent redirects to preserve HTTP method\n  // Both 301 and 308 transfer SEO equity equally; 308 is the modern standard\n  const hierarchicalUrl = await getThreadUrl(thread);\n  permanentRedirect(hierarchicalUrl);\n}\n"],"names":[],"mappings":"kiCACA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QAGA,EAAA,EAAA,CAAA,CAAA,QAMA,eAAe,EAAU,CAAW,EAClC,GAAI,CAEF,IAAM,EAAM,MAAM,MAAM,GAAG,qBAAa,GAAK,CAAE,CAC7C,MAAO,WACP,QAAS,CACP,OAAU,kBACZ,CACF,GAEA,GAAI,CAAC,EAAI,EAAE,CAET,CAFW,MACX,QAAQ,KAAK,CAAC,CAAC,gBAAgB,EAAE,EAAI,CAAC,CAAC,CAAE,EAAI,MAAM,CAAE,EAAI,UAAU,EAC5D,KAGT,OAAO,MAAM,EAAI,IAAI,EACvB,CAAE,MAAO,EAAO,CAEd,OADA,QAAQ,KAAK,CAAC,CAAC,eAAe,EAAE,EAAI,CAAC,CAAC,CAAE,GACjC,IACT,CACF,CAYO,eAAe,EAAiB,QAAE,CAAM,CAAa,EAC1D,GAAM,MAAE,CAAI,CAAE,CAAG,MAAM,EACjB,EAA6B,MAAM,EAAU,CAAC,kBAAkB,EAAE,EAAA,CAAM,EAE9E,GAAI,CAAC,EACH,MADW,AACJ,CACL,MAAO,6BACP,YAAa,gDACf,EAGF,IAAM,EAAc,EAAO,eAAe,EAAI,AAjBhD,SAAS,AAAc,CAAY,CAAE,EAAoB,GAAG,EAC1D,IAAM,EAAiB,AAJhB,EAAK,GAIC,IAJM,CAAC,WAAY,IAAI,OAAO,CAAC,UAAW,KAAK,IAAI,UAKhE,AAAI,EAAK,MAAM,EAAI,EAAkB,EAC9B,EAAK,KADkB,IACT,CAAC,EAAG,GAAW,IAAI,GAAK,KAC/C,EAa8D,EAAO,IAAI,EAAI,IACrE,EAAQ,CAAA,EAAG,EAAO,KAAK,CAAC,gBAAgB,CAAC,CAE/C,MAAO,OACL,EACA,cACA,SAAU,CACR,EAAO,YAAY,EAAI,QACvB,gBACA,cACA,iBACA,qBACA,MACA,MACD,CACD,UAAW,OACT,cACA,EACA,KAAM,UACN,IAAK,CAAC,2BAA2B,EAAE,EAAA,CAAM,CACzC,SAAU,SACZ,EACA,QAAS,CACP,KAAM,4BACN,cACA,CACF,CACF,CACF,CAEe,eAAe,EAAiB,QAAE,CAAM,CAAa,EAClE,GAAM,MAAE,CAAI,CAAE,CAAG,MAAM,EAGjB,EAA6B,MAAM,EAAU,CAAC,kBAAkB,EAAE,EAAA,CAAM,CAG1E,CAAC,GACH,CAAA,EAAA,EADW,AACX,QAAA,AAAQ,IAMV,IAAM,EAAkB,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,EAAC,GAC3C,CAAA,EAAA,EAAA,iBAAA,AAAiB,EAAC,EACpB"}