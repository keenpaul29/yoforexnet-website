module.exports=[63910,68811,82434,47271,92492,64785,81079,91537,7682,60289,22642,37921,17742,33331,56760,66143,86443,88120,47860,60128,96749,55082,86843,37559,86079,16708,13562,a=>{"use strict";var b=a.i(70106);let c=(0,b.default)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);a.s(["Building",()=>c],63910);let d=(0,b.default)("FileChartColumn",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 18v-1",key:"zg0ygc"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"M16 18v-3",key:"j5jt4h"}]]);a.s(["FileBarChart2",()=>d],68811);let e=(0,b.default)("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);a.s(["Bot",()=>e],82434);let f=(0,b.default)("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);a.s(["TestTube",()=>f],47271);var g=a.i(87924),h=a.i(72131),i=a.i(50944),j=a.i(5539),k=a.i(6893),l=a.i(91868),m=a.i(66384),n=a.i(35385);function o({children:a}){let b=(0,i.useRouter)(),[c,d]=(0,h.useState)(!0),[e,f]=(0,h.useState)(!1),[o,p]=(0,h.useState)(null);return((0,h.useEffect)(()=>{!async function(){try{let a=await fetch("/api/me");if(!a.ok)return void p("not-authenticated");let b=await a.json();if("admin"!==b.role&&"moderator"!==b.role&&"superadmin"!==b.role)return void p("not-admin");f(!0)}catch(a){console.error("Auth check failed:",a),p("not-authenticated")}finally{d(!1)}}()},[b]),c)?(0,g.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,g.jsxs)("div",{className:"text-center space-y-4",children:[(0,g.jsx)(j.Skeleton,{className:"h-8 w-48 mx-auto"}),(0,g.jsx)(j.Skeleton,{className:"h-4 w-64 mx-auto"})]})}):"not-authenticated"===o?(0,g.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background p-4",children:(0,g.jsxs)(k.Card,{className:"max-w-md w-full",children:[(0,g.jsxs)(k.CardHeader,{className:"text-center",children:[(0,g.jsx)("div",{className:"mx-auto mb-4 w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:(0,g.jsx)(n.LogIn,{className:"h-6 w-6 text-primary"})}),(0,g.jsx)(k.CardTitle,{children:"Authentication Required"}),(0,g.jsx)(k.CardDescription,{children:"You must be logged in to access the admin dashboard."})]}),(0,g.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(l.Button,{className:"w-full",asChild:!0,children:(0,g.jsx)("a",{href:"/api/login",children:"Sign In with Replit"})}),(0,g.jsx)(l.Button,{className:"w-full",variant:"outline",onClick:()=>b.push("/"),children:"Go to Home"})]}),(0,g.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"After signing in, contact an administrator to grant you admin access."})]})]})}):"not-admin"===o?(0,g.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background p-4",children:(0,g.jsxs)(k.Card,{className:"max-w-md w-full",children:[(0,g.jsxs)(k.CardHeader,{className:"text-center",children:[(0,g.jsx)("div",{className:"mx-auto mb-4 w-12 h-12 bg-destructive/10 rounded-full flex items-center justify-center",children:(0,g.jsx)(m.ShieldAlert,{className:"h-6 w-6 text-destructive"})}),(0,g.jsx)(k.CardTitle,{children:"Access Denied"}),(0,g.jsx)(k.CardDescription,{children:"You don't have admin privileges to access this area."})]}),(0,g.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,g.jsx)("div",{className:"p-4 bg-muted rounded-lg",children:(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"This area is restricted to administrators only. If you believe you should have access, please contact a system administrator."})}),(0,g.jsx)(l.Button,{className:"w-full",variant:"outline",onClick:()=>b.push("/"),children:"Go to Home"})]})]})}):e?(0,g.jsx)(g.Fragment,{children:a}):null}a.s(["AdminAuthCheck",()=>o],92492);var p=a.i(33217),q=a.i(10598),r=a.i(60246),s=a.i(4720),t=a.i(90166),u=a.i(92e3),v=a.i(17371),w=a.i(86520),x=a.i(24669),y=a.i(63588),z=a.i(90545),A=a.i(90669),B=a.i(10738),C=a.i(57431),D=a.i(77924),E=a.i(18155),F=a.i(23665),G=a.i(64321),H=a.i(27165),I=a.i(67149),J=a.i(58042),K=a.i(94222),L=a.i(54419),M=a.i(59854),N=a.i(48662),O=a.i(2274),P=a.i(61792),Q=a.i(38246);function R(){let{data:a,isLoading:b}=(0,p.useQuery)({queryKey:["/api/admin/overview/stats"],refetchInterval:3e4}),c=a||{users:{total:0,new24h:0,online:0,dailyRegistrations:0,premiumMembers:0},content:{total:0,new24h:0,avgPostsPerUser:0},revenue:{total:0,today:0},moderation:{pending:0,reports:0}},{data:d,isLoading:e}=(0,p.useQuery)({queryKey:["/api/admin/overview/engagement-metrics"],refetchInterval:3e4}),f=d||{dailyActiveUsers:0,postsToday:0,commentsToday:0,likesToday:0},{data:h,isLoading:i}=(0,p.useQuery)({queryKey:["/api/admin/overview/revenue-breakdown"],refetchInterval:6e4}),l=h||{stripe:0,crypto:0,total:0},{data:m,isLoading:n}=(0,p.useQuery)({queryKey:["/api/admin/overview/top-content"],refetchInterval:6e4}),o=Array.isArray(m)?m:[],{data:R,isLoading:S}=(0,p.useQuery)({queryKey:["/api/admin/overview/top-users"],refetchInterval:6e4}),T=Array.isArray(R)?R:[],{data:U,isLoading:V}=(0,p.useQuery)({queryKey:["/api/admin/overview/activity-feed"],refetchInterval:15e3}),W=Array.isArray(U)?U:[],{data:X,isLoading:Y}=(0,p.useQuery)({queryKey:["/api/admin/overview/user-growth"],refetchInterval:6e4}),Z=Array.isArray(X)?X:[],{data:$,isLoading:_}=(0,p.useQuery)({queryKey:["/api/admin/overview/content-trend"],refetchInterval:6e4}),aa=Array.isArray($)?$:[],ab=[{name:"Stripe",value:l.stripe,fill:"hsl(var(--primary))"},{name:"Crypto",value:l.crypto,fill:"hsl(var(--chart-2))"}];return b?(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)(j.Skeleton,{className:"h-10 w-64"}),(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(8)].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b))})]}):(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Overview Dashboard"}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-total-users",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Users"}),(0,g.jsx)(r.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-users",children:c.users.total}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",c.users.new24h," in last 24h"]})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-total-content",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Content"}),(0,g.jsx)(s.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-content",children:c.content.total}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",c.content.new24h," in last 24h"]})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-total-revenue",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Revenue"}),(0,g.jsx)(t.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-total-revenue",children:["$",c.revenue.total]}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+$",c.revenue.today," today"]})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-pending-moderation",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Pending Moderation"}),(0,g.jsx)(u.AlertCircle,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-pending-moderation",children:c.moderation.pending}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:[c.moderation.reports," reports"]})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-online-users",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Online Users"}),(0,g.jsx)(r.Users,{className:"h-4 w-4 text-green-500"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-online-users",children:c.users.online}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Active in last 15min"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-daily-registrations",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Daily Registrations"}),(0,g.jsx)(v.UserPlus,{className:"h-4 w-4 text-blue-500"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-daily-registrations",children:c.users.dailyRegistrations}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Registered today"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-premium-members",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Premium Members"}),(0,g.jsx)(w.Crown,{className:"h-4 w-4 text-amber-500"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-premium-members",children:c.users.premiumMembers}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Level 5 and above"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-avg-posts-user",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Avg Posts/User"}),(0,g.jsx)(x.TrendingUp,{className:"h-4 w-4 text-purple-500"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-posts-user",children:(c.content.avgPostsPerUser||0).toFixed(1)}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Per user average"})]})]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4","data-testid":"section-engagement-metrics",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-dau",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"DAU"}),(0,g.jsx)(A.Activity,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-xl font-bold","data-testid":"text-dau",children:f.dailyActiveUsers})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-posts-today",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Posts Today"}),(0,g.jsx)(s.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-xl font-bold","data-testid":"text-posts-today",children:f.postsToday})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-comments-today",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Comments Today"}),(0,g.jsx)(y.MessageSquare,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-xl font-bold","data-testid":"text-comments-today",children:f.commentsToday})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-likes-today",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Likes Today"}),(0,g.jsx)(z.ThumbsUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-xl font-bold","data-testid":"text-likes-today",children:f.likesToday})})]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-user-growth-chart",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"User Growth (Last 7 Days)"})}),(0,g.jsx)(k.CardContent,{children:Y?(0,g.jsx)(j.Skeleton,{className:"h-64"}):Z.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(C.LineChart,{data:Z,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"date"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(D.Line,{type:"monotone",dataKey:"users",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-content-trend-chart",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Content Trend (Last 7 Days)"})}),(0,g.jsx)(k.CardContent,{children:_?(0,g.jsx)(j.Skeleton,{className:"h-64"}):aa.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(E.BarChart,{data:aa,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"date"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(F.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-revenue-breakdown-chart",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Revenue Breakdown"})}),(0,g.jsx)(k.CardContent,{children:i?(0,g.jsx)(j.Skeleton,{className:"h-64"}):l.total>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(G.PieChart,{children:[(0,g.jsx)(H.Pie,{data:ab,cx:"50%",cy:"50%",labelLine:!1,label:a=>`${a.name}: $${a.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:ab.map((a,b)=>(0,g.jsx)(I.Cell,{fill:a.fill},`cell-${b}`))}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(O.Legend,{})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No revenue data"})})]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-top-content",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Top Content"})}),(0,g.jsx)(k.CardContent,{children:n?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):o.length>0?(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{"data-testid":"table-top-content",children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{className:"w-12",children:"#"}),(0,g.jsx)(q.TableHead,{children:"Title"}),(0,g.jsx)(q.TableHead,{children:"Author"}),(0,g.jsx)(q.TableHead,{children:"Views"})]})}),(0,g.jsx)(q.TableBody,{children:o.map((a,b)=>(0,g.jsxs)(q.TableRow,{"data-testid":`row-top-content-${a.id}`,children:[(0,g.jsx)(q.TableCell,{className:"font-medium",children:b+1}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(Q.default,{href:`/thread/${a.slug}`,className:"text-primary hover:underline","data-testid":`link-content-${a.id}`,children:a.title})}),(0,g.jsx)(q.TableCell,{children:a.author}),(0,g.jsx)(q.TableCell,{children:a.views})]},a.id))})]})}):(0,g.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No content data"})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-top-users",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Top Users Leaderboard"})}),(0,g.jsx)(k.CardContent,{children:S?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):T.length>0?(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{"data-testid":"table-top-users",children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{className:"w-12",children:"#"}),(0,g.jsx)(q.TableHead,{children:"Username"}),(0,g.jsx)(q.TableHead,{children:"Rep"}),(0,g.jsx)(q.TableHead,{children:"Coins"}),(0,g.jsx)(q.TableHead,{children:"Posts"})]})}),(0,g.jsx)(q.TableBody,{children:T.map((a,b)=>(0,g.jsxs)(q.TableRow,{"data-testid":`row-top-user-${a.id}`,children:[(0,g.jsx)(q.TableCell,{className:"font-medium",children:b+1}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(Q.default,{href:`/user/${a.username}`,className:"text-primary hover:underline","data-testid":`link-user-${a.id}`,children:a.username})}),(0,g.jsx)(q.TableCell,{children:a.reputation}),(0,g.jsx)(q.TableCell,{children:a.coinBalance}),(0,g.jsx)(q.TableCell,{children:a.totalPosts})]},a.id))})]})}):(0,g.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No user data"})})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-activity-feed",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Recent Admin Activity"})}),(0,g.jsx)(k.CardContent,{children:V?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):W.length>0?(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Admin"}),(0,g.jsx)(q.TableHead,{children:"Action"}),(0,g.jsx)(q.TableHead,{children:"Target"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Time"})]})}),(0,g.jsx)(q.TableBody,{children:W.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`activity-${a.id}`,children:[(0,g.jsx)(q.TableCell,{"data-testid":`activity-admin-${a.id}`,children:a.adminUsername||"System"}),(0,g.jsx)(q.TableCell,{"data-testid":`activity-action-${a.id}`,children:a.actionType}),(0,g.jsx)(q.TableCell,{"data-testid":`activity-target-${a.id}`,children:a.targetType}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"success"===a.status?"default":"destructive",children:a.status})}),(0,g.jsx)(q.TableCell,{"data-testid":`activity-time-${a.id}`,children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})})]},a.id))})]})}):(0,g.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No recent activity"})})]})]})}a.s(["default",()=>R],64785);var S=a.i(70025),T=a.i(59162),U=a.i(97799),V=a.i(32954),W=a.i(32246),X=a.i(77573),Y=a.i(76725),Z=a.i(18549),$=a.i(24371),_=a.i(87532),aa=a.i(56468);let ab=(0,b.default)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);var ac=a.i(72089),ad=a.i(84505),ae=a.i(13749),af=a.i(50522),ag=a.i(3314),ah=a.i(41675),ai=a.i(72228),aj=a.i(71871);function ak(){let[a,b]=(0,h.useState)(""),[c,d]=(0,h.useState)("all"),[e,f]=(0,h.useState)("all"),[i,m]=(0,h.useState)("createdAt"),[n,o]=(0,h.useState)("desc"),[s,t]=(0,h.useState)(1),[u,v]=(0,h.useState)(25),[w,y]=(0,h.useState)(null),[z,A]=(0,h.useState)(!1),[C,D]=(0,h.useState)(!1),[E,F]=(0,h.useState)(),[G,H]=(0,h.useState)(""),[I,J]=(0,h.useState)(""),[K,L]=(0,h.useState)(""),{toast:M}=(0,Y.useToast)(),{data:N,isLoading:O}=(0,p.useQuery)({queryKey:["/api/admin/users",{search:a,role:c,status:e,sortBy:i,sortOrder:n,page:s,limit:u}]}),R=N?.users||[],ak=N?.totalPages||1,al=N?.total||0,{data:am}=(0,p.useQuery)({queryKey:["/api/admin/users/stats",{search:a,role:c,status:e}],queryFn:()=>{let b=new URLSearchParams;a&&b.append("search",a),"all"!==c&&b.append("role",c),"all"!==e&&b.append("status",e);let d=b.toString();return fetch(`/api/admin/users/stats${d?"?"+d:""}`).then(a=>a.json())}}),an=am||{total:0,avgReputation:0,avgCoins:0,bannedCount:0},{data:ao}=(0,p.useQuery)({queryKey:["/api/admin/users",w?.id,"activity"],queryFn:()=>fetch(`/api/admin/users/${w?.id}/activity`).then(a=>a.json()),enabled:!!w}),ap=ao||{totalThreads:0,totalReplies:0,totalContent:0,coinsEarned:0,coinsSpent:0,accountAge:0},{data:aq}=(0,p.useQuery)({queryKey:["/api/admin/users",w?.id,"posts"],queryFn:()=>fetch(`/api/admin/users/${w?.id}/posts`).then(a=>a.json()),enabled:!!w}),ar=Array.isArray(aq)?aq:[],{data:as}=(0,p.useQuery)({queryKey:["/api/admin/users",w?.id,"coin-history"],queryFn:()=>fetch(`/api/admin/users/${w?.id}/coin-history`).then(a=>a.json()),enabled:!!w}),at=Array.isArray(as)?as:[],au=(0,S.useMutation)({mutationFn:async({userId:a,reason:b})=>(0,aj.apiRequest)("POST",`/api/admin/users/${a}/ban`,{reason:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),M({title:"User banned successfully"}),y(null)},onError:()=>{M({title:"Failed to ban user",variant:"destructive"})}}),av=(0,S.useMutation)({mutationFn:async({userId:a,suspendedUntil:b,reason:c})=>(0,aj.apiRequest)("POST",`/api/admin/users/${a}/suspend`,{suspendedUntil:b,reason:c}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),M({title:"User suspended successfully"}),A(!1),F(void 0),H(""),y(null)},onError:()=>{M({title:"Failed to suspend user",variant:"destructive"})}}),aw=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("POST",`/api/admin/users/${a}/activate`,{}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),M({title:"User activated successfully"}),y(null)},onError:()=>{M({title:"Failed to activate user",variant:"destructive"})}}),ax=(0,S.useMutation)({mutationFn:async({userId:a,role:b,reason:c})=>(0,aj.apiRequest)("POST",`/api/admin/users/${a}/role`,{role:b,reason:c}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),M({title:"User role changed successfully"}),D(!1),J(""),L(""),y(null)},onError:()=>{M({title:"Failed to change user role",variant:"destructive"})}}),ay=(0,S.useMutation)({mutationFn:async({userId:a,amount:b,reason:c})=>(0,aj.apiRequest)("POST",`/api/admin/users/${a}/adjust-coins`,{amount:b,reason:c}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/users"]}),M({title:"Coins adjusted successfully"})},onError:()=>{M({title:"Failed to adjust coins",variant:"destructive"})}}),az=async()=>{try{let b=new URLSearchParams({search:a,role:c,status:e,sortBy:i,sortOrder:n}),d=await fetch(`/api/admin/users/export/csv?${b}`);if(!d.ok)throw Error("Export failed");let f=await d.blob(),g=window.URL.createObjectURL(f),h=document.createElement("a");h.href=g,h.download=`users-export-${new Date().toISOString()}.csv`,document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(g),document.body.removeChild(h),M({title:"Users exported successfully"})}catch(a){M({title:"Failed to export users",variant:"destructive"})}};return O?(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)(j.Skeleton,{className:"h-10 w-64"}),(0,g.jsx)(j.Skeleton,{className:"h-96"})]}):(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"User Management"}),(0,g.jsxs)(l.Button,{onClick:az,variant:"outline","data-testid":"button-export-users",children:[(0,g.jsx)(ad.Download,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4","data-testid":"section-user-stats",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-total-users-stat",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Users"}),(0,g.jsx)(r.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-users-stat",children:an.total})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-avg-reputation",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Avg Reputation"}),(0,g.jsx)(x.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-reputation",children:(an.avgReputation||0).toFixed(0)})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-avg-coins",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Avg Coins"}),(0,g.jsx)(ac.Coins,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-coins",children:(an.avgCoins||0).toFixed(0)})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-banned-count",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Banned/Suspended"}),(0,g.jsx)(aa.Ban,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-banned-count",children:an.bannedCount})})]})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Search & Filters"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,g.jsxs)("div",{className:"relative flex-1",children:[(0,g.jsx)(_.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,g.jsx)(T.Input,{placeholder:"Search by username or email...",value:a,onChange:a=>b(a.target.value),className:"pl-9","data-testid":"input-user-search"})]}),(0,g.jsxs)(V.Select,{value:c,onValueChange:d,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-role-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Filter by role"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Roles"}),(0,g.jsx)(V.SelectItem,{value:"member",children:"Member"}),(0,g.jsx)(V.SelectItem,{value:"moderator",children:"Moderator"}),(0,g.jsx)(V.SelectItem,{value:"admin",children:"Admin"})]})]}),(0,g.jsxs)(V.Select,{value:e,onValueChange:f,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-status-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Filter by status"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Status"}),(0,g.jsx)(V.SelectItem,{value:"active",children:"Active"}),(0,g.jsx)(V.SelectItem,{value:"suspended",children:"Suspended"}),(0,g.jsx)(V.SelectItem,{value:"banned",children:"Banned"})]})]})]}),(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,g.jsxs)(V.Select,{value:i,onValueChange:m,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-sort-by",children:(0,g.jsx)(V.SelectValue,{placeholder:"Sort by"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"username",children:"Username"}),(0,g.jsx)(V.SelectItem,{value:"email",children:"Email"}),(0,g.jsx)(V.SelectItem,{value:"coinBalance",children:"Coins"}),(0,g.jsx)(V.SelectItem,{value:"reputation",children:"Reputation"}),(0,g.jsx)(V.SelectItem,{value:"createdAt",children:"Created At"}),(0,g.jsx)(V.SelectItem,{value:"lastActive",children:"Last Active"})]})]}),(0,g.jsxs)(V.Select,{value:n,onValueChange:o,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-sort-order",children:(0,g.jsx)(V.SelectValue,{placeholder:"Sort order"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"asc",children:"Ascending"}),(0,g.jsx)(V.SelectItem,{value:"desc",children:"Descending"})]})]})]})]})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Users (",al,")"]})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"User"}),(0,g.jsx)(q.TableHead,{children:"Email"}),(0,g.jsx)(q.TableHead,{children:"Role"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Coins"}),(0,g.jsx)(q.TableHead,{children:"Joined"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:R.length>0?R.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`user-row-${a.id}`,children:[(0,g.jsx)(q.TableCell,{"data-testid":`user-name-${a.id}`,children:a.username}),(0,g.jsx)(q.TableCell,{children:a.email}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"outline",children:a.role})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"active"===a.status?"default":"destructive",children:a.status})}),(0,g.jsx)(q.TableCell,{"data-testid":`user-coins-${a.id}`,children:a.coinBalance}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,g.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:()=>y(a),"data-testid":`button-view-user-${a.id}`,children:[(0,g.jsx)(ab,{className:"h-4 w-4 mr-1"}),"View"]}),"active"===a.status?(0,g.jsxs)(l.Button,{size:"sm",variant:"destructive",onClick:()=>au.mutate({userId:a.id,reason:"Manual ban"}),"data-testid":`button-ban-user-${a.id}`,children:[(0,g.jsx)(aa.Ban,{className:"h-4 w-4 mr-1"}),"Ban"]}):(0,g.jsxs)(l.Button,{size:"sm",variant:"default",onClick:()=>aw.mutate(a.id),"data-testid":`button-activate-user-${a.id}`,children:[(0,g.jsx)(ab,{className:"h-4 w-4 mr-1"}),"Activate"]})]})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No users found"})})})]})}),(0,g.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)("span",{className:"text-sm text-muted-foreground",children:"Items per page:"}),(0,g.jsxs)(V.Select,{value:u.toString(),onValueChange:a=>v(parseInt(a)),children:[(0,g.jsx)(V.SelectTrigger,{className:"w-20","data-testid":"select-items-per-page",children:(0,g.jsx)(V.SelectValue,{})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"10",children:"10"}),(0,g.jsx)(V.SelectItem,{value:"25",children:"25"}),(0,g.jsx)(V.SelectItem,{value:"50",children:"50"}),(0,g.jsx)(V.SelectItem,{value:"100",children:"100"})]})]})]}),(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>t(a=>Math.max(1,a-1)),disabled:1===s,"data-testid":"button-previous-page",children:[(0,g.jsx)(ae.ChevronLeft,{className:"h-4 w-4 mr-1"}),"Previous"]}),(0,g.jsxs)("span",{className:"text-sm","data-testid":"text-page-info",children:["Page ",s," of ",ak]}),(0,g.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>t(a=>Math.min(ak,a+1)),disabled:s===ak,"data-testid":"button-next-page",children:["Next",(0,g.jsx)(af.ChevronRight,{className:"h-4 w-4 ml-1"})]})]})]})]})]}),(0,g.jsx)(W.Dialog,{open:!!w,onOpenChange:a=>!a&&y(null),children:(0,g.jsxs)(W.DialogContent,{className:"max-w-3xl max-h-[80vh] overflow-y-auto","data-testid":"modal-user-detail",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsxs)(W.DialogTitle,{children:["User Details: ",w?.username]}),(0,g.jsx)(W.DialogDescription,{children:"Comprehensive user information and management"})]}),w&&(0,g.jsxs)(X.Tabs,{defaultValue:"profile",className:"w-full",children:[(0,g.jsxs)(X.TabsList,{className:"grid w-full grid-cols-4",children:[(0,g.jsx)(X.TabsTrigger,{value:"profile","data-testid":"tab-profile",children:"Profile"}),(0,g.jsx)(X.TabsTrigger,{value:"activity","data-testid":"tab-activity",children:"Activity"}),(0,g.jsx)(X.TabsTrigger,{value:"posts","data-testid":"tab-posts",children:"Posts"}),(0,g.jsx)(X.TabsTrigger,{value:"coin-history","data-testid":"tab-coin-history",children:"Coin History"})]}),(0,g.jsxs)(X.TabsContent,{value:"profile",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Username"}),(0,g.jsx)("p",{className:"font-medium",children:w.username})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Email"}),(0,g.jsx)("p",{className:"font-medium",children:w.email})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Role"}),(0,g.jsx)(P.Badge,{variant:"outline",children:w.role})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,g.jsx)(P.Badge,{variant:"active"===w.status?"default":"destructive",children:w.status})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Coin Balance"}),(0,g.jsx)("p",{className:"font-medium",children:w.coinBalance})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Reputation"}),(0,g.jsx)("p",{className:"font-medium",children:w.reputation})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Level"}),(0,g.jsx)("p",{className:"font-medium",children:w.level||0})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Created At"}),(0,g.jsx)("p",{className:"font-medium",children:(0,B.formatDistanceToNow)(new Date(w.createdAt),{addSuffix:!0})})]}),w.lastActive&&(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Last Active"}),(0,g.jsx)("p",{className:"font-medium",children:(0,B.formatDistanceToNow)(new Date(w.lastActive),{addSuffix:!0})})]}),w.suspendedUntil&&(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Suspended Until"}),(0,g.jsx)("p",{className:"font-medium",children:(0,ai.format)(new Date(w.suspendedUntil),"PPP")})]})]}),(0,g.jsxs)("div",{className:"flex gap-2 flex-wrap pt-4",children:[(0,g.jsxs)(l.Button,{onClick:()=>{A(!0)},variant:"outline",disabled:"active"!==w.status,children:[(0,g.jsx)(ah.Calendar,{className:"h-4 w-4 mr-1"}),"Suspend"]}),(0,g.jsxs)(l.Button,{onClick:()=>{D(!0)},variant:"outline",children:[(0,g.jsx)(ag.Shield,{className:"h-4 w-4 mr-1"}),"Change Role"]}),(0,g.jsxs)(l.Button,{onClick:()=>{ay.mutate({userId:w.id,amount:100,reason:"Admin adjustment"})},variant:"outline",children:[(0,g.jsx)(ac.Coins,{className:"h-4 w-4 mr-1"}),"Add 100 Coins"]})]})]}),(0,g.jsx)(X.TabsContent,{value:"activity",className:"space-y-4",children:(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm",children:"Total Threads"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("p",{className:"text-2xl font-bold",children:ap.totalThreads})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm",children:"Total Replies"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("p",{className:"text-2xl font-bold",children:ap.totalReplies})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm",children:"Content Published"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("p",{className:"text-2xl font-bold",children:ap.totalContent})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm",children:"Coins Earned"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("p",{className:"text-2xl font-bold",children:ap.coinsEarned})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm",children:"Coins Spent"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("p",{className:"text-2xl font-bold",children:ap.coinsSpent})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm",children:"Account Age"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("p",{className:"text-2xl font-bold",children:[ap.accountAge," days"]})})]})]})}),(0,g.jsx)(X.TabsContent,{value:"posts",children:ar.length>0?(0,g.jsx)("div",{className:"space-y-2",children:ar.map(a=>(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"pt-4",children:(0,g.jsxs)("div",{className:"flex justify-between items-start",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)(Q.default,{href:`/thread/${a.slug}`,className:"text-primary hover:underline font-medium",children:a.title}),(0,g.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["thread"===a.type?"Thread":"Reply"," Â· ",(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})]})]}),void 0!==a.views&&(0,g.jsxs)("div",{className:"text-sm text-muted-foreground",children:[a.views," views"]})]})})},a.id))}):(0,g.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No posts yet"})}),(0,g.jsx)(X.TabsContent,{value:"coin-history",children:at.length>0?(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Date"}),(0,g.jsx)(q.TableHead,{children:"Type"}),(0,g.jsx)(q.TableHead,{children:"Amount"}),(0,g.jsx)(q.TableHead,{children:"Description"}),(0,g.jsx)(q.TableHead,{children:"Balance"})]})}),(0,g.jsx)(q.TableBody,{children:at.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"earn"===a.type||"recharge"===a.type?"default":"secondary",children:a.type})}),(0,g.jsxs)(q.TableCell,{className:a.amount>0?"text-green-600":"text-red-600",children:[a.amount>0?"+":"",a.amount]}),(0,g.jsx)(q.TableCell,{children:a.description}),(0,g.jsx)(q.TableCell,{children:a.balance})]},a.id))})]})}):(0,g.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No coin history"})})]})]})}),(0,g.jsx)(W.Dialog,{open:z,onOpenChange:A,children:(0,g.jsxs)(W.DialogContent,{"data-testid":"dialog-suspend-user",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Suspend User"}),(0,g.jsxs)(W.DialogDescription,{children:["Temporarily suspend ",w?.username,"'s account"]})]}),(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-sm font-medium",children:"Suspended Until"}),(0,g.jsxs)($.Popover,{children:[(0,g.jsx)($.PopoverTrigger,{asChild:!0,children:(0,g.jsxs)(l.Button,{variant:"outline",className:"w-full justify-start text-left font-normal mt-2","data-testid":"input-suspended-until",children:[(0,g.jsx)(ah.Calendar,{className:"mr-2 h-4 w-4"}),E?(0,ai.format)(E,"PPP"):(0,g.jsx)("span",{children:"Pick a date"})]})}),(0,g.jsx)($.PopoverContent,{className:"w-auto p-0",children:(0,g.jsx)(Z.Calendar,{mode:"single",selected:E,onSelect:F,initialFocus:!0})})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-sm font-medium",children:"Reason"}),(0,g.jsx)(U.Textarea,{placeholder:"Enter suspension reason...",value:G,onChange:a=>H(a.target.value),className:"mt-2","data-testid":"input-suspend-reason"})]})]}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),(0,g.jsx)(l.Button,{onClick:()=>{w&&E&&av.mutate({userId:w.id,suspendedUntil:E.toISOString(),reason:G})},disabled:!E||av.isPending,"data-testid":"button-suspend-confirm",children:av.isPending?"Suspending...":"Suspend User"})]})]})}),(0,g.jsx)(W.Dialog,{open:C,onOpenChange:D,children:(0,g.jsxs)(W.DialogContent,{"data-testid":"dialog-change-role",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Change User Role"}),(0,g.jsxs)(W.DialogDescription,{children:["Change the role for ",w?.username]})]}),(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-sm font-medium",children:"New Role"}),(0,g.jsxs)(V.Select,{value:I,onValueChange:J,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full mt-2","data-testid":"select-new-role",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select new role"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"member",children:"Member"}),(0,g.jsx)(V.SelectItem,{value:"moderator",children:"Moderator"}),(0,g.jsx)(V.SelectItem,{value:"admin",children:"Admin"})]})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-sm font-medium",children:"Reason (Optional)"}),(0,g.jsx)(U.Textarea,{placeholder:"Enter reason for role change...",value:K,onChange:a=>L(a.target.value),className:"mt-2","data-testid":"input-role-change-reason"})]})]}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),(0,g.jsx)(l.Button,{onClick:()=>{w&&I&&ax.mutate({userId:w.id,role:I,reason:K})},disabled:!I||ax.isPending,"data-testid":"button-change-role-confirm",children:ax.isPending?"Changing...":"Change Role"})]})]})})]})}a.s(["default",()=>ak],81079);var al=a.i(27311),am=a.i(510),an=a.i(53465),ao=a.i(16201);let ap=(0,b.default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var aq=a.i(77156),ar=a.i(73570),as=a.i(41710),at=a.i(46842),au=a.i(69520);let av=(0,b.default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var aw=a.i(81560),ax=a.i(53390);function ay(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)("all"),[d,e]=(0,h.useState)(1),[f,i]=(0,h.useState)(20),[m,n]=(0,h.useState)([]),[o,r]=(0,h.useState)("pending"),[t,u]=(0,h.useState)(1),[v,w]=(0,h.useState)(20),[y,z]=(0,h.useState)(100),[A,C]=(0,h.useState)("all"),[D,E]=(0,h.useState)(!1),[F,G]=(0,h.useState)(null),[H,I]=(0,h.useState)(!1),[J,K]=(0,h.useState)(null),[L,M]=(0,h.useState)(""),[N,O]=(0,h.useState)(!1),[Q,R]=(0,h.useState)(!1),[Z,$]=(0,h.useState)(null),[_,ab]=(0,h.useState)(null),[ac,ad]=(0,h.useState)(!1),[ah,ak]=(0,h.useState)(""),[ay,az]=(0,h.useState)(!1),[aA,aB]=(0,h.useState)(7),[aC,aD]=(0,h.useState)(""),[aE,aF]=(0,h.useState)(null),[aG,aH]=(0,h.useState)(!1),[aI,aJ]=(0,h.useState)(""),[aK,aL]=(0,h.useState)(!1),[aM,aN]=(0,h.useState)(null),[aO,aP]=(0,h.useState)(!1),[aQ,aR]=(0,h.useState)(!1),[aS,aT]=(0,h.useState)(""),{data:aU,isLoading:aV}=(0,p.useQuery)({queryKey:["/api/moderation/queue",{type:b,page:d,perPage:f}],refetchInterval:3e4}),{data:aW}=(0,p.useQuery)({queryKey:["/api/moderation/queue/count"],refetchInterval:3e4}),{data:aX,isLoading:aY}=(0,p.useQuery)({queryKey:["/api/moderation/reported",{status:o,page:t,perPage:v}],refetchInterval:3e4}),{data:aZ}=(0,p.useQuery)({queryKey:["/api/moderation/reported/count"],refetchInterval:3e4}),{data:a$,isLoading:a_}=(0,p.useQuery)({queryKey:["/api/moderation/history",{limit:y,moderatorId:"all"!==A?A:void 0}],refetchInterval:!1}),{data:a0,isLoading:a1}=(0,p.useQuery)({queryKey:["/api/moderation/stats"],refetchInterval:6e4}),a2=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("POST",`/api/moderation/${a}/approve`,{}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),a({title:"Content approved successfully"}),n([])},onError:()=>{a({title:"Failed to approve content",variant:"destructive"})}}),a3=(0,S.useMutation)({mutationFn:async({contentId:a,reason:b,deletePermanently:c})=>(0,aj.apiRequest)("POST",`/api/moderation/${a}/reject`,{reason:b,deletePermanently:c}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),a({title:"Content rejected successfully"}),I(!1),M(""),O(!1),K(null),E(!1),n([])},onError:()=>{a({title:"Failed to reject content",variant:"destructive"})}}),a4=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("POST","/api/moderation/bulk-approve",{contentIds:a}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),a({title:`Successfully approved ${m.length} items`}),n([]),aP(!1)},onError:()=>{a({title:"Failed to approve selected items",variant:"destructive"})}}),a5=(0,S.useMutation)({mutationFn:async({contentIds:a,reason:b})=>(0,aj.apiRequest)("POST","/api/moderation/bulk-reject",{contentIds:a,reason:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/moderation/queue"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/queue/count"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),a({title:`Successfully rejected ${m.length} items`}),n([]),aR(!1),aT("")},onError:()=>{a({title:"Failed to reject selected items",variant:"destructive"})}}),a6=(0,S.useMutation)({mutationFn:async({reportId:a,reason:b})=>(0,aj.apiRequest)("POST",`/api/moderation/report/${a}/dismiss`,{reason:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/moderation/reported"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/reported/count"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]}),a({title:"Report dismissed successfully"}),ad(!1),ak(""),R(!1)},onError:()=>{a({title:"Failed to dismiss report",variant:"destructive"})}}),a7=(0,S.useMutation)({mutationFn:async({reportId:a,action:b,reason:c,suspendDays:d})=>(0,aj.apiRequest)("POST",`/api/moderation/report/${a}/action`,{action:b,reason:c,suspendDays:d}),onSuccess:(b,c)=>{aj.queryClient.invalidateQueries({queryKey:["/api/moderation/reported"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/reported/count"]}),aj.queryClient.invalidateQueries({queryKey:["/api/moderation/stats"]});let d="delete"===c.action?"deleted":"warn"===c.action?"warned":"suspend"===c.action?"suspended":"banned";a({title:`Author ${d} successfully`}),R(!1),az(!1),aH(!1),aD(""),aJ(""),aL(!1)},onError:()=>{a({title:"Failed to take action",variant:"destructive"})}}),a8=async b=>{try{let a=await fetch(`/api/moderation/${b}/details`),c=await a.json();G(c),E(!0)}catch(b){a({title:"Failed to load content details",variant:"destructive"})}},a9=async b=>{try{let a=await fetch(`/api/moderation/report/${b}`),c=await a.json();$(c),ab(b),R(!0)}catch(b){a({title:"Failed to load report details",variant:"destructive"})}},ba=a=>{K(a),I(!0)},bb=(a,b)=>a.length<=b?a:a.substring(0,b)+"...",bc=aU?.items||[],bd=aX?.items||[],be=a$||[],bf=bc.length>0&&m.length===bc.length;return m.length>0&&(m.length,bc.length),(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Content Moderation"})}),(0,g.jsxs)(X.Tabs,{defaultValue:"queue",className:"space-y-4",children:[(0,g.jsxs)(X.TabsList,{children:[(0,g.jsxs)(X.TabsTrigger,{value:"queue","data-testid":"tab-moderation-queue",children:["Moderation Queue",aW&&aW.pending>0&&(0,g.jsx)(P.Badge,{variant:"destructive",className:"ml-2",children:aW.pending})]}),(0,g.jsxs)(X.TabsTrigger,{value:"reported","data-testid":"tab-reported-content",children:["Reported Content",aZ&&aZ.pending>0&&(0,g.jsx)(P.Badge,{variant:"destructive",className:"ml-2",children:aZ.pending})]}),(0,g.jsx)(X.TabsTrigger,{value:"history","data-testid":"tab-moderation-history",children:"Moderation History"}),(0,g.jsx)(X.TabsTrigger,{value:"stats","data-testid":"tab-moderation-stats",children:"Statistics"})]}),(0,g.jsxs)(X.TabsContent,{value:"queue",className:"space-y-4",children:[(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,g.jsx)(k.CardTitle,{children:"Content Type"}),(0,g.jsx)(X.Tabs,{value:b,onValueChange:c,className:"w-auto",children:(0,g.jsxs)(X.TabsList,{children:[(0,g.jsx)(X.TabsTrigger,{value:"all","data-testid":"filter-content-type-all",children:"All"}),(0,g.jsx)(X.TabsTrigger,{value:"thread","data-testid":"filter-content-type-thread",children:"Threads"}),(0,g.jsx)(X.TabsTrigger,{value:"reply","data-testid":"filter-content-type-reply",children:"Replies"})]})})]})})}),m.length>0&&(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"pt-6",children:(0,g.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,g.jsxs)(l.Button,{onClick:()=>{0===m.length||m.length>100||aP(!0)},disabled:0===m.length||m.length>100||a4.isPending,"data-testid":"button-bulk-approve",children:[(0,g.jsx)(ao.CheckCircle,{className:"h-4 w-4 mr-2"}),"Approve Selected (",m.length,")"]}),(0,g.jsxs)(l.Button,{variant:"destructive",onClick:()=>{0===m.length||m.length>100||aR(!0)},disabled:0===m.length||m.length>100||a5.isPending,"data-testid":"button-bulk-reject",children:[(0,g.jsx)(ap,{className:"h-4 w-4 mr-2"}),"Reject Selected (",m.length,")"]}),m.length>100&&(0,g.jsx)(an.Alert,{className:"flex-1",children:(0,g.jsx)(an.AlertDescription,{children:"Maximum 100 items can be selected for bulk actions"})})]})})}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Pending Content (",aU?.total||0,")"]})}),(0,g.jsxs)(k.CardContent,{children:[aV?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-16"},b))}):0===bc.length?(0,g.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No pending items in queue"}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{"data-testid":"table-moderation-queue",children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{className:"w-12",children:(0,g.jsx)(al.Checkbox,{checked:bf,onCheckedChange:a=>{a?n((aU?.items||[]).map(a=>a.id)):n([])},"data-testid":"checkbox-select-all"})}),(0,g.jsx)(q.TableHead,{children:"Content Preview"}),(0,g.jsx)(q.TableHead,{children:"Author"}),(0,g.jsx)(q.TableHead,{children:"Category"}),(0,g.jsx)(q.TableHead,{children:"Submitted"}),(0,g.jsx)(q.TableHead,{children:"Word Count"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:bc.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(al.Checkbox,{checked:m.includes(a.id),onCheckedChange:b=>{var c;return c=a.id,void(b?n([...m,c]):n(m.filter(a=>a!==c)))},"data-testid":`checkbox-select-${a.id}`})}),(0,g.jsx)(q.TableCell,{className:"max-w-md",children:(0,g.jsxs)("div",{className:"space-y-1",children:[a.title&&(0,g.jsx)("div",{className:"font-medium",children:bb(a.title,50)}),(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:bb(a.body,100)}),(0,g.jsxs)("div",{className:"flex gap-1",children:[(0,g.jsx)(P.Badge,{variant:"outline",children:a.type}),a.hasLinks&&(0,g.jsx)(P.Badge,{variant:"secondary",children:"Links"}),a.hasImages&&(0,g.jsx)(P.Badge,{variant:"secondary",children:"Images"})]})]})}),(0,g.jsxs)(q.TableCell,{children:["@",a.authorUsername]}),(0,g.jsx)(q.TableCell,{children:"thread"===a.type?a.categoryName:a.threadTitle}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:a.wordCount}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,g.jsxs)(l.Button,{size:"sm",variant:"ghost",onClick:()=>a8(a.id),"data-testid":`button-view-details-${a.id}`,children:[(0,g.jsx)(aq.Eye,{className:"h-4 w-4 mr-1"}),"View"]}),(0,g.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:()=>a2.mutate(a.id),disabled:a2.isPending,"data-testid":`button-approve-${a.id}`,children:[(0,g.jsx)(ao.CheckCircle,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,g.jsxs)(l.Button,{size:"sm",variant:"destructive",onClick:()=>ba(a.id),"data-testid":`button-reject-${a.id}`,children:[(0,g.jsx)(ap,{className:"h-4 w-4 mr-1"}),"Reject"]})]})})]},a.id))})]})}),aU&&aU.pages>1&&(0,g.jsxs)("div",{className:"flex items-center justify-between gap-4 mt-4 flex-wrap",children:[(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)("span",{className:"text-sm text-muted-foreground",children:"Items per page:"}),(0,g.jsxs)(V.Select,{value:f.toString(),onValueChange:a=>i(Number(a)),children:[(0,g.jsx)(V.SelectTrigger,{className:"w-20",children:(0,g.jsx)(V.SelectValue,{})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"10",children:"10"}),(0,g.jsx)(V.SelectItem,{value:"20",children:"20"}),(0,g.jsx)(V.SelectItem,{value:"50",children:"50"}),(0,g.jsx)(V.SelectItem,{value:"100",children:"100"})]})]})]}),(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>e(a=>Math.max(1,a-1)),disabled:1===d,children:[(0,g.jsx)(ae.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,g.jsxs)("span",{className:"text-sm",children:["Page ",d," of ",aU.pages]}),(0,g.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>e(a=>Math.min(aU.pages,a+1)),disabled:d===aU.pages,children:["Next",(0,g.jsx)(af.ChevronRight,{className:"h-4 w-4"})]})]})]})]})]})]}),(0,g.jsxs)(X.TabsContent,{value:"reported",className:"space-y-4",children:[(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,g.jsx)(k.CardTitle,{children:"Filter by Status"}),(0,g.jsxs)(V.Select,{value:o,onValueChange:r,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-48",children:(0,g.jsx)(V.SelectValue,{})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"pending",children:"Pending"}),(0,g.jsx)(V.SelectItem,{value:"resolved",children:"Resolved"}),(0,g.jsx)(V.SelectItem,{value:"dismissed",children:"Dismissed"})]})]})]})})}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Reported Content (",aX?.total||0,")"]})}),(0,g.jsxs)(k.CardContent,{children:[aY?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-16"},b))}):0===bd.length?(0,g.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No reported content found"}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{"data-testid":"table-reported-content",children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Content Preview"}),(0,g.jsx)(q.TableHead,{children:"Author"}),(0,g.jsx)(q.TableHead,{children:"Reports"}),(0,g.jsx)(q.TableHead,{children:"Reasons"}),(0,g.jsx)(q.TableHead,{children:"First Reported"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:bd.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{className:"max-w-md",children:(0,g.jsxs)("div",{className:"space-y-1",children:[(0,g.jsx)("div",{className:"text-sm",children:bb(a.contentPreview,100)}),(0,g.jsx)(P.Badge,{variant:"outline",children:a.contentType})]})}),(0,g.jsxs)(q.TableCell,{children:["@",a.authorUsername]}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"destructive",children:a.reportCount})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.reasons.slice(0,3).map((a,b)=>(0,g.jsx)(P.Badge,{variant:"secondary",children:a},b)),a.reasons.length>3&&(0,g.jsxs)(P.Badge,{variant:"secondary",children:["+",a.reasons.length-3]})]})}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.firstReportedAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"pending"===a.status?"destructive":"resolved"===a.status?"default":"secondary",children:a.status})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,g.jsxs)(l.Button,{size:"sm",variant:"ghost",onClick:()=>a9(a.contentId),children:[(0,g.jsx)(aq.Eye,{className:"h-4 w-4 mr-1"}),"View Details"]}),"pending"===a.status&&(0,g.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:()=>a9(a.contentId),"data-testid":`button-take-action-${a.contentId}`,children:[(0,g.jsx)(ag.Shield,{className:"h-4 w-4 mr-1"}),"Take Action"]})]})})]},a.contentId))})]})}),aX&&aX.pages>1&&(0,g.jsxs)("div",{className:"flex items-center justify-between gap-4 mt-4 flex-wrap",children:[(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)("span",{className:"text-sm text-muted-foreground",children:"Items per page:"}),(0,g.jsxs)(V.Select,{value:v.toString(),onValueChange:a=>w(Number(a)),children:[(0,g.jsx)(V.SelectTrigger,{className:"w-20",children:(0,g.jsx)(V.SelectValue,{})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"10",children:"10"}),(0,g.jsx)(V.SelectItem,{value:"20",children:"20"}),(0,g.jsx)(V.SelectItem,{value:"50",children:"50"}),(0,g.jsx)(V.SelectItem,{value:"100",children:"100"})]})]})]}),(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>u(a=>Math.max(1,a-1)),disabled:1===t,children:[(0,g.jsx)(ae.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,g.jsxs)("span",{className:"text-sm",children:["Page ",t," of ",aX.pages]}),(0,g.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>u(a=>Math.min(aX.pages,a+1)),disabled:t===aX.pages,children:["Next",(0,g.jsx)(af.ChevronRight,{className:"h-4 w-4"})]})]})]})]})]})]}),(0,g.jsxs)(X.TabsContent,{value:"history",className:"space-y-4",children:[(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,g.jsx)(k.CardTitle,{children:"Filters"}),(0,g.jsxs)("div",{className:"flex gap-4 flex-wrap",children:[(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)("span",{className:"text-sm",children:"Moderator:"}),(0,g.jsxs)(V.Select,{value:A,onValueChange:C,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-48","data-testid":"select-moderator-filter",children:(0,g.jsx)(V.SelectValue,{})}),(0,g.jsx)(V.SelectContent,{children:(0,g.jsx)(V.SelectItem,{value:"all",children:"All Moderators"})})]})]}),(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)("span",{className:"text-sm",children:"Limit:"}),(0,g.jsxs)(V.Select,{value:y.toString(),onValueChange:a=>z(Number(a)),children:[(0,g.jsx)(V.SelectTrigger,{className:"w-32",children:(0,g.jsx)(V.SelectValue,{})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"50",children:"50"}),(0,g.jsx)(V.SelectItem,{value:"100",children:"100"}),(0,g.jsx)(V.SelectItem,{value:"200",children:"200"}),(0,g.jsx)(V.SelectItem,{value:"500",children:"500"})]})]})]}),(0,g.jsxs)(l.Button,{variant:"outline",onClick:()=>aj.queryClient.invalidateQueries({queryKey:["/api/moderation/history"]}),children:[(0,g.jsx)(au.RefreshCw,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]})})}),(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsx)(k.CardTitle,{children:"Moderation History"}),(0,g.jsx)(k.CardDescription,{children:"Read-only log of recent moderation actions"})]}),(0,g.jsx)(k.CardContent,{children:a_?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):0===be.length?(0,g.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No moderation history available"}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{"data-testid":"table-history",children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Timestamp"}),(0,g.jsx)(q.TableHead,{children:"Moderator"}),(0,g.jsx)(q.TableHead,{children:"Action"}),(0,g.jsx)(q.TableHead,{children:"Content"}),(0,g.jsx)(q.TableHead,{children:"Reason"})]})}),(0,g.jsx)(q.TableBody,{children:be.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{children:(0,ai.format)(new Date(a.createdAt),"MMM d, yyyy HH:mm")}),(0,g.jsxs)(q.TableCell,{children:["@",a.moderatorUsername]}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"approve"===a.actionType?"default":"reject"===a.actionType?"destructive":"secondary",children:a.actionType})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"space-y-1",children:[(0,g.jsx)("div",{className:"text-sm",children:bb(a.contentTitle,50)}),(0,g.jsx)(P.Badge,{variant:"outline",children:a.contentType})]})}),(0,g.jsx)(q.TableCell,{className:"max-w-md",children:a.reason?bb(a.reason,100):"-"})]},a.id))})]})})})]})]}),(0,g.jsx)(X.TabsContent,{value:"stats",className:"space-y-4",children:a1?(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(8)].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b))}):a0?(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-today-approved",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Today Approved"}),(0,g.jsx)(ao.CheckCircle,{className:"h-4 w-4 text-green-500"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold",children:a0.todayApproved})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-today-rejected",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Today Rejected"}),(0,g.jsx)(ap,{className:"h-4 w-4 text-red-500"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold",children:a0.todayRejected})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-today-reports-handled",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Today Reports Handled"}),(0,g.jsx)(ar.AlertTriangle,{className:"h-4 w-4 text-orange-500"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold",children:a0.todayReportsHandled})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-total-moderated-today",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Moderated Today"}),(0,g.jsx)(x.TrendingUp,{className:"h-4 w-4 text-blue-500"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold",children:a0.totalModeratedToday})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-avg-response-time",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Avg Response Time"}),(0,g.jsx)(as.Clock,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold",children:[a0.avgResponseTimeMinutes,"m"]}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Average time to first action"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-most-active-moderator",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Most Active Moderator"}),(0,g.jsx)(at.User,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-lg font-bold",children:["@",a0.mostActiveModerator||"N/A"]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-pending-under-1hr",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Pending < 1hr"}),(0,g.jsx)(s.FileText,{className:"h-4 w-4 text-green-500"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold",children:a0.pendingUnderOneHour}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Fresh submissions"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-pending-over-24hrs",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Pending > 24hrs"}),(0,g.jsx)(ar.AlertTriangle,{className:"h-4 w-4 text-red-500"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold",children:a0.pendingOverTwentyFourHours}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Urgent - needs attention"})]})]})]}):null})]}),(0,g.jsx)(W.Dialog,{open:D,onOpenChange:E,children:(0,g.jsxs)(W.DialogContent,{className:"max-w-4xl max-h-[90vh]","data-testid":"dialog-content-details",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsxs)(W.DialogTitle,{children:["Review Content - ",F?.type==="thread"?"Thread":"Reply"]})}),(0,g.jsx)(am.ScrollArea,{className:"max-h-[calc(90vh-150px)]",children:F&&(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"font-semibold mb-2",children:"Content"}),F.title&&(0,g.jsx)("h4",{className:"text-lg font-bold mb-2",children:F.title}),(0,g.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:F.body})]}),F.parentThread&&(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"font-semibold mb-2",children:"Parent Thread"}),(0,g.jsx)("div",{className:"p-3 bg-muted rounded-lg",children:(0,g.jsx)("p",{className:"text-sm",children:F.parentThread.title})})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"font-semibold mb-2",children:"Author Information"}),(0,g.jsxs)("div",{className:"flex items-start gap-4 p-4 bg-muted rounded-lg",children:[(0,g.jsx)(ax.Avatar,{children:(0,g.jsx)(ax.AvatarFallback,{children:F.author.username[0].toUpperCase()})}),(0,g.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{className:"font-medium",children:["@",F.author.username]}),(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:F.author.role})]}),(0,g.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{className:"text-muted-foreground",children:"Reputation:"})," ",(0,g.jsx)("span",{className:"font-medium",children:F.author.reputation})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{className:"text-muted-foreground",children:"Member since:"})," ",(0,g.jsx)("span",{className:"font-medium",children:(0,ai.format)(new Date(F.author.createdAt),"MMM d, yyyy")})]})]}),F.author.badges&&F.author.badges.length>0&&(0,g.jsx)("div",{className:"flex gap-1 flex-wrap",children:F.author.badges.map((a,b)=>(0,g.jsx)(P.Badge,{variant:"secondary",children:a},b))})]})]})]}),F.recentPosts.length>0&&(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"font-semibold mb-2",children:"Author's Recent Posts"}),(0,g.jsx)("div",{className:"space-y-2",children:F.recentPosts.map(a=>(0,g.jsx)("div",{className:"p-3 bg-muted rounded-lg text-sm",children:(0,g.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,g.jsxs)("div",{className:"flex-1",children:[(0,g.jsx)("div",{className:"font-medium",children:a.title}),(0,g.jsx)("div",{className:"text-muted-foreground",children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})})]}),(0,g.jsx)(P.Badge,{variant:"outline",children:a.type})]})},a.id))})]}),F.warnings.length>0&&(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"font-semibold mb-2 text-orange-600",children:"Warning History"}),(0,g.jsx)("div",{className:"space-y-2",children:F.warnings.map((a,b)=>(0,g.jsxs)("div",{className:"p-3 bg-orange-50 dark:bg-orange-950/20 rounded-lg text-sm border border-orange-200 dark:border-orange-800",children:[(0,g.jsx)("div",{className:"font-medium",children:a.reason}),(0,g.jsxs)("div",{className:"text-muted-foreground",children:["By @",a.moderator," â¢ ",(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})]})]},b))})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"font-semibold mb-2",children:"Metadata"}),(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4 p-4 bg-muted rounded-lg text-sm",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{className:"text-muted-foreground",children:"Created:"})," ",(0,ai.format)(new Date(F.metadata.createdAt),"MMM d, yyyy HH:mm")]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{className:"text-muted-foreground",children:"Word Count:"})," ",F.metadata.wordCount]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{className:"text-muted-foreground",children:"Has Links:"})," ",F.metadata.hasLinks?"Yes":"No"]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{className:"text-muted-foreground",children:"Has Images:"})," ",F.metadata.hasImages?"Yes":"No"]}),F.metadata.category&&(0,g.jsxs)("div",{className:"col-span-2",children:[(0,g.jsx)("span",{className:"text-muted-foreground",children:"Category:"})," ",F.metadata.category]})]})]})]})}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{variant:"ghost",onClick:()=>E(!1),children:"Close"}),(0,g.jsxs)(l.Button,{variant:"outline",onClick:()=>{F&&a2.mutate(F.id)},children:[(0,g.jsx)(ao.CheckCircle,{className:"h-4 w-4 mr-2"}),"Approve"]}),(0,g.jsxs)(l.Button,{variant:"destructive",onClick:()=>{F&&ba(F.id)},children:[(0,g.jsx)(ap,{className:"h-4 w-4 mr-2"}),"Reject"]})]})]})}),(0,g.jsx)(W.Dialog,{open:H,onOpenChange:I,children:(0,g.jsxs)(W.DialogContent,{"data-testid":"dialog-reject-content",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Reject Content"}),(0,g.jsx)(W.DialogDescription,{children:"Please provide a reason for rejecting this content"})]}),(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,g.jsx)(U.Textarea,{value:L,onChange:a=>M(a.target.value),placeholder:"Enter reason for rejection...",className:"min-h-24","data-testid":"textarea-reason"}),(0,g.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[L.length,"/500 characters"]})]}),(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)(al.Checkbox,{checked:N,onCheckedChange:a=>O(a),id:"delete-permanently"}),(0,g.jsx)("label",{htmlFor:"delete-permanently",className:"text-sm cursor-pointer",children:"Delete permanently"})]})]}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{variant:"ghost",onClick:()=>I(!1),children:"Cancel"}),(0,g.jsx)(l.Button,{variant:"destructive",onClick:()=>{!J||!L||L.length<10||L.length>500?a({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):a3.mutate({contentId:J,reason:L,deletePermanently:N})},disabled:a3.isPending||L.length<10||L.length>500,children:"Reject"})]})]})}),(0,g.jsx)(W.Dialog,{open:Q,onOpenChange:R,children:(0,g.jsxs)(W.DialogContent,{className:"max-w-4xl max-h-[90vh]","data-testid":"dialog-report-details",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Report Details"})}),(0,g.jsx)(am.ScrollArea,{className:"max-h-[calc(90vh-150px)]",children:Z&&(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"font-semibold mb-2",children:"Content"}),Z.content.title&&(0,g.jsx)("h4",{className:"text-lg font-bold mb-2",children:Z.content.title}),(0,g.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:Z.content.body})]}),(0,g.jsxs)("div",{children:[(0,g.jsxs)("h3",{className:"font-semibold mb-2",children:["Reports (",Z.reports.length,")"]}),(0,g.jsx)("div",{className:"space-y-3",children:Z.reports.map((a,b)=>(0,g.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,g.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{className:"font-medium",children:["@",a.reporterUsername]}),(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})})]}),(0,g.jsx)(P.Badge,{variant:"destructive",children:a.reason})]}),a.description&&(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:a.description})]},b))})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"font-semibold mb-2",children:"Author Information"}),(0,g.jsx)("div",{className:"p-4 bg-muted rounded-lg",children:(0,g.jsxs)("div",{className:"flex gap-4 text-sm",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{className:"text-muted-foreground",children:"Username:"})," ",(0,g.jsxs)("span",{className:"font-medium",children:["@",Z.author.username]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{className:"text-muted-foreground",children:"Reputation:"})," ",(0,g.jsx)("span",{className:"font-medium",children:Z.author.reputation})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("span",{className:"text-muted-foreground",children:"Role:"})," ",(0,g.jsx)("span",{className:"font-medium",children:Z.author.role})]})]})})]})]})}),(0,g.jsxs)(W.DialogFooter,{className:"flex-wrap gap-2",children:[(0,g.jsx)(l.Button,{variant:"ghost",onClick:()=>R(!1),children:"Close"}),(0,g.jsx)(l.Button,{variant:"secondary",onClick:()=>{ad(!0)},children:"Dismiss Report"}),(0,g.jsxs)(l.Button,{variant:"destructive",onClick:()=>{_&&a7.mutate({reportId:_,action:"delete",reason:"Content deleted by moderator"})},children:[(0,g.jsx)(aw.Trash2,{className:"h-4 w-4 mr-2"}),"Delete Content"]}),(0,g.jsxs)(l.Button,{variant:"outline",onClick:()=>{_&&a7.mutate({reportId:_,action:"warn",reason:"Warning issued for reported content"})},className:"border-yellow-500 text-yellow-600 hover:bg-yellow-50 dark:hover:bg-yellow-950/20",children:[(0,g.jsx)(ar.AlertTriangle,{className:"h-4 w-4 mr-2"}),"Warn Author"]}),(0,g.jsxs)(l.Button,{variant:"outline",onClick:()=>{Z&&(aF(Z.author.username),az(!0))},className:"border-orange-500 text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-950/20",children:[(0,g.jsx)(av,{className:"h-4 w-4 mr-2"}),"Suspend Author"]}),(0,g.jsxs)(l.Button,{variant:"destructive",onClick:()=>{Z&&(aN(Z.author.username),aH(!0))},children:[(0,g.jsx)(aa.Ban,{className:"h-4 w-4 mr-2"}),"Ban Author"]})]})]})}),(0,g.jsx)(W.Dialog,{open:ac,onOpenChange:ad,children:(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Dismiss Report"}),(0,g.jsx)(W.DialogDescription,{children:"Optionally provide a reason for dismissing this report"})]}),(0,g.jsx)("div",{className:"space-y-4",children:(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (optional, max 500 characters)"}),(0,g.jsx)(U.Textarea,{value:ah,onChange:a=>ak(a.target.value),placeholder:"Enter reason for dismissal...",className:"min-h-24"})]})}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{variant:"ghost",onClick:()=>ad(!1),children:"Cancel"}),(0,g.jsx)(l.Button,{onClick:()=>{_&&a6.mutate({reportId:_,reason:ah||void 0})},disabled:a6.isPending,children:"Dismiss Report"})]})]})}),(0,g.jsx)(W.Dialog,{open:ay,onOpenChange:az,children:(0,g.jsxs)(W.DialogContent,{"data-testid":"dialog-suspend-author",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Suspend Author"}),(0,g.jsx)(W.DialogDescription,{children:"Temporarily suspend this user's account"})]}),(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Suspend Days (1-365)"}),(0,g.jsx)(T.Input,{type:"number",min:1,max:365,value:aA,onChange:a=>aB(Number(a.target.value)),"data-testid":"input-suspend-days"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,g.jsx)(U.Textarea,{value:aC,onChange:a=>aD(a.target.value),placeholder:"Enter reason for suspension...",className:"min-h-24","data-testid":"textarea-reason"})]})]}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{variant:"ghost",onClick:()=>az(!1),children:"Cancel"}),(0,g.jsx)(l.Button,{variant:"destructive",onClick:()=>{!_||!aC||aC.length<10||aC.length>500?a({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):aA<1||aA>365?a({title:"Suspend days must be between 1 and 365",variant:"destructive"}):a7.mutate({reportId:_,action:"suspend",reason:aC,suspendDays:aA})},disabled:a7.isPending||aC.length<10||aC.length>500||aA<1||aA>365,children:"Suspend User"})]})]})}),(0,g.jsx)(W.Dialog,{open:aG,onOpenChange:aH,children:(0,g.jsxs)(W.DialogContent,{"data-testid":"dialog-ban-author",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Ban Author"}),(0,g.jsx)(W.DialogDescription,{children:"Permanently ban this user from the platform"})]}),(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)(an.Alert,{variant:"destructive",children:[(0,g.jsx)(ar.AlertTriangle,{className:"h-4 w-4"}),(0,g.jsx)(an.AlertDescription,{children:"This action is permanent and cannot be undone."})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,g.jsx)(U.Textarea,{value:aI,onChange:a=>aJ(a.target.value),placeholder:"Enter reason for ban...",className:"min-h-24","data-testid":"textarea-reason"})]}),(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)(al.Checkbox,{checked:aK,onCheckedChange:a=>aL(a),id:"ban-confirm"}),(0,g.jsx)("label",{htmlFor:"ban-confirm",className:"text-sm cursor-pointer",children:"I understand this is permanent"})]})]}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{variant:"ghost",onClick:()=>aH(!1),children:"Cancel"}),(0,g.jsx)(l.Button,{variant:"destructive",onClick:()=>{!_||!aI||aI.length<10||aI.length>500?a({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):aK?a7.mutate({reportId:_,action:"ban",reason:aI}):a({title:"Please confirm that you understand this action is permanent",variant:"destructive"})},disabled:a7.isPending||!aK||aI.length<10||aI.length>500,children:"Ban User"})]})]})}),(0,g.jsx)(W.Dialog,{open:aO,onOpenChange:aP,children:(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Approve Selected Items"}),(0,g.jsxs)(W.DialogDescription,{children:["Are you sure you want to approve ",m.length," items?"]})]}),(0,g.jsxs)(an.Alert,{children:[(0,g.jsx)(ar.AlertTriangle,{className:"h-4 w-4"}),(0,g.jsx)(an.AlertDescription,{children:"This action cannot be undone."})]}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{variant:"ghost",onClick:()=>aP(!1),children:"Cancel"}),(0,g.jsx)(l.Button,{onClick:()=>{a4.mutate(m)},disabled:a4.isPending,children:"Approve All"})]})]})}),(0,g.jsx)(W.Dialog,{open:aQ,onOpenChange:aR,children:(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Reject Selected Items"}),(0,g.jsxs)(W.DialogDescription,{children:["Reject ",m.length," selected items"]})]}),(0,g.jsx)("div",{className:"space-y-4",children:(0,g.jsxs)("div",{children:[(0,g.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Reason (10-500 characters)"}),(0,g.jsx)(U.Textarea,{value:aS,onChange:a=>aT(a.target.value),placeholder:"This reason will apply to all selected items...",className:"min-h-24","data-testid":"textarea-reason"})]})}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{variant:"ghost",onClick:()=>aR(!1),children:"Cancel"}),(0,g.jsx)(l.Button,{variant:"destructive",onClick:()=>{!aS||aS.length<10||aS.length>500?a({title:"Reason must be between 10 and 500 characters",variant:"destructive"}):a5.mutate({contentIds:m,reason:aS})},disabled:a5.isPending||aS.length<10||aS.length>500,children:"Reject All"})]})]})})]})}a.s(["default",()=>ay],91537);var az=a.i(95245),aA=a.i(59501),aB=a.i(36570),aC=a.i(39392),aD=a.i(83497),aE=a.i(21374),aF=a.i(15618);let aG=aB.z.object({type:aB.z.enum(["ea","indicator","article","source_code"]),title:aB.z.string().min(10,"Title must be at least 10 characters").max(120),description:aB.z.string().min(300,"Description must be at least 300 characters"),category:aB.z.string().min(1,"Category is required"),priceCoins:aB.z.number().min(0).max(1e4),isFree:aB.z.boolean(),platform:aB.z.enum(["MT4","MT5","Both"]).optional(),version:aB.z.string().optional(),tags:aB.z.string().optional(),license:aB.z.string().optional(),minDeposit:aB.z.number().optional(),hedging:aB.z.boolean().optional(),changelog:aB.z.string().optional()});function aH({trigger:a}){let{toast:b}=(0,Y.useToast)(),[c,d]=(0,h.useState)(!1),[e,f]=(0,h.useState)([]),i=(0,az.useForm)({resolver:(0,aA.zodResolver)(aG),defaultValues:{type:"ea",title:"",description:"",category:"",priceCoins:0,isFree:!0,platform:"MT4",version:"1.0",tags:"",license:"Standard",minDeposit:void 0,hedging:!1,changelog:""}}),j=(0,S.useMutation)({mutationFn:async a=>{let b=a.tags?a.tags.split(",").map(a=>a.trim()).filter(Boolean):[],c={...a,tags:b,status:"approved",files:[],images:[]};return(await (0,aj.apiRequest)("POST","/api/admin/content",c)).json()},onSuccess:()=>{b({title:"Content Created!",description:"The marketplace content has been successfully added."}),i.reset(),f([]),d(!1),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/revenue-chart"]}),aj.queryClient.invalidateQueries({queryKey:["/api/content"]})},onError:a=>{b({variant:"destructive",title:"Failed to Create Content",description:a.message||"Could not create marketplace content. Please try again."})}}),k=["Expert Advisors","Indicators","Scripts","Templates","Trading Systems","Libraries","Utilities","Educational"],m=["Scalping","Day Trading","Swing Trading","Grid","Martingale","Breakout","Trend Following","Mean Reversion","News Trading","High Frequency","Performance Report"],n=i.watch("isFree");return(0,h.useEffect)(()=>{n&&i.setValue("priceCoins",0)},[n,i]),(0,g.jsxs)(W.Dialog,{open:c,onOpenChange:d,children:[(0,g.jsx)(W.DialogTrigger,{asChild:!0,children:a||(0,g.jsxs)(l.Button,{"data-testid":"button-add-content",children:[(0,g.jsx)(aF.Plus,{className:"h-4 w-4 mr-2"}),"Add Content"]})}),(0,g.jsxs)(W.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Add Marketplace Content"}),(0,g.jsx)(W.DialogDescription,{children:"Create new marketplace content (EA, Indicator, Article, or Source Code). All fields marked with * are required."})]}),(0,g.jsx)(aC.Form,{...i,children:(0,g.jsxs)("form",{onSubmit:i.handleSubmit(a=>{j.mutate(a)}),className:"space-y-6",children:[(0,g.jsx)(aC.FormField,{control:i.control,name:"type",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Content Type *"}),(0,g.jsxs)(V.Select,{onValueChange:a.onChange,value:a.value,children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(V.SelectTrigger,{"data-testid":"select-content-type",children:(0,g.jsx)(V.SelectValue,{})})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"ea",children:"Expert Advisor (EA)"}),(0,g.jsx)(V.SelectItem,{value:"indicator",children:"Indicator"}),(0,g.jsx)(V.SelectItem,{value:"article",children:"Article"}),(0,g.jsx)(V.SelectItem,{value:"source_code",children:"Source Code"})]})]}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:i.control,name:"title",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Title *"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{placeholder:"e.g., Gold Scalper Pro EA v2.5",...a,"data-testid":"input-content-title"})}),(0,g.jsxs)(aC.FormDescription,{children:[a.value.length,"/120 characters"]}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:i.control,name:"description",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Description *"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(U.Textarea,{placeholder:"Detailed description of the content, features, benefits, and usage instructions...",className:"min-h-[150px]",...a,"data-testid":"textarea-content-description"})}),(0,g.jsxs)(aC.FormDescription,{children:[a.value.length," characters (minimum 300)"]}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:i.control,name:"category",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Category *"}),(0,g.jsxs)(V.Select,{onValueChange:a.onChange,value:a.value||void 0,children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(V.SelectTrigger,{"data-testid":"select-category",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select a category..."})})}),(0,g.jsx)(V.SelectContent,{children:k.map(a=>(0,g.jsx)(V.SelectItem,{value:a,children:a},a))})]}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:i.control,name:"platform",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Platform"}),(0,g.jsxs)(V.Select,{onValueChange:a.onChange,value:a.value||void 0,children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(V.SelectTrigger,{"data-testid":"select-platform",children:(0,g.jsx)(V.SelectValue,{})})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"MT4",children:"MT4"}),(0,g.jsx)(V.SelectItem,{value:"MT5",children:"MT5"}),(0,g.jsx)(V.SelectItem,{value:"Both",children:"Both MT4 & MT5"})]})]}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsx)(aC.FormField,{control:i.control,name:"isFree",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(al.Checkbox,{checked:a.value,onCheckedChange:a.onChange,"data-testid":"checkbox-is-free"})}),(0,g.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,g.jsx)(aC.FormLabel,{children:"Free Content"}),(0,g.jsx)(aC.FormDescription,{children:"Check if this content is free"})]})]})}),(0,g.jsx)(aC.FormField,{control:i.control,name:"priceCoins",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Price (Coins) *"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{type:"number",min:0,max:1e4,disabled:n,...a,onChange:b=>a.onChange(parseInt(b.target.value)||0),"data-testid":"input-price-coins"})}),(0,g.jsx)(aC.FormDescription,{children:"0-10,000 coins"}),(0,g.jsx)(aC.FormMessage,{})]})})]}),(0,g.jsx)(aC.FormField,{control:i.control,name:"tags",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Tags"}),(0,g.jsx)("div",{className:"flex flex-wrap gap-2 mb-3",children:m.map(a=>(0,g.jsx)(P.Badge,{variant:e.includes(a)?"default":"outline",className:"cursor-pointer",onClick:()=>{let b;f(b=e.includes(a)?e.filter(b=>b!==a):[...e,a]),i.setValue("tags",b.join(", "))},"data-testid":`tag-${a.toLowerCase().replace(/\s+/g,"-")}`,children:a},a))}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{placeholder:"Or enter custom tags separated by commas...",...a,"data-testid":"input-tags"})}),(0,g.jsx)(aC.FormDescription,{children:"Click tags above or enter custom tags separated by commas (max 8)"}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsx)(aC.FormField,{control:i.control,name:"version",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Version"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{placeholder:"e.g., 1.0, 2.5.1",...a,"data-testid":"input-version"})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:i.control,name:"license",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"License"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{placeholder:"e.g., Standard, Extended, GPL",...a,"data-testid":"input-license"})}),(0,g.jsx)(aC.FormMessage,{})]})})]}),(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsx)(aC.FormField,{control:i.control,name:"minDeposit",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Minimum Deposit"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{type:"number",placeholder:"e.g., 100",...a,onChange:b=>a.onChange(b.target.value?parseInt(b.target.value):void 0),value:a.value||"","data-testid":"input-min-deposit"})}),(0,g.jsx)(aC.FormDescription,{children:"Minimum account balance required"}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:i.control,name:"hedging",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4 mt-2",children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(al.Checkbox,{checked:a.value,onCheckedChange:a.onChange,"data-testid":"checkbox-hedging"})}),(0,g.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,g.jsx)(aC.FormLabel,{children:"Supports Hedging"}),(0,g.jsx)(aC.FormDescription,{children:"Check if this EA supports hedging"})]})]})})]}),(0,g.jsx)(aC.FormField,{control:i.control,name:"changelog",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Changelog"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(U.Textarea,{placeholder:"Version history and updates...",className:"min-h-[100px]",...a,"data-testid":"textarea-changelog"})}),(0,g.jsx)(aC.FormDescription,{children:"Document version changes and improvements"}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,g.jsx)(l.Button,{type:"submit",disabled:j.isPending,"data-testid":"button-submit-content",children:j.isPending?"Creating...":"Create Content"}),(0,g.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>{i.reset(),f([]),d(!1)},"data-testid":"button-cancel",children:"Cancel"})]})]})})]})]})}let aI=aB.z.object({reason:aB.z.string().min(10,"Reason must be at least 10 characters").max(500,"Reason must be less than 500 characters")}),aJ=aB.z.object({durationDays:aB.z.number().min(1,"Duration must be at least 1 day").max(365,"Duration cannot exceed 365 days")});function aK(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)(""),[d,e]=(0,h.useState)(""),[f,i]=(0,h.useState)("all"),[m,n]=(0,h.useState)("all"),[o,r]=(0,h.useState)("all"),[s,u]=(0,h.useState)(1),[v,w]=(0,h.useState)(20),[y,z]=(0,h.useState)(null),[A,E]=(0,h.useState)(null),[F,G]=(0,h.useState)(null);(0,h.useEffect)(()=>{let a=setTimeout(()=>{e(b),u(1)},300);return()=>clearTimeout(a)},[b]),(0,h.useEffect)(()=>{u(1)},[f,m,o]);let H=new URLSearchParams({page:s.toString(),limit:v.toString(),...d&&{search:d},..."all"!==f&&{category:f},..."all"!==m&&{status:m},..."all"!==o&&{priceRange:o}}),{data:I,isLoading:O}=(0,p.useQuery)({queryKey:["/api/admin/marketplace/stats"]}),Q=I||{totalItems:0,pendingItems:0,totalSales:0,salesThisWeek:0,totalRevenue:0,revenueThisWeek:0},{data:R,isLoading:X}=(0,p.useQuery)({queryKey:["/api/admin/marketplace/items",s,v,d,f,m,o],queryFn:async()=>{let a=await fetch(`/api/admin/marketplace/items?${H}`);if(!a.ok){let b=await a.json();return{items:Array.isArray(b)?b:[],totalItems:Array.isArray(b)?b.length:0,totalPages:1,currentPage:1,pageSize:Array.isArray(b)?b.length:20}}return a.json()}}),Z=R?.items||[],$=R?.totalItems||0,_=R?.totalPages||1,{data:aa,isLoading:ab}=(0,p.useQuery)({queryKey:["/api/admin/marketplace/top-selling"]}),ac=Array.isArray(aa)?aa:[],{data:ad,isLoading:ae}=(0,p.useQuery)({queryKey:["/api/admin/marketplace/revenue-chart"]}),af=Array.isArray(ad)?ad:[],{data:ag,isLoading:ah}=(0,p.useQuery)({queryKey:["/api/admin/marketplace/top-vendors"]}),ai=Array.isArray(ag)?ag:[],{data:ak,isLoading:al}=(0,p.useQuery)({queryKey:["/api/admin/marketplace/items",y],enabled:!!y,queryFn:async()=>{let a=await fetch(`/api/admin/marketplace/items/${y}`);if(!a.ok)throw Error("Failed to fetch item details");return a.json()}}),am=(0,az.useForm)({resolver:(0,aA.zodResolver)(aI),defaultValues:{reason:""}}),an=(0,az.useForm)({resolver:(0,aA.zodResolver)(aJ),defaultValues:{durationDays:30}}),ar=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("POST",`/api/admin/marketplace/${a}/approve`,{}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-vendors"]}),a({title:"Item approved successfully"})},onError:()=>{a({title:"Failed to approve item",variant:"destructive"})}}),as=(0,S.useMutation)({mutationFn:async a=>{if(!A)throw Error("No item selected");return(0,aj.apiRequest)("POST",`/api/admin/marketplace/${A}/reject`,a)},onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-vendors"]}),E(null),a({title:"Item rejected successfully"}),am.reset()},onError:()=>{a({title:"Failed to reject item",variant:"destructive"})}}),at=(0,S.useMutation)({mutationFn:async a=>{if(!F)throw Error("No item selected");return(0,aj.apiRequest)("POST",`/api/admin/marketplace/${F}/feature`,a)},onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/items"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/stats"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-selling"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/marketplace/top-vendors"]}),G(null),a({title:"Item featured successfully"}),an.reset()},onError:()=>{a({title:"Failed to feature item",variant:"destructive"})}});return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Marketplace Management"}),(0,g.jsx)(aH,{})]}),(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,g.jsx)("div",{className:"flex-1",children:(0,g.jsx)(T.Input,{placeholder:"Search by title or seller...",value:b,onChange:a=>c(a.target.value),"data-testid":"input-search-items"})}),(0,g.jsxs)(V.Select,{value:f,onValueChange:i,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-[200px]","data-testid":"select-category-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"All Categories"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Categories"}),(0,g.jsx)(V.SelectItem,{value:"Expert Advisors",children:"Expert Advisors"}),(0,g.jsx)(V.SelectItem,{value:"Indicators",children:"Indicators"}),(0,g.jsx)(V.SelectItem,{value:"Scripts",children:"Scripts"}),(0,g.jsx)(V.SelectItem,{value:"Templates",children:"Templates"})]})]}),(0,g.jsxs)(V.Select,{value:m,onValueChange:n,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-status-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"All Statuses"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Statuses"}),(0,g.jsx)(V.SelectItem,{value:"pending",children:"Pending"}),(0,g.jsx)(V.SelectItem,{value:"approved",children:"Approved"}),(0,g.jsx)(V.SelectItem,{value:"rejected",children:"Rejected"})]})]}),(0,g.jsxs)(V.Select,{value:o,onValueChange:r,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-price-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"All Prices"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Prices"}),(0,g.jsx)(V.SelectItem,{value:"free",children:"Free (0 coins)"}),(0,g.jsx)(V.SelectItem,{value:"low",children:"Low (1-100)"}),(0,g.jsx)(V.SelectItem,{value:"medium",children:"Medium (101-500)"}),(0,g.jsx)(V.SelectItem,{value:"high",children:"High (500+)"})]})]}),(0,g.jsx)(l.Button,{variant:"outline",onClick:()=>{c(""),i("all"),n("all"),r("all")},"data-testid":"button-clear-filters",children:"Clear Filters"})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-total-items",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Items"}),(0,g.jsx)(aD.Package,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:O?(0,g.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-items",children:Q.totalItems}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:[Q.pendingItems," pending approval"]})]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-total-sales",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Sales"}),(0,g.jsx)(x.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:O?(0,g.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-sales",children:Q.totalSales}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+",Q.salesThisWeek," this week"]})]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-total-revenue",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Revenue"}),(0,g.jsx)(t.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:O?(0,g.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-marketplace-revenue",children:["$",Q.totalRevenue]}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:["+$",Q.revenueThisWeek," this week"]})]})})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-revenue-chart",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Revenue Trend (Last 30 Days)"})}),(0,g.jsx)(k.CardContent,{children:ae?(0,g.jsx)(j.Skeleton,{className:"h-64"}):af.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(C.LineChart,{data:af,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"date"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(D.Line,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No revenue data available"})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-top-selling",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Top Selling Items"})}),(0,g.jsx)(k.CardContent,{children:ab?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):ac.length>0?(0,g.jsx)("div",{className:"space-y-3",children:ac.map((a,b)=>(0,g.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[(0,g.jsxs)("div",{className:"flex items-center gap-3",children:[(0,g.jsxs)("div",{className:"text-lg font-bold text-muted-foreground",children:["#",b+1]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"font-medium",children:a.title}),(0,g.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.sales," sales"]})]})]}),(0,g.jsxs)(P.Badge,{children:[a.coinPrice," coins"]})]},a.id))}):(0,g.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No sales data available"})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-top-vendors",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Top Vendors"})}),(0,g.jsx)(k.CardContent,{children:ah?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):ai.length>0?(0,g.jsx)("div",{className:"space-y-3",children:ai.map((a,b)=>(0,g.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[(0,g.jsxs)("div",{className:"flex items-center gap-3",children:[(0,g.jsxs)("div",{className:"text-lg font-bold text-muted-foreground",children:["#",b+1]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"font-medium",children:a.sellerUsername}),(0,g.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.totalSales," sales â¢ ",a.itemCount," items"]})]})]}),(0,g.jsxs)(P.Badge,{children:[a.totalRevenue," coins earned"]})]},a.sellerId))}):(0,g.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No vendor data available"})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-marketplace-items",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Marketplace Items (",$,")"]})}),(0,g.jsx)(k.CardContent,{children:X?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-16"},b))}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Title"}),(0,g.jsx)(q.TableHead,{children:"Seller"}),(0,g.jsx)(q.TableHead,{children:"Price"}),(0,g.jsx)(q.TableHead,{children:"Sales"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Listed"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:Z.length>0?Z.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`item-row-${a.id}`,children:[(0,g.jsx)(q.TableCell,{"data-testid":`item-title-${a.id}`,children:a.title}),(0,g.jsx)(q.TableCell,{children:a.sellerUsername}),(0,g.jsxs)(q.TableCell,{children:[a.coinPrice," coins"]}),(0,g.jsx)(q.TableCell,{children:a.sales}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"approved"===a.status?"default":"secondary",children:a.status})}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,g.jsx)(l.Button,{size:"sm",variant:"ghost",onClick:()=>z(a.id),"data-testid":`button-view-item-${a.id}`,children:(0,g.jsx)(aq.Eye,{className:"h-4 w-4"})}),(0,g.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:()=>ar.mutate(a.id),disabled:"approved"===a.status||ar.isPending,"data-testid":`button-approve-item-${a.id}`,children:[(0,g.jsx)(ao.CheckCircle,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,g.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:()=>E(a.id),disabled:"rejected"===a.status,"data-testid":`button-reject-item-${a.id}`,children:[(0,g.jsx)(ap,{className:"h-4 w-4 mr-1"}),"Reject"]}),(0,g.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:()=>G(a.id),disabled:"approved"!==a.status,"data-testid":`button-feature-item-${a.id}`,children:[(0,g.jsx)(aE.Star,{className:"h-4 w-4 mr-1"}),"Feature"]})]})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No marketplace items found"})})})]})}),$>0&&(0,g.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 px-2 py-4 border-t mt-4",children:[(0,g.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(s-1)*v+1,"-",Math.min(s*v,$)," of ",$," items"]}),(0,g.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)("span",{className:"text-sm",children:"Items per page:"}),(0,g.jsxs)(V.Select,{value:v.toString(),onValueChange:a=>w(parseInt(a)),children:[(0,g.jsx)(V.SelectTrigger,{className:"w-[80px]","data-testid":"select-page-size",children:(0,g.jsx)(V.SelectValue,{})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"10",children:"10"}),(0,g.jsx)(V.SelectItem,{value:"20",children:"20"}),(0,g.jsx)(V.SelectItem,{value:"50",children:"50"}),(0,g.jsx)(V.SelectItem,{value:"100",children:"100"})]})]})]}),(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>u(1),disabled:1===s,"data-testid":"button-first-page",children:"First"}),(0,g.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>u(s-1),disabled:1===s,"data-testid":"button-prev-page",children:"Previous"}),(0,g.jsxs)("span",{className:"text-sm",children:["Page ",s," of ",_]}),(0,g.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>u(s+1),disabled:s===_,"data-testid":"button-next-page",children:"Next"}),(0,g.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>u(_),disabled:s===_,"data-testid":"button-last-page",children:"Last"})]})]})]})]})})]}),(0,g.jsx)(W.Dialog,{open:null!==y,onOpenChange:()=>z(null),children:(0,g.jsxs)(W.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Item Details"})}),al?(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsx)(j.Skeleton,{className:"h-20"}),(0,g.jsx)(j.Skeleton,{className:"h-20"}),(0,g.jsx)(j.Skeleton,{className:"h-32"})]}):ak?(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Title"}),(0,g.jsx)("p",{className:"font-medium",children:ak.title})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Category"}),(0,g.jsx)("p",{className:"font-medium",children:ak.category})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Price"}),(0,g.jsxs)("p",{className:"font-medium",children:[ak.coinPrice," coins"]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,g.jsx)(P.Badge,{children:ak.status})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Seller"}),(0,g.jsx)("p",{className:"font-medium",children:ak.sellerUsername})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Sales"}),(0,g.jsx)("p",{className:"font-medium",children:ak.sales})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Description"}),(0,g.jsx)("p",{className:"text-sm",children:ak.description})]}),ak.recentPurchases&&ak.recentPurchases.length>0&&(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm font-medium mb-2",children:"Recent Purchases"}),(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Buyer"}),(0,g.jsx)(q.TableHead,{children:"Price"}),(0,g.jsx)(q.TableHead,{children:"Date"})]})}),(0,g.jsx)(q.TableBody,{children:ak.recentPurchases.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{children:a.buyerUsername}),(0,g.jsxs)(q.TableCell,{children:[a.coins," coins"]}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.purchasedAt),{addSuffix:!0})})]},a.id))})]})]})]}):(0,g.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"Item not found"})]})}),(0,g.jsx)(W.Dialog,{open:null!==A,onOpenChange:()=>E(null),children:(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Reject Marketplace Item"}),(0,g.jsx)(W.DialogDescription,{children:"Please provide a reason for rejecting this item. The seller will see this reason."})]}),(0,g.jsx)(aC.Form,{...am,children:(0,g.jsxs)("form",{onSubmit:am.handleSubmit(a=>{as.mutate(a)}),className:"space-y-4",children:[(0,g.jsx)(aC.FormField,{control:am.control,name:"reason",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Rejection Reason *"}),(0,g.jsxs)(V.Select,{onValueChange:b=>{"custom"!==b&&a.onChange(b)},children:[(0,g.jsx)(V.SelectTrigger,{"data-testid":"select-reject-reason",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select a reason..."})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"Poor description",children:"Poor description"}),(0,g.jsx)(V.SelectItem,{value:"Inappropriate content",children:"Inappropriate content"}),(0,g.jsx)(V.SelectItem,{value:"Duplicate listing",children:"Duplicate listing"}),(0,g.jsx)(V.SelectItem,{value:"Missing files",children:"Missing files"}),(0,g.jsx)(V.SelectItem,{value:"Price too high",children:"Price too high"}),(0,g.jsx)(V.SelectItem,{value:"custom",children:"Custom reason..."})]})]}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(U.Textarea,{placeholder:"Or enter a custom reason...",...a,"data-testid":"textarea-reject-reason",className:"min-h-[100px]"})}),(0,g.jsx)(aC.FormDescription,{children:"Minimum 10 characters"}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)(l.Button,{type:"submit",disabled:as.isPending,"data-testid":"button-confirm-reject",children:as.isPending?"Rejecting...":"Reject Item"}),(0,g.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>E(null),children:"Cancel"})]})]})})]})}),(0,g.jsx)(W.Dialog,{open:null!==F,onOpenChange:()=>G(null),children:(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Feature Marketplace Item"}),(0,g.jsx)(W.DialogDescription,{children:"Featured items appear prominently on the marketplace homepage."})]}),(0,g.jsx)(aC.Form,{...an,children:(0,g.jsxs)("form",{onSubmit:an.handleSubmit(a=>{at.mutate(a)}),className:"space-y-4",children:[(0,g.jsx)(aC.FormField,{control:an.control,name:"durationDays",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Feature Duration (Days) *"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{type:"number",min:1,max:365,...a,onChange:b=>a.onChange(parseInt(b.target.value)||1),"data-testid":"input-feature-duration"})}),(0,g.jsx)(aC.FormDescription,{children:"How long should this item be featured? (1-365 days)"}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)(l.Button,{type:"submit",disabled:at.isPending,"data-testid":"button-confirm-feature",children:at.isPending?"Featuring...":"Feature Item"}),(0,g.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>G(null),children:"Cancel"})]})]})})]})})]})}a.s(["default",()=>aK],7682);var aL=a.i(67900),aM=a.i(67453),aN=a.i(4416),aO=a.i(24569);let aP=aB.z.object({name:aB.z.string().min(1,"Name is required"),country:aB.z.string().optional(),regulation:aB.z.string().optional(),websiteUrl:aB.z.string().url("Must be a valid URL").optional(),minDeposit:aB.z.string().optional(),leverage:aB.z.string().optional(),platform:aB.z.string().optional(),spreadType:aB.z.string().optional(),minSpread:aB.z.string().optional()}),aQ=aB.z.object({enabled:aB.z.boolean(),reason:aB.z.string().optional(),severity:aB.z.enum(["low","medium","high","critical"]).optional()}),aR=aB.z.object({reason:aB.z.string().min(10,"Reason must be at least 10 characters")});function aS(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)("brokers"),[d,e]=(0,h.useState)(""),[f,i]=(0,h.useState)(""),[n,o]=(0,h.useState)("all"),[r,s]=(0,h.useState)("all"),[t,u]=(0,h.useState)("all"),[v,w]=(0,h.useState)(1),[x,z]=(0,h.useState)(20),[A,C]=(0,h.useState)(null),[D,E]=(0,h.useState)(null),[F,G]=(0,h.useState)(null),[H,I]=(0,h.useState)(null),[J,K]=(0,h.useState)(null),[L,M]=(0,h.useState)(null),[N,O]=(0,h.useState)(null),[Q,R]=(0,h.useState)(!1),[Z,$]=(0,h.useState)(!1),[aa,ab]=(0,h.useState)(!1);(0,h.useEffect)(()=>{let a=setTimeout(()=>{i(d),w(1)},300);return()=>clearTimeout(a)},[d]),(0,h.useEffect)(()=>{w(1)},[n,r,t]);let{data:ac,isLoading:ad}=(0,p.useQuery)({queryKey:["/api/admin/brokers/stats"]}),ae=ac||{totalBrokers:0,verifiedBrokers:0,scamWarnings:0,totalReviews:0,pendingReviews:0,pendingScamReports:0},{data:af,isLoading:ag}=(0,p.useQuery)({queryKey:["/api/admin/brokers",f,n,r,t,v,x],queryFn:async()=>{let a=new URLSearchParams({page:v.toString(),pageSize:x.toString()});f&&a.set("search",f),"all"!==n&&a.set("country",n),"verified"===r&&a.set("isVerified","true"),"unverified"===r&&a.set("isVerified","false"),"scam_warning"===r&&a.set("scamWarning","true"),"all"!==t&&a.set("regulation",t);let b=await fetch(`/api/admin/brokers?${a.toString()}`);if(!b.ok)throw Error("Failed to fetch brokers");return b.json()},enabled:"brokers"===b}),ah=af?.items||[],ai=af?.total||0,{data:ak,isLoading:am}=(0,p.useQuery)({queryKey:["/api/admin/scam-reports",v,x],queryFn:async()=>{let a=new URLSearchParams({page:v.toString(),pageSize:x.toString()}),b=await fetch(`/api/admin/scam-reports?${a.toString()}`);if(!b.ok)throw Error("Failed to fetch scam reports");return b.json()},enabled:"scam-reports"===b}),an=ak?.items||[],ao=ak?.total||0,{data:ap,isLoading:as}=(0,p.useQuery)({queryKey:["/api/admin/broker-reviews",v,x],queryFn:async()=>{let a=new URLSearchParams({page:v.toString(),pageSize:x.toString()}),b=await fetch(`/api/admin/broker-reviews?${a.toString()}`);if(!b.ok)throw Error("Failed to fetch reviews");return b.json()},enabled:"reviews"===b}),at=ap?.items||[],au=ap?.total||0,av=(0,az.useForm)({resolver:(0,aA.zodResolver)(aP),defaultValues:{name:"",country:"",regulation:"",websiteUrl:"",minDeposit:"",leverage:"",platform:"",spreadType:"",minSpread:""}}),ax=(0,az.useForm)({resolver:(0,aA.zodResolver)(aP)}),ay=(0,az.useForm)({resolver:(0,aA.zodResolver)(aQ),defaultValues:{enabled:!0,reason:"",severity:"medium"}}),aB=(0,az.useForm)({resolver:(0,aA.zodResolver)(aR),defaultValues:{reason:""}}),aD=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("POST","/api/brokers",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),R(!1),av.reset(),a({title:"Broker added successfully"})},onError:()=>{a({title:"Failed to add broker",variant:"destructive"})}}),aF=(0,S.useMutation)({mutationFn:async a=>{if(!D)throw Error("No broker selected");return(0,aj.apiRequest)("PATCH",`/api/admin/brokers/${D}`,a)},onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),E(null),a({title:"Broker updated successfully"})},onError:()=>{a({title:"Failed to update broker",variant:"destructive"})}}),aG=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("DELETE",`/api/admin/brokers/${a}`,{}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),G(null),$(!1),a({title:"Broker deleted successfully"})},onError:()=>{a({title:"Failed to delete broker",variant:"destructive"})}}),aH=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("POST",`/api/admin/brokers/${a}/verify`,{}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),I(null),ab(!1),a({title:"Broker verified successfully"})},onError:()=>{a({title:"Failed to verify broker",variant:"destructive"})}}),aI=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("POST",`/api/admin/brokers/${a}/unverify`,{}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),a({title:"Broker verification removed"})},onError:()=>{a({title:"Failed to unverify broker",variant:"destructive"})}}),aJ=(0,S.useMutation)({mutationFn:async a=>{if(!J)throw Error("No broker selected");return(0,aj.apiRequest)("POST",`/api/admin/brokers/${J}/scam-warning`,a)},onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),K(null),ay.reset(),a({title:"Scam warning updated successfully"})},onError:()=>{a({title:"Failed to update scam warning",variant:"destructive"})}}),aK=(0,S.useMutation)({mutationFn:async({reportId:a,resolution:b})=>(0,aj.apiRequest)("POST",`/api/admin/scam-reports/${a}/resolve`,{resolution:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/scam-reports"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),M(null),a({title:"Scam report resolved"})},onError:()=>{a({title:"Failed to resolve scam report",variant:"destructive"})}}),aS=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("POST",`/api/admin/broker-reviews/${a}/approve`,{}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/broker-reviews"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),O(null),a({title:"Review approved successfully"})},onError:()=>{a({title:"Failed to approve review",variant:"destructive"})}}),aT=(0,S.useMutation)({mutationFn:async a=>{if(!N)throw Error("No review selected");return(0,aj.apiRequest)("POST",`/api/admin/broker-reviews/${N}/reject`,a)},onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/broker-reviews"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/brokers/stats"]}),O(null),aB.reset(),a({title:"Review rejected"})},onError:()=>{a({title:"Failed to reject review",variant:"destructive"})}}),aU=a=>{w(a),window.scrollTo({top:0,behavior:"smooth"})},aV=ah.find(a=>a.id===A||a.id===D||a.id===F||a.id===H||a.id===J),aW=an.find(a=>a.id===L),aX=at.find(a=>a.id===N);return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Broker Management"}),(0,g.jsx)(l.Button,{onClick:()=>R(!0),"data-testid":"button-add-broker",children:"+ Add Broker"})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"stat-total-brokers",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Brokers"}),(0,g.jsx)(aL.Building2,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:ad?(0,g.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,g.jsx)("div",{className:"text-2xl font-bold",children:ae.totalBrokers})})]}),(0,g.jsxs)(k.Card,{"data-testid":"stat-verified-brokers",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Verified Brokers"}),(0,g.jsx)(aM.CheckCircle2,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:ad?(0,g.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,g.jsx)("div",{className:"text-2xl font-bold",children:ae.verifiedBrokers})})]}),(0,g.jsxs)(k.Card,{"data-testid":"stat-scam-warnings",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Scam Warnings"}),(0,g.jsx)(ar.AlertTriangle,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:ad?(0,g.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,g.jsx)("div",{className:"text-2xl font-bold",children:ae.scamWarnings})})]}),(0,g.jsxs)(k.Card,{"data-testid":"stat-total-reviews",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Reviews"}),(0,g.jsx)(y.MessageSquare,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:ad?(0,g.jsx)(j.Skeleton,{className:"h-8 w-20"}):(0,g.jsx)("div",{className:"text-2xl font-bold",children:ae.totalReviews})})]})]}),(0,g.jsxs)(X.Tabs,{value:b,onValueChange:c,className:"space-y-4",children:[(0,g.jsxs)(X.TabsList,{children:[(0,g.jsxs)(X.TabsTrigger,{value:"brokers","data-testid":"tab-brokers",children:["Brokers (",ae.totalBrokers,")"]}),(0,g.jsxs)(X.TabsTrigger,{value:"scam-reports","data-testid":"tab-scam-reports",children:["Scam Reports (",ae.pendingScamReports,")"]}),(0,g.jsxs)(X.TabsTrigger,{value:"reviews","data-testid":"tab-reviews",children:["Reviews (",ae.totalReviews,")"]})]}),(0,g.jsxs)(X.TabsContent,{value:"brokers",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,g.jsxs)("div",{className:"flex-1 relative",children:[(0,g.jsx)(_.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,g.jsx)(T.Input,{placeholder:"Search by broker name...",value:d,onChange:a=>e(a.target.value),className:"pl-9","data-testid":"input-search-brokers"})]}),(0,g.jsxs)(V.Select,{value:n,onValueChange:o,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-country-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"All Countries"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Countries"}),(0,g.jsx)(V.SelectItem,{value:"USA",children:"USA"}),(0,g.jsx)(V.SelectItem,{value:"UK",children:"UK"}),(0,g.jsx)(V.SelectItem,{value:"Cyprus",children:"Cyprus"}),(0,g.jsx)(V.SelectItem,{value:"Australia",children:"Australia"})]})]}),(0,g.jsxs)(V.Select,{value:r,onValueChange:s,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-verification-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Verification"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All"}),(0,g.jsx)(V.SelectItem,{value:"verified",children:"Verified"}),(0,g.jsx)(V.SelectItem,{value:"unverified",children:"Unverified"}),(0,g.jsx)(V.SelectItem,{value:"scam_warning",children:"Scam Warning"})]})]}),(0,g.jsxs)(V.Select,{value:t,onValueChange:u,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-[180px]","data-testid":"select-regulation-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Regulation"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All"}),(0,g.jsx)(V.SelectItem,{value:"FCA",children:"FCA"}),(0,g.jsx)(V.SelectItem,{value:"ASIC",children:"ASIC"}),(0,g.jsx)(V.SelectItem,{value:"CySEC",children:"CySEC"}),(0,g.jsx)(V.SelectItem,{value:"CFTC",children:"CFTC"})]})]}),(0,g.jsxs)(V.Select,{value:x.toString(),onValueChange:a=>z(parseInt(a)),children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-[120px]","data-testid":"select-page-size",children:(0,g.jsx)(V.SelectValue,{})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"10",children:"10 / page"}),(0,g.jsx)(V.SelectItem,{value:"20",children:"20 / page"}),(0,g.jsx)(V.SelectItem,{value:"50",children:"50 / page"}),(0,g.jsx)(V.SelectItem,{value:"100",children:"100 / page"})]})]}),(0,g.jsx)(l.Button,{variant:"outline",onClick:()=>{e(""),o("all"),s("all"),u("all")},"data-testid":"button-clear-filters",children:"Clear"})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Brokers (",ai,")"]})}),(0,g.jsx)(k.CardContent,{children:ag?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-16"},b))}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Name"}),(0,g.jsx)(q.TableHead,{children:"Country"}),(0,g.jsx)(q.TableHead,{children:"Regulation"}),(0,g.jsx)(q.TableHead,{children:"Verified"}),(0,g.jsx)(q.TableHead,{children:"Reviews"}),(0,g.jsx)(q.TableHead,{children:"Rating"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:ah.length>0?ah.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`row-broker-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:(0,g.jsx)("div",{className:"flex items-center gap-2",children:(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"font-medium",children:a.name}),a.scamWarning&&(0,g.jsx)(P.Badge,{variant:"destructive",className:"text-xs",children:"Scam Warning"})]})})}),(0,g.jsx)(q.TableCell,{children:a.country||"-"}),(0,g.jsx)(q.TableCell,{children:a.regulation||"-"}),(0,g.jsx)(q.TableCell,{children:a.isVerified?(0,g.jsxs)(P.Badge,{variant:"default",children:[(0,g.jsx)(aM.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Verified"]}):(0,g.jsx)(P.Badge,{variant:"secondary",children:"Unverified"})}),(0,g.jsx)(q.TableCell,{children:a.reviewCount}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex items-center gap-1",children:[(0,g.jsx)(aE.Star,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),(0,g.jsx)("span",{children:a.overallRating||0})]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"approved"===a.status?"default":"secondary",children:a.status})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,g.jsx)(l.Button,{size:"sm",variant:"ghost",onClick:()=>C(a.id),"data-testid":`button-view-broker-${a.id}`,children:(0,g.jsx)(aq.Eye,{className:"h-4 w-4"})}),(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>{E(a.id),ax.reset({name:a.name,country:a.country||"",regulation:a.regulation||""})},"data-testid":`button-edit-broker-${a.id}`,children:(0,g.jsx)(aO.Edit,{className:"h-4 w-4"})}),a.isVerified?(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>aI.mutate(a.id),"data-testid":`button-unverify-broker-${a.id}`,children:"Unverify"}):(0,g.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:()=>I(a.id),"data-testid":`button-verify-broker-${a.id}`,children:[(0,g.jsx)(aN.ShieldCheck,{className:"h-4 w-4 mr-1"}),"Verify"]}),(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>K(a.id),"data-testid":`button-scam-warning-${a.id}`,children:(0,g.jsx)(m.ShieldAlert,{className:"h-4 w-4"})}),(0,g.jsx)(l.Button,{size:"sm",variant:"destructive",onClick:()=>G(a.id),"data-testid":`button-delete-broker-${a.id}`,children:(0,g.jsx)(aw.Trash2,{className:"h-4 w-4"})})]})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"No brokers found"})})})]})}),ai>x&&(0,g.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,g.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(v-1)*x+1," to ",Math.min(v*x,ai)," of ",ai," brokers"]}),(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>aU(1),disabled:1===v,"data-testid":"button-first-page",children:"First"}),(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>aU(v-1),disabled:1===v,"data-testid":"button-prev-page",children:"Previous"}),(0,g.jsxs)("div",{className:"flex items-center gap-2 px-4",children:[(0,g.jsx)(T.Input,{type:"number",min:1,max:Math.ceil(ai/x),value:v,onChange:a=>{let b=parseInt(a.target.value);b>=1&&b<=Math.ceil(ai/x)&&aU(b)},className:"w-16 text-center","data-testid":"input-page-number"}),(0,g.jsxs)("span",{className:"text-sm text-muted-foreground",children:["of ",Math.ceil(ai/x)]})]}),(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>aU(v+1),disabled:v>=Math.ceil(ai/x),"data-testid":"button-next-page",children:"Next"}),(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>aU(Math.ceil(ai/x)),disabled:v>=Math.ceil(ai/x),"data-testid":"button-last-page",children:"Last"})]})]})]})})]})]}),(0,g.jsx)(X.TabsContent,{value:"scam-reports",className:"space-y-4",children:(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Scam Reports (",ao,")"]})}),(0,g.jsx)(k.CardContent,{children:am?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-16"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Broker"}),(0,g.jsx)(q.TableHead,{children:"Reporter"}),(0,g.jsx)(q.TableHead,{children:"Severity"}),(0,g.jsx)(q.TableHead,{children:"Report"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Date"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:an.length>0?an.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`row-scam-report-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:a.brokerName}),(0,g.jsx)(q.TableCell,{children:a.username}),(0,g.jsx)(q.TableCell,{children:a.scamSeverity?(0,g.jsx)(P.Badge,{variant:"critical"===a.scamSeverity||"high"===a.scamSeverity?"destructive":"medium"===a.scamSeverity?"default":"secondary",children:a.scamSeverity}):"-"}),(0,g.jsx)(q.TableCell,{className:"max-w-xs truncate",children:a.reviewTitle}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"approved"===a.status?"default":"secondary",children:a.status})}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.datePosted),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>M(a.id),"data-testid":`button-view-report-${a.id}`,children:(0,g.jsx)(aq.Eye,{className:"h-4 w-4"})}),"pending"===a.status&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>aK.mutate({reportId:a.id,resolution:"confirmed"}),disabled:aK.isPending,"data-testid":`button-confirm-scam-${a.id}`,children:"Confirm"}),(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>aK.mutate({reportId:a.id,resolution:"dismissed"}),disabled:aK.isPending,"data-testid":`button-dismiss-scam-${a.id}`,children:"Dismiss"})]})]})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No scam reports found"})})})]})})})]})}),(0,g.jsx)(X.TabsContent,{value:"reviews",className:"space-y-4",children:(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Broker Reviews (",au,")"]})}),(0,g.jsx)(k.CardContent,{children:as?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-16"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Broker"}),(0,g.jsx)(q.TableHead,{children:"Reviewer"}),(0,g.jsx)(q.TableHead,{children:"Rating"}),(0,g.jsx)(q.TableHead,{children:"Review"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Date"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:at.length>0?at.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`row-review-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:a.brokerName}),(0,g.jsx)(q.TableCell,{children:a.username}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex items-center gap-1",children:[(0,g.jsx)(aE.Star,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),(0,g.jsx)("span",{children:a.rating})]})}),(0,g.jsx)(q.TableCell,{className:"max-w-xs truncate",children:a.reviewTitle}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"approved"===a.status?"default":"secondary",children:a.status})}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.datePosted),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>O(a.id),"data-testid":`button-view-review-${a.id}`,children:(0,g.jsx)(aq.Eye,{className:"h-4 w-4"})}),"pending"===a.status&&(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>aS.mutate(a.id),disabled:aS.isPending,"data-testid":`button-approve-review-${a.id}`,children:"Approve"})})]})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No reviews found"})})})]})})})]})})]}),(0,g.jsx)(W.Dialog,{open:Q,onOpenChange:R,children:(0,g.jsxs)(W.DialogContent,{"data-testid":"modal-add-broker",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Add New Broker"}),(0,g.jsx)(W.DialogDescription,{children:"Add a new broker to the directory"})]}),(0,g.jsx)(aC.Form,{...av,children:(0,g.jsxs)("form",{onSubmit:av.handleSubmit(a=>{aD.mutate(a)}),className:"space-y-4",children:[(0,g.jsx)(aC.FormField,{control:av.control,name:"name",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Broker Name *"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{...a,"data-testid":"input-broker-name"})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:av.control,name:"country",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Country"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{...a,"data-testid":"input-country"})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:av.control,name:"regulation",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Regulation"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{...a,placeholder:"e.g., FCA, ASIC","data-testid":"input-regulation"})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:av.control,name:"websiteUrl",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Website URL"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{...a,type:"url",placeholder:"https://...","data-testid":"input-website"})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>R(!1),children:"Cancel"}),(0,g.jsx)(l.Button,{type:"submit",disabled:aD.isPending,"data-testid":"button-submit-add-broker",children:"Add Broker"})]})]})})]})}),(0,g.jsx)(W.Dialog,{open:!!A,onOpenChange:()=>C(null),children:(0,g.jsxs)(W.DialogContent,{"data-testid":"modal-view-broker",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Broker Details"})}),aV&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),(0,g.jsx)("div",{className:"text-lg font-semibold",children:aV.name})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Country"}),(0,g.jsx)("div",{children:aV.country||"-"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Regulation"}),(0,g.jsx)("div",{children:aV.regulation||"-"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,g.jsxs)("div",{className:"flex gap-2 mt-1",children:[(0,g.jsx)(P.Badge,{variant:aV.isVerified?"default":"secondary",children:aV.isVerified?"Verified":"Unverified"}),aV.scamWarning&&(0,g.jsx)(P.Badge,{variant:"destructive",children:"Scam Warning"}),(0,g.jsx)(P.Badge,{children:aV.status})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Reviews & Rating"}),(0,g.jsxs)("div",{children:[aV.reviewCount," reviews â¢ ",aV.overallRating,"/5 rating"]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Scam Reports"}),(0,g.jsx)("div",{children:aV.scamReportCount})]})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{variant:"outline",onClick:()=>C(null),children:"Close"})})]})}),(0,g.jsx)(W.Dialog,{open:!!D,onOpenChange:()=>E(null),children:(0,g.jsxs)(W.DialogContent,{"data-testid":"modal-edit-broker",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Edit Broker"})}),(0,g.jsx)(aC.Form,{...ax,children:(0,g.jsxs)("form",{onSubmit:ax.handleSubmit(a=>{aF.mutate(a)}),className:"space-y-4",children:[(0,g.jsx)(aC.FormField,{control:ax.control,name:"name",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Broker Name *"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{...a})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:ax.control,name:"country",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Country"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{...a})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:ax.control,name:"regulation",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Regulation"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{...a})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>E(null),children:"Cancel"}),(0,g.jsx)(l.Button,{type:"submit",disabled:aF.isPending,children:"Save Changes"})]})]})})]})}),(0,g.jsx)(W.Dialog,{open:!!F,onOpenChange:()=>{G(null),$(!1)},children:(0,g.jsxs)(W.DialogContent,{"data-testid":"modal-delete-broker",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Delete Broker"}),(0,g.jsx)(W.DialogDescription,{children:"This will soft-delete the broker. Reviews will be preserved for audit trail."})]}),aV&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,g.jsx)("div",{className:"font-medium",children:aV.name}),(0,g.jsxs)("div",{className:"text-sm text-muted-foreground",children:[aV.reviewCount," reviews"]})]}),(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)(al.Checkbox,{id:"delete-confirm",checked:Z,onCheckedChange:a=>$(a),"data-testid":"checkbox-delete-confirm"}),(0,g.jsx)("label",{htmlFor:"delete-confirm",className:"text-sm font-medium cursor-pointer",children:"Yes, I want to delete this broker"})]})]}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{variant:"outline",onClick:()=>{G(null),$(!1)},children:"Cancel"}),(0,g.jsx)(l.Button,{variant:"destructive",disabled:!Z||aG.isPending,onClick:()=>F&&aG.mutate(F),"data-testid":"button-confirm-delete",children:"Delete Broker"})]})]})}),(0,g.jsx)(W.Dialog,{open:!!H,onOpenChange:()=>{I(null),ab(!1)},children:(0,g.jsxs)(W.DialogContent,{"data-testid":"modal-verify-broker",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Verify Broker"}),(0,g.jsx)(W.DialogDescription,{children:"Mark this broker as verified after confirming they meet standards"})]}),aV&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,g.jsx)("div",{className:"font-medium",children:aV.name}),(0,g.jsxs)("div",{className:"text-sm text-muted-foreground",children:[aV.country," â¢ ",aV.regulation]})]}),(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)(al.Checkbox,{id:"verify-confirm",checked:aa,onCheckedChange:a=>ab(a),"data-testid":"checkbox-verify-confirm"}),(0,g.jsx)("label",{htmlFor:"verify-confirm",className:"text-sm font-medium cursor-pointer",children:"I've verified this broker meets our standards"})]})]}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{variant:"outline",onClick:()=>{I(null),ab(!1)},children:"Cancel"}),(0,g.jsxs)(l.Button,{disabled:!aa||aH.isPending,onClick:()=>H&&aH.mutate(H),"data-testid":"button-confirm-verify",children:[(0,g.jsx)(aN.ShieldCheck,{className:"h-4 w-4 mr-2"}),"Verify Broker"]})]})]})}),(0,g.jsx)(W.Dialog,{open:!!J,onOpenChange:()=>K(null),children:(0,g.jsxs)(W.DialogContent,{"data-testid":"modal-scam-warning",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Scam Warning"}),(0,g.jsx)(W.DialogDescription,{children:"Add or remove scam warning for this broker"})]}),(0,g.jsx)(aC.Form,{...ay,children:(0,g.jsxs)("form",{onSubmit:ay.handleSubmit(a=>{aJ.mutate(a)}),className:"space-y-4",children:[(0,g.jsx)(aC.FormField,{control:ay.control,name:"enabled",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{className:"flex items-center justify-between rounded-lg border p-4",children:[(0,g.jsxs)("div",{className:"space-y-0.5",children:[(0,g.jsx)(aC.FormLabel,{className:"text-base",children:"Enable Scam Warning"}),(0,g.jsx)(aC.FormDescription,{children:"Mark this broker with a scam warning"})]}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(al.Checkbox,{checked:a.value,onCheckedChange:a.onChange,"data-testid":"checkbox-enable-warning"})})]})}),(0,g.jsx)(aC.FormField,{control:ay.control,name:"severity",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Severity"}),(0,g.jsxs)(V.Select,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(V.SelectTrigger,{"data-testid":"select-severity",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select severity"})})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"low",children:"Low"}),(0,g.jsx)(V.SelectItem,{value:"medium",children:"Medium"}),(0,g.jsx)(V.SelectItem,{value:"high",children:"High"}),(0,g.jsx)(V.SelectItem,{value:"critical",children:"Critical"})]})]}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:ay.control,name:"reason",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Reason"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(U.Textarea,{...a,rows:3,"data-testid":"textarea-warning-reason"})}),(0,g.jsx)(aC.FormDescription,{children:"Optional explanation for the warning"}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>K(null),children:"Cancel"}),(0,g.jsx)(l.Button,{type:"submit",disabled:aJ.isPending,children:"Save"})]})]})})]})}),(0,g.jsx)(W.Dialog,{open:!!L,onOpenChange:()=>M(null),children:(0,g.jsxs)(W.DialogContent,{className:"max-w-2xl","data-testid":"modal-view-scam-report",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Scam Report Details"})}),aW&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Broker"}),(0,g.jsx)("div",{className:"font-semibold",children:aW.brokerName})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Reporter"}),(0,g.jsx)("div",{children:aW.username})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Severity"}),(0,g.jsx)(P.Badge,{variant:"critical"===aW.scamSeverity||"high"===aW.scamSeverity?"destructive":"default",children:aW.scamSeverity||"Not specified"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Title"}),(0,g.jsx)("div",{children:aW.reviewTitle})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Report"}),(0,g.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:aW.reviewBody})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,g.jsx)(P.Badge,{children:aW.status})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Submitted"}),(0,g.jsx)("div",{children:(0,B.formatDistanceToNow)(new Date(aW.datePosted),{addSuffix:!0})})]})]}),(0,g.jsxs)(W.DialogFooter,{children:[aW?.status==="pending"&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(l.Button,{variant:"outline",onClick:()=>L&&aK.mutate({reportId:L,resolution:"dismissed"}),disabled:aK.isPending,"data-testid":"button-dismiss-report",children:"Dismiss Report"}),(0,g.jsx)(l.Button,{onClick:()=>L&&aK.mutate({reportId:L,resolution:"confirmed"}),disabled:aK.isPending,"data-testid":"button-confirm-report",children:"Confirm Scam"})]}),aW?.status!=="pending"&&(0,g.jsx)(l.Button,{variant:"outline",onClick:()=>M(null),children:"Close"})]})]})}),(0,g.jsx)(W.Dialog,{open:!!N,onOpenChange:()=>O(null),children:(0,g.jsxs)(W.DialogContent,{className:"max-w-2xl","data-testid":"modal-view-review",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Review Details"})}),aX&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Broker"}),(0,g.jsx)("div",{className:"font-semibold",children:aX.brokerName})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Reviewer"}),(0,g.jsx)("div",{children:aX.username})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Rating"}),(0,g.jsxs)("div",{className:"flex items-center gap-1",children:[[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(aE.Star,{className:`h-4 w-4 ${b<aX.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},b)),(0,g.jsxs)("span",{className:"ml-2",children:[aX.rating,"/5"]})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Title"}),(0,g.jsx)("div",{children:aX.reviewTitle})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Review"}),(0,g.jsx)("div",{className:"p-4 bg-muted rounded-lg whitespace-pre-wrap",children:aX.reviewBody})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,g.jsx)(P.Badge,{children:aX.status})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Submitted"}),(0,g.jsx)("div",{children:(0,B.formatDistanceToNow)(new Date(aX.datePosted),{addSuffix:!0})})]}),"pending"===aX.status&&(0,g.jsx)(aC.Form,{...aB,children:(0,g.jsxs)("form",{onSubmit:aB.handleSubmit(a=>{aT.mutate(a)}),className:"space-y-4 pt-4 border-t",children:[(0,g.jsx)(aC.FormField,{control:aB.control,name:"reason",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Rejection Reason (if rejecting)"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(U.Textarea,{...a,rows:3,placeholder:"Explain why this review is being rejected...","data-testid":"textarea-reject-reason"})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>aX&&aS.mutate(aX.id),disabled:aS.isPending,"data-testid":"button-approve-review",children:"Approve"}),(0,g.jsx)(l.Button,{type:"submit",variant:"destructive",disabled:aT.isPending,"data-testid":"button-reject-review",children:"Reject"})]})]})})]}),aX?.status!=="pending"&&(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{variant:"outline",onClick:()=>O(null),children:"Close"})})]})})]})}a.s(["default",()=>aS],60289);var aT=a.i(53277);let aU=(0,b.default)("CircleArrowDown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]),aV=(0,b.default)("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);var aW=a.i(83077),aX=a.i(5151),aY=a.i(48532),aZ=a.i(58419);function a$(a,b){let c=a.getFullYear()-b.getFullYear()||a.getMonth()-b.getMonth()||a.getDate()-b.getDate()||a.getHours()-b.getHours()||a.getMinutes()-b.getMinutes()||a.getSeconds()-b.getSeconds()||a.getMilliseconds()-b.getMilliseconds();return c<0?-1:c>0?1:c}let a_={coinPurchases:"hsl(var(--primary))",subscriptions:"hsl(142, 76%, 36%)",marketplace:"hsl(262, 83%, 58%)",other:"hsl(var(--muted))"},a0=aB.z.object({adminNotes:aB.z.string().optional(),verified:aB.z.boolean().refine(a=>!0===a,{message:"You must verify all conditions before approving"})}),a1=aB.z.object({reason:aB.z.enum(["insufficient_balance","invalid_wallet","suspicious_activity","verification_required","other"]),detailedReason:aB.z.string().min(10,"Please provide a detailed reason (minimum 10 characters)"),notifyUser:aB.z.boolean().default(!0)}),a2=aB.z.object({transactionId:aB.z.string().min(1,"Transaction ID is required"),notes:aB.z.string().optional(),confirmed:aB.z.boolean().refine(a=>!0===a,{message:"You must confirm payment has been sent"})}),a3=aB.z.object({dateFrom:aB.z.string().optional(),dateTo:aB.z.string().optional(),types:aB.z.array(aB.z.string()).min(1,"Select at least one transaction type"),format:aB.z.enum(["csv"]).default("csv"),includeNotes:aB.z.boolean().default(!1)});function a4(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(a)}function a5(a){switch(a?.toLowerCase()){case"completed":return"default";case"pending":return"secondary";case"failed":return"destructive";default:return"outline"}}function a6(a){switch(a?.toLowerCase()){case"coin purchase":return"default";case"subscription":return"secondary";case"marketplace":default:return"outline";case"withdrawal":return"destructive"}}function a7(){var a;let[b,c]=(0,h.useState)("30d"),{toast:d}=(0,Y.useToast)(),[e,f]=(0,h.useState)(null),[i,m]=(0,h.useState)(null),[n,o]=(0,h.useState)(null),[r,s]=(0,h.useState)(null),[u,v]=(0,h.useState)(null),[w,y]=(0,h.useState)(!1),{data:z,isLoading:A}=(0,p.useQuery)({queryKey:["/api/admin/finance/overview",b]}),E=z??{totalRevenue:0,revenueGrowth:0,pendingWithdrawals:0,pendingWithdrawalCount:0,totalTransactions:0,transactionsToday:0},{data:F,isLoading:Q}=(0,p.useQuery)({queryKey:["/api/admin/finance/transactions/recent",{limit:20,period:b}]}),R=Array.isArray(F)?F:[],{data:X,isLoading:Z}=(0,p.useQuery)({queryKey:["/api/admin/finance/withdrawals/pending"]}),$=Array.isArray(X)?X:[],{data:_,isLoading:aa}=(0,p.useQuery)({queryKey:["/api/admin/finance/revenue/trend",{period:b}]}),ab=Array.isArray(_)?_:[],{data:ac,isLoading:ae}=(0,p.useQuery)({queryKey:["/api/admin/finance/revenue/by-source",{period:b}]}),af=Array.isArray(ac)?ac:[],{data:ag}=(0,p.useQuery)({queryKey:["/api/admin/finance/withdrawals",r||e||i||n],enabled:!!(r||e||i||n),queryFn:async()=>{let a=r||e||i||n,b=$.find(b=>b.id===a);if(b)return b;let c=await fetch(`/api/admin/finance/withdrawals/${a}`);if(!c.ok)throw Error("Failed to fetch withdrawal");return c.json()}}),{data:ah}=(0,p.useQuery)({queryKey:["/api/admin/finance/transactions",u],enabled:!!u,queryFn:async()=>{let a=R.find(a=>a.id===u);if(a)return a;let b=await fetch(`/api/admin/finance/transactions/${u}`);if(!b.ok)throw Error("Failed to fetch transaction");return b.json()}}),ak=(0,az.useForm)({resolver:(0,aA.zodResolver)(a0),defaultValues:{adminNotes:"",verified:!1}}),am=(0,az.useForm)({resolver:(0,aA.zodResolver)(a1),defaultValues:{reason:"other",detailedReason:"",notifyUser:!0}}),an=(0,az.useForm)({resolver:(0,aA.zodResolver)(a2),defaultValues:{transactionId:"",notes:"",confirmed:!1}}),as=(0,az.useForm)({resolver:(0,aA.zodResolver)(a3),defaultValues:{types:[],format:"csv",includeNotes:!1}}),at=(0,S.useMutation)({mutationFn:async a=>{if(!e)throw Error("No withdrawal selected");return(0,aj.apiRequest)("POST",`/api/admin/finance/withdrawals/${e}/approve`,a)},onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/finance"]}),f(null),ak.reset(),d({title:"Withdrawal approved successfully"})},onError:()=>{d({title:"Failed to approve withdrawal",variant:"destructive"})}}),au=(0,S.useMutation)({mutationFn:async a=>{if(!i)throw Error("No withdrawal selected");return(0,aj.apiRequest)("POST",`/api/admin/finance/withdrawals/${i}/reject`,a)},onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/finance"]}),m(null),am.reset(),d({title:"Withdrawal rejected successfully"})},onError:()=>{d({title:"Failed to reject withdrawal",variant:"destructive"})}}),av=(0,S.useMutation)({mutationFn:async a=>{if(!n)throw Error("No withdrawal selected");return(0,aj.apiRequest)("POST",`/api/admin/finance/withdrawals/${n}/complete`,a)},onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/finance"]}),o(null),an.reset(),d({title:"Withdrawal marked as completed"})},onError:()=>{d({title:"Failed to complete withdrawal",variant:"destructive"})}}),aw=(0,S.useMutation)({mutationFn:async a=>{let b=new URLSearchParams;a.dateFrom&&b.set("dateFrom",a.dateFrom),a.dateTo&&b.set("dateTo",a.dateTo),a.types.forEach(a=>b.append("types",a)),b.set("format",a.format),b.set("includeNotes",a.includeNotes.toString());let c=await fetch(`/api/admin/finance/transactions/export?${b.toString()}`);if(!c.ok)throw Error("Export failed");let d=await c.blob(),e=window.URL.createObjectURL(d),f=document.createElement("a");f.href=e,f.download=`transactions-${(0,ai.format)(new Date,"yyyy-MM-dd")}.csv`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(e)},onSuccess:()=>{y(!1),as.reset(),d({title:"Transactions exported successfully"})},onError:()=>{d({title:"Failed to export transactions",variant:"destructive"})}});return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold","data-testid":"title-finance-management",children:"Finance Management"}),(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsxs)(V.Select,{value:b,onValueChange:c,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-48","data-testid":"select-period-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select period"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"today",children:"Today"}),(0,g.jsx)(V.SelectItem,{value:"7d",children:"Last 7 Days"}),(0,g.jsx)(V.SelectItem,{value:"30d",children:"Last 30 Days"}),(0,g.jsx)(V.SelectItem,{value:"90d",children:"Last 90 Days"}),(0,g.jsx)(V.SelectItem,{value:"year",children:"This Year"}),(0,g.jsx)(V.SelectItem,{value:"all",children:"All Time"})]})]}),(0,g.jsxs)(l.Button,{variant:"outline",onClick:()=>y(!0),"data-testid":"button-export-transactions",children:[(0,g.jsx)(ad.Download,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-total-revenue",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Revenue"}),(0,g.jsx)(t.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:A?(0,g.jsx)(j.Skeleton,{className:"h-8 w-24"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-finance-revenue",children:a4(E.totalRevenue)}),(0,g.jsxs)("p",{className:`text-xs flex items-center gap-1 ${E.revenueGrowth>=0?"text-green-600":"text-red-600"}`,children:[E.revenueGrowth>=0?(0,g.jsx)(x.TrendingUp,{className:"h-3 w-3"}):(0,g.jsx)(aT.TrendingDown,{className:"h-3 w-3"}),E.revenueGrowth>=0?"+":"",E.revenueGrowth,"% vs last period"]})]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-pending-withdrawals",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Pending Withdrawals"}),(0,g.jsx)(aU,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:A?(0,g.jsx)(j.Skeleton,{className:"h-8 w-24"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:`text-2xl font-bold ${E.pendingWithdrawalCount>0?"text-orange-600":""}`,"data-testid":"text-pending-withdrawals",children:a4(E.pendingWithdrawals)}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:[E.pendingWithdrawalCount," ",1===E.pendingWithdrawalCount?"request":"requests"]})]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-total-transactions",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Transactions"}),(0,g.jsx)(aV,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:A?(0,g.jsx)(j.Skeleton,{className:"h-8 w-24"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-total-transactions",children:(a=E.totalTransactions,new Intl.NumberFormat("en-US").format(a))}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:[E.transactionsToday," today"]})]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-top-earner",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Top Earner"}),(0,g.jsx)(aW.Trophy,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:A?(0,g.jsx)(j.Skeleton,{className:"h-8 w-24"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[E.topEarner?.avatarUrl&&(0,g.jsxs)(ax.Avatar,{className:"h-6 w-6",children:[(0,g.jsx)(ax.AvatarImage,{src:E.topEarner.avatarUrl}),(0,g.jsx)(ax.AvatarFallback,{children:E.topEarner.username?.[0]?.toUpperCase()})]}),(0,g.jsx)("div",{className:"text-lg font-bold truncate",children:E.topEarner?.username||"N/A"})]}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a4(E.topEarner?.earnings||0)," earned"]})]})})]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-revenue-trend",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Revenue Trend"})}),(0,g.jsx)(k.CardContent,{children:aa?(0,g.jsx)(j.Skeleton,{className:"h-64"}):ab.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(C.LineChart,{data:ab,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"date"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{formatter:a=>a4(Number(a))}),(0,g.jsx)(D.Line,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3}})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No revenue data available"})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-revenue-by-source",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Revenue by Source"})}),(0,g.jsx)(k.CardContent,{children:ae?(0,g.jsx)(j.Skeleton,{className:"h-64"}):af.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(G.PieChart,{children:[(0,g.jsx)(H.Pie,{data:af,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:60,label:a=>`${a.name}: ${a4(a.value)}`,children:af.map((a,b)=>{let c=a.name.toLowerCase().replace(/\s+/g,"");return(0,g.jsx)(I.Cell,{fill:a_[c]||a_.other},`cell-${b}`)})}),(0,g.jsx)(M.Tooltip,{formatter:a=>a4(Number(a))}),(0,g.jsx)(O.Legend,{})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No source data available"})})]})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Pending Withdrawals (",$.length,")"]})}),(0,g.jsx)(k.CardContent,{children:Z?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-16"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"User"}),(0,g.jsx)(q.TableHead,{children:"Amount"}),(0,g.jsx)(q.TableHead,{children:"Method"}),(0,g.jsx)(q.TableHead,{children:"Wallet"}),(0,g.jsx)(q.TableHead,{children:"Requested"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:$.length>0?$.map(a=>{var b,c;let e,h,i,j,k,n,o=(b=new Date,c=new Date(a.createdAt),e=(0,aZ.toDate)(b),i=a$(e,h=(0,aZ.toDate)(c)),j=Math.abs((0,aY.differenceInCalendarDays)(e,h)),e.setDate(e.getDate()-i*j),k=Number(a$(e,h)===-i),0==(n=i*(j-k))?0:n);return(0,g.jsxs)(q.TableRow,{"data-testid":`withdrawal-row-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsxs)(ax.Avatar,{className:"h-8 w-8",children:[(0,g.jsx)(ax.AvatarImage,{src:a.avatarUrl}),(0,g.jsx)(ax.AvatarFallback,{children:a.username?.[0]?.toUpperCase()})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"font-medium",children:a.username}),o>7&&(0,g.jsxs)(P.Badge,{variant:"destructive",className:"text-xs mt-1",children:[(0,g.jsx)(ar.AlertTriangle,{className:"h-3 w-3 mr-1"}),"Urgent"]})]})]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)("span",{className:"font-bold","data-testid":`withdrawal-amount-${a.id}`,children:a4(a.amount)})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"outline",children:a.method||"USDT"})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex items-center gap-2 max-w-xs",children:[(0,g.jsx)("span",{className:"truncate",children:a.walletAddress||"N/A"}),a.walletAddress&&(0,g.jsx)(l.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>{var b;return b=a.walletAddress,void(navigator.clipboard.writeText(b),d({title:"Copied to clipboard"}))},children:(0,g.jsx)(aX.Copy,{className:"h-3 w-3"})})]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm",children:(0,ai.format)(new Date(a.createdAt),"MMM dd, yyyy HH:mm")}),(0,g.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})})]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,g.jsxs)(l.Button,{size:"sm",variant:"outline",className:"bg-green-50 hover:bg-green-100 text-green-700 border-green-200",onClick:()=>f(a.id),"data-testid":`approve-withdrawal-${a.id}`,children:[(0,g.jsx)(ao.CheckCircle,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,g.jsxs)(l.Button,{size:"sm",variant:"outline",className:"bg-red-50 hover:bg-red-100 text-red-700 border-red-200",onClick:()=>m(a.id),"data-testid":`reject-withdrawal-${a.id}`,children:[(0,g.jsx)(ap,{className:"h-4 w-4 mr-1"}),"Reject"]}),(0,g.jsx)(l.Button,{size:"sm",variant:"ghost",onClick:()=>s(a.id),"data-testid":`view-withdrawal-${a.id}`,children:(0,g.jsx)(aq.Eye,{className:"h-4 w-4"})})]})})]},a.id)}):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No pending withdrawals"})})})]})})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between",children:(0,g.jsxs)(k.CardTitle,{children:["Recent Transactions (",R.length,")"]})}),(0,g.jsx)(k.CardContent,{children:Q?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-16"},b))}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"User"}),(0,g.jsx)(q.TableHead,{children:"Type"}),(0,g.jsx)(q.TableHead,{children:"Amount"}),(0,g.jsx)(q.TableHead,{children:"Method"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Date"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:R.length>0?R.map(a=>{let b=["coin purchase","subscription","marketplace"].includes(a.type?.toLowerCase()||"");return(0,g.jsxs)(q.TableRow,{"data-testid":`transaction-row-${a.id}`,className:"cursor-pointer hover:bg-muted/50",onClick:()=>v(a.id),children:[(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsxs)(ax.Avatar,{className:"h-8 w-8",children:[(0,g.jsx)(ax.AvatarImage,{src:a.avatarUrl}),(0,g.jsx)(ax.AvatarFallback,{children:a.username?.[0]?.toUpperCase()})]}),(0,g.jsx)("span",{className:"font-medium",children:a.username})]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:a6(a.type),children:a.type||"Unknown"})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("span",{className:`font-semibold ${b?"text-green-600":"text-red-600"}`,"data-testid":`transaction-amount-${a.id}`,children:[b?"+":"-",a4(a.amount)]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)("span",{className:"text-sm",children:a.method||"N/A"})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:a5(a.status||"pending"),children:a.status||"Pending"})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)("div",{className:"text-sm",children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"ghost",onClick:b=>{b.stopPropagation(),v(a.id)},"data-testid":`view-transaction-${a.id}`,children:(0,g.jsx)(aq.Eye,{className:"h-4 w-4"})})})]},a.id)}):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No recent transactions"})})})]})}),R.length>0&&(0,g.jsx)("div",{className:"mt-4 flex justify-center",children:(0,g.jsx)(l.Button,{variant:"outline",children:"View All Transactions"})})]})})]}),(0,g.jsx)(W.Dialog,{open:!!e,onOpenChange:a=>!a&&f(null),children:(0,g.jsxs)(W.DialogContent,{className:"max-w-2xl",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Approve Withdrawal Request"}),(0,g.jsx)(W.DialogDescription,{children:"Review and approve this withdrawal request"})]}),ag&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[(0,g.jsxs)(ax.Avatar,{className:"h-12 w-12",children:[(0,g.jsx)(ax.AvatarImage,{src:ag.avatarUrl}),(0,g.jsx)(ax.AvatarFallback,{children:ag.username?.[0]?.toUpperCase()})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"font-semibold",children:ag.username}),(0,g.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Current Balance: ",a4(ag.userBalance||0)]})]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Amount Requested"}),(0,g.jsx)("div",{className:"text-2xl font-bold",children:a4(ag.amount)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Method"}),(0,g.jsx)("div",{className:"text-lg font-semibold",children:ag.method||"USDT"})]}),(0,g.jsxs)("div",{className:"col-span-2",children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Wallet Address"}),(0,g.jsx)("div",{className:"font-mono text-sm break-all",children:ag.walletAddress||"N/A"})]})]}),(0,g.jsx)(aC.Form,{...ak,children:(0,g.jsxs)("form",{onSubmit:ak.handleSubmit(a=>at.mutate(a)),className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2 p-4 bg-green-50 dark:bg-green-950 rounded-lg",children:[(0,g.jsx)("div",{className:"font-medium mb-2",children:"Verification Checklist:"}),(0,g.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,g.jsx)(ao.CheckCircle,{className:"h-4 w-4 text-green-600"}),(0,g.jsx)("span",{children:"User has sufficient balance"})]}),(0,g.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,g.jsx)(ao.CheckCircle,{className:"h-4 w-4 text-green-600"}),(0,g.jsx)("span",{children:"Wallet address is valid"})]}),(0,g.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,g.jsx)(ao.CheckCircle,{className:"h-4 w-4 text-green-600"}),(0,g.jsx)("span",{children:"No suspicious activity detected"})]})]}),(0,g.jsx)(aC.FormField,{control:ak.control,name:"adminNotes",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Admin Notes (Optional)"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(U.Textarea,{...a,placeholder:"Add any internal notes..."})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:ak.control,name:"verified",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(al.Checkbox,{checked:a.value,onCheckedChange:a.onChange})}),(0,g.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,g.jsx)(aC.FormLabel,{children:"I confirm all verification checks have been completed"}),(0,g.jsx)(aC.FormMessage,{})]})]})}),(0,g.jsx)("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-950 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)(ar.AlertTriangle,{className:"h-5 w-5 text-yellow-600 flex-shrink-0"}),(0,g.jsxs)("div",{className:"text-sm",children:[(0,g.jsx)("strong",{children:"Warning:"})," Amount will be deducted from user's balance immediately upon approval."]})]})}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>f(null),children:"Cancel"}),(0,g.jsx)(l.Button,{type:"submit",className:"bg-green-600 hover:bg-green-700",disabled:at.isPending,children:at.isPending?"Processing...":"Approve & Process"})]})]})})]})]})}),(0,g.jsx)(W.Dialog,{open:!!i,onOpenChange:a=>!a&&m(null),children:(0,g.jsxs)(W.DialogContent,{className:"max-w-2xl",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Reject Withdrawal Request"}),(0,g.jsx)(W.DialogDescription,{children:"Provide a reason for rejecting this withdrawal request"})]}),ag&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-muted/50 rounded-lg",children:[(0,g.jsxs)(ax.Avatar,{className:"h-12 w-12",children:[(0,g.jsx)(ax.AvatarImage,{src:ag.avatarUrl}),(0,g.jsx)(ax.AvatarFallback,{children:ag.username?.[0]?.toUpperCase()})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"font-semibold",children:ag.username}),(0,g.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Requested: ",a4(ag.amount)]})]})]}),(0,g.jsx)(aC.Form,{...am,children:(0,g.jsxs)("form",{onSubmit:am.handleSubmit(a=>au.mutate(a)),className:"space-y-4",children:[(0,g.jsx)(aC.FormField,{control:am.control,name:"reason",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Rejection Reason"}),(0,g.jsxs)(V.Select,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(V.SelectTrigger,{children:(0,g.jsx)(V.SelectValue,{placeholder:"Select a reason"})})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"insufficient_balance",children:"Insufficient Balance"}),(0,g.jsx)(V.SelectItem,{value:"invalid_wallet",children:"Invalid Wallet Details"}),(0,g.jsx)(V.SelectItem,{value:"suspicious_activity",children:"Suspicious Activity"}),(0,g.jsx)(V.SelectItem,{value:"verification_required",children:"Verification Required"}),(0,g.jsx)(V.SelectItem,{value:"other",children:"Other"})]})]}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:am.control,name:"detailedReason",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Detailed Reason (shown to user)"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(U.Textarea,{...a,placeholder:"Provide a clear explanation that will be shown to the user...",rows:4})}),(0,g.jsx)(aC.FormDescription,{children:"This message will be sent to the user, so please be clear and professional."}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:am.control,name:"notifyUser",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(al.Checkbox,{checked:a.value,onCheckedChange:a.onChange})}),(0,g.jsx)("div",{className:"space-y-1 leading-none",children:(0,g.jsx)(aC.FormLabel,{children:"Notify user by email"})})]})}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>m(null),children:"Cancel"}),(0,g.jsx)(l.Button,{type:"submit",variant:"destructive",disabled:au.isPending,children:au.isPending?"Processing...":"Reject Request"})]})]})})]})]})}),(0,g.jsx)(W.Dialog,{open:!!n,onOpenChange:a=>!a&&o(null),children:(0,g.jsxs)(W.DialogContent,{className:"max-w-2xl",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Mark Withdrawal as Completed"}),(0,g.jsx)(W.DialogDescription,{children:"Confirm that payment has been successfully sent"})]}),ag&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg space-y-2",children:[(0,g.jsxs)("div",{className:"flex justify-between",children:[(0,g.jsx)("span",{className:"text-sm text-muted-foreground",children:"User:"}),(0,g.jsx)("span",{className:"font-medium",children:ag.username})]}),(0,g.jsxs)("div",{className:"flex justify-between",children:[(0,g.jsx)("span",{className:"text-sm text-muted-foreground",children:"Amount:"}),(0,g.jsx)("span",{className:"font-bold",children:a4(ag.amount)})]}),(0,g.jsxs)("div",{className:"flex justify-between",children:[(0,g.jsx)("span",{className:"text-sm text-muted-foreground",children:"Method:"}),(0,g.jsx)("span",{children:ag.method||"USDT"})]}),(0,g.jsxs)("div",{className:"flex justify-between",children:[(0,g.jsx)("span",{className:"text-sm text-muted-foreground",children:"Wallet:"}),(0,g.jsx)("span",{className:"font-mono text-xs",children:ag.walletAddress})]})]}),(0,g.jsx)(aC.Form,{...an,children:(0,g.jsxs)("form",{onSubmit:an.handleSubmit(a=>av.mutate(a)),className:"space-y-4",children:[(0,g.jsx)(aC.FormField,{control:an.control,name:"transactionId",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Transaction ID / Payment Reference *"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{...a,placeholder:"Enter transaction ID or payment reference"})}),(0,g.jsx)(aC.FormDescription,{children:"The transaction hash or payment reference from the payment gateway"}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:an.control,name:"notes",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Additional Notes (Optional)"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(U.Textarea,{...a,placeholder:"Add any additional information..."})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:an.control,name:"confirmed",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(al.Checkbox,{checked:a.value,onCheckedChange:a.onChange})}),(0,g.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,g.jsx)(aC.FormLabel,{children:"I confirm that payment has been sent successfully"}),(0,g.jsx)(aC.FormMessage,{})]})]})}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>o(null),children:"Cancel"}),(0,g.jsx)(l.Button,{type:"submit",className:"bg-green-600 hover:bg-green-700",disabled:av.isPending,children:av.isPending?"Processing...":"Mark as Completed"})]})]})})]})]})}),(0,g.jsx)(W.Dialog,{open:!!u,onOpenChange:a=>!a&&v(null),children:(0,g.jsxs)(W.DialogContent,{className:"max-w-3xl",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Transaction Details"}),(0,g.jsx)(W.DialogDescription,{children:"Complete information about this transaction"})]}),ah&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{className:"col-span-2 p-4 bg-muted/50 rounded-lg",children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Transaction ID"}),(0,g.jsx)("div",{className:"font-mono text-sm",children:ah.id})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Type"}),(0,g.jsx)(P.Badge,{variant:a6(ah.type),className:"mt-1",children:ah.type})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Status"}),(0,g.jsx)(P.Badge,{variant:a5(ah.status||"pending"),className:"mt-1",children:ah.status||"Pending"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Amount"}),(0,g.jsx)("div",{className:"text-xl font-bold",children:a4(ah.amount)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Payment Method"}),(0,g.jsx)("div",{className:"font-medium",children:ah.method||"N/A"})]}),(0,g.jsxs)("div",{className:"col-span-2",children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"User"}),(0,g.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,g.jsxs)(ax.Avatar,{className:"h-8 w-8",children:[(0,g.jsx)(ax.AvatarImage,{src:ah.avatarUrl}),(0,g.jsx)(ax.AvatarFallback,{children:ah.username?.[0]?.toUpperCase()})]}),(0,g.jsx)("span",{className:"font-medium",children:ah.username})]})]}),(0,g.jsxs)("div",{className:"col-span-2",children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Date & Time"}),(0,g.jsx)("div",{children:(0,ai.format)(new Date(ah.createdAt),"PPpp")}),(0,g.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,B.formatDistanceToNow)(new Date(ah.createdAt),{addSuffix:!0})})]}),ah.description&&(0,g.jsxs)("div",{className:"col-span-2",children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Description"}),(0,g.jsx)("div",{className:"text-sm",children:ah.description})]})]}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsxs)(l.Button,{variant:"outline",onClick:()=>{d({title:"Receipt download feature coming soon"})},children:[(0,g.jsx)(ad.Download,{className:"h-4 w-4 mr-2"}),"Download Receipt"]}),(0,g.jsx)(l.Button,{onClick:()=>v(null),children:"Close"})]})]})]})}),(0,g.jsx)(W.Dialog,{open:w,onOpenChange:y,children:(0,g.jsxs)(W.DialogContent,{className:"max-w-2xl",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Export Transactions"}),(0,g.jsx)(W.DialogDescription,{children:"Select filters and export transactions to CSV"})]}),(0,g.jsx)(aC.Form,{...as,children:(0,g.jsxs)("form",{onSubmit:as.handleSubmit(a=>aw.mutate(a)),className:"space-y-4",children:[(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsx)(aC.FormField,{control:as.control,name:"dateFrom",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"From Date"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{type:"date",...a})}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:as.control,name:"dateTo",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"To Date"}),(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(T.Input,{type:"date",...a})}),(0,g.jsx)(aC.FormMessage,{})]})})]}),(0,g.jsx)(aC.FormField,{control:as.control,name:"types",render:()=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Transaction Types"}),(0,g.jsx)("div",{className:"space-y-2",children:["Coin Purchases","Subscriptions","Marketplace","Withdrawals"].map(a=>(0,g.jsx)(aC.FormField,{control:as.control,name:"types",render:({field:b})=>(0,g.jsxs)(aC.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(al.Checkbox,{checked:b.value?.includes(a),onCheckedChange:c=>c?b.onChange([...b.value,a]):b.onChange(b.value?.filter(b=>b!==a))})}),(0,g.jsx)(aC.FormLabel,{className:"font-normal",children:a})]})},a))}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:as.control,name:"format",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{children:[(0,g.jsx)(aC.FormLabel,{children:"Export Format"}),(0,g.jsxs)(V.Select,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(V.SelectTrigger,{children:(0,g.jsx)(V.SelectValue,{placeholder:"Select format"})})}),(0,g.jsx)(V.SelectContent,{children:(0,g.jsx)(V.SelectItem,{value:"csv",children:"CSV"})})]}),(0,g.jsx)(aC.FormMessage,{})]})}),(0,g.jsx)(aC.FormField,{control:as.control,name:"includeNotes",render:({field:a})=>(0,g.jsxs)(aC.FormItem,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,g.jsx)(aC.FormControl,{children:(0,g.jsx)(al.Checkbox,{checked:a.value,onCheckedChange:a.onChange})}),(0,g.jsx)("div",{className:"space-y-1 leading-none",children:(0,g.jsx)(aC.FormLabel,{children:"Include detailed notes"})})]})}),(0,g.jsxs)(W.DialogFooter,{children:[(0,g.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancel"}),(0,g.jsx)(l.Button,{type:"submit",disabled:aw.isPending,"data-testid":"button-export-submit",children:aw.isPending?"Exporting...":"Export"})]})]})})]})}),(0,g.jsx)(W.Dialog,{open:!!r,onOpenChange:a=>!a&&s(null),children:(0,g.jsxs)(W.DialogContent,{className:"max-w-2xl",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Withdrawal Details"})}),ag&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{className:"col-span-2",children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"User"}),(0,g.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,g.jsxs)(ax.Avatar,{className:"h-10 w-10",children:[(0,g.jsx)(ax.AvatarImage,{src:ag.avatarUrl}),(0,g.jsx)(ax.AvatarFallback,{children:ag.username?.[0]?.toUpperCase()})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"font-semibold",children:ag.username}),(0,g.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Balance: ",a4(ag.userBalance||0)]})]})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Amount"}),(0,g.jsx)("div",{className:"text-2xl font-bold",children:a4(ag.amount)})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Method"}),(0,g.jsx)("div",{className:"font-medium",children:ag.method||"USDT"})]}),(0,g.jsxs)("div",{className:"col-span-2",children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Wallet Address"}),(0,g.jsx)("div",{className:"font-mono text-sm break-all bg-muted/50 p-2 rounded",children:ag.walletAddress||"N/A"})]}),(0,g.jsxs)("div",{className:"col-span-2",children:[(0,g.jsx)("div",{className:"text-sm text-muted-foreground",children:"Requested"}),(0,g.jsx)("div",{children:(0,ai.format)(new Date(ag.createdAt),"PPpp")}),(0,g.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,B.formatDistanceToNow)(new Date(ag.createdAt),{addSuffix:!0})})]})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{onClick:()=>s(null),children:"Close"})})]})]})})]})}a.s(["default",()=>a7],22642);var a8=a.i(39622),a9=a.i(85811);let ba=["hsl(var(--primary))","hsl(var(--secondary))","hsl(var(--accent))","hsl(var(--muted))","#8884d8","#82ca9d","#ffc658","#ff7c7c"];function bb(){let[a,b]=(0,h.useState)("users"),{data:c,isLoading:d}=(0,p.useQuery)({queryKey:["/api/admin/analytics/users"]}),e=c||{dau:0,mau:0,newUsers:0,churnRate:0,growthData:[],countryData:[],activeInactiveData:[]},{data:f,isLoading:i}=(0,p.useQuery)({queryKey:["/api/admin/analytics/content"]}),l=f||{trendData:[],typeDistribution:[],topCreators:[],qualityScores:[]},{data:m,isLoading:n}=(0,p.useQuery)({queryKey:["/api/admin/analytics/financial"]}),o=m||{revenueTrend:[],revenueBySource:[],topEarners:[],transactionVolume:[]},{data:r,isLoading:s}=(0,p.useQuery)({queryKey:["/api/admin/analytics/engagement"]}),t=r||{avgSessionDuration:"0m",bounceRate:0,pagesPerSession:0,heatmapData:[]};return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Analytics & Reports"}),(0,g.jsxs)(X.Tabs,{value:a,onValueChange:b,"data-testid":"tabs-analytics",children:[(0,g.jsxs)(X.TabsList,{className:"grid w-full grid-cols-4",children:[(0,g.jsx)(X.TabsTrigger,{value:"users","data-testid":"tab-users",children:"Users"}),(0,g.jsx)(X.TabsTrigger,{value:"content","data-testid":"tab-content",children:"Content"}),(0,g.jsx)(X.TabsTrigger,{value:"financial","data-testid":"tab-financial",children:"Financial"}),(0,g.jsx)(X.TabsTrigger,{value:"engagement","data-testid":"tab-engagement",children:"Engagement"})]}),(0,g.jsx)(X.TabsContent,{value:"users",className:"space-y-4",children:d?(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b))}),(0,g.jsx)(j.Skeleton,{className:"h-96"})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-dau",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"DAU"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-dau",children:e.dau}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Daily Active Users"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-mau",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"MAU"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-mau",children:e.mau}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Monthly Active Users"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-new-users",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"New Users"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-new-users",children:e.newUsers}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Last 30 days"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-churn-rate",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Churn Rate"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-churn-rate",children:[e.churnRate,"%"]}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Monthly churn"})]})]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-user-growth",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"User Growth (Last 30 Days)"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(C.LineChart,{data:e.growthData,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"date"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(O.Legend,{}),(0,g.jsx)(D.Line,{type:"monotone",dataKey:"users",stroke:"hsl(var(--primary))",strokeWidth:2})]})})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-users-by-country",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Users by Country (Top 10)"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(E.BarChart,{data:e.countryData,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"country"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(F.Bar,{dataKey:"users",fill:"hsl(var(--primary))"})]})})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-active-inactive",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Active vs Inactive Users"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(G.PieChart,{children:[(0,g.jsx)(H.Pie,{data:e.activeInactiveData,cx:"50%",cy:"50%",labelLine:!1,label:a=>`${a.name}: ${a.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:e.activeInactiveData.map((a,b)=>(0,g.jsx)(I.Cell,{fill:ba[b%ba.length]},`cell-${b}`))}),(0,g.jsx)(M.Tooltip,{})]})})})]})]})]})}),(0,g.jsx)(X.TabsContent,{value:"content",className:"space-y-4",children:i?(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsx)(j.Skeleton,{className:"h-96"}),(0,g.jsx)(j.Skeleton,{className:"h-64"})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-content-trend",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Content Creation Trend (Last 30 Days)"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(C.LineChart,{data:l.trendData,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"date"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(O.Legend,{}),(0,g.jsx)(D.Line,{type:"monotone",dataKey:"count",stroke:"hsl(var(--primary))",strokeWidth:2})]})})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-content-type-distribution",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Content Type Distribution"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(G.PieChart,{children:[(0,g.jsx)(H.Pie,{data:l.typeDistribution,cx:"50%",cy:"50%",labelLine:!1,label:a=>`${a.name}: ${a.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:l.typeDistribution.map((a,b)=>(0,g.jsx)(I.Cell,{fill:ba[b%ba.length]},`cell-${b}`))}),(0,g.jsx)(M.Tooltip,{})]})})})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-top-creators",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Top Content Creators"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Rank"}),(0,g.jsx)(q.TableHead,{children:"Creator"}),(0,g.jsx)(q.TableHead,{children:"Posts"}),(0,g.jsx)(q.TableHead,{children:"Views"}),(0,g.jsx)(q.TableHead,{children:"Avg Quality"})]})}),(0,g.jsx)(q.TableBody,{children:l.topCreators.length>0?l.topCreators.map((a,b)=>(0,g.jsxs)(q.TableRow,{"data-testid":`creator-${a.id}`,children:[(0,g.jsx)(q.TableCell,{"data-testid":`creator-rank-${a.id}`,children:b+1}),(0,g.jsx)(q.TableCell,{children:a.username}),(0,g.jsx)(q.TableCell,{children:a.posts}),(0,g.jsx)(q.TableCell,{children:a.views}),(0,g.jsx)(q.TableCell,{children:a.avgQuality?.toFixed(1)||"N/A"})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No data available"})})})]})})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-quality-scores",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Quality Scores Histogram"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(E.BarChart,{data:l.qualityScores,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"score"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(F.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})})})]})]})}),(0,g.jsx)(X.TabsContent,{value:"financial",className:"space-y-4",children:n?(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsx)(j.Skeleton,{className:"h-96"}),(0,g.jsx)(j.Skeleton,{className:"h-64"})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-revenue-trend",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Revenue Trend (Last 30 Days)"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(a8.AreaChart,{data:o.revenueTrend,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"date"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(O.Legend,{}),(0,g.jsx)(a9.Area,{type:"monotone",dataKey:"revenue",stroke:"hsl(var(--primary))",fill:"hsl(var(--primary))",fillOpacity:.6})]})})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-revenue-by-source",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Revenue by Source"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(G.PieChart,{children:[(0,g.jsx)(H.Pie,{data:o.revenueBySource,cx:"50%",cy:"50%",labelLine:!1,label:a=>`${a.name}: $${a.value}`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:o.revenueBySource.map((a,b)=>(0,g.jsx)(I.Cell,{fill:ba[b%ba.length]},`cell-${b}`))}),(0,g.jsx)(M.Tooltip,{})]})})})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-top-earners",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Top Earners"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Rank"}),(0,g.jsx)(q.TableHead,{children:"User"}),(0,g.jsx)(q.TableHead,{children:"Total Earnings"}),(0,g.jsx)(q.TableHead,{children:"This Month"}),(0,g.jsx)(q.TableHead,{children:"Sales"})]})}),(0,g.jsx)(q.TableBody,{children:o.topEarners.length>0?o.topEarners.map((a,b)=>(0,g.jsxs)(q.TableRow,{"data-testid":`earner-${a.id}`,children:[(0,g.jsx)(q.TableCell,{"data-testid":`earner-rank-${a.id}`,children:b+1}),(0,g.jsx)(q.TableCell,{children:a.username}),(0,g.jsxs)(q.TableCell,{children:["$",a.totalEarnings]}),(0,g.jsxs)(q.TableCell,{children:["$",a.monthlyEarnings]}),(0,g.jsx)(q.TableCell,{children:a.sales})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No data available"})})})]})})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-transaction-volume",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Transaction Volume"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(E.BarChart,{data:o.transactionVolume,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"date"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(F.Bar,{dataKey:"volume",fill:"hsl(var(--primary))"})]})})})]})]})}),(0,g.jsx)(X.TabsContent,{value:"engagement",className:"space-y-4",children:s?(0,g.jsx)("div",{className:"space-y-4",children:(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b))})}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-avg-session",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Avg Session Duration"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-session",children:t.avgSessionDuration}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Per user session"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-bounce-rate",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Bounce Rate"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-bounce-rate",children:[t.bounceRate,"%"]}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Single page visits"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-pages-per-session",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Pages Per Session"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-pages-per-session",children:t.pagesPerSession}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Average pages"})]})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-engagement-heatmap",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Engagement Heatmap (Hourly Activity)"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:300,children:(0,g.jsxs)(E.BarChart,{data:t.heatmapData,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"hour"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(O.Legend,{}),(0,g.jsx)(F.Bar,{dataKey:"activity",fill:"hsl(var(--primary))"})]})})})]})]})})]})]})}a.s(["default",()=>bb],37921);var bc=a.i(81615),bd=a.i(37689),be=a.i(35221);function bf(){let[a,b]=(0,h.useState)("general"),[c,d]=(0,h.useState)(""),{toast:e}=(0,Y.useToast)(),{data:f,isLoading:i}=(0,p.useQuery)({queryKey:["/api/admin/settings/general"]}),m=f||{siteName:"YoForex",siteDescription:"",maintenanceMode:!1,registrationEnabled:!0},{data:n,isLoading:o}=(0,p.useQuery)({queryKey:["/api/admin/settings/coin-economy"]}),r=n||{usdToCoinsRate:100,packages:[],minWithdrawal:1e3,withdrawalFee:5},{data:s,isLoading:t}=(0,p.useQuery)({queryKey:["/api/admin/settings/email-templates",{search:c}]}),u=Array.isArray(s)?s:[],{data:v,isLoading:w}=(0,p.useQuery)({queryKey:["/api/admin/settings/feature-flags"]}),x=Array.isArray(v)?v:[],{data:y,isLoading:z}=(0,p.useQuery)({queryKey:["/api/admin/settings/admin-roles"]}),A=Array.isArray(y)?y:[],B=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("PUT","/api/admin/settings/general",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/settings/general"]}),e({title:"Settings updated successfully"})},onError:()=>{e({title:"Failed to update settings",variant:"destructive"})}});(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("PUT","/api/admin/settings/coin-economy",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/settings/coin-economy"]}),e({title:"Coin settings updated successfully"})},onError:()=>{e({title:"Failed to update coin settings",variant:"destructive"})}});let C=(0,S.useMutation)({mutationFn:async({flagId:a,enabled:b})=>(0,aj.apiRequest)("PUT",`/api/admin/settings/feature-flags/${a}`,{enabled:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/settings/feature-flags"]}),e({title:"Feature flag updated"})},onError:()=>{e({title:"Failed to update feature flag",variant:"destructive"})}});return(0,S.useMutation)({mutationFn:async({userId:a,role:b})=>(0,aj.apiRequest)("POST","/api/admin/settings/admin-roles/grant",{userId:a,role:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/settings/admin-roles"]}),e({title:"Admin role granted successfully"})},onError:()=>{e({title:"Failed to grant admin role",variant:"destructive"})}}),(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"System Settings"}),(0,g.jsxs)(X.Tabs,{value:a,onValueChange:b,"data-testid":"tabs-settings",children:[(0,g.jsxs)(X.TabsList,{className:"grid w-full grid-cols-5",children:[(0,g.jsx)(X.TabsTrigger,{value:"general","data-testid":"tab-general",children:"General"}),(0,g.jsx)(X.TabsTrigger,{value:"coin-economy","data-testid":"tab-coin-economy",children:"Coin Economy"}),(0,g.jsx)(X.TabsTrigger,{value:"email-templates","data-testid":"tab-email-templates",children:"Email Templates"}),(0,g.jsx)(X.TabsTrigger,{value:"feature-flags","data-testid":"tab-feature-flags",children:"Feature Flags"}),(0,g.jsx)(X.TabsTrigger,{value:"admin-roles","data-testid":"tab-admin-roles",children:"Admin Roles"})]}),(0,g.jsx)(X.TabsContent,{value:"general",className:"space-y-4",children:i?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(k.Card,{"data-testid":"card-general-settings",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"General Settings"})}),(0,g.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"site-name",children:"Site Name"}),(0,g.jsx)(T.Input,{id:"site-name",defaultValue:m.siteName,"data-testid":"input-site-name"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"site-description",children:"Site Description"}),(0,g.jsx)(U.Textarea,{id:"site-description",defaultValue:m.siteDescription,"data-testid":"textarea-site-description"})]}),(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{className:"space-y-1",children:[(0,g.jsx)(be.Label,{htmlFor:"maintenance-mode",children:"Maintenance Mode"}),(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enable site maintenance mode"})]}),(0,g.jsx)(bc.Switch,{id:"maintenance-mode",defaultChecked:m.maintenanceMode,"data-testid":"switch-maintenance-mode"})]}),(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{className:"space-y-1",children:[(0,g.jsx)(be.Label,{htmlFor:"registration-enabled",children:"Registration Enabled"}),(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Allow new user registrations"})]}),(0,g.jsx)(bc.Switch,{id:"registration-enabled",defaultChecked:m.registrationEnabled,"data-testid":"switch-registration-enabled"})]}),(0,g.jsx)(l.Button,{onClick:()=>B.mutate(m),disabled:B.isPending,"data-testid":"button-save-general",children:"Save Changes"})]})]})}),(0,g.jsx)(X.TabsContent,{value:"coin-economy",className:"space-y-4",children:o?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(k.Card,{"data-testid":"card-exchange-rate",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Exchange Rate"})}),(0,g.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"usd-to-coins",children:"USD to Coins Rate"}),(0,g.jsx)(T.Input,{id:"usd-to-coins",type:"number",defaultValue:r.usdToCoinsRate,"data-testid":"input-usd-to-coins"}),(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"1 USD = X coins"})]}),(0,g.jsx)(l.Button,{"data-testid":"button-save-exchange-rate",children:"Save Exchange Rate"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-recharge-packages",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Recharge Packages"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Package"}),(0,g.jsx)(q.TableHead,{children:"Coins"}),(0,g.jsx)(q.TableHead,{children:"Price (USD)"}),(0,g.jsx)(q.TableHead,{children:"Bonus"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:r.packages.length>0?r.packages.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`package-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:a.name}),(0,g.jsx)(q.TableCell,{children:a.coins}),(0,g.jsxs)(q.TableCell,{children:["$",a.price]}),(0,g.jsxs)(q.TableCell,{children:[a.bonus,"%"]}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"outline","data-testid":`button-edit-package-${a.id}`,children:"Edit"})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No packages configured"})})})]})})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-withdrawal-settings",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Withdrawal Settings"})}),(0,g.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"min-withdrawal",children:"Minimum Withdrawal Amount"}),(0,g.jsx)(T.Input,{id:"min-withdrawal",type:"number",defaultValue:r.minWithdrawal,"data-testid":"input-min-withdrawal"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"withdrawal-fee",children:"Withdrawal Fee (%)"}),(0,g.jsx)(T.Input,{id:"withdrawal-fee",type:"number",defaultValue:r.withdrawalFee,"data-testid":"input-withdrawal-fee"})]}),(0,g.jsx)(l.Button,{"data-testid":"button-save-withdrawal",children:"Save Withdrawal Settings"})]})]})]})}),(0,g.jsxs)(X.TabsContent,{value:"email-templates",className:"space-y-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Search Templates"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(T.Input,{placeholder:"Search templates...",value:c,onChange:a=>d(a.target.value),"data-testid":"input-search-templates"})})]}),t?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(k.Card,{"data-testid":"card-email-templates",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Email Templates"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Name"}),(0,g.jsx)(q.TableHead,{children:"Subject"}),(0,g.jsx)(q.TableHead,{children:"Type"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:u.length>0?u.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`template-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:a.name}),(0,g.jsx)(q.TableCell,{children:a.subject}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"outline",children:a.type})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)(l.Button,{size:"sm",variant:"outline","data-testid":`button-edit-template-${a.id}`,children:"Edit"}),(0,g.jsx)(l.Button,{size:"sm",variant:"outline","data-testid":`button-preview-template-${a.id}`,children:"Preview"})]})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"No templates found"})})})]})})})]})]}),(0,g.jsx)(X.TabsContent,{value:"feature-flags",className:"space-y-4",children:w?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(k.Card,{"data-testid":"card-feature-flags",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Feature Flags"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Feature"}),(0,g.jsx)(q.TableHead,{children:"Description"}),(0,g.jsx)(q.TableHead,{children:"Enabled"}),(0,g.jsx)(q.TableHead,{children:"Rollout %"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:x.length>0?x.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`flag-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:a.name}),(0,g.jsx)(q.TableCell,{children:a.description}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(bc.Switch,{checked:a.enabled,onCheckedChange:b=>C.mutate({flagId:a.id,enabled:b}),"data-testid":`switch-flag-${a.id}`})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)("div",{className:"w-24",children:(0,g.jsx)(bd.Slider,{defaultValue:[a.rolloutPercentage],max:100,step:1,"data-testid":`slider-rollout-${a.id}`})})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"outline","data-testid":`button-configure-flag-${a.id}`,children:"Configure"})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No feature flags configured"})})})]})})})]})}),(0,g.jsx)(X.TabsContent,{value:"admin-roles",className:"space-y-4",children:z?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(k.Card,{"data-testid":"card-admin-roles",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Admin Roles & Permissions"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"User"}),(0,g.jsx)(q.TableHead,{children:"Email"}),(0,g.jsx)(q.TableHead,{children:"Role"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:A.length>0?A.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`admin-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:a.username}),(0,g.jsx)(q.TableCell,{children:a.email}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{children:a.role})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)(l.Button,{size:"sm",variant:"outline","data-testid":`button-edit-permissions-${a.id}`,children:"Edit Permissions"}),(0,g.jsx)(l.Button,{size:"sm",variant:"destructive","data-testid":`button-revoke-admin-${a.id}`,children:"Revoke"})]})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"No admins found"})})})]})})})]})})]})]})}function bg(){let[a,b]=(0,h.useState)("security-events"),[c,d]=(0,h.useState)("all"),[e,f]=(0,h.useState)("all"),[i,m]=(0,h.useState)("all"),[n,o]=(0,h.useState)("active"),[r,s]=(0,h.useState)(null),{toast:t}=(0,Y.useToast)(),{data:u,isLoading:v}=(0,p.useQuery)({queryKey:["/api/admin/security/events",{type:c,severity:e,resolved:i}]}),w=Array.isArray(u)?u:[],{data:x,isLoading:y}=(0,p.useQuery)({queryKey:["/api/admin/security/ip-bans",{status:n}]}),z=Array.isArray(x)?x:[],{data:A,isLoading:E}=(0,p.useQuery)({queryKey:["/api/admin/security/performance-metrics"]}),F=A||{cpu:0,memory:0,disk:0,network:0,responseTimeData:[],errorRateData:[],dbQueryTime:{avg:0,min:0,max:0},alerts:[]},G=(0,S.useMutation)({mutationFn:async({eventId:a,notes:b})=>(0,aj.apiRequest)("POST",`/api/admin/security/events/${a}/resolve`,{notes:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/security/events"]}),t({title:"Event resolved successfully"}),s(null)},onError:()=>{t({title:"Failed to resolve event",variant:"destructive"})}}),H=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("POST","/api/admin/security/ip-bans",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/security/ip-bans"]}),t({title:"IP banned successfully"})},onError:()=>{t({title:"Failed to ban IP",variant:"destructive"})}}),I=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("DELETE",`/api/admin/security/ip-bans/${a}`),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/security/ip-bans"]}),t({title:"IP unbanned successfully"})},onError:()=>{t({title:"Failed to unban IP",variant:"destructive"})}}),O=a=>{switch(a){case"critical":case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}};return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Security & Safety"}),(0,g.jsxs)(X.Tabs,{value:a,onValueChange:b,"data-testid":"tabs-security",children:[(0,g.jsxs)(X.TabsList,{className:"grid w-full grid-cols-3",children:[(0,g.jsx)(X.TabsTrigger,{value:"security-events","data-testid":"tab-security-events",children:"Security Events"}),(0,g.jsx)(X.TabsTrigger,{value:"ip-bans","data-testid":"tab-ip-bans",children:"IP Bans"}),(0,g.jsx)(X.TabsTrigger,{value:"performance","data-testid":"tab-performance",children:"Performance Metrics"})]}),(0,g.jsxs)(X.TabsContent,{value:"security-events",className:"space-y-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Filters"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,g.jsxs)(V.Select,{value:c,onValueChange:d,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-type-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Event Type"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Types"}),(0,g.jsx)(V.SelectItem,{value:"login_attempt",children:"Login Attempt"}),(0,g.jsx)(V.SelectItem,{value:"suspicious_activity",children:"Suspicious Activity"}),(0,g.jsx)(V.SelectItem,{value:"data_breach",children:"Data Breach"})]})]}),(0,g.jsxs)(V.Select,{value:e,onValueChange:f,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-severity-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Severity"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Severities"}),(0,g.jsx)(V.SelectItem,{value:"critical",children:"Critical"}),(0,g.jsx)(V.SelectItem,{value:"high",children:"High"}),(0,g.jsx)(V.SelectItem,{value:"medium",children:"Medium"}),(0,g.jsx)(V.SelectItem,{value:"low",children:"Low"})]})]}),(0,g.jsxs)(V.Select,{value:i,onValueChange:m,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-resolved-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Status"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Status"}),(0,g.jsx)(V.SelectItem,{value:"resolved",children:"Resolved"}),(0,g.jsx)(V.SelectItem,{value:"unresolved",children:"Unresolved"})]})]})]})})]}),v?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(k.Card,{"data-testid":"card-security-events",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Security Events (",w.length,")"]})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Timestamp"}),(0,g.jsx)(q.TableHead,{children:"Type"}),(0,g.jsx)(q.TableHead,{children:"Severity"}),(0,g.jsx)(q.TableHead,{children:"Description"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:w.length>0?w.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`event-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:a.type}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:O(a.severity),children:a.severity})}),(0,g.jsx)(q.TableCell,{children:a.description}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:a.resolved?"secondary":"default",children:a.resolved?"Resolved":"Unresolved"})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>s(a),"data-testid":`button-view-event-${a.id}`,children:a.resolved?"View":"Resolve"})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No security events found"})})})]})})})]}),(0,g.jsx)(W.Dialog,{open:!!r,onOpenChange:()=>s(null),children:(0,g.jsxs)(W.DialogContent,{"data-testid":"dialog-event-detail",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Security Event Details"}),(0,g.jsxs)(W.DialogDescription,{children:["Event ID: ",r?.id]})]}),r&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Type"}),(0,g.jsx)("p",{className:"font-medium",children:r.type})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Severity"}),(0,g.jsx)(P.Badge,{variant:O(r.severity),children:r.severity})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Description"}),(0,g.jsx)("p",{children:r.description})]}),!r.resolved&&(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"resolution-notes",children:"Resolution Notes"}),(0,g.jsx)(U.Textarea,{id:"resolution-notes",placeholder:"Enter resolution notes...","data-testid":"textarea-resolution-notes"}),(0,g.jsx)(l.Button,{onClick:()=>{let a=document.getElementById("resolution-notes")?.value;G.mutate({eventId:r.id,notes:a})},disabled:G.isPending,"data-testid":"button-resolve-event",children:"Resolve Event"})]})]})]})})]}),(0,g.jsxs)(X.TabsContent,{value:"ip-bans",className:"space-y-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Add IP Ban"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,g.jsx)(T.Input,{placeholder:"IP Address",id:"ban-ip-address","data-testid":"input-ban-ip-address"}),(0,g.jsx)(T.Input,{placeholder:"Reason",id:"ban-reason","data-testid":"input-ban-reason"}),(0,g.jsxs)(V.Select,{defaultValue:"permanent",children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-ban-duration",children:(0,g.jsx)(V.SelectValue,{placeholder:"Duration"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"permanent",children:"Permanent"}),(0,g.jsx)(V.SelectItem,{value:"7",children:"7 Days"}),(0,g.jsx)(V.SelectItem,{value:"30",children:"30 Days"})]})]}),(0,g.jsx)(l.Button,{onClick:()=>{let a=document.getElementById("ban-ip-address")?.value,b=document.getElementById("ban-reason")?.value;H.mutate({ipAddress:a,reason:b,duration:0})},disabled:H.isPending,"data-testid":"button-add-ban",children:"Add Ban"})]})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-4 space-y-0",children:[(0,g.jsx)(k.CardTitle,{children:"IP Bans"}),(0,g.jsxs)(V.Select,{value:n,onValueChange:o,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-48","data-testid":"select-ban-status-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Filter"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All"}),(0,g.jsx)(V.SelectItem,{value:"active",children:"Active"}),(0,g.jsx)(V.SelectItem,{value:"expired",children:"Expired"})]})]})]}),(0,g.jsx)(k.CardContent,{children:y?(0,g.jsx)(j.Skeleton,{className:"h-64"}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"IP Address"}),(0,g.jsx)(q.TableHead,{children:"Reason"}),(0,g.jsx)(q.TableHead,{children:"Banned By"}),(0,g.jsx)(q.TableHead,{children:"Banned At"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:z.length>0?z.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`ban-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:a.ipAddress}),(0,g.jsx)(q.TableCell,{children:a.reason}),(0,g.jsx)(q.TableCell,{children:a.bannedBy}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:a.active?"destructive":"secondary",children:a.active?"Active":"Expired"})}),(0,g.jsx)(q.TableCell,{children:a.active&&(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>I.mutate(a.id),disabled:I.isPending,"data-testid":`button-unban-${a.id}`,children:"Unban"})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No IP bans found"})})})]})})})]})]}),(0,g.jsx)(X.TabsContent,{value:"performance",className:"space-y-4",children:E?(0,g.jsx)("div",{className:"space-y-4",children:(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b))})}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-cpu",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"CPU Usage"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-cpu",children:[F.cpu,"%"]}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Current usage"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-memory",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Memory"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-memory",children:[F.memory,"%"]}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Used"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-disk",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Disk"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-disk",children:[F.disk,"%"]}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Used"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-network",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Network"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-network",children:[F.network," MB/s"]}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Throughput"})]})]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-response-time",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Response Time (Last 24 Hours)"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(C.LineChart,{data:F.responseTimeData,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"time"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(D.Line,{type:"monotone",dataKey:"responseTime",stroke:"hsl(var(--primary))",strokeWidth:2})]})})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-error-rate",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Error Rate"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(C.LineChart,{data:F.errorRateData,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"time"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(D.Line,{type:"monotone",dataKey:"errors",stroke:"hsl(var(--destructive))",strokeWidth:2})]})})})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-db-metrics",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Database Query Time Metrics"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Average"}),(0,g.jsxs)("p",{className:"text-2xl font-bold",children:[F.dbQueryTime.avg,"ms"]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Min"}),(0,g.jsxs)("p",{className:"text-2xl font-bold",children:[F.dbQueryTime.min,"ms"]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Max"}),(0,g.jsxs)("p",{className:"text-2xl font-bold",children:[F.dbQueryTime.max,"ms"]})]})]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-performance-alerts",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Performance Alerts"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Alert"}),(0,g.jsx)(q.TableHead,{children:"Severity"}),(0,g.jsx)(q.TableHead,{children:"Time"})]})}),(0,g.jsx)(q.TableBody,{children:F.alerts.length>0?F.alerts.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{children:a.message}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:O(a.severity),children:a.severity})}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.time),{addSuffix:!0})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:3,className:"text-center py-8 text-muted-foreground",children:"No performance alerts"})})})]})})})]})]})})]})]})}a.s(["default",()=>bf],17742),a.s(["default",()=>bg],33331);var bh=a.i(65910);function bi(){let[a,b]=(0,h.useState)("announcements"),[c,d]=(0,h.useState)(!1),{toast:e}=(0,Y.useToast)(),{data:f,isLoading:i}=(0,p.useQuery)({queryKey:["/api/admin/communications/announcements"]}),m=Array.isArray(f)?f:[],{data:n,isLoading:o}=(0,p.useQuery)({queryKey:["/api/admin/communications/campaigns"]}),r=Array.isArray(n)?n:[],{data:s,isLoading:t}=(0,p.useQuery)({queryKey:["/api/admin/communications/campaign-stats"]}),u=s||{sent:0,opened:0,openRate:0,clicked:0,clickRate:0,bounced:0,bounceRate:0},v=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("POST","/api/admin/communications/announcements",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/communications/announcements"]}),e({title:"Announcement created successfully"}),d(!1)},onError:()=>{e({title:"Failed to create announcement",variant:"destructive"})}}),w=(0,S.useMutation)({mutationFn:async({id:a,active:b})=>(0,aj.apiRequest)("PUT",`/api/admin/communications/announcements/${a}`,{active:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/communications/announcements"]}),e({title:"Announcement updated"})},onError:()=>{e({title:"Failed to update announcement",variant:"destructive"})}}),x=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("DELETE",`/api/admin/communications/announcements/${a}`),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/communications/announcements"]}),e({title:"Announcement deleted"})},onError:()=>{e({title:"Failed to delete announcement",variant:"destructive"})}});return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Communications"}),(0,g.jsxs)(X.Tabs,{value:a,onValueChange:b,"data-testid":"tabs-communications",children:[(0,g.jsxs)(X.TabsList,{className:"grid w-full grid-cols-2",children:[(0,g.jsx)(X.TabsTrigger,{value:"announcements","data-testid":"tab-announcements",children:"Announcements"}),(0,g.jsx)(X.TabsTrigger,{value:"email-campaigns","data-testid":"tab-email-campaigns",children:"Email Campaigns"})]}),(0,g.jsxs)(X.TabsContent,{value:"announcements",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Announcements"}),(0,g.jsxs)(W.Dialog,{open:c,onOpenChange:d,children:[(0,g.jsx)(W.DialogTrigger,{asChild:!0,children:(0,g.jsx)(l.Button,{"data-testid":"button-create-announcement",children:"Create Announcement"})}),(0,g.jsxs)(W.DialogContent,{"data-testid":"dialog-create-announcement",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsx)(W.DialogTitle,{children:"Create Announcement"}),(0,g.jsx)(W.DialogDescription,{children:"Create a new announcement for your users"})]}),(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"announcement-title",children:"Title"}),(0,g.jsx)(T.Input,{id:"announcement-title",placeholder:"Announcement title","data-testid":"input-announcement-title"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"announcement-content",children:"Content"}),(0,g.jsx)(U.Textarea,{id:"announcement-content",placeholder:"Announcement content",rows:4,"data-testid":"textarea-announcement-content"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"announcement-type",children:"Type"}),(0,g.jsxs)(V.Select,{defaultValue:"info",children:[(0,g.jsx)(V.SelectTrigger,{id:"announcement-type","data-testid":"select-announcement-type",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select type"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"info",children:"Info"}),(0,g.jsx)(V.SelectItem,{value:"warning",children:"Warning"}),(0,g.jsx)(V.SelectItem,{value:"success",children:"Success"}),(0,g.jsx)(V.SelectItem,{value:"error",children:"Error"})]})]})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"announcement-audience",children:"Target Audience"}),(0,g.jsxs)(V.Select,{defaultValue:"all",children:[(0,g.jsx)(V.SelectTrigger,{id:"announcement-audience","data-testid":"select-announcement-audience",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select audience"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Users"}),(0,g.jsx)(V.SelectItem,{value:"premium",children:"Premium Users"}),(0,g.jsx)(V.SelectItem,{value:"free",children:"Free Users"}),(0,g.jsx)(V.SelectItem,{value:"sellers",children:"Sellers"})]})]})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"announcement-display",children:"Display Type"}),(0,g.jsxs)(V.Select,{defaultValue:"banner",children:[(0,g.jsx)(V.SelectTrigger,{id:"announcement-display","data-testid":"select-announcement-display",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select display type"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"banner",children:"Banner"}),(0,g.jsx)(V.SelectItem,{value:"modal",children:"Modal"}),(0,g.jsx)(V.SelectItem,{value:"toast",children:"Toast"})]})]})]}),(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"announcement-start",children:"Start Date"}),(0,g.jsx)(T.Input,{id:"announcement-start",type:"date","data-testid":"input-announcement-start"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"announcement-end",children:"End Date"}),(0,g.jsx)(T.Input,{id:"announcement-end",type:"date","data-testid":"input-announcement-end"})]})]}),(0,g.jsx)(l.Button,{onClick:()=>{let a=document.getElementById("announcement-title")?.value,b=document.getElementById("announcement-content")?.value;v.mutate({title:a,content:b,type:"info",audience:"all"})},disabled:v.isPending,"data-testid":"button-submit-announcement",children:"Create Announcement"})]})]})]})]}),i?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsx)(k.Card,{"data-testid":"card-announcements",children:(0,g.jsx)(k.CardContent,{className:"p-0",children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Title"}),(0,g.jsx)(q.TableHead,{children:"Type"}),(0,g.jsx)(q.TableHead,{children:"Audience"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Views"}),(0,g.jsx)(q.TableHead,{children:"Clicks"}),(0,g.jsx)(q.TableHead,{children:"Created"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:m.length>0?m.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`announcement-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:a.title}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"outline",children:a.type})}),(0,g.jsx)(q.TableCell,{children:a.audience}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(bc.Switch,{checked:a.active,onCheckedChange:b=>w.mutate({id:a.id,active:b}),"data-testid":`switch-announcement-${a.id}`})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex items-center gap-1",children:[(0,g.jsx)(aq.Eye,{className:"h-4 w-4"}),a.views||0]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex items-center gap-1",children:[(0,g.jsx)(bh.MousePointer,{className:"h-4 w-4"}),a.clicks||0]})}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsx)(l.Button,{size:"sm",variant:"outline","data-testid":`button-edit-announcement-${a.id}`,children:"Edit"}),(0,g.jsx)(l.Button,{size:"sm",variant:"destructive",onClick:()=>x.mutate(a.id),disabled:x.isPending,"data-testid":`button-delete-announcement-${a.id}`,children:"Delete"})]})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No announcements found"})})})]})})})})]}),(0,g.jsxs)(X.TabsContent,{value:"email-campaigns",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Email Campaigns"}),(0,g.jsx)(l.Button,{"data-testid":"button-create-campaign",children:"Create Campaign"})]}),t?(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b))}):(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-sent",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Sent"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-sent",children:u.sent}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Emails sent"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-opened",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Opened"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-opened",children:u.opened}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:[u.openRate,"% open rate"]})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-clicked",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Clicked"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-clicked",children:u.clicked}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:[u.clickRate,"% click rate"]})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-bounced",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Bounced"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-bounced",children:u.bounced}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:[u.bounceRate,"% bounce rate"]})]})]})]}),o?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(k.Card,{"data-testid":"card-campaigns",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Recent Campaigns"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Name"}),(0,g.jsx)(q.TableHead,{children:"Subject"}),(0,g.jsx)(q.TableHead,{children:"Sent"}),(0,g.jsx)(q.TableHead,{children:"Opened"}),(0,g.jsx)(q.TableHead,{children:"Clicked"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Created"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:r.length>0?r.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`campaign-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:a.name}),(0,g.jsx)(q.TableCell,{children:a.subject}),(0,g.jsx)(q.TableCell,{children:a.sent||0}),(0,g.jsx)(q.TableCell,{children:a.opened||0}),(0,g.jsx)(q.TableCell,{children:a.clicked||0}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"sent"===a.status?"default":"secondary",children:a.status})}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"outline","data-testid":`button-view-campaign-${a.id}`,children:"View Report"})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No campaigns found"})})})]})})})]})]})]})]})}a.s(["default",()=>bi],56760);var bj=a.i(64604);function bk(){let[a,b]=(0,h.useState)("all"),[c,d]=(0,h.useState)("all"),[e,f]=(0,h.useState)("all"),[i,m]=(0,h.useState)(null),{toast:n}=(0,Y.useToast)(),{data:o,isLoading:r}=(0,p.useQuery)({queryKey:["/api/admin/support/tickets",{status:a,priority:c,category:e}]}),s=Array.isArray(o)?o:[],{data:t,isLoading:u}=(0,p.useQuery)({queryKey:["/api/admin/support/stats"]}),v=t||{openTickets:0,avgResponseTime:"0h",avgResolutionTime:"0h",satisfactionScore:0},w=(0,S.useMutation)({mutationFn:async({ticketId:a,data:b})=>(0,aj.apiRequest)("PUT",`/api/admin/support/tickets/${a}`,b),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/support/tickets"]}),n({title:"Ticket updated successfully"})},onError:()=>{n({title:"Failed to update ticket",variant:"destructive"})}}),x=(0,S.useMutation)({mutationFn:async({ticketId:a,message:b})=>(0,aj.apiRequest)("POST",`/api/admin/support/tickets/${a}/reply`,{message:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/support/tickets"]}),n({title:"Reply sent successfully"})},onError:()=>{n({title:"Failed to send reply",variant:"destructive"})}}),y=(0,S.useMutation)({mutationFn:async a=>(0,aj.apiRequest)("POST",`/api/admin/support/tickets/${a}/close`),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/support/tickets"]}),n({title:"Ticket closed"}),m(null)},onError:()=>{n({title:"Failed to close ticket",variant:"destructive"})}}),z=a=>{switch(a){case"urgent":case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}};return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Support & Tickets"}),u?(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b))}):(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-open-tickets",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Open Tickets"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-open-tickets",children:v.openTickets}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Awaiting response"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-avg-response-time",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Avg Response Time"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-response-time",children:v.avgResponseTime}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Time to first response"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-avg-resolution-time",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Avg Resolution Time"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-resolution-time",children:v.avgResolutionTime}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Time to close"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-satisfaction-score",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Satisfaction Score"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-satisfaction-score",children:[v.satisfactionScore,"%"]}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"User satisfaction"})]})]})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Filters"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,g.jsxs)(V.Select,{value:a,onValueChange:b,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-status-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Status"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Status"}),(0,g.jsx)(V.SelectItem,{value:"open",children:"Open"}),(0,g.jsx)(V.SelectItem,{value:"in_progress",children:"In Progress"}),(0,g.jsx)(V.SelectItem,{value:"resolved",children:"Resolved"}),(0,g.jsx)(V.SelectItem,{value:"closed",children:"Closed"})]})]}),(0,g.jsxs)(V.Select,{value:c,onValueChange:d,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-priority-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Priority"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Priorities"}),(0,g.jsx)(V.SelectItem,{value:"urgent",children:"Urgent"}),(0,g.jsx)(V.SelectItem,{value:"high",children:"High"}),(0,g.jsx)(V.SelectItem,{value:"medium",children:"Medium"}),(0,g.jsx)(V.SelectItem,{value:"low",children:"Low"})]})]}),(0,g.jsxs)(V.Select,{value:e,onValueChange:f,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-category-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Category"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Categories"}),(0,g.jsx)(V.SelectItem,{value:"technical",children:"Technical"}),(0,g.jsx)(V.SelectItem,{value:"billing",children:"Billing"}),(0,g.jsx)(V.SelectItem,{value:"general",children:"General"})]})]})]})})]}),r?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(k.Card,{"data-testid":"card-tickets",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Support Tickets (",s.length,")"]})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Ticket #"}),(0,g.jsx)(q.TableHead,{children:"User"}),(0,g.jsx)(q.TableHead,{children:"Subject"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Priority"}),(0,g.jsx)(q.TableHead,{children:"Created"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:s.length>0?s.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`ticket-${a.id}`,children:[(0,g.jsxs)(q.TableCell,{children:["#",a.id]}),(0,g.jsx)(q.TableCell,{children:a.username}),(0,g.jsx)(q.TableCell,{children:a.subject}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"outline",children:a.status})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:z(a.priority),children:a.priority})}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>m(a),"data-testid":`button-view-ticket-${a.id}`,children:"View"})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No tickets found"})})})]})})})]}),(0,g.jsx)(W.Dialog,{open:!!i,onOpenChange:()=>m(null),children:(0,g.jsxs)(W.DialogContent,{className:"max-w-3xl","data-testid":"dialog-ticket-detail",children:[(0,g.jsxs)(W.DialogHeader,{children:[(0,g.jsxs)(W.DialogTitle,{children:["Ticket #",i?.id]}),(0,g.jsx)(W.DialogDescription,{children:i?.subject})]}),i&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"User"}),(0,g.jsx)("p",{className:"font-medium",children:i.username})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,g.jsx)(P.Badge,{variant:"outline",children:i.status})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Priority"}),(0,g.jsx)(P.Badge,{variant:z(i.priority),children:i.priority})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Category"}),(0,g.jsx)("p",{className:"font-medium",children:i.category||"N/A"})]})]}),(0,g.jsx)(bj.Separator,{}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{children:"Conversation"}),(0,g.jsx)("div",{className:"border rounded-md p-4 space-y-4 max-h-96 overflow-y-auto",children:i.messages&&i.messages.length>0?i.messages.map(a=>(0,g.jsxs)("div",{className:"space-y-1",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsx)("p",{className:"font-medium",children:a.sender}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})})]}),(0,g.jsx)("p",{className:"text-sm",children:a.content}),(0,g.jsx)(bj.Separator,{className:"mt-2"})]},a.id)):(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages yet"})})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"reply-message",children:"Reply"}),(0,g.jsx)(U.Textarea,{id:"reply-message",placeholder:"Type your reply...",rows:4,"data-testid":"textarea-reply"}),(0,g.jsx)(l.Button,{onClick:()=>{let a=document.getElementById("reply-message")?.value;x.mutate({ticketId:i.id,message:a})},disabled:x.isPending,"data-testid":"button-send-reply",children:"Send Reply"})]}),(0,g.jsx)(bj.Separator,{}),(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,g.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"assign-admin",children:"Assign to Admin"}),(0,g.jsxs)(V.Select,{children:[(0,g.jsx)(V.SelectTrigger,{id:"assign-admin","data-testid":"select-assign-admin",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select admin"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"admin1",children:"Admin 1"}),(0,g.jsx)(V.SelectItem,{value:"admin2",children:"Admin 2"})]})]})]}),(0,g.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"update-status",children:"Update Status"}),(0,g.jsxs)(V.Select,{defaultValue:i.status,onValueChange:a=>{w.mutate({ticketId:i.id,data:{status:a}})},children:[(0,g.jsx)(V.SelectTrigger,{id:"update-status","data-testid":"select-update-status",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select status"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"open",children:"Open"}),(0,g.jsx)(V.SelectItem,{value:"in_progress",children:"In Progress"}),(0,g.jsx)(V.SelectItem,{value:"resolved",children:"Resolved"}),(0,g.jsx)(V.SelectItem,{value:"closed",children:"Closed"})]})]})]})]}),(0,g.jsx)("div",{className:"flex gap-2",children:(0,g.jsx)(l.Button,{variant:"destructive",onClick:()=>y.mutate(i.id),disabled:y.isPending,"data-testid":"button-close-ticket",children:"Close Ticket"})}),i.tags&&i.tags.length>0&&(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{children:"Tags"}),(0,g.jsx)("div",{className:"flex flex-wrap gap-2",children:i.tags.map((a,b)=>(0,g.jsx)(P.Badge,{variant:"secondary",children:a},b))})]})]})]})})]})}function bl(){let[a,b]=(0,h.useState)("admin-actions"),[c,d]=(0,h.useState)("all"),[e,f]=(0,h.useState)("all"),[i,m]=(0,h.useState)("all"),[n,o]=(0,h.useState)(""),[r,s]=(0,h.useState)("all"),[t,u]=(0,h.useState)("all"),[v,w]=(0,h.useState)("all"),{data:x,isLoading:y}=(0,p.useQuery)({queryKey:["/api/admin/logs/admin-actions",{admin:c,actionType:e,targetType:i,search:n}]}),z=Array.isArray(x)?x:[],{data:A,isLoading:C}=(0,p.useQuery)({queryKey:["/api/admin/logs/security",{severity:r,eventType:v}]}),D=Array.isArray(A)?A:[],{data:E,isLoading:F}=(0,p.useQuery)({queryKey:["/api/admin/logs/performance",{metricType:t}]}),G=E??{aggregations:{avg:0,min:0,max:0},logs:[]},{data:H,isLoading:I}=(0,p.useQuery)({queryKey:["/api/admin/logs/system-events",{severity:r,eventType:v}]}),J=Array.isArray(H)?H:[],K=a=>{console.log(`Exporting logs as ${a}`)},L=a=>{switch(a){case"critical":case"high":return"destructive";case"medium":return"default";case"low":return"secondary";default:return"outline"}};return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Audit Logs"}),(0,g.jsxs)(X.Tabs,{value:a,onValueChange:b,"data-testid":"tabs-logs",children:[(0,g.jsxs)(X.TabsList,{className:"grid w-full grid-cols-4",children:[(0,g.jsx)(X.TabsTrigger,{value:"admin-actions","data-testid":"tab-admin-actions",children:"Admin Actions"}),(0,g.jsx)(X.TabsTrigger,{value:"security","data-testid":"tab-security-logs",children:"Security Logs"}),(0,g.jsx)(X.TabsTrigger,{value:"performance","data-testid":"tab-performance-logs",children:"Performance Logs"}),(0,g.jsx)(X.TabsTrigger,{value:"system","data-testid":"tab-system-events",children:"System Events"})]}),(0,g.jsxs)(X.TabsContent,{value:"admin-actions",className:"space-y-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Filters & Search"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[(0,g.jsx)(T.Input,{placeholder:"Search logs...",value:n,onChange:a=>{let b=a.target.value;setTimeout(()=>o(b),300)},"data-testid":"input-search-logs"}),(0,g.jsxs)(V.Select,{value:c,onValueChange:d,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-admin-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Admin User"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Admins"}),(0,g.jsx)(V.SelectItem,{value:"admin1",children:"Admin 1"}),(0,g.jsx)(V.SelectItem,{value:"admin2",children:"Admin 2"})]})]}),(0,g.jsxs)(V.Select,{value:e,onValueChange:f,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-action-type-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Action Type"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Actions"}),(0,g.jsx)(V.SelectItem,{value:"create",children:"Create"}),(0,g.jsx)(V.SelectItem,{value:"update",children:"Update"}),(0,g.jsx)(V.SelectItem,{value:"delete",children:"Delete"})]})]}),(0,g.jsxs)(V.Select,{value:i,onValueChange:m,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-target-type-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Target Type"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Targets"}),(0,g.jsx)(V.SelectItem,{value:"user",children:"User"}),(0,g.jsx)(V.SelectItem,{value:"content",children:"Content"}),(0,g.jsx)(V.SelectItem,{value:"settings",children:"Settings"})]})]})]}),(0,g.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,g.jsx)(T.Input,{type:"date",placeholder:"Start Date",className:"w-full md:w-auto","data-testid":"input-start-date"}),(0,g.jsx)(T.Input,{type:"date",placeholder:"End Date",className:"w-full md:w-auto","data-testid":"input-end-date"}),(0,g.jsxs)("div",{className:"flex gap-2 ml-auto",children:[(0,g.jsxs)(l.Button,{variant:"outline",onClick:()=>K("csv"),"data-testid":"button-export-csv",children:[(0,g.jsx)(ad.Download,{className:"h-4 w-4 mr-1"}),"CSV"]}),(0,g.jsxs)(l.Button,{variant:"outline",onClick:()=>K("json"),"data-testid":"button-export-json",children:[(0,g.jsx)(ad.Download,{className:"h-4 w-4 mr-1"}),"JSON"]})]})]})]})]}),y?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(k.Card,{"data-testid":"card-admin-logs",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Admin Action Logs (",z.length,")"]})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Timestamp"}),(0,g.jsx)(q.TableHead,{children:"Admin"}),(0,g.jsx)(q.TableHead,{children:"Action Type"}),(0,g.jsx)(q.TableHead,{children:"Target"}),(0,g.jsx)(q.TableHead,{children:"Details"}),(0,g.jsx)(q.TableHead,{children:"IP Address"})]})}),(0,g.jsx)(q.TableBody,{children:z.length>0?z.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`log-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:a.adminUsername}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"outline",children:a.actionType})}),(0,g.jsx)(q.TableCell,{children:a.targetType}),(0,g.jsx)(q.TableCell,{children:a.details}),(0,g.jsx)(q.TableCell,{children:a.ipAddress})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No logs found"})})})]})})})]})]}),(0,g.jsxs)(X.TabsContent,{value:"security",className:"space-y-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Filters"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,g.jsxs)(V.Select,{value:r,onValueChange:s,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-security-severity-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Severity"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Severities"}),(0,g.jsx)(V.SelectItem,{value:"critical",children:"Critical"}),(0,g.jsx)(V.SelectItem,{value:"high",children:"High"}),(0,g.jsx)(V.SelectItem,{value:"medium",children:"Medium"}),(0,g.jsx)(V.SelectItem,{value:"low",children:"Low"})]})]}),(0,g.jsxs)(V.Select,{value:v,onValueChange:w,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-security-event-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Event Type"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Events"}),(0,g.jsx)(V.SelectItem,{value:"login",children:"Login"}),(0,g.jsx)(V.SelectItem,{value:"access",children:"Access"}),(0,g.jsx)(V.SelectItem,{value:"breach",children:"Breach"})]})]})]})})]}),C?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(k.Card,{"data-testid":"card-security-logs",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Security Event Logs (",D.length,")"]})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Timestamp"}),(0,g.jsx)(q.TableHead,{children:"Event Type"}),(0,g.jsx)(q.TableHead,{children:"Severity"}),(0,g.jsx)(q.TableHead,{children:"Description"}),(0,g.jsx)(q.TableHead,{children:"User"}),(0,g.jsx)(q.TableHead,{children:"IP Address"})]})}),(0,g.jsx)(q.TableBody,{children:D.length>0?D.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`security-log-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:a.eventType}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:L(a.severity),children:a.severity})}),(0,g.jsx)(q.TableCell,{children:a.description}),(0,g.jsx)(q.TableCell,{children:a.username||"N/A"}),(0,g.jsx)(q.TableCell,{children:a.ipAddress})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No security logs found"})})})]})})})]})]}),(0,g.jsxs)(X.TabsContent,{value:"performance",className:"space-y-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Filters"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,g.jsxs)(V.Select,{value:t,onValueChange:u,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-metric-type-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Metric Type"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Metrics"}),(0,g.jsx)(V.SelectItem,{value:"cpu",children:"CPU"}),(0,g.jsx)(V.SelectItem,{value:"memory",children:"Memory"}),(0,g.jsx)(V.SelectItem,{value:"response_time",children:"Response Time"})]})]}),(0,g.jsx)(T.Input,{type:"date",placeholder:"Start Date","data-testid":"input-perf-start-date"}),(0,g.jsx)(T.Input,{type:"date",placeholder:"End Date","data-testid":"input-perf-end-date"})]})})]}),F?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-avg-metric",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Average"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-avg-metric",children:G.aggregations?.avg||0}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Average value"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-min-metric",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Minimum"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-min-metric",children:G.aggregations?.min||0}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Minimum value"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-max-metric",children:[(0,g.jsx)(k.CardHeader,{className:"pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Maximum"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-max-metric",children:G.aggregations?.max||0}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Maximum value"})]})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-performance-logs",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["Performance Metrics (",G.logs.length,")"]})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Timestamp"}),(0,g.jsx)(q.TableHead,{children:"Metric Type"}),(0,g.jsx)(q.TableHead,{children:"Value"}),(0,g.jsx)(q.TableHead,{children:"Unit"}),(0,g.jsx)(q.TableHead,{children:"Status"})]})}),(0,g.jsx)(q.TableBody,{children:G.logs.length>0?G.logs.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`perf-log-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:a.metricType}),(0,g.jsx)(q.TableCell,{children:a.value}),(0,g.jsx)(q.TableCell,{children:a.unit}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"normal"===a.status?"secondary":"destructive",children:a.status})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No performance logs found"})})})]})})})]})]})]}),(0,g.jsxs)(X.TabsContent,{value:"system",className:"space-y-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Filters"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,g.jsxs)(V.Select,{value:v,onValueChange:w,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-system-event-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Event Type"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Events"}),(0,g.jsx)(V.SelectItem,{value:"startup",children:"Startup"}),(0,g.jsx)(V.SelectItem,{value:"shutdown",children:"Shutdown"}),(0,g.jsx)(V.SelectItem,{value:"error",children:"Error"})]})]}),(0,g.jsxs)(V.Select,{value:r,onValueChange:s,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-full md:w-48","data-testid":"select-system-severity-filter",children:(0,g.jsx)(V.SelectValue,{placeholder:"Severity"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Severities"}),(0,g.jsx)(V.SelectItem,{value:"critical",children:"Critical"}),(0,g.jsx)(V.SelectItem,{value:"high",children:"High"}),(0,g.jsx)(V.SelectItem,{value:"medium",children:"Medium"}),(0,g.jsx)(V.SelectItem,{value:"low",children:"Low"})]})]})]})})]}),I?(0,g.jsx)(j.Skeleton,{className:"h-96"}):(0,g.jsxs)(k.Card,{"data-testid":"card-system-events",children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{children:["System Events (",J.length,")"]})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Timestamp"}),(0,g.jsx)(q.TableHead,{children:"Event Type"}),(0,g.jsx)(q.TableHead,{children:"Severity"}),(0,g.jsx)(q.TableHead,{children:"Description"}),(0,g.jsx)(q.TableHead,{children:"Component"})]})}),(0,g.jsx)(q.TableBody,{children:J.length>0?J.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`system-event-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:a.eventType}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:L(a.severity),children:a.severity})}),(0,g.jsx)(q.TableCell,{children:a.description}),(0,g.jsx)(q.TableCell,{children:a.component})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No system events found"})})})]})})})]})]})]})]})}a.s(["default",()=>bk],66143),a.s(["default",()=>bl],86443);let bm=(0,b.default)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);function bn(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)(!1),[d,e]=(0,h.useState)([70]),{data:f,isLoading:i}=(0,p.useQuery)({queryKey:["/api/admin/automation/rules"]}),m=Array.isArray(f)?f:[],{data:n,isLoading:o}=(0,p.useQuery)({queryKey:["/api/admin/ai/moderation-stats"]}),r=n||{accuracyRate:0,falsePositives:0,falseNegatives:0,timeSavedHours:0},{data:s,isLoading:t}=(0,p.useQuery)({queryKey:["/api/admin/ai/moderation-decisions"]}),u=Array.isArray(s)?s:[],{data:v,isLoading:w}=(0,p.useQuery)({queryKey:["/api/admin/ai/sentiment-distribution"]}),x=Array.isArray(v)?v:[],{data:y,isLoading:z}=(0,p.useQuery)({queryKey:["/api/admin/ai/spam-metrics"]}),A=y||{accuracy:0,blocked:0,flagged:0},{data:C,isLoading:D}=(0,p.useQuery)({queryKey:["/api/admin/ai/flagged-content"]}),E=Array.isArray(C)?C:[],F=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/automation/rules","POST",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/automation/rules"]}),a({title:"Rule created successfully"}),c(!1)}}),J=(0,S.useMutation)({mutationFn:({id:a,enabled:b})=>(0,aj.apiRequest)(`/api/admin/automation/rules/${a}`,"PATCH",{enabled:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/automation/rules"]}),a({title:"Rule updated"})}}),K=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)(`/api/admin/automation/rules/${a}/execute`,"POST"),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/automation/rules"]}),a({title:"Rule executed successfully"})}}),L=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)(`/api/admin/ai/moderation-decisions/${a}/override`,"POST"),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/ai/moderation-decisions"]}),a({title:"Decision overridden"})}}),Q=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/ai/spam-sensitivity","PATCH",{sensitivity:a}),onSuccess:()=>{a({title:"Sensitivity updated"})}}),R=["hsl(var(--primary))","hsl(var(--accent))","hsl(var(--muted))"];return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"AI & Automation"}),(0,g.jsxs)(X.Tabs,{defaultValue:"automation",className:"space-y-4",children:[(0,g.jsxs)(X.TabsList,{children:[(0,g.jsx)(X.TabsTrigger,{value:"automation","data-testid":"tab-automation",children:"Automation Rules"}),(0,g.jsx)(X.TabsTrigger,{value:"moderation","data-testid":"tab-moderation",children:"Content Moderation AI"}),(0,g.jsx)(X.TabsTrigger,{value:"spam","data-testid":"tab-spam",children:"Spam Detection"})]}),(0,g.jsxs)(X.TabsContent,{value:"automation",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Automation Rules"}),(0,g.jsxs)(W.Dialog,{open:b,onOpenChange:c,children:[(0,g.jsx)(W.DialogTrigger,{asChild:!0,children:(0,g.jsx)(l.Button,{"data-testid":"button-create-rule",children:"Create Rule"})}),(0,g.jsxs)(W.DialogContent,{className:"max-w-2xl",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Create Automation Rule"})}),(0,g.jsxs)("form",{onSubmit:b=>{b.preventDefault();let c=new FormData(b.currentTarget),d=c.get("triggerConfig"),e=c.get("actionConfig");try{JSON.parse(d),JSON.parse(e)}catch(b){a({title:"Invalid JSON in configuration",variant:"destructive"});return}F.mutate({name:c.get("name"),triggerType:c.get("triggerType"),triggerConfig:d,actionType:c.get("actionType"),actionConfig:e})},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"name",children:"Rule Name"}),(0,g.jsx)(T.Input,{id:"name",name:"name",required:!0,"data-testid":"input-rule-name"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"triggerType",children:"Trigger Type"}),(0,g.jsxs)(V.Select,{name:"triggerType",required:!0,children:[(0,g.jsx)(V.SelectTrigger,{"data-testid":"select-trigger-type",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select trigger type"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"user_signup",children:"User Signup"}),(0,g.jsx)(V.SelectItem,{value:"content_published",children:"Content Published"}),(0,g.jsx)(V.SelectItem,{value:"time_based",children:"Time Based"}),(0,g.jsx)(V.SelectItem,{value:"threshold_reached",children:"Threshold Reached"})]})]})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"triggerConfig",children:"Trigger Configuration (JSON)"}),(0,g.jsx)(U.Textarea,{id:"triggerConfig",name:"triggerConfig",placeholder:'{"key": "value"}',className:"font-mono text-sm",required:!0,"data-testid":"textarea-trigger-config"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"actionType",children:"Action Type"}),(0,g.jsxs)(V.Select,{name:"actionType",required:!0,children:[(0,g.jsx)(V.SelectTrigger,{"data-testid":"select-action-type",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select action type"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"send_email",children:"Send Email"}),(0,g.jsx)(V.SelectItem,{value:"create_notification",children:"Create Notification"}),(0,g.jsx)(V.SelectItem,{value:"award_coins",children:"Award Coins"}),(0,g.jsx)(V.SelectItem,{value:"assign_badge",children:"Assign Badge"})]})]})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"actionConfig",children:"Action Configuration (JSON)"}),(0,g.jsx)(U.Textarea,{id:"actionConfig",name:"actionConfig",placeholder:'{"key": "value"}',className:"font-mono text-sm",required:!0,"data-testid":"textarea-action-config"})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{type:"submit",disabled:F.isPending,"data-testid":"button-submit-rule",children:F.isPending?"Creating...":"Create Rule"})})]})]})]})]}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:i?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Name"}),(0,g.jsx)(q.TableHead,{children:"Trigger"}),(0,g.jsx)(q.TableHead,{children:"Action"}),(0,g.jsx)(q.TableHead,{children:"Executions"}),(0,g.jsx)(q.TableHead,{children:"Last Executed"}),(0,g.jsx)(q.TableHead,{children:"Enabled"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsxs)(q.TableBody,{children:[m.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`rule-${a.id}`,children:[(0,g.jsx)(q.TableCell,{"data-testid":`rule-name-${a.id}`,children:a.name}),(0,g.jsx)(q.TableCell,{children:a.triggerType}),(0,g.jsx)(q.TableCell,{children:a.actionType}),(0,g.jsx)(q.TableCell,{children:a.executionCount||0}),(0,g.jsx)(q.TableCell,{children:a.lastExecutedAt?(0,B.formatDistanceToNow)(new Date(a.lastExecutedAt),{addSuffix:!0}):"Never"}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(bc.Switch,{checked:a.enabled,onCheckedChange:b=>J.mutate({id:a.id,enabled:b}),"data-testid":`switch-rule-${a.id}`})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:()=>K.mutate(a.id),disabled:K.isPending,"data-testid":`button-execute-${a.id}`,children:[(0,g.jsx)(bm,{className:"w-3 h-3 mr-1"}),"Execute"]})})]},a.id)),0===m.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No automation rules created"})})]})]})})})})]}),(0,g.jsxs)(X.TabsContent,{value:"moderation",className:"space-y-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Content Moderation AI"}),(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:o?[void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b)):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(k.Card,{"data-testid":"card-accuracy-rate",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Accuracy Rate"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-accuracy-rate",children:[r.accuracyRate,"%"]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-false-positives",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"False Positives"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-false-positives",children:r.falsePositives})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-false-negatives",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"False Negatives"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-false-negatives",children:r.falseNegatives})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-time-saved",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Time Saved"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-time-saved",children:[r.timeSavedHours,"h"]})})]})]})}),(0,g.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Recent AI Decisions"})}),(0,g.jsx)(k.CardContent,{children:t?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Content"}),(0,g.jsx)(q.TableHead,{children:"Decision"}),(0,g.jsx)(q.TableHead,{children:"Confidence"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsxs)(q.TableBody,{children:[u.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{className:"max-w-xs truncate",children:a.contentPreview}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"approved"===a.decision?"default":"destructive",children:a.decision})}),(0,g.jsxs)(q.TableCell,{children:[a.confidence,"%"]}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>L.mutate(a.id),"data-testid":`button-override-${a.id}`,children:"Override"})})]},a.id)),0===u.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No recent decisions"})})]})]})})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Sentiment Distribution"})}),(0,g.jsx)(k.CardContent,{children:w?(0,g.jsx)(j.Skeleton,{className:"h-64"}):x.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(G.PieChart,{children:[(0,g.jsx)(H.Pie,{data:x,cx:"50%",cy:"50%",labelLine:!1,label:a=>a.name,outerRadius:80,fill:"hsl(var(--primary))",dataKey:"value",children:x.map((a,b)=>(0,g.jsx)(I.Cell,{fill:R[b%R.length]},`cell-${b}`))}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(O.Legend,{})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]}),(0,g.jsxs)(X.TabsContent,{value:"spam",className:"space-y-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Spam Detection"}),(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:z?[void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b)):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(k.Card,{"data-testid":"card-spam-accuracy",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Detection Accuracy"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-spam-accuracy",children:[A.accuracy,"%"]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-spam-blocked",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Spam Blocked"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-spam-blocked",children:A.blocked})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-spam-flagged",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Currently Flagged"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-spam-flagged",children:A.flagged})})]})]})}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Adjust Sensitivity"})}),(0,g.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsxs)(be.Label,{children:["Sensitivity Level: ",d[0],"%"]}),(0,g.jsx)(bd.Slider,{value:d,onValueChange:e,max:100,step:1,"data-testid":"slider-sensitivity"}),(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Higher values will flag more content as potential spam"})]}),(0,g.jsx)(l.Button,{onClick:()=>Q.mutate(d[0]),disabled:Q.isPending,"data-testid":"button-update-sensitivity",children:"Update Sensitivity"})]})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Flagged Content"})}),(0,g.jsx)(k.CardContent,{children:D?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Content"}),(0,g.jsx)(q.TableHead,{children:"Spam Score"}),(0,g.jsx)(q.TableHead,{children:"Author"}),(0,g.jsx)(q.TableHead,{children:"Flagged At"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsxs)(q.TableBody,{children:[E.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{className:"max-w-xs truncate",children:a.contentPreview}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:a.spamScore>80?"destructive":"secondary",children:[a.spamScore,"%"]})}),(0,g.jsx)(q.TableCell,{children:a.authorUsername}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.flaggedAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"outline","data-testid":`button-approve-${a.id}`,children:"Approve"})})]},a.id)),0===E.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No flagged content"})})]})]})})})]})]})]})]})}a.s(["default",()=>bn],88120);var bo=a.i(93518);function bp(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)(!1),[d,e]=(0,h.useState)(!1),[f,i]=(0,h.useState)("contributors"),[m,n]=(0,h.useState)("all-time"),{data:o,isLoading:r}=(0,p.useQuery)({queryKey:["/api/admin/gamification/badges"]}),s=Array.isArray(o)?o:[],{data:t,isLoading:u}=(0,p.useQuery)({queryKey:["/api/admin/gamification/achievements"]}),v=Array.isArray(t)?t:[],{data:w,isLoading:x}=(0,p.useQuery)({queryKey:["/api/admin/gamification/leaderboard",f,m]}),y=Array.isArray(w)?w:[],{data:z,isLoading:A}=(0,p.useQuery)({queryKey:["/api/admin/gamification/goals"]}),B=Array.isArray(z)?z:[],{data:G,isLoading:H}=(0,p.useQuery)({queryKey:["/api/admin/gamification/goal-completion"]}),I=Array.isArray(G)?G:[],O=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/gamification/badges","POST",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/gamification/badges"]}),a({title:"Badge created successfully"}),c(!1)}}),Q=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/gamification/achievements","POST",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/gamification/achievements"]}),a({title:"Achievement created successfully"}),e(!1)}});return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Gamification"}),(0,g.jsxs)(X.Tabs,{defaultValue:"badges",className:"space-y-4",children:[(0,g.jsxs)(X.TabsList,{children:[(0,g.jsx)(X.TabsTrigger,{value:"badges","data-testid":"tab-badges",children:"Badges"}),(0,g.jsx)(X.TabsTrigger,{value:"achievements","data-testid":"tab-achievements",children:"Achievements"}),(0,g.jsx)(X.TabsTrigger,{value:"leaderboards","data-testid":"tab-leaderboards",children:"Leaderboards"}),(0,g.jsx)(X.TabsTrigger,{value:"goals","data-testid":"tab-goals",children:"Goals"})]}),(0,g.jsxs)(X.TabsContent,{value:"badges",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Badges"}),(0,g.jsxs)(W.Dialog,{open:b,onOpenChange:c,children:[(0,g.jsx)(W.DialogTrigger,{asChild:!0,children:(0,g.jsx)(l.Button,{"data-testid":"button-create-badge",children:"Create Badge"})}),(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Create New Badge"})}),(0,g.jsxs)("form",{onSubmit:a=>{a.preventDefault();let b=new FormData(a.currentTarget);O.mutate({name:b.get("name"),description:b.get("description"),imageUrl:b.get("imageUrl"),rarity:b.get("rarity")})},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"name",children:"Badge Name"}),(0,g.jsx)(T.Input,{id:"name",name:"name",required:!0,"data-testid":"input-badge-name"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"description",children:"Description"}),(0,g.jsx)(T.Input,{id:"description",name:"description",required:!0,"data-testid":"input-badge-description"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"imageUrl",children:"Image URL"}),(0,g.jsx)(T.Input,{id:"imageUrl",name:"imageUrl",type:"url",required:!0,"data-testid":"input-badge-image"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"rarity",children:"Rarity"}),(0,g.jsxs)(V.Select,{name:"rarity",required:!0,children:[(0,g.jsx)(V.SelectTrigger,{"data-testid":"select-badge-rarity",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select rarity"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"common",children:"Common"}),(0,g.jsx)(V.SelectItem,{value:"rare",children:"Rare"}),(0,g.jsx)(V.SelectItem,{value:"epic",children:"Epic"}),(0,g.jsx)(V.SelectItem,{value:"legendary",children:"Legendary"})]})]})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{type:"submit",disabled:O.isPending,"data-testid":"button-submit-badge",children:O.isPending?"Creating...":"Create Badge"})})]})]})]})]}),r?(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-48"},b))}):(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.map(a=>(0,g.jsxs)(k.Card,{"data-testid":`badge-card-${a.id}`,children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center gap-4",children:[(0,g.jsx)("div",{className:"w-16 h-16 bg-muted rounded-lg flex items-center justify-center",children:a.imageUrl?(0,g.jsx)("img",{src:a.imageUrl,alt:a.name,className:"w-12 h-12"}):(0,g.jsx)(bo.Award,{className:"w-8 h-8"})}),(0,g.jsxs)("div",{className:"flex-1",children:[(0,g.jsx)(k.CardTitle,{className:"text-lg","data-testid":`badge-name-${a.id}`,children:a.name}),(0,g.jsx)(P.Badge,{variant:"secondary",children:a.rarity})]})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:a.description})}),(0,g.jsx)(k.CardFooter,{className:"flex justify-between gap-2",children:(0,g.jsxs)("div",{className:"text-sm",children:[(0,g.jsx)("span",{className:"font-semibold",children:a.totalEarned||0})," earned"]})})]},a.id)),0===s.length&&(0,g.jsx)("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:"No badges created yet"})]})]}),(0,g.jsxs)(X.TabsContent,{value:"achievements",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Achievements"}),(0,g.jsxs)(W.Dialog,{open:d,onOpenChange:e,children:[(0,g.jsx)(W.DialogTrigger,{asChild:!0,children:(0,g.jsx)(l.Button,{"data-testid":"button-create-achievement",children:"Create Achievement"})}),(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Create New Achievement"})}),(0,g.jsxs)("form",{onSubmit:a=>{a.preventDefault();let b=new FormData(a.currentTarget);Q.mutate({name:b.get("name"),description:b.get("description"),criteria:b.get("criteria"),rewardCoins:parseInt(b.get("rewardCoins"))})},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"ach-name",children:"Achievement Name"}),(0,g.jsx)(T.Input,{id:"ach-name",name:"name",required:!0,"data-testid":"input-achievement-name"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"ach-description",children:"Description"}),(0,g.jsx)(T.Input,{id:"ach-description",name:"description",required:!0,"data-testid":"input-achievement-description"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"criteria",children:"Criteria"}),(0,g.jsx)(T.Input,{id:"criteria",name:"criteria",required:!0,"data-testid":"input-achievement-criteria"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"rewardCoins",children:"Reward Coins"}),(0,g.jsx)(T.Input,{id:"rewardCoins",name:"rewardCoins",type:"number",required:!0,"data-testid":"input-achievement-reward"})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{type:"submit",disabled:Q.isPending,"data-testid":"button-submit-achievement",children:Q.isPending?"Creating...":"Create Achievement"})})]})]})]})]}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:u?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Name"}),(0,g.jsx)(q.TableHead,{children:"Description"}),(0,g.jsx)(q.TableHead,{children:"Criteria"}),(0,g.jsx)(q.TableHead,{children:"Reward"}),(0,g.jsx)(q.TableHead,{children:"Completion Rate"})]})}),(0,g.jsxs)(q.TableBody,{children:[v.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`achievement-${a.id}`,children:[(0,g.jsx)(q.TableCell,{className:"font-medium","data-testid":`achievement-name-${a.id}`,children:a.name}),(0,g.jsx)(q.TableCell,{children:a.description}),(0,g.jsx)(q.TableCell,{children:a.criteria}),(0,g.jsxs)(q.TableCell,{children:[a.rewardCoins," coins"]}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"secondary",children:[a.completionRate||0,"%"]})})]},a.id)),0===v.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No achievements created"})})]})]})})})})]}),(0,g.jsxs)(X.TabsContent,{value:"leaderboards",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Leaderboards"}),(0,g.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,g.jsxs)(V.Select,{value:f,onValueChange:i,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-48","data-testid":"select-leaderboard-type",children:(0,g.jsx)(V.SelectValue,{})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"contributors",children:"Top Contributors"}),(0,g.jsx)(V.SelectItem,{value:"earners",children:"Top Earners"}),(0,g.jsx)(V.SelectItem,{value:"uploaders",children:"Top Uploaders"})]})]}),(0,g.jsxs)(V.Select,{value:m,onValueChange:n,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-40","data-testid":"select-time-period",children:(0,g.jsx)(V.SelectValue,{})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"weekly",children:"Weekly"}),(0,g.jsx)(V.SelectItem,{value:"monthly",children:"Monthly"}),(0,g.jsx)(V.SelectItem,{value:"all-time",children:"All Time"})]})]})]})]}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:x?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[...Array(10)].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{className:"w-20",children:"Rank"}),(0,g.jsx)(q.TableHead,{children:"User"}),(0,g.jsx)(q.TableHead,{children:"Score"})]})}),(0,g.jsxs)(q.TableBody,{children:[y.map((a,b)=>(0,g.jsxs)(q.TableRow,{"data-testid":`leaderboard-${b}`,children:[(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[b<3&&(0,g.jsx)(aW.Trophy,{className:`w-4 h-4 ${0===b?"text-yellow-500":1===b?"text-gray-400":"text-amber-700"}`}),(0,g.jsxs)("span",{className:"font-semibold",children:["#",b+1]})]})}),(0,g.jsx)(q.TableCell,{"data-testid":`leaderboard-user-${b}`,children:a.username}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{children:a.score})})]},a.id)),0===y.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:3,className:"text-center text-muted-foreground py-8",children:"No data available"})})]})]})})})})]}),(0,g.jsxs)(X.TabsContent,{value:"goals",className:"space-y-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"User Goals Analytics"}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Goal Completion Rate"})}),(0,g.jsx)(k.CardContent,{children:H?(0,g.jsx)(j.Skeleton,{className:"h-64"}):I.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(C.LineChart,{data:I,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"date"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(D.Line,{type:"monotone",dataKey:"completionRate",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Top Goals by Participation"})}),(0,g.jsx)(k.CardContent,{children:A?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):B.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(E.BarChart,{data:B,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"name"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(F.Bar,{dataKey:"participants",fill:"hsl(var(--primary))"})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]})]})}a.s(["default",()=>bp],47860);var bq=a.i(52495);function br(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)(""),[d,e]=(0,h.useState)(!1),[f,i]=(0,h.useState)(!1),[m,n]=(0,h.useState)(null),{data:o,isLoading:r}=(0,p.useQuery)({queryKey:["/api/admin/seo/content",b]}),t=Array.isArray(o)?o:[],{data:u,isLoading:v}=(0,p.useQuery)({queryKey:["/api/admin/seo/campaigns"]}),w=Array.isArray(u)?u:[],{data:x,isLoading:y}=(0,p.useQuery)({queryKey:["/api/admin/seo/campaign-stats"]}),z=x||{reach:0,conversions:0,roi:0},{data:A,isLoading:C}=(0,p.useQuery)({queryKey:["/api/admin/seo/search-rankings"]}),D=Array.isArray(A)?A:[],{data:E,isLoading:F}=(0,p.useQuery)({queryKey:["/api/admin/seo/top-queries"]}),G=Array.isArray(E)?E:[],{data:H,isLoading:I}=(0,p.useQuery)({queryKey:["/api/admin/seo/sitemap-status"]}),J=H||{totalUrls:0},K=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)(`/api/admin/seo/meta/${a.id}`,"PATCH",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/seo/content"]}),a({title:"Meta tags updated successfully"}),e(!1)}}),L=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/seo/campaigns","POST",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/seo/campaigns"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/seo/campaign-stats"]}),a({title:"Campaign created successfully"}),i(!1)}}),M=(0,S.useMutation)({mutationFn:()=>(0,aj.apiRequest)("/api/admin/seo/sitemap/generate","POST"),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/seo/sitemap-status"]}),a({title:"Sitemap generated successfully"})}});return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"SEO & Marketing"}),(0,g.jsxs)(X.Tabs,{defaultValue:"meta",className:"space-y-4",children:[(0,g.jsxs)(X.TabsList,{children:[(0,g.jsx)(X.TabsTrigger,{value:"meta","data-testid":"tab-meta",children:"Meta Tags"}),(0,g.jsx)(X.TabsTrigger,{value:"campaigns","data-testid":"tab-campaigns",children:"Campaigns"}),(0,g.jsx)(X.TabsTrigger,{value:"analytics","data-testid":"tab-seo-analytics",children:"SEO Analytics"})]}),(0,g.jsxs)(X.TabsContent,{value:"meta",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Meta Tags Management"}),(0,g.jsxs)("div",{className:"relative w-full md:w-auto md:min-w-80",children:[(0,g.jsx)(_.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,g.jsx)(T.Input,{placeholder:"Search content...",value:b,onChange:a=>c(a.target.value),className:"pl-10","data-testid":"input-search-content"})]})]}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:r?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Title"}),(0,g.jsx)(q.TableHead,{children:"Type"}),(0,g.jsx)(q.TableHead,{children:"Meta Title"}),(0,g.jsx)(q.TableHead,{children:"Meta Description"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsxs)(q.TableBody,{children:[t.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`content-${a.id}`,children:[(0,g.jsx)(q.TableCell,{className:"font-medium max-w-xs truncate","data-testid":`content-title-${a.id}`,children:a.title}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"secondary",children:a.type})}),(0,g.jsx)(q.TableCell,{className:"max-w-xs truncate",children:a.metaTitle||"-"}),(0,g.jsx)(q.TableCell,{className:"max-w-xs truncate",children:a.metaDescription||"-"}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>{n(a),e(!0)},"data-testid":`button-edit-meta-${a.id}`,children:"Edit Meta"})})]},a.id)),0===t.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No content found"})})]})]})})})}),(0,g.jsx)(W.Dialog,{open:d,onOpenChange:e,children:(0,g.jsxs)(W.DialogContent,{className:"max-w-2xl",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Edit Meta Tags"})}),m&&(0,g.jsxs)("form",{onSubmit:a=>{a.preventDefault();let b=new FormData(a.currentTarget);K.mutate({id:m.id,title:b.get("title"),description:b.get("description"),keywords:b.get("keywords")})},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"title",children:"Meta Title"}),(0,g.jsx)(T.Input,{id:"title",name:"title",defaultValue:m.metaTitle,maxLength:60,"data-testid":"input-meta-title"}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Recommended: 50-60 characters"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"description",children:"Meta Description"}),(0,g.jsx)(U.Textarea,{id:"description",name:"description",defaultValue:m.metaDescription,maxLength:160,rows:3,"data-testid":"textarea-meta-description"}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Recommended: 150-160 characters"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"keywords",children:"Keywords (comma-separated)"}),(0,g.jsx)(T.Input,{id:"keywords",name:"keywords",defaultValue:m.metaKeywords,"data-testid":"input-meta-keywords"})]}),(0,g.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,g.jsx)("h4",{className:"font-semibold mb-2",children:"Search Result Preview"}),(0,g.jsxs)("div",{className:"space-y-1",children:[(0,g.jsx)("div",{className:"text-sm text-blue-600 hover:underline cursor-pointer",children:m.metaTitle||m.title}),(0,g.jsx)("div",{className:"text-xs text-green-700",children:"https://yoforex.com/..."}),(0,g.jsx)("div",{className:"text-xs text-muted-foreground",children:m.metaDescription||"No description provided"})]})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{type:"submit",disabled:K.isPending,"data-testid":"button-save-meta",children:K.isPending?"Saving...":"Save Changes"})})]})]})})]}),(0,g.jsxs)(X.TabsContent,{value:"campaigns",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Marketing Campaigns"}),(0,g.jsxs)(W.Dialog,{open:f,onOpenChange:i,children:[(0,g.jsx)(W.DialogTrigger,{asChild:!0,children:(0,g.jsx)(l.Button,{"data-testid":"button-create-campaign",children:"Create Campaign"})}),(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Create Marketing Campaign"})}),(0,g.jsxs)("form",{onSubmit:a=>{a.preventDefault();let b=new FormData(a.currentTarget);L.mutate({name:b.get("name"),description:b.get("description"),startDate:b.get("startDate"),endDate:b.get("endDate"),budget:parseFloat(b.get("budget"))})},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"camp-name",children:"Campaign Name"}),(0,g.jsx)(T.Input,{id:"camp-name",name:"name",required:!0,"data-testid":"input-campaign-name"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"camp-description",children:"Description"}),(0,g.jsx)(U.Textarea,{id:"camp-description",name:"description",required:!0,"data-testid":"textarea-campaign-description"})]}),(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"startDate",children:"Start Date"}),(0,g.jsx)(T.Input,{id:"startDate",name:"startDate",type:"date",required:!0,"data-testid":"input-campaign-start"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"endDate",children:"End Date"}),(0,g.jsx)(T.Input,{id:"endDate",name:"endDate",type:"date",required:!0,"data-testid":"input-campaign-end"})]})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"budget",children:"Budget ($)"}),(0,g.jsx)(T.Input,{id:"budget",name:"budget",type:"number",step:"0.01",required:!0,"data-testid":"input-campaign-budget"})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{type:"submit",disabled:L.isPending,"data-testid":"button-submit-campaign",children:L.isPending?"Creating...":"Create Campaign"})})]})]})]})]}),(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:y?[void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b)):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(k.Card,{"data-testid":"card-campaign-reach",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Reach"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-campaign-reach",children:z.reach.toLocaleString()})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-campaign-conversions",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Conversions"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"text-2xl font-bold","data-testid":"text-campaign-conversions",children:z.conversions})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-campaign-roi",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"ROI"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-campaign-roi",children:[z.roi,"%"]})})]})]})}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:v?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Name"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Start Date"}),(0,g.jsx)(q.TableHead,{children:"End Date"}),(0,g.jsx)(q.TableHead,{children:"Budget"}),(0,g.jsx)(q.TableHead,{children:"Performance"})]})}),(0,g.jsxs)(q.TableBody,{children:[w.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`campaign-${a.id}`,children:[(0,g.jsx)(q.TableCell,{className:"font-medium","data-testid":`campaign-name-${a.id}`,children:a.name}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"active"===a.status?"default":"secondary",children:a.status})}),(0,g.jsx)(q.TableCell,{children:new Date(a.startDate).toLocaleDateString()}),(0,g.jsx)(q.TableCell,{children:new Date(a.endDate).toLocaleDateString()}),(0,g.jsxs)(q.TableCell,{children:["$",a.budget.toLocaleString()]}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"outline",children:[a.performance||0,"% CTR"]})})]},a.id)),0===w.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No campaigns created"})})]})]})})})})]}),(0,g.jsxs)(X.TabsContent,{value:"analytics",className:"space-y-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"SEO Analytics"}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Search Rankings"})}),(0,g.jsx)(k.CardContent,{children:C?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Page"}),(0,g.jsx)(q.TableHead,{children:"Keyword"}),(0,g.jsx)(q.TableHead,{children:"Position"}),(0,g.jsx)(q.TableHead,{children:"Change"})]})}),(0,g.jsxs)(q.TableBody,{children:[D.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{className:"max-w-xs truncate",children:a.page}),(0,g.jsx)(q.TableCell,{children:a.keyword}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"secondary",children:["#",a.position]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:(a.change??0)>0?"default":"destructive",children:[(a.change??0)>0?"+":"",a.change??0]})})]},a.id)),0===D.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No ranking data available"})})]})]})})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Top Search Queries"})}),(0,g.jsx)(k.CardContent,{children:F?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Query"}),(0,g.jsx)(q.TableHead,{children:"Impressions"}),(0,g.jsx)(q.TableHead,{children:"Clicks"}),(0,g.jsx)(q.TableHead,{children:"CTR"})]})}),(0,g.jsxs)(q.TableBody,{children:[G.map((a,b)=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{className:"font-medium",children:a.query}),(0,g.jsx)(q.TableCell,{children:a.impressions.toLocaleString()}),(0,g.jsx)(q.TableCell,{children:a.clicks.toLocaleString()}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"outline",children:[a.ctr,"%"]})})]},b)),0===G.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No query data available"})})]})]})})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2",children:[(0,g.jsx)(k.CardTitle,{children:"Sitemap Status"}),(0,g.jsxs)(l.Button,{onClick:()=>M.mutate(),disabled:M.isPending,"data-testid":"button-generate-sitemap",children:[(0,g.jsx)(s.FileText,{className:"w-4 h-4 mr-2"}),"Generate Sitemap"]})]}),(0,g.jsx)(k.CardContent,{children:I?(0,g.jsx)(j.Skeleton,{className:"h-20"}):(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("span",{className:"text-sm text-muted-foreground",children:"Last Generated:"}),(0,g.jsx)("span",{className:"font-medium",children:J.lastGenerated?(0,B.formatDistanceToNow)(new Date(J.lastGenerated),{addSuffix:!0}):"Never"})]}),(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total URLs:"}),(0,g.jsx)(P.Badge,{variant:"secondary",children:J.totalUrls})]}),J.sitemapUrl&&(0,g.jsx)("div",{className:"flex items-center gap-2 pt-2",children:(0,g.jsxs)("a",{href:J.sitemapUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:["View Sitemap ",(0,g.jsx)(bq.ExternalLink,{className:"w-3 h-3"})]})})]})})]})]})]})]})}a.s(["default",()=>br],60128);var bs=a.i(31122),bt=a.i(81402);let bu=(0,b.default)("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]),bv=(0,b.default)("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),bw=[{id:"user.created",label:"User Created"},{id:"user.updated",label:"User Updated"},{id:"content.published",label:"Content Published"},{id:"content.deleted",label:"Content Deleted"},{id:"transaction.completed",label:"Transaction Completed"},{id:"comment.posted",label:"Comment Posted"}];function bx(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)(!1),[d,e]=(0,h.useState)(!1),[f,i]=(0,h.useState)(null),[m,n]=(0,h.useState)([]),[o,r]=(0,h.useState)("all"),[s,t]=(0,h.useState)("all"),[u,v]=(0,h.useState)("all"),{data:w,isLoading:x}=(0,p.useQuery)({queryKey:["/api/admin/integrations/api-keys"]}),y=Array.isArray(w)?w:[],{data:z,isLoading:A}=(0,p.useQuery)({queryKey:["/api/admin/integrations/webhooks"]}),C=Array.isArray(z)?z:[],{data:D,isLoading:E}=(0,p.useQuery)({queryKey:["/api/admin/integrations/event-logs",o,s,u]}),F=Array.isArray(D)?D:[],G=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/integrations/api-keys","POST",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/api-keys"]}),a({title:"API key created successfully"}),c(!1)}}),H=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)(`/api/admin/integrations/api-keys/${a}/revoke`,"DELETE"),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/api-keys"]}),a({title:"API key revoked"}),i(null)}}),I=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/integrations/webhooks","POST",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/webhooks"]}),a({title:"Webhook created successfully"}),e(!1),n([])}}),J=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)(`/api/admin/integrations/webhooks/${a}/test`,"POST"),onSuccess:()=>{a({title:"Test webhook sent"})}}),K=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)(`/api/admin/integrations/event-logs/${a}/retry`,"POST"),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/integrations/event-logs"]}),a({title:"Event retry initiated"})}});return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"API & Integrations"}),(0,g.jsxs)(X.Tabs,{defaultValue:"api-keys",className:"space-y-4",children:[(0,g.jsxs)(X.TabsList,{children:[(0,g.jsx)(X.TabsTrigger,{value:"api-keys","data-testid":"tab-api-keys",children:"API Keys"}),(0,g.jsx)(X.TabsTrigger,{value:"webhooks","data-testid":"tab-webhooks",children:"Webhooks"}),(0,g.jsx)(X.TabsTrigger,{value:"event-logs","data-testid":"tab-event-logs",children:"Event Logs"})]}),(0,g.jsxs)(X.TabsContent,{value:"api-keys",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"API Keys"}),(0,g.jsxs)(W.Dialog,{open:b,onOpenChange:c,children:[(0,g.jsx)(W.DialogTrigger,{asChild:!0,children:(0,g.jsxs)(l.Button,{"data-testid":"button-create-api-key",children:[(0,g.jsx)(bt.Key,{className:"w-4 h-4 mr-2"}),"Create API Key"]})}),(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Create API Key"})}),(0,g.jsxs)("form",{onSubmit:a=>{a.preventDefault();let b=new FormData(a.currentTarget);G.mutate({name:b.get("name"),permissions:b.get("permissions"),rateLimit:parseInt(b.get("rateLimit"))})},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"key-name",children:"Name"}),(0,g.jsx)(T.Input,{id:"key-name",name:"name",required:!0,"data-testid":"input-api-key-name"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"permissions",children:"Permissions"}),(0,g.jsxs)(V.Select,{name:"permissions",required:!0,children:[(0,g.jsx)(V.SelectTrigger,{"data-testid":"select-api-key-permissions",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select permissions"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"read",children:"Read Only"}),(0,g.jsx)(V.SelectItem,{value:"write",children:"Read & Write"}),(0,g.jsx)(V.SelectItem,{value:"admin",children:"Admin"})]})]})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"rateLimit",children:"Rate Limit (requests/hour)"}),(0,g.jsx)(T.Input,{id:"rateLimit",name:"rateLimit",type:"number",defaultValue:"1000",required:!0,"data-testid":"input-api-key-rate-limit"})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{type:"submit",disabled:G.isPending,"data-testid":"button-submit-api-key",children:G.isPending?"Creating...":"Create API Key"})})]})]})]})]}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:x?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Name"}),(0,g.jsx)(q.TableHead,{children:"Key"}),(0,g.jsx)(q.TableHead,{children:"Permissions"}),(0,g.jsx)(q.TableHead,{children:"Rate Limit"}),(0,g.jsx)(q.TableHead,{children:"Last Used"}),(0,g.jsx)(q.TableHead,{children:"Usage"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsxs)(q.TableBody,{children:[y.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`api-key-${a.id}`,children:[(0,g.jsx)(q.TableCell,{className:"font-medium","data-testid":`api-key-name-${a.id}`,children:a.name}),(0,g.jsxs)(q.TableCell,{className:"font-mono text-xs",children:[a.key.substring(0,12),"...",a.key.substring(a.key.length-4)]}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"outline",children:a.permissions})}),(0,g.jsxs)(q.TableCell,{children:[a.rateLimit,"/hr"]}),(0,g.jsx)(q.TableCell,{children:a.lastUsedAt?(0,B.formatDistanceToNow)(new Date(a.lastUsedAt),{addSuffix:!0}):"Never"}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"secondary",children:[a.usageCount||0," requests"]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"destructive",onClick:()=>i(a.id),"data-testid":`button-revoke-${a.id}`,children:"Revoke"})})]},a.id)),0===y.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No API keys created"})})]})]})})})}),(0,g.jsx)(bs.AlertDialog,{open:!!f,onOpenChange:a=>!a&&i(null),children:(0,g.jsxs)(bs.AlertDialogContent,{children:[(0,g.jsxs)(bs.AlertDialogHeader,{children:[(0,g.jsx)(bs.AlertDialogTitle,{children:"Revoke API Key"}),(0,g.jsx)(bs.AlertDialogDescription,{children:"Are you sure you want to revoke this API key? This action cannot be undone and will immediately invalidate the key."})]}),(0,g.jsxs)(bs.AlertDialogFooter,{children:[(0,g.jsx)(bs.AlertDialogCancel,{"data-testid":"button-cancel-revoke",children:"Cancel"}),(0,g.jsx)(bs.AlertDialogAction,{onClick:()=>f&&H.mutate(f),"data-testid":"button-confirm-revoke",children:"Revoke"})]})]})})]}),(0,g.jsxs)(X.TabsContent,{value:"webhooks",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Webhooks"}),(0,g.jsxs)(W.Dialog,{open:d,onOpenChange:e,children:[(0,g.jsx)(W.DialogTrigger,{asChild:!0,children:(0,g.jsxs)(l.Button,{"data-testid":"button-create-webhook",children:[(0,g.jsx)(bu,{className:"w-4 h-4 mr-2"}),"Create Webhook"]})}),(0,g.jsxs)(W.DialogContent,{className:"max-w-2xl",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Create Webhook"})}),(0,g.jsxs)("form",{onSubmit:b=>{b.preventDefault();let c=new FormData(b.currentTarget);0===m.length?a({title:"Please select at least one event",variant:"destructive"}):I.mutate({url:c.get("url"),events:m,secret:c.get("secret")})},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"url",children:"Webhook URL"}),(0,g.jsx)(T.Input,{id:"url",name:"url",type:"url",placeholder:"https://example.com/webhook",required:!0,"data-testid":"input-webhook-url"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{children:"Events"}),(0,g.jsx)("div",{className:"grid grid-cols-2 gap-2 p-4 border rounded-lg",children:bw.map(a=>(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)(al.Checkbox,{id:a.id,checked:m.includes(a.id),onCheckedChange:b=>{n(b?[...m,a.id]:m.filter(b=>b!==a.id))},"data-testid":`checkbox-event-${a.id}`}),(0,g.jsx)(be.Label,{htmlFor:a.id,className:"text-sm cursor-pointer",children:a.label})]},a.id))})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"secret",children:"Secret (optional)"}),(0,g.jsx)(T.Input,{id:"secret",name:"secret",placeholder:"Webhook signing secret","data-testid":"input-webhook-secret"}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Used to verify webhook authenticity"})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{type:"submit",disabled:I.isPending,"data-testid":"button-submit-webhook",children:I.isPending?"Creating...":"Create Webhook"})})]})]})]})]}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:A?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"URL"}),(0,g.jsx)(q.TableHead,{children:"Events"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Success"}),(0,g.jsx)(q.TableHead,{children:"Failures"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsxs)(q.TableBody,{children:[C.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`webhook-${a.id}`,children:[(0,g.jsx)(q.TableCell,{className:"font-mono text-xs max-w-xs truncate","data-testid":`webhook-url-${a.id}`,children:a.url}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.events?.slice(0,2).map(a=>(0,g.jsx)(P.Badge,{variant:"secondary",className:"text-xs",children:a},a)),(a.events?.length??0)>2&&(0,g.jsxs)(P.Badge,{variant:"secondary",className:"text-xs",children:["+",(a.events?.length??0)-2]})]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:a.active?"default":"secondary",children:a.active?"Active":"Inactive"})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"outline",children:a.successCount||0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:(a.failureCount??0)>0?"destructive":"outline",children:a.failureCount||0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>J.mutate(a.id),disabled:J.isPending,"data-testid":`button-test-webhook-${a.id}`,children:"Test"})})]},a.id)),0===C.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No webhooks configured"})})]})]})})})})]}),(0,g.jsxs)(X.TabsContent,{value:"event-logs",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Event Logs"}),(0,g.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,g.jsxs)(V.Select,{value:o,onValueChange:r,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-48","data-testid":"select-filter-webhook",children:(0,g.jsx)(V.SelectValue,{placeholder:"All Webhooks"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Webhooks"}),C.map(a=>(0,g.jsxs)(V.SelectItem,{value:a.id,children:[a.url.substring(0,30),"..."]},a.id))]})]}),(0,g.jsxs)(V.Select,{value:s,onValueChange:t,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-48","data-testid":"select-filter-event-type",children:(0,g.jsx)(V.SelectValue,{placeholder:"All Events"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Events"}),bw.map(a=>(0,g.jsx)(V.SelectItem,{value:a.id,children:a.label},a.id))]})]}),(0,g.jsxs)(V.Select,{value:u,onValueChange:v,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-40","data-testid":"select-filter-status",children:(0,g.jsx)(V.SelectValue,{placeholder:"All Status"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Status"}),(0,g.jsx)(V.SelectItem,{value:"success",children:"Success"}),(0,g.jsx)(V.SelectItem,{value:"failed",children:"Failed"}),(0,g.jsx)(V.SelectItem,{value:"pending",children:"Pending"})]})]})]})]}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:E?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[...Array(10)].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Event Type"}),(0,g.jsx)(q.TableHead,{children:"Webhook"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Response"}),(0,g.jsx)(q.TableHead,{children:"Timestamp"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsxs)(q.TableBody,{children:[F.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"secondary",children:a.eventType})}),(0,g.jsx)(q.TableCell,{className:"font-mono text-xs max-w-xs truncate",children:a.webhookUrl}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"success"===a.status?"default":"failed"===a.status?"destructive":"secondary",children:a.status})}),(0,g.jsx)(q.TableCell,{className:"max-w-xs truncate",children:a.response||"-"}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:"failed"===a.status&&(0,g.jsxs)(l.Button,{size:"sm",variant:"outline",onClick:()=>K.mutate(a.id),disabled:K.isPending,"data-testid":`button-retry-${a.id}`,children:[(0,g.jsx)(bv,{className:"w-3 h-3 mr-1"}),"Retry"]})})]},a.id)),0===F.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No event logs found"})})]})]})})})})]})]})]})}a.s(["default",()=>bx],96749);var by=a.i(23312);let bz=["hsl(var(--primary))","hsl(var(--accent))","hsl(var(--muted))","hsl(var(--destructive))"];function bA(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)("all"),{data:d,isLoading:e}=(0,p.useQuery)({queryKey:["/api/admin/mobile/notification-history"]}),f=Array.isArray(d)?d:[],{data:i,isLoading:m}=(0,p.useQuery)({queryKey:["/api/admin/mobile/app-versions"]}),n=Array.isArray(i)?i:[],{data:o,isLoading:r}=(0,p.useQuery)({queryKey:["/api/admin/mobile/version-distribution"]}),s=Array.isArray(o)?o:[],{data:t,isLoading:u}=(0,p.useQuery)({queryKey:["/api/admin/mobile/device-types"]}),v=Array.isArray(t)?t:[],{data:w,isLoading:x}=(0,p.useQuery)({queryKey:["/api/admin/mobile/os-distribution"]}),y=Array.isArray(w)?w:[],{data:z,isLoading:A}=(0,p.useQuery)({queryKey:["/api/admin/mobile/browser-distribution"]}),C=Array.isArray(z)?z:[],{data:D,isLoading:Q}=(0,p.useQuery)({queryKey:["/api/admin/mobile/screen-resolutions"]}),R=Array.isArray(D)?D:[],V=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/mobile/send-notification","POST",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/mobile/notification-history"]}),a({title:"Notification sent successfully"})}}),W=(0,S.useMutation)({mutationFn:({id:a,forceUpdate:b})=>(0,aj.apiRequest)(`/api/admin/mobile/app-versions/${a}/force-update`,"PATCH",{forceUpdate:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/mobile/app-versions"]}),a({title:"Force update setting updated"})}});return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Mobile & Push Notifications"}),(0,g.jsxs)(X.Tabs,{defaultValue:"push",className:"space-y-4",children:[(0,g.jsxs)(X.TabsList,{children:[(0,g.jsx)(X.TabsTrigger,{value:"push","data-testid":"tab-push",children:"Push Notifications"}),(0,g.jsx)(X.TabsTrigger,{value:"versions","data-testid":"tab-versions",children:"App Versions"}),(0,g.jsx)(X.TabsTrigger,{value:"analytics","data-testid":"tab-device-analytics",children:"Device Analytics"})]}),(0,g.jsxs)(X.TabsContent,{value:"push",className:"space-y-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Send Push Notification"}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"pt-6",children:(0,g.jsxs)("form",{onSubmit:a=>{a.preventDefault();let c=new FormData(a.currentTarget);V.mutate({title:c.get("title"),body:c.get("body"),targetType:b,targetValue:c.get("targetValue")})},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"title",children:"Notification Title"}),(0,g.jsx)(T.Input,{id:"title",name:"title",required:!0,"data-testid":"input-notification-title"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"body",children:"Notification Body"}),(0,g.jsx)(U.Textarea,{id:"body",name:"body",rows:3,required:!0,"data-testid":"textarea-notification-body"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{children:"Target"}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)(al.Checkbox,{id:"target-all",checked:"all"===b,onCheckedChange:()=>c("all"),"data-testid":"checkbox-target-all"}),(0,g.jsx)(be.Label,{htmlFor:"target-all",className:"cursor-pointer",children:"All Users"})]}),(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)(al.Checkbox,{id:"target-segments",checked:"segments"===b,onCheckedChange:()=>c("segments"),"data-testid":"checkbox-target-segments"}),(0,g.jsx)(be.Label,{htmlFor:"target-segments",className:"cursor-pointer",children:"Specific Segments"})]}),(0,g.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,g.jsx)(al.Checkbox,{id:"target-users",checked:"users"===b,onCheckedChange:()=>c("users"),"data-testid":"checkbox-target-users"}),(0,g.jsx)(be.Label,{htmlFor:"target-users",className:"cursor-pointer",children:"Specific User IDs"})]})]})]}),("segments"===b||"users"===b)&&(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"targetValue",children:"segments"===b?"Segment Names (comma-separated)":"User IDs (comma-separated)"}),(0,g.jsx)(T.Input,{id:"targetValue",name:"targetValue",placeholder:"segments"===b?"premium, active-traders":"user-123, user-456","data-testid":"input-target-value"})]}),(0,g.jsxs)(l.Button,{type:"submit",disabled:V.isPending,"data-testid":"button-send-notification",children:[(0,g.jsx)(by.Bell,{className:"w-4 h-4 mr-2"}),V.isPending?"Sending...":"Send Notification"]})]})})}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Notification History"})}),(0,g.jsx)(k.CardContent,{children:e?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Title"}),(0,g.jsx)(q.TableHead,{children:"Target"}),(0,g.jsx)(q.TableHead,{children:"Delivered"}),(0,g.jsx)(q.TableHead,{children:"Opened"}),(0,g.jsx)(q.TableHead,{children:"CTR"}),(0,g.jsx)(q.TableHead,{children:"Sent At"})]})}),(0,g.jsxs)(q.TableBody,{children:[f.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{className:"font-medium max-w-xs truncate",children:a.title}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"secondary",children:a.targetType})}),(0,g.jsx)(q.TableCell,{children:a.deliveredCount}),(0,g.jsx)(q.TableCell,{children:a.openedCount}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"outline",children:[a.ctr,"%"]})}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.sentAt),{addSuffix:!0})})]},a.id)),0===f.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No notifications sent yet"})})]})]})})})]})]}),(0,g.jsxs)(X.TabsContent,{value:"versions",className:"space-y-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"App Versions"}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:m?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Version"}),(0,g.jsx)(q.TableHead,{children:"Platform"}),(0,g.jsx)(q.TableHead,{children:"Release Date"}),(0,g.jsx)(q.TableHead,{children:"Users"}),(0,g.jsx)(q.TableHead,{children:"Force Update"})]})}),(0,g.jsxs)(q.TableBody,{children:[n.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`version-${a.id}`,children:[(0,g.jsx)(q.TableCell,{className:"font-medium",children:a.version}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"secondary",children:a.platform})}),(0,g.jsx)(q.TableCell,{children:new Date(a.releaseDate).toLocaleDateString()}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"outline",children:[a.userCount," users"]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(bc.Switch,{checked:a.forceUpdate,onCheckedChange:b=>W.mutate({id:a.id,forceUpdate:b}),"data-testid":`switch-force-update-${a.id}`})})]},a.id)),0===n.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No app versions found"})})]})]})})})}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"User Distribution by Version"})}),(0,g.jsx)(k.CardContent,{children:r?(0,g.jsx)(j.Skeleton,{className:"h-64"}):s.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(G.PieChart,{children:[(0,g.jsx)(H.Pie,{data:s,cx:"50%",cy:"50%",labelLine:!1,label:a=>`v${a.version}: ${a.percentage}%`,outerRadius:80,fill:"hsl(var(--primary))",dataKey:"count",children:s.map((a,b)=>(0,g.jsx)(I.Cell,{fill:bz[b%bz.length]},`cell-${b}`))}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(O.Legend,{})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]}),(0,g.jsxs)(X.TabsContent,{value:"analytics",className:"space-y-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Device Analytics"}),(0,g.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Device Types"})}),(0,g.jsx)(k.CardContent,{children:u?(0,g.jsx)(j.Skeleton,{className:"h-64"}):v.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(G.PieChart,{children:[(0,g.jsx)(H.Pie,{data:v,cx:"50%",cy:"50%",labelLine:!1,label:a=>`${a.name}: ${a.percentage}%`,outerRadius:80,fill:"hsl(var(--primary))",dataKey:"value",children:v.map((a,b)=>(0,g.jsx)(I.Cell,{fill:bz[b%bz.length]},`cell-${b}`))}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(O.Legend,{})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"OS Distribution"})}),(0,g.jsx)(k.CardContent,{children:x?(0,g.jsx)(j.Skeleton,{className:"h-64"}):y.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(E.BarChart,{data:y,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"name"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(F.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Browser Distribution"})}),(0,g.jsx)(k.CardContent,{children:A?(0,g.jsx)(j.Skeleton,{className:"h-64"}):C.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(E.BarChart,{data:C,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"name"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(F.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Screen Resolutions"})}),(0,g.jsx)(k.CardContent,{children:Q?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-8"},b))}):R.length>0?(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Resolution"}),(0,g.jsx)(q.TableHead,{children:"Users"}),(0,g.jsx)(q.TableHead,{children:"Percentage"})]})}),(0,g.jsx)(q.TableBody,{children:R.map((a,b)=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{className:"font-medium",children:a.resolution}),(0,g.jsx)(q.TableCell,{children:a.count}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"secondary",children:[a.percentage,"%"]})})]},b))})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]})]})]})}a.s(["default",()=>bA],55082);let bB=(0,b.default)("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]),bC=(0,b.default)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);function bD(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)(!1),[d,e]=(0,h.useState)(!1),{data:f,isLoading:i}=(0,p.useQuery)({queryKey:["/api/admin/performance/system-metrics"]}),m=f||{cpu:0,memory:0,diskIO:0,network:0},{data:n,isLoading:o}=(0,p.useQuery)({queryKey:["/api/admin/performance/response-time"]}),r=Array.isArray(n)?n:[],{data:s,isLoading:t}=(0,p.useQuery)({queryKey:["/api/admin/performance/throughput"]}),u=Array.isArray(s)?s:[],{data:v,isLoading:w}=(0,p.useQuery)({queryKey:["/api/admin/performance/alerts"]}),x=Array.isArray(v)?v:[],{data:y,isLoading:z}=(0,p.useQuery)({queryKey:["/api/admin/performance/alert-history"]}),G=Array.isArray(y)?y:[],{data:H,isLoading:I}=(0,p.useQuery)({queryKey:["/api/admin/performance/slow-queries"]}),O=Array.isArray(H)?H:[],{data:Q,isLoading:R}=(0,p.useQuery)({queryKey:["/api/admin/performance/database-metrics"]}),U=Q||{avgQueryTime:0,activeConnections:0,maxConnections:0,poolUsage:0},{data:V,isLoading:Z}=(0,p.useQuery)({queryKey:["/api/admin/performance/query-histogram"]}),$=Array.isArray(V)?V:[],{data:_,isLoading:aa}=(0,p.useQuery)({queryKey:["/api/admin/performance/cache-stats"]}),ab=_||{hitRate:0,hits:0,misses:0,size:0,keyCount:0},{data:ac,isLoading:ad}=(0,p.useQuery)({queryKey:["/api/admin/performance/cached-keys"]}),ae=Array.isArray(ac)?ac:[],af=(0,S.useMutation)({mutationFn:()=>(0,aj.apiRequest)("/api/admin/performance/record-metric","POST"),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/performance/system-metrics"]}),a({title:"Metric recorded"})}}),ag=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/performance/alerts","POST",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/performance/alerts"]}),a({title:"Alert threshold configured"}),c(!1)}}),ah=(0,S.useMutation)({mutationFn:()=>(0,aj.apiRequest)("/api/admin/performance/cache/clear","DELETE"),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/performance/cache-stats"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/performance/cached-keys"]}),a({title:"Cache cleared successfully"}),e(!1)}});return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Performance Monitor"}),(0,g.jsxs)(X.Tabs,{defaultValue:"metrics",className:"space-y-4",children:[(0,g.jsxs)(X.TabsList,{children:[(0,g.jsx)(X.TabsTrigger,{value:"metrics","data-testid":"tab-metrics",children:"Metrics"}),(0,g.jsx)(X.TabsTrigger,{value:"alerts","data-testid":"tab-alerts",children:"Alerts"}),(0,g.jsx)(X.TabsTrigger,{value:"database","data-testid":"tab-database",children:"Database Performance"}),(0,g.jsx)(X.TabsTrigger,{value:"cache","data-testid":"tab-cache",children:"Cache Stats"})]}),(0,g.jsxs)(X.TabsContent,{value:"metrics",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"System Metrics"}),(0,g.jsxs)(l.Button,{onClick:()=>af.mutate(),disabled:af.isPending,"data-testid":"button-record-metric",children:[(0,g.jsx)(A.Activity,{className:"w-4 h-4 mr-2"}),"Record Metric"]})]}),(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:i?[void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b)):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(k.Card,{"data-testid":"card-cpu",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"CPU Usage"}),(0,g.jsx)(bB,{className:"w-4 h-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-cpu-usage",children:[m.cpu,"%"]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-memory",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Memory Usage"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-memory-usage",children:[m.memory,"%"]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-disk",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Disk I/O"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-disk-io",children:[m.diskIO," MB/s"]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-network",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Network"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-network",children:[m.network," MB/s"]})})]})]})}),(0,g.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Response Time (Last 24 Hours)"})}),(0,g.jsx)(k.CardContent,{children:o?(0,g.jsx)(j.Skeleton,{className:"h-64"}):r.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(C.LineChart,{data:r,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"time"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(D.Line,{type:"monotone",dataKey:"responseTime",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Throughput (Requests/Second)"})}),(0,g.jsx)(k.CardContent,{children:t?(0,g.jsx)(j.Skeleton,{className:"h-64"}):u.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(C.LineChart,{data:u,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"time"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(D.Line,{type:"monotone",dataKey:"rps",stroke:"hsl(var(--primary))",strokeWidth:2})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]})]}),(0,g.jsxs)(X.TabsContent,{value:"alerts",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Performance Alerts"}),(0,g.jsxs)(W.Dialog,{open:b,onOpenChange:c,children:[(0,g.jsx)(W.DialogTrigger,{asChild:!0,children:(0,g.jsx)(l.Button,{"data-testid":"button-configure-alert",children:"Configure Alert"})}),(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Configure Alert Threshold"})}),(0,g.jsxs)("form",{onSubmit:a=>{a.preventDefault();let b=new FormData(a.currentTarget);ag.mutate({metricType:b.get("metricType"),threshold:parseFloat(b.get("threshold")),condition:b.get("condition")})},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"metricType",children:"Metric Type"}),(0,g.jsx)(T.Input,{id:"metricType",name:"metricType",required:!0,"data-testid":"input-metric-type"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"threshold",children:"Threshold Value"}),(0,g.jsx)(T.Input,{id:"threshold",name:"threshold",type:"number",step:"0.01",required:!0,"data-testid":"input-threshold"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"condition",children:"Condition"}),(0,g.jsx)(T.Input,{id:"condition",name:"condition",placeholder:"e.g., greater than",required:!0,"data-testid":"input-condition"})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{type:"submit",disabled:ag.isPending,"data-testid":"button-submit-alert",children:ag.isPending?"Configuring...":"Configure Alert"})})]})]})]})]}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:w?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Metric"}),(0,g.jsx)(q.TableHead,{children:"Condition"}),(0,g.jsx)(q.TableHead,{children:"Threshold"}),(0,g.jsx)(q.TableHead,{children:"Current Value"}),(0,g.jsx)(q.TableHead,{children:"Status"})]})}),(0,g.jsxs)(q.TableBody,{children:[x.map(a=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{className:"font-medium",children:a.metricType}),(0,g.jsx)(q.TableCell,{children:a.condition}),(0,g.jsx)(q.TableCell,{children:a.threshold}),(0,g.jsx)(q.TableCell,{children:a.currentValue}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:a.triggered?"destructive":"default",children:a.triggered?"Triggered":"OK"})})]},a.id)),0===x.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No alerts configured"})})]})]})})})}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Alert History"})}),(0,g.jsx)(k.CardContent,{children:z?(0,g.jsx)(j.Skeleton,{className:"h-64"}):G.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(E.BarChart,{data:G,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"date"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(F.Bar,{dataKey:"count",fill:"hsl(var(--destructive))"})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No alert history"})})]})]}),(0,g.jsxs)(X.TabsContent,{value:"database",className:"space-y-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Database Performance"}),(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:R?[void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b)):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(k.Card,{"data-testid":"card-query-time",children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Avg Query Time"}),(0,g.jsx)(bC,{className:"w-4 h-4 text-muted-foreground"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-query-time",children:[U.avgQueryTime,"ms"]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-connections",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Active Connections"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-connections",children:[U.activeConnections," / ",U.maxConnections]})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-pool-usage",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Pool Usage"})}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-pool-usage",children:[U.poolUsage,"%"]})})]})]})}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Slow Queries"})}),(0,g.jsx)(k.CardContent,{children:I?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Query"}),(0,g.jsx)(q.TableHead,{children:"Execution Time"}),(0,g.jsx)(q.TableHead,{children:"Calls"}),(0,g.jsx)(q.TableHead,{children:"Last Run"})]})}),(0,g.jsxs)(q.TableBody,{children:[O.map((a,b)=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{className:"font-mono text-xs max-w-md truncate",children:a.query}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"destructive",children:[a.executionTime,"ms"]})}),(0,g.jsx)(q.TableCell,{children:a.callCount}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.lastRun),{addSuffix:!0})})]},b)),0===O.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No slow queries detected"})})]})]})})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Query Execution Time Histogram"})}),(0,g.jsx)(k.CardContent,{children:Z?(0,g.jsx)(j.Skeleton,{className:"h-64"}):$.length>0?(0,g.jsx)(N.ResponsiveContainer,{width:"100%",height:250,children:(0,g.jsxs)(E.BarChart,{data:$,children:[(0,g.jsx)(L.CartesianGrid,{strokeDasharray:"3 3"}),(0,g.jsx)(J.XAxis,{dataKey:"range"}),(0,g.jsx)(K.YAxis,{}),(0,g.jsx)(M.Tooltip,{}),(0,g.jsx)(F.Bar,{dataKey:"count",fill:"hsl(var(--primary))"})]})}):(0,g.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No data available"})})]})]}),(0,g.jsxs)(X.TabsContent,{value:"cache",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Cache Statistics"}),(0,g.jsxs)(l.Button,{variant:"destructive",onClick:()=>e(!0),"data-testid":"button-clear-cache",children:[(0,g.jsx)(aw.Trash2,{className:"w-4 h-4 mr-2"}),"Clear Cache"]})]}),(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:aa?[void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-32"},b)):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(k.Card,{"data-testid":"card-hit-rate",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Cache Hit Rate"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-hit-rate",children:[ab.hitRate,"%"]}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:[ab.hits," hits / ",ab.misses," misses"]})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-cache-size",children:[(0,g.jsx)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2 space-y-0 pb-2",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Cache Size"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-cache-size",children:[ab.size," MB"]}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:[ab.keyCount," keys stored"]})]})]})]})}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Most Cached Keys"})}),(0,g.jsx)(k.CardContent,{children:ad?(0,g.jsx)("div",{className:"space-y-2",children:[...Array(10)].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Key"}),(0,g.jsx)(q.TableHead,{children:"Hits"}),(0,g.jsx)(q.TableHead,{children:"Size"}),(0,g.jsx)(q.TableHead,{children:"TTL"})]})}),(0,g.jsxs)(q.TableBody,{children:[ae.map((a,b)=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{className:"font-mono text-xs max-w-md truncate",children:a.key}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"secondary",children:a.hits})}),(0,g.jsxs)(q.TableCell,{children:[a.size," KB"]}),(0,g.jsxs)(q.TableCell,{children:[a.ttl,"s"]})]},b)),0===ae.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"No cached keys"})})]})]})})})]})]})]}),(0,g.jsx)(bs.AlertDialog,{open:d,onOpenChange:e,children:(0,g.jsxs)(bs.AlertDialogContent,{children:[(0,g.jsxs)(bs.AlertDialogHeader,{children:[(0,g.jsx)(bs.AlertDialogTitle,{children:"Clear Cache"}),(0,g.jsx)(bs.AlertDialogDescription,{children:"Are you sure you want to clear the entire cache? This action cannot be undone and may temporarily affect performance."})]}),(0,g.jsxs)(bs.AlertDialogFooter,{children:[(0,g.jsx)(bs.AlertDialogCancel,{children:"Cancel"}),(0,g.jsx)(bs.AlertDialogAction,{onClick:()=>ah.mutate(),className:"bg-destructive hover:bg-destructive/90",children:"Clear Cache"})]})]})})]})}a.s(["default",()=>bD],86843);var bE=a.i(73320),bF=a.i(38632);let bG=(0,b.default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function bH(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)(""),[d,e]=(0,h.useState)("all"),[f,i]=(0,h.useState)(!1),[m,n]=(0,h.useState)(null),[o,r]=(0,h.useState)(null),[t,u]=(0,h.useState)(""),[v,w]=(0,h.useState)(""),[x,y]=(0,h.useState)(!1),[z,A]=(0,h.useState)(null),{data:C,isLoading:D}=(0,p.useQuery)({queryKey:["/api/admin/content-studio/media",b,d]}),E=Array.isArray(C)?C:[],{data:F,isLoading:G}=(0,p.useQuery)({queryKey:["/api/admin/content-studio/revisions",t,v],enabled:!!t&&!!v}),H=Array.isArray(F)?F:[],I=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/content-studio/media/upload","POST",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/media"]}),a({title:"Media uploaded successfully"})}}),J=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)(`/api/admin/content-studio/media/${a.id}`,"PATCH",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/media"]}),a({title:"Media updated successfully"}),i(!1)}}),K=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)(`/api/admin/content-studio/media/${a}`,"DELETE"),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/media"]}),a({title:"Media deleted successfully"}),n(null)}}),L=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)(`/api/admin/content-studio/revisions/${a}/restore`,"POST"),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/content-studio/revisions"]}),a({title:"Revision restored successfully"}),y(!1)}});return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Content Studio"}),(0,g.jsxs)(X.Tabs,{defaultValue:"media",className:"space-y-4",children:[(0,g.jsxs)(X.TabsList,{children:[(0,g.jsx)(X.TabsTrigger,{value:"media","data-testid":"tab-media",children:"Media Library"}),(0,g.jsx)(X.TabsTrigger,{value:"revisions","data-testid":"tab-revisions",children:"Content Revisions"})]}),(0,g.jsxs)(X.TabsContent,{value:"media",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Media Library"}),(0,g.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,g.jsx)(T.Input,{placeholder:"Search files...",value:b,onChange:a=>c(a.target.value),className:"w-64","data-testid":"input-search-media"}),(0,g.jsxs)(V.Select,{value:d,onValueChange:e,children:[(0,g.jsx)(V.SelectTrigger,{className:"w-40","data-testid":"select-file-type",children:(0,g.jsx)(V.SelectValue,{})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"all",children:"All Types"}),(0,g.jsx)(V.SelectItem,{value:"images",children:"Images"}),(0,g.jsx)(V.SelectItem,{value:"documents",children:"Documents"}),(0,g.jsx)(V.SelectItem,{value:"videos",children:"Videos"})]})]}),(0,g.jsx)(l.Button,{asChild:!0,"data-testid":"button-upload-media",children:(0,g.jsxs)("label",{className:"cursor-pointer",children:[(0,g.jsx)(bE.Upload,{className:"w-4 h-4 mr-2"}),"Upload File",(0,g.jsx)("input",{type:"file",className:"hidden",onChange:a=>{let b=a.target.files?.[0];if(b){let a=new FormData;a.append("file",b),I.mutate(a)}},accept:"image/*,video/*,.pdf,.doc,.docx"})]})})]})]}),D?(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-64"},b))}):(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[E.map(a=>{var b;return(0,g.jsxs)(k.Card,{"data-testid":`media-card-${a.id}`,children:[(0,g.jsx)(k.CardHeader,{className:"p-0",children:(0,g.jsx)("div",{className:"aspect-video bg-muted rounded-t-lg flex items-center justify-center overflow-hidden",children:a.type?.startsWith("image/")?(0,g.jsx)("img",{src:a.url,alt:a.altText||a.filename,className:"w-full h-full object-cover"}):(0,g.jsxs)("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[(b=a.type).startsWith("image/")?(0,g.jsx)(bF.Image,{className:"w-4 h-4"}):b.startsWith("video/")?(0,g.jsx)(bG,{className:"w-4 h-4"}):(0,g.jsx)(s.FileText,{className:"w-4 h-4"}),(0,g.jsx)("span",{className:"text-xs",children:a.type})]})})}),(0,g.jsxs)(k.CardContent,{className:"pt-4 space-y-2",children:[(0,g.jsx)("div",{className:"font-medium truncate","data-testid":`media-filename-${a.id}`,children:a.filename}),(0,g.jsx)("div",{className:"flex flex-wrap gap-1",children:a.tags?.map((a,b)=>(0,g.jsx)(P.Badge,{variant:"secondary",className:"text-xs",children:a},b))}),(0,g.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Used ",a.usageCount||0," times"]})]}),(0,g.jsxs)(k.CardFooter,{className:"flex justify-between gap-2",children:[(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>{r(a),i(!0)},"data-testid":`button-edit-media-${a.id}`,children:"Edit"}),(0,g.jsx)(l.Button,{size:"sm",variant:"destructive",onClick:()=>n(a.id),"data-testid":`button-delete-media-${a.id}`,children:(0,g.jsx)(aw.Trash2,{className:"w-3 h-3"})})]})]},a.id)}),0===E.length&&(0,g.jsx)("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:"No media files found"})]}),(0,g.jsx)(W.Dialog,{open:f,onOpenChange:i,children:(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Edit Media"})}),o&&(0,g.jsxs)("form",{onSubmit:a=>{a.preventDefault();let b=new FormData(a.currentTarget),c=b.get("tags").split(",").map(a=>a.trim()).filter(Boolean);J.mutate({id:o?.id,altText:b.get("altText"),tags:c})},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"altText",children:"Alt Text"}),(0,g.jsx)(T.Input,{id:"altText",name:"altText",defaultValue:o.altText,"data-testid":"input-alt-text"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"tags",children:"Tags (comma-separated)"}),(0,g.jsx)(T.Input,{id:"tags",name:"tags",defaultValue:o.tags?.join(", "),placeholder:"tag1, tag2, tag3","data-testid":"input-tags"})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{type:"submit",disabled:J.isPending,"data-testid":"button-save-media",children:J.isPending?"Saving...":"Save Changes"})})]})]})}),(0,g.jsx)(bs.AlertDialog,{open:!!m,onOpenChange:a=>!a&&n(null),children:(0,g.jsxs)(bs.AlertDialogContent,{children:[(0,g.jsxs)(bs.AlertDialogHeader,{children:[(0,g.jsx)(bs.AlertDialogTitle,{children:"Delete Media"}),(0,g.jsx)(bs.AlertDialogDescription,{children:"Are you sure you want to delete this media file? This action cannot be undone."})]}),(0,g.jsxs)(bs.AlertDialogFooter,{children:[(0,g.jsx)(bs.AlertDialogCancel,{"data-testid":"button-cancel-delete",children:"Cancel"}),(0,g.jsx)(bs.AlertDialogAction,{onClick:()=>m&&K.mutate(m),"data-testid":"button-confirm-delete",children:"Delete"})]})]})})]}),(0,g.jsxs)(X.TabsContent,{value:"revisions",className:"space-y-4",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Content Revisions"}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"pt-6 space-y-4",children:(0,g.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"contentType",children:"Content Type"}),(0,g.jsxs)(V.Select,{value:t,onValueChange:u,children:[(0,g.jsx)(V.SelectTrigger,{"data-testid":"select-content-type",children:(0,g.jsx)(V.SelectValue,{placeholder:"Select type"})}),(0,g.jsxs)(V.SelectContent,{children:[(0,g.jsx)(V.SelectItem,{value:"thread",children:"Thread"}),(0,g.jsx)(V.SelectItem,{value:"comment",children:"Comment"}),(0,g.jsx)(V.SelectItem,{value:"content",children:"Content"}),(0,g.jsx)(V.SelectItem,{value:"user",children:"User Profile"})]})]})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"contentId",children:"Content ID"}),(0,g.jsx)(T.Input,{id:"contentId",value:v,onChange:a=>w(a.target.value),placeholder:"Enter content ID","data-testid":"input-content-id"})]})]})})}),t&&v&&(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsx)(k.CardTitle,{children:"Revision History"})}),(0,g.jsx)(k.CardContent,{children:G?(0,g.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Revision #"}),(0,g.jsx)(q.TableHead,{children:"Changed By"}),(0,g.jsx)(q.TableHead,{children:"Changed Fields"}),(0,g.jsx)(q.TableHead,{children:"Timestamp"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsxs)(q.TableBody,{children:[H.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`revision-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"secondary",children:["#",a.revisionNumber]})}),(0,g.jsx)(q.TableCell,{children:a.changedBy}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)("div",{className:"flex flex-wrap gap-1",children:a.changedFields?.map((a,b)=>(0,g.jsx)(P.Badge,{variant:"outline",className:"text-xs",children:a},b))})}),(0,g.jsx)(q.TableCell,{children:(0,B.formatDistanceToNow)(new Date(a.timestamp),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsxs)(l.Button,{size:"sm",variant:"outline","data-testid":`button-view-diff-${a.id}`,children:[(0,g.jsx)(aq.Eye,{className:"w-3 h-3 mr-1"}),"View Diff"]}),(0,g.jsx)(l.Button,{size:"sm",variant:"default",onClick:()=>{A(a),y(!0)},"data-testid":`button-restore-${a.id}`,children:"Restore"})]})})]},a.id)),0===H.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No revisions found"})})]})]})})})]}),(0,g.jsx)(bs.AlertDialog,{open:x,onOpenChange:y,children:(0,g.jsxs)(bs.AlertDialogContent,{children:[(0,g.jsxs)(bs.AlertDialogHeader,{children:[(0,g.jsx)(bs.AlertDialogTitle,{children:"Restore Revision"}),(0,g.jsxs)(bs.AlertDialogDescription,{children:["Are you sure you want to restore this revision? This will overwrite the current content with revision #",z?.revisionNumber,"."]})]}),(0,g.jsxs)(bs.AlertDialogFooter,{children:[(0,g.jsx)(bs.AlertDialogCancel,{"data-testid":"button-cancel-restore",children:"Cancel"}),(0,g.jsx)(bs.AlertDialogAction,{onClick:()=>z&&L.mutate(z.id),"data-testid":"button-confirm-restore",children:"Restore"})]})]})})]})]})]})}a.s(["default",()=>bH],37559);let bI=(0,b.default)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);function bJ(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)(!1),[d,e]=(0,h.useState)(!1),[f,i]=(0,h.useState)(!1),[m,n]=(0,h.useState)(null),[o,r]=(0,h.useState)([0]),{data:s,isLoading:t}=(0,p.useQuery)({queryKey:["/api/admin/testing/ab-tests"]}),u=Array.isArray(s)?s:[],{data:v,isLoading:w}=(0,p.useQuery)({queryKey:["/api/admin/testing/feature-flags"]}),x=Array.isArray(v)?v:[],y=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/testing/ab-tests","POST",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),a({title:"A/B test created successfully"}),c(!1)}}),z=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)(`/api/admin/testing/ab-tests/${a}/start`,"POST"),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),a({title:"Test started"})}}),A=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)(`/api/admin/testing/ab-tests/${a}/stop`,"POST"),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),a({title:"Test stopped"})}}),B=(0,S.useMutation)({mutationFn:({testId:a,variantId:b})=>(0,aj.apiRequest)(`/api/admin/testing/ab-tests/${a}/winner`,"POST",{variantId:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/testing/ab-tests"]}),a({title:"Winner declared"})}}),C=(0,S.useMutation)({mutationFn:a=>(0,aj.apiRequest)("/api/admin/testing/feature-flags","POST",a),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/testing/feature-flags"]}),a({title:"Feature flag created successfully"}),e(!1)}}),D=(0,S.useMutation)({mutationFn:({id:a,enabled:b})=>(0,aj.apiRequest)(`/api/admin/testing/feature-flags/${a}/toggle`,"PATCH",{enabled:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/testing/feature-flags"]}),a({title:"Feature flag updated"})}}),E=(0,S.useMutation)({mutationFn:({id:a,rollout:b})=>(0,aj.apiRequest)(`/api/admin/testing/feature-flags/${a}/rollout`,"PATCH",{rollout:b}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/testing/feature-flags"]}),a({title:"Rollout percentage updated"}),i(!1)}});return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Testing & Experiments"}),(0,g.jsxs)(X.Tabs,{defaultValue:"ab-tests",className:"space-y-4",children:[(0,g.jsxs)(X.TabsList,{children:[(0,g.jsx)(X.TabsTrigger,{value:"ab-tests","data-testid":"tab-ab-tests",children:"A/B Tests"}),(0,g.jsx)(X.TabsTrigger,{value:"feature-flags","data-testid":"tab-feature-flags",children:"Feature Flags"})]}),(0,g.jsxs)(X.TabsContent,{value:"ab-tests",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"A/B Tests"}),(0,g.jsxs)(W.Dialog,{open:b,onOpenChange:c,children:[(0,g.jsx)(W.DialogTrigger,{asChild:!0,children:(0,g.jsx)(l.Button,{"data-testid":"button-create-test",children:"Create A/B Test"})}),(0,g.jsxs)(W.DialogContent,{className:"max-w-2xl",children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Create A/B Test"})}),(0,g.jsxs)("form",{onSubmit:b=>{b.preventDefault();let c=new FormData(b.currentTarget),d=c.get("variants"),e=c.get("trafficAllocation");try{let a=JSON.parse(d),b=JSON.parse(e);y.mutate({name:c.get("name"),description:c.get("description"),variants:a,trafficAllocation:b})}catch(b){a({title:"Invalid JSON format",variant:"destructive"})}},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"test-name",children:"Test Name"}),(0,g.jsx)(T.Input,{id:"test-name",name:"name",required:!0,"data-testid":"input-test-name"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"test-description",children:"Description"}),(0,g.jsx)(U.Textarea,{id:"test-description",name:"description",required:!0,"data-testid":"textarea-test-description"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"variants",children:"Variants (JSON Array)"}),(0,g.jsx)(U.Textarea,{id:"variants",name:"variants",placeholder:'[{"id": "A", "name": "Control"}, {"id": "B", "name": "Variant B"}]',className:"font-mono text-sm",rows:3,required:!0,"data-testid":"textarea-variants"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"trafficAllocation",children:"Traffic Allocation (JSON Object)"}),(0,g.jsx)(U.Textarea,{id:"trafficAllocation",name:"trafficAllocation",placeholder:'{"A": 50, "B": 50}',className:"font-mono text-sm",rows:2,required:!0,"data-testid":"textarea-traffic-allocation"}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Percentages should add up to 100"})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{type:"submit",disabled:y.isPending,"data-testid":"button-submit-test",children:y.isPending?"Creating...":"Create Test"})})]})]})]})]}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:t?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Name"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"Variants"}),(0,g.jsx)(q.TableHead,{children:"Traffic"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsxs)(q.TableBody,{children:[u.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`test-${a.id}`,children:[(0,g.jsx)(q.TableCell,{className:"font-medium","data-testid":`test-name-${a.id}`,children:a.name}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(P.Badge,{variant:"running"===a.status?"default":"completed"===a.status?"secondary":"outline",children:a.status})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)("div",{className:"flex flex-wrap gap-1",children:a.variants.map(a=>(0,g.jsx)(P.Badge,{variant:"outline",className:"text-xs",children:a.name},a.id))})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)("div",{className:"text-xs",children:Object.entries(a.trafficAllocation).map(([a,b])=>(0,g.jsxs)("div",{children:[a,": ",b,"%"]},a))})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)("div",{className:"flex gap-2",children:["draft"===a.status&&(0,g.jsxs)(l.Button,{size:"sm",variant:"default",onClick:()=>z.mutate(a.id),disabled:z.isPending,"data-testid":`button-start-${a.id}`,children:[(0,g.jsx)(bm,{className:"w-3 h-3 mr-1"}),"Start"]}),"running"===a.status&&(0,g.jsxs)(l.Button,{size:"sm",variant:"destructive",onClick:()=>A.mutate(a.id),disabled:A.isPending,"data-testid":`button-stop-${a.id}`,children:[(0,g.jsx)(bI,{className:"w-3 h-3 mr-1"}),"Stop"]})]})})]},a.id)),0===u.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No A/B tests created"})})]})]})})})}),u.filter(a=>"running"===a.status||"completed"===a.status).map(a=>(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between gap-2",children:[(0,g.jsxs)(k.CardTitle,{children:["Results: ",a.name]}),"completed"===a.status&&a.winner&&(0,g.jsxs)(P.Badge,{variant:"default",children:[(0,g.jsx)(aW.Trophy,{className:"w-3 h-3 mr-1"}),"Winner: ",a.winner]})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Variant"}),(0,g.jsx)(q.TableHead,{children:"Impressions"}),(0,g.jsx)(q.TableHead,{children:"Conversions"}),(0,g.jsx)(q.TableHead,{children:"Conversion Rate"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsx)(q.TableBody,{children:(a.results||[]).map(b=>(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableCell,{className:"font-medium",children:b.variantName}),(0,g.jsx)(q.TableCell,{children:b.impressions}),(0,g.jsx)(q.TableCell,{children:b.conversions}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"secondary",children:[b.conversionRate,"%"]})}),(0,g.jsx)(q.TableCell,{children:"running"===a.status&&!a.winner&&(0,g.jsx)(l.Button,{size:"sm",variant:"default",onClick:()=>B.mutate({testId:a.id,variantId:b.variantId}),disabled:B.isPending,"data-testid":`button-declare-winner-${b.variantId}`,children:"Declare Winner"})})]},b.variantId))})]})})})]},`results-${a.id}`))]}),(0,g.jsxs)(X.TabsContent,{value:"feature-flags",className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("h2",{className:"text-xl font-semibold",children:"Feature Flags"}),(0,g.jsxs)(W.Dialog,{open:d,onOpenChange:e,children:[(0,g.jsx)(W.DialogTrigger,{asChild:!0,children:(0,g.jsx)(l.Button,{"data-testid":"button-create-flag",children:"Create Feature Flag"})}),(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Create Feature Flag"})}),(0,g.jsxs)("form",{onSubmit:a=>{a.preventDefault();let b=new FormData(a.currentTarget),c=b.get("targetUsers").split(",").map(a=>a.trim()).filter(Boolean);C.mutate({key:b.get("key"),name:b.get("name"),description:b.get("description"),enabled:!1,rollout:0,targetUsers:c})},className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"flag-key",children:"Flag Key"}),(0,g.jsx)(T.Input,{id:"flag-key",name:"key",placeholder:"new_feature_enabled",required:!0,"data-testid":"input-flag-key"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"flag-name",children:"Flag Name"}),(0,g.jsx)(T.Input,{id:"flag-name",name:"name",required:!0,"data-testid":"input-flag-name"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"flag-description",children:"Description"}),(0,g.jsx)(U.Textarea,{id:"flag-description",name:"description","data-testid":"textarea-flag-description"})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)(be.Label,{htmlFor:"targetUsers",children:"Target Users (comma-separated IDs, optional)"}),(0,g.jsx)(U.Textarea,{id:"targetUsers",name:"targetUsers",placeholder:"user-123, user-456","data-testid":"textarea-target-users"})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{type:"submit",disabled:C.isPending,"data-testid":"button-submit-flag",children:C.isPending?"Creating...":"Create Flag"})})]})]})]})]}),(0,g.jsx)(k.Card,{children:(0,g.jsx)(k.CardContent,{className:"p-0",children:w?(0,g.jsx)("div",{className:"p-4 space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,b)=>(0,g.jsx)(j.Skeleton,{className:"h-12"},b))}):(0,g.jsx)("div",{className:"overflow-x-auto",children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Flag Key"}),(0,g.jsx)(q.TableHead,{children:"Name"}),(0,g.jsx)(q.TableHead,{children:"Enabled"}),(0,g.jsx)(q.TableHead,{children:"Rollout %"}),(0,g.jsx)(q.TableHead,{children:"Target Users"}),(0,g.jsx)(q.TableHead,{children:"Actions"})]})}),(0,g.jsxs)(q.TableBody,{children:[x.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`flag-${a.id}`,children:[(0,g.jsx)(q.TableCell,{className:"font-mono text-sm","data-testid":`flag-key-${a.id}`,children:a.key}),(0,g.jsx)(q.TableCell,{className:"font-medium",children:a.name}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(bc.Switch,{checked:a.enabled,onCheckedChange:b=>D.mutate({id:a.id,enabled:b}),"data-testid":`switch-flag-${a.id}`})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"secondary",children:[a.rollout,"%"]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsxs)(P.Badge,{variant:"outline",children:[a.targetUsers.length," users"]})}),(0,g.jsx)(q.TableCell,{children:(0,g.jsx)(l.Button,{size:"sm",variant:"outline",onClick:()=>{n(a),r([a.rollout]),i(!0)},"data-testid":`button-rollout-${a.id}`,children:"Adjust Rollout"})})]},a.id)),0===x.length&&(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No feature flags created"})})]})]})})})}),(0,g.jsx)(W.Dialog,{open:f,onOpenChange:i,children:(0,g.jsxs)(W.DialogContent,{children:[(0,g.jsx)(W.DialogHeader,{children:(0,g.jsx)(W.DialogTitle,{children:"Adjust Rollout Percentage"})}),m&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsxs)(be.Label,{children:["Rollout: ",o[0],"%"]}),(0,g.jsx)(bd.Slider,{value:o,onValueChange:r,max:100,step:1,"data-testid":"slider-rollout"}),(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Percentage of users who will see this feature"})]}),(0,g.jsx)(W.DialogFooter,{children:(0,g.jsx)(l.Button,{onClick:()=>E.mutate({id:m.id,rollout:o[0]}),disabled:E.isPending,"data-testid":"button-save-rollout",children:E.isPending?"Saving...":"Save"})})]})]})})]})]})]})}a.s(["default",()=>bJ],86079);var bK=a.i(54074);let bL=(0,b.default)("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);var bM=a.i(1027);let bN=[{url:"/",type:"Homepage",schemaTypes:["Organization","WebSite"],status:"valid"},{url:"/category/trading-strategies/martingale-strategy",type:"Thread (Forum)",schemaTypes:["DiscussionForumPosting","BreadcrumbList","Comment"],status:"valid"},{url:"/category/expert-advisors/mt4/trend-ea",type:"Product (Marketplace)",schemaTypes:["Product","AggregateRating","Review","BreadcrumbList"],status:"valid"},{url:"/user/forex_newbie423",type:"Profile",schemaTypes:["Person"],status:"valid"},{url:"/category/forex-education/beginner-guide",type:"Article/Blog",schemaTypes:["Article","BreadcrumbList"],status:"warning",warning:"Consider adding author image for rich results"}],bO=[{id:"1",url:"/",pageType:"Homepage",status:"valid",errorCount:0,warningCount:0,timestamp:new Date().toISOString()},{id:"2",url:"/thread/best-scalping-ea",pageType:"Article",status:"valid",errorCount:0,warningCount:1,timestamp:new Date(Date.now()-3e5).toISOString(),details:"Missing recommended property: image dimensions"},{id:"3",url:"/content/invalid-product",pageType:"Product",status:"invalid",errorCount:2,warningCount:0,timestamp:new Date(Date.now()-6e5).toISOString(),details:"Missing required properties: price, availability"}];function bP(){let[a,b]=(0,h.useState)(""),[c,d]=(0,h.useState)(""),[e,f]=(0,h.useState)([]),[i,j]=(0,h.useState)(!1),{data:m}=(0,p.useQuery)({queryKey:["/api/admin/schema/stats"],refetchInterval:6e4}),{data:n}=(0,p.useQuery)({queryKey:["/api/admin/schema/logs"],refetchInterval:3e4}),o=(0,S.useMutation)({mutationFn:async()=>await (0,aj.apiRequest)("POST","/api/admin/schema/validate-all",{}),onSuccess:()=>{aj.queryClient.invalidateQueries({queryKey:["/api/admin/schema/stats"]}),aj.queryClient.invalidateQueries({queryKey:["/api/admin/schema/logs"]})}}),q=async a=>{j(!0);try{let b=await (0,aj.apiRequest)("POST","/api/admin/schema/validate",{url:a}),c=await b.json();f([c,...e.slice(0,9)])}catch(a){console.error("Validation error:",a)}finally{j(!1)}},r=a=>{switch(a){case"valid":return(0,g.jsx)(aM.CheckCircle2,{className:"w-4 h-4 text-green-600"});case"invalid":return(0,g.jsx)(ap,{className:"w-4 h-4 text-red-600"});case"warning":return(0,g.jsx)(ar.AlertTriangle,{className:"w-4 h-4 text-yellow-600"})}},t=a=>(0,g.jsxs)(P.Badge,{variant:{valid:"default",invalid:"destructive",warning:"outline"}[a],className:"gap-1",children:[r(a),a.toUpperCase()]});return(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Schema Validation Dashboard"}),(0,g.jsx)("p",{className:"text-muted-foreground mt-2",children:"Real-time monitoring and validation of Schema.org JSON-LD structured data across all pages"})]}),(0,g.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Total Pages"}),(0,g.jsx)(bL,{className:"h-4 w-4 text-muted-foreground"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold",children:m?.totalPages||bN.length}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"With schema markup"})]})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Valid Schemas"}),(0,g.jsx)(aM.CheckCircle2,{className:"h-4 w-4 text-green-600"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold text-green-600",children:m?.validPages||5}),(0,g.jsxs)("p",{className:"text-xs text-muted-foreground",children:[m?Math.round(m.validPages/m.totalPages*100):83,"% success rate"]})]})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Warnings"}),(0,g.jsx)(ar.AlertTriangle,{className:"h-4 w-4 text-yellow-600"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:m?.warningPages||1}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Need attention"})]})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Errors"}),(0,g.jsx)(ap,{className:"h-4 w-4 text-red-600"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsx)("div",{className:"text-2xl font-bold text-red-600",children:m?.invalidPages||0}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Require fixes"})]})]})]}),(0,g.jsxs)(X.Tabs,{defaultValue:"overview",className:"space-y-4",children:[(0,g.jsxs)(X.TabsList,{children:[(0,g.jsx)(X.TabsTrigger,{value:"overview",children:"Overview"}),(0,g.jsx)(X.TabsTrigger,{value:"validator",children:"Live Validator"}),(0,g.jsx)(X.TabsTrigger,{value:"logs",children:"Validation Logs"}),(0,g.jsx)(X.TabsTrigger,{value:"schema-types",children:"Schema Types"})]}),(0,g.jsxs)(X.TabsContent,{value:"overview",className:"space-y-4",children:[(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsxs)(k.CardTitle,{className:"flex items-center gap-2",children:[(0,g.jsx)(A.Activity,{className:"w-5 h-5"}),"Page Validation Status"]}),(0,g.jsx)(k.CardDescription,{children:"Current schema validation status for all pages"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,g.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Last validation: ",m?.lastValidationRun||"Just now"]}),(0,g.jsxs)(l.Button,{onClick:()=>o.mutate(),disabled:o.isPending,size:"sm",className:"gap-2",children:[(0,g.jsx)(au.RefreshCw,{className:`w-4 h-4 ${o.isPending?"animate-spin":""}`}),"Validate All Pages"]})]}),(0,g.jsx)(am.ScrollArea,{className:"h-[400px]",children:(0,g.jsx)("div",{className:"space-y-2",children:bN.map((a,c)=>{let e=bO.find(b=>b.url===a.url),f=e?.status||"valid";return(0,g.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,g.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)("span",{className:"font-medium",children:a.url}),(0,g.jsx)(P.Badge,{variant:"secondary",className:"text-xs",children:a.type})]}),(0,g.jsx)("div",{className:"flex gap-1",children:a.schemaTypes.map((a,b)=>(0,g.jsx)(P.Badge,{variant:"outline",className:"text-xs",children:a},b))}),e?.details&&(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:e.details})]}),(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[t(f),(0,g.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:()=>{d(a.url),b(a.url)},className:"gap-1",children:[(0,g.jsx)(aq.Eye,{className:"w-4 h-4"}),"View"]})]})]},c)})})})]})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsx)(k.CardHeader,{children:(0,g.jsxs)(k.CardTitle,{className:"flex items-center gap-2",children:[(0,g.jsx)(bM.Zap,{className:"w-5 h-5"}),"Quick Testing Tools"]})}),(0,g.jsxs)(k.CardContent,{className:"grid gap-3 md:grid-cols-2",children:[(0,g.jsxs)(l.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://search.google.com/test/rich-results","_blank"),children:[(0,g.jsx)(bq.ExternalLink,{className:"w-4 h-4"}),"Google Rich Results Test"]}),(0,g.jsxs)(l.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://validator.schema.org/","_blank"),children:[(0,g.jsx)(bq.ExternalLink,{className:"w-4 h-4"}),"Schema.org Validator"]}),(0,g.jsxs)(l.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://search.google.com/search-console","_blank"),children:[(0,g.jsx)(bq.ExternalLink,{className:"w-4 h-4"}),"Google Search Console"]}),(0,g.jsxs)(l.Button,{variant:"outline",className:"justify-start gap-2",onClick:()=>window.open("https://json-ld.org/playground/","_blank"),children:[(0,g.jsx)(bq.ExternalLink,{className:"w-4 h-4"}),"JSON-LD Playground"]})]})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsx)(k.CardTitle,{className:"text-lg",children:"Schema Type Distribution"}),(0,g.jsx)(k.CardDescription,{children:"Number of pages by schema type"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("span",{className:"text-sm",children:"DiscussionForumPosting"}),(0,g.jsx)(P.Badge,{variant:"secondary",children:"Threads"})]}),(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("span",{className:"text-sm",children:"Product"}),(0,g.jsx)(P.Badge,{variant:"secondary",children:"Marketplace"})]}),(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("span",{className:"text-sm",children:"Person"}),(0,g.jsx)(P.Badge,{variant:"secondary",children:"Profiles"})]}),(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsx)("span",{className:"text-sm",children:"Article/BlogPosting"}),(0,g.jsx)(P.Badge,{variant:"secondary",children:"Content"})]})]})})]}),(0,g.jsxs)(k.Card,{className:"col-span-full",children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsxs)(k.CardTitle,{className:"flex items-center gap-2",children:[(0,g.jsx)(_.Search,{className:"h-5 w-5"}),"Google Rich Results Testing"]}),(0,g.jsx)(k.CardDescription,{children:"Test your schemas with Google's official validation tools"})]}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)("h4",{className:"font-medium",children:"Rich Results Test"}),(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Test how Google sees your structured data"}),(0,g.jsxs)("a",{href:"https://search.google.com/test/rich-results",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:underline","data-testid":"link-google-rich-results",children:["Open Rich Results Test ",(0,g.jsx)(bq.ExternalLink,{className:"h-3 w-3"})]})]}),(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsx)("h4",{className:"font-medium",children:"Schema Markup Validator"}),(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Validate your JSON-LD against Schema.org standards"}),(0,g.jsxs)("a",{href:"https://validator.schema.org/",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-sm text-blue-600 hover:underline","data-testid":"link-schema-validator",children:["Open Schema Validator ",(0,g.jsx)(bq.ExternalLink,{className:"h-3 w-3"})]})]})]}),(0,g.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,g.jsx)("h4",{className:"font-medium text-sm",children:"Quick Test URLs"}),(0,g.jsx)("div",{className:"grid gap-2",children:[{type:"Thread",url:"/category/trading-strategies/best-scalping-ea"},{type:"Marketplace",url:"/category/expert-advisors/trend-ea"},{type:"Profile",url:"/user/forex_newbie423"}].map(a=>(0,g.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[(0,g.jsx)("span",{className:"text-sm font-medium",children:a.type}),(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>{let b=`${window.location.origin}${a.url}`,c=`https://search.google.com/test/rich-results?url=${encodeURIComponent(b)}`;window.open(c,"_blank")},"data-testid":`button-test-google-${a.type.toLowerCase()}`,children:["Test in Google ",(0,g.jsx)(bq.ExternalLink,{className:"h-3 w-3 ml-1"})]}),(0,g.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:()=>navigator.clipboard.writeText(`${window.location.origin}${a.url}`),"data-testid":`button-copy-url-${a.type.toLowerCase()}`,children:"Copy URL"})]})]},a.type))})]})]})]}),(0,g.jsxs)(k.Card,{className:"col-span-full",children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsxs)(k.CardTitle,{className:"flex items-center gap-2",children:[(0,g.jsx)(s.FileText,{className:"h-5 w-5"}),"Validation Logs"]}),(0,g.jsx)(k.CardDescription,{children:"Recent schema validation events and errors"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)("div",{className:"space-y-2",children:[(0,g.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-950 rounded",children:[(0,g.jsx)(aM.CheckCircle2,{className:"h-4 w-4 text-green-600"}),(0,g.jsxs)("div",{className:"flex-1",children:[(0,g.jsx)("p",{className:"text-sm font-medium",children:"All schemas validated successfully"}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:"Last check: Just now"})]})]}),(0,g.jsx)("div",{className:"text-sm text-muted-foreground text-center py-4",children:"No validation errors detected"})]})})]}),(0,g.jsxs)(k.Card,{className:"col-span-full",children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsx)(k.CardTitle,{children:"Schema.org 2025 Compliance Checklist"}),(0,g.jsx)(k.CardDescription,{children:"Ensure all schemas meet the latest standards"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"space-y-3",children:[{item:'All schemas use @context: "https://schema.org"',status:!0},{item:"Required properties present for each type",status:!0},{item:"Publisher includes Organization with logo",status:!0},{item:"Dates in ISO 8601 format",status:!0},{item:"Images include proper dimensions",status:!1,note:"Optional but recommended"},{item:"Videos use ISO 8601 duration format",status:!0}].map((a,b)=>(0,g.jsxs)("div",{className:"flex items-start gap-3",children:[a.status?(0,g.jsx)(aM.CheckCircle2,{className:"h-5 w-5 text-green-600 mt-0.5"}):(0,g.jsx)(u.AlertCircle,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),(0,g.jsxs)("div",{className:"flex-1",children:[(0,g.jsx)("p",{className:"text-sm font-medium",children:a.item}),a.note&&(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:a.note})]})]},b))})})]})]}),(0,g.jsx)(X.TabsContent,{value:"validator",className:"space-y-4",children:(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsx)(k.CardTitle,{children:"Live Schema Validator"}),(0,g.jsx)(k.CardDescription,{children:"Test and validate schema markup for any page URL"})]}),(0,g.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsxs)("div",{className:"flex-1",children:[(0,g.jsx)(be.Label,{htmlFor:"test-url",children:"Page URL"}),(0,g.jsx)(T.Input,{id:"test-url",placeholder:"/thread/best-scalping-ea",value:c,onChange:a=>d(a.target.value)})]}),(0,g.jsx)("div",{className:"flex items-end",children:(0,g.jsxs)(l.Button,{onClick:()=>q(c),disabled:!c||i,className:"gap-2",children:[(0,g.jsx)(_.Search,{className:"w-4 h-4"}),"Validate"]})})]}),e.length>0&&(0,g.jsxs)("div",{className:"space-y-4",children:[(0,g.jsx)(bj.Separator,{}),(0,g.jsx)("div",{className:"text-sm font-medium",children:"Validation Results"}),(0,g.jsx)(am.ScrollArea,{className:"h-[500px]",children:(0,g.jsx)("div",{className:"space-y-4",children:e.map((a,b)=>(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsx)(k.CardTitle,{className:"text-base",children:a.url}),t(a.isValid?"valid":"invalid")]}),(0,g.jsxs)(k.CardDescription,{children:["Schema Type: ",a.schemaType," â¢ Page Type: ",a.pageType]})]}),(0,g.jsxs)(k.CardContent,{className:"space-y-3",children:[a.errors.length>0&&(0,g.jsxs)(an.Alert,{variant:"destructive",children:[(0,g.jsx)(ar.AlertTriangle,{className:"h-4 w-4"}),(0,g.jsx)(an.AlertTitle,{children:"Errors Found"}),(0,g.jsx)(an.AlertDescription,{children:(0,g.jsx)("ul",{className:"list-disc list-inside space-y-1",children:a.errors.map((a,b)=>(0,g.jsx)("li",{className:"text-sm",children:a},b))})})]}),a.warnings.length>0&&(0,g.jsxs)(an.Alert,{children:[(0,g.jsx)(ar.AlertTriangle,{className:"h-4 w-4"}),(0,g.jsx)(an.AlertTitle,{children:"Warnings"}),(0,g.jsx)(an.AlertDescription,{children:(0,g.jsx)("ul",{className:"list-disc list-inside space-y-1",children:a.warnings.map((a,b)=>(0,g.jsx)("li",{className:"text-sm",children:a},b))})})]}),a.isValid&&0===a.errors.length&&(0,g.jsxs)(an.Alert,{children:[(0,g.jsx)(aM.CheckCircle2,{className:"h-4 w-4 text-green-600"}),(0,g.jsx)(an.AlertTitle,{children:"Schema Valid"}),(0,g.jsx)(an.AlertDescription,{children:"All required properties present and valid"})]}),(0,g.jsxs)("details",{className:"border rounded-lg p-3",children:[(0,g.jsxs)("summary",{className:"cursor-pointer font-medium text-sm flex items-center gap-2",children:[(0,g.jsx)(bK.Code,{className:"w-4 h-4"}),"View Schema JSON"]}),(0,g.jsx)("pre",{className:"mt-3 text-xs bg-muted p-3 rounded overflow-x-auto",children:JSON.stringify(a.schema,null,2)})]}),(0,g.jsxs)("div",{className:"flex gap-2",children:[(0,g.jsxs)(l.Button,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>{window.open(`https://search.google.com/test/rich-results?url=${encodeURIComponent("http://localhost:3000"+a.url)}`,"_blank")},children:[(0,g.jsx)(bq.ExternalLink,{className:"w-3 h-3"}),"Test in Google"]}),(0,g.jsxs)(l.Button,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>{window.open(`https://validator.schema.org/#url=${encodeURIComponent("http://localhost:3000"+a.url)}`,"_blank")},children:[(0,g.jsx)(bq.ExternalLink,{className:"w-3 h-3"}),"Schema.org Validator"]})]})]})]},b))})})]})]})]})}),(0,g.jsx)(X.TabsContent,{value:"logs",className:"space-y-4",children:(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsxs)(k.CardTitle,{className:"flex items-center gap-2",children:[(0,g.jsx)(bC,{className:"w-5 h-5"}),"Validation History"]}),(0,g.jsx)(k.CardDescription,{children:"Historical log of all schema validation runs"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)(am.ScrollArea,{className:"h-[500px]",children:(0,g.jsx)("div",{className:"space-y-2",children:(n||bO).map(a=>(0,g.jsxs)("div",{className:"flex items-start justify-between p-4 border rounded-lg",children:[(0,g.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[r(a.status),(0,g.jsx)("span",{className:"font-medium",children:a.url}),(0,g.jsx)(P.Badge,{variant:"secondary",className:"text-xs",children:a.pageType})]}),a.details&&(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:a.details}),(0,g.jsxs)("div",{className:"flex gap-4 text-xs text-muted-foreground",children:[(0,g.jsxs)("span",{children:["Errors: ",a.errorCount]}),(0,g.jsxs)("span",{children:["Warnings: ",a.warningCount]}),(0,g.jsx)("span",{children:new Date(a.timestamp).toLocaleString()})]})]}),t(a.status)]},a.id))})})})]})}),(0,g.jsx)(X.TabsContent,{value:"schema-types",className:"space-y-4",children:(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsxs)(k.CardTitle,{className:"flex items-center gap-2",children:[(0,g.jsx)(x.TrendingUp,{className:"w-5 h-5"}),"Schema Type Distribution"]}),(0,g.jsx)(k.CardDescription,{children:"Overview of schema types implemented across the platform"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsx)("div",{className:"space-y-4",children:[{type:"Organization",count:1,validCount:1,description:"Company information on homepage"},{type:"WebSite",count:1,validCount:1,description:"Site-wide search capability"},{type:"Article",count:15,validCount:14,description:"Forum threads and blog posts"},{type:"Product",count:10,validCount:10,description:"Marketplace EA listings"},{type:"BreadcrumbList",count:25,validCount:25,description:"Navigation breadcrumbs"},{type:"ProfilePage",count:15,validCount:15,description:"User profile pages"},{type:"LocalBusiness",count:7,validCount:7,description:"Broker listings"}].map((a,b)=>(0,g.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,g.jsxs)("div",{className:"space-y-1 flex-1",children:[(0,g.jsx)("div",{className:"font-medium",children:a.type}),(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:a.description})]}),(0,g.jsxs)("div",{className:"text-right space-y-1",children:[(0,g.jsxs)("div",{className:"text-sm font-medium",children:[a.validCount,"/",a.count," valid"]}),(0,g.jsxs)("div",{className:"text-xs text-muted-foreground",children:[Math.round(a.validCount/a.count*100),"% success rate"]})]})]},b))})})]})})]})]})}a.s(["default",()=>bP],16708);let bQ=(0,b.default)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);function bR(){let{toast:a}=(0,Y.useToast)(),[b,c]=(0,h.useState)(!1),{data:d,isLoading:e}=(0,p.useQuery)({queryKey:["/api/admin/sitemap/status"],refetchInterval:3e4}),f=(0,S.useMutation)({mutationFn:async()=>(c(!0),(await (0,aj.apiRequest)("POST","/api/admin/sitemap/generate",{})).json()),onSuccess:b=>{c(!1),aj.queryClient.invalidateQueries({queryKey:["/api/admin/sitemap/status"]}),a({title:"Sitemap Generated Successfully!",description:`${b.urlCount} URLs added. Submitted to search engines.`})},onError:b=>{c(!1),a({title:"Failed to Generate Sitemap",description:b instanceof Error?b.message:"Unknown error",variant:"destructive"})}});return e?(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsx)(j.Skeleton,{className:"h-10 w-64"}),(0,g.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:[1,2,3].map(a=>(0,g.jsx)(j.Skeleton,{className:"h-32"},a))})]}):(0,g.jsxs)("div",{className:"space-y-6",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("h1",{className:"text-3xl font-bold",children:"Sitemap Management"}),(0,g.jsx)("p",{className:"text-muted-foreground",children:"Automated sitemap generation and search engine submission"})]}),(0,g.jsx)(l.Button,{onClick:()=>f.mutate(),disabled:b,size:"lg","data-testid":"button-generate-sitemap",children:b?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(au.RefreshCw,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating..."]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(au.RefreshCw,{className:"w-4 h-4 mr-2"}),"Generate Now"]})})]}),(0,g.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,g.jsxs)(k.Card,{"data-testid":"card-last-generation",children:[(0,g.jsx)(k.CardHeader,{className:"pb-3",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Last Generation"})}),(0,g.jsx)(k.CardContent,{children:d?.lastGeneration?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"text-2xl font-bold","data-testid":"text-url-count",children:[d.lastGeneration.urlCount," URLs"]}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,B.formatDistanceToNow)(new Date(d.lastGeneration.createdAt),{addSuffix:!0})})]}):(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Never generated"})})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-automation-status",children:[(0,g.jsx)(k.CardHeader,{className:"pb-3",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Automation Status"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("div",{className:"flex items-center gap-2",children:[(0,g.jsx)(aM.CheckCircle2,{className:"w-5 h-5 text-green-600"}),(0,g.jsx)("span",{className:"font-semibold",children:"Active"})]}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Runs daily at 2:00 AM"})]})]}),(0,g.jsxs)(k.Card,{"data-testid":"card-sitemap-url",children:[(0,g.jsx)(k.CardHeader,{className:"pb-3",children:(0,g.jsx)(k.CardTitle,{className:"text-sm font-medium",children:"Sitemap URL"})}),(0,g.jsxs)(k.CardContent,{children:[(0,g.jsxs)("a",{href:"/sitemap.xml",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline flex items-center gap-1","data-testid":"link-sitemap-xml",children:["/sitemap.xml",(0,g.jsx)(bq.ExternalLink,{className:"w-3 h-3"})]}),(0,g.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Public sitemap file"})]})]})]}),d?.lastError&&(0,g.jsxs)(an.Alert,{variant:"destructive","data-testid":"alert-last-error",children:[(0,g.jsx)(ar.AlertTriangle,{className:"h-4 w-4"}),(0,g.jsxs)(an.AlertDescription,{children:[(0,g.jsx)("strong",{children:"Last Error:"})," ",d.lastError.errorMessage,(0,g.jsx)("br",{}),(0,g.jsx)("span",{className:"text-xs",children:(0,B.formatDistanceToNow)(new Date(d.lastError.createdAt),{addSuffix:!0})})]})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsx)(k.CardTitle,{children:"Recent Activity"}),(0,g.jsx)(k.CardDescription,{children:"Last 20 sitemap operations"})]}),(0,g.jsx)(k.CardContent,{children:(0,g.jsxs)(q.Table,{children:[(0,g.jsx)(q.TableHeader,{children:(0,g.jsxs)(q.TableRow,{children:[(0,g.jsx)(q.TableHead,{children:"Action"}),(0,g.jsx)(q.TableHead,{children:"Status"}),(0,g.jsx)(q.TableHead,{children:"URLs"}),(0,g.jsx)(q.TableHead,{children:"Submitted To"}),(0,g.jsx)(q.TableHead,{children:"Time"}),(0,g.jsx)(q.TableHead,{children:"Details"})]})}),(0,g.jsx)(q.TableBody,{children:d?.recentLogs&&d.recentLogs.length>0?d.recentLogs.map(a=>(0,g.jsxs)(q.TableRow,{"data-testid":`row-log-${a.id}`,children:[(0,g.jsx)(q.TableCell,{children:(a=>{switch(a){case"generate":return(0,g.jsxs)(P.Badge,{variant:"outline",children:[(0,g.jsx)(s.FileText,{className:"w-3 h-3 mr-1"}),"Generate"]});case"submit_google":return(0,g.jsxs)(P.Badge,{variant:"outline",children:[(0,g.jsx)(bQ,{className:"w-3 h-3 mr-1"}),"Google"]});case"submit_indexnow":return(0,g.jsxs)(P.Badge,{variant:"outline",children:[(0,g.jsx)(bQ,{className:"w-3 h-3 mr-1"}),"IndexNow"]});default:return(0,g.jsx)(P.Badge,{variant:"outline",children:a})}})(a.action)}),(0,g.jsx)(q.TableCell,{children:(a=>{switch(a){case"success":return(0,g.jsxs)(P.Badge,{variant:"default",className:"bg-green-600",children:[(0,g.jsx)(aM.CheckCircle2,{className:"w-3 h-3 mr-1"}),"Success"]});case"error":return(0,g.jsxs)(P.Badge,{variant:"destructive",children:[(0,g.jsx)(ap,{className:"w-3 h-3 mr-1"}),"Error"]});case"pending":return(0,g.jsxs)(P.Badge,{variant:"secondary",children:[(0,g.jsx)(as.Clock,{className:"w-3 h-3 mr-1"}),"Pending"]});default:return(0,g.jsx)(P.Badge,{children:a})}})(a.status)}),(0,g.jsx)(q.TableCell,{children:a.urlCount||"-"}),(0,g.jsx)(q.TableCell,{children:a.submittedTo||"-"}),(0,g.jsx)(q.TableCell,{className:"text-sm text-muted-foreground",children:(0,B.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,g.jsx)(q.TableCell,{className:"text-sm text-muted-foreground",children:a.errorMessage?(0,g.jsx)("span",{className:"text-red-600 truncate max-w-xs block",children:a.errorMessage}):(0,g.jsx)("span",{className:"text-green-600",children:"OK"})})]},a.id)):(0,g.jsx)(q.TableRow,{children:(0,g.jsx)(q.TableCell,{colSpan:6,className:"text-center text-muted-foreground",children:'No activity yet. Click "Generate Now" to create your first sitemap.'})})})]})})]}),(0,g.jsxs)(k.Card,{children:[(0,g.jsxs)(k.CardHeader,{children:[(0,g.jsx)(k.CardTitle,{children:"Setup Instructions"}),(0,g.jsx)(k.CardDescription,{children:"Configure your environment for optimal search engine submission"})]}),(0,g.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("h4",{className:"font-semibold mb-2",children:"1. IndexNow API Key (Bing & Yandex)"}),(0,g.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Generate an API key and set ",(0,g.jsx)("code",{className:"bg-muted px-1 py-0.5 rounded",children:"INDEXNOW_API_KEY"})," environment variable."]}),(0,g.jsxs)("a",{href:"https://www.bing.com/indexnow/getstarted",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline inline-flex items-center gap-1",children:["Get IndexNow Key ",(0,g.jsx)(bq.ExternalLink,{className:"w-3 h-3"})]})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h4",{className:"font-semibold mb-2",children:"2. Add Sitemap to robots.txt"}),(0,g.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:["Add this line to your ",(0,g.jsx)("code",{className:"bg-muted px-1 py-0.5 rounded",children:"/public/robots.txt"}),":"]}),(0,g.jsx)("code",{className:"block bg-muted px-3 py-2 rounded text-sm",children:"Sitemap: https://yoforex.net/sitemap.xml"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h4",{className:"font-semibold mb-2",children:"3. Verify in Search Console"}),(0,g.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Submit your sitemap manually in"," ",(0,g.jsx)("a",{href:"https://search.google.com/search-console",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Google Search Console"})," ","and"," ",(0,g.jsx)("a",{href:"https://www.bing.com/webmasters",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Bing Webmaster Tools"}),"."]})]})]})]})]})}a.s(["default",()=>bR],13562)}];

//# sourceMappingURL=node_modules_lucide-react_dist_esm_icons_building_60972cc8.js.map