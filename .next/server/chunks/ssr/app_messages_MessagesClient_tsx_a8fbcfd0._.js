module.exports=[50869,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(33217),e=a.i(70025),f=a.i(64690),g=a.i(10132),h=a.i(6893),i=a.i(91868),j=a.i(59162),k=a.i(97799),l=a.i(61792),m=a.i(77573),n=a.i(53390),o=a.i(63588),p=a.i(92759),q=a.i(70106);let r=(0,q.default)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]),s=(0,q.default)("SendHorizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]);var t=a.i(87532),u=a.i(210),v=a.i(33441),w=a.i(20610);let x=(0,q.default)("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),y=(0,q.default)("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),z=(0,q.default)("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);var A=a.i(81560),B=a.i(56468);let C=(0,q.default)("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);var D=a.i(5151);let E=(0,q.default)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),F=(0,q.default)("Forward",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]),G=(0,q.default)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);var H=a.i(90953),I=a.i(10738),J=a.i(71871),K=a.i(80364),L=a.i(76725);function M({initialConversations:a=[]}){let[q,M]=(0,c.useState)("inbox"),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)(!1),[X,Y]=(0,c.useState)("newest"),Z=(0,K.useIsMobile)(),{toast:$}=(0,L.useToast)(),_=(0,c.useRef)(null);(0,c.useRef)(null);let{data:aa}=(0,d.useQuery)({queryKey:["/api/me"]}),{data:ab=[],isLoading:ac}=(0,d.useQuery)({queryKey:["/api/conversations"],initialData:a,refetchInterval:15e3}),{data:ad=[],isLoading:ae}=(0,d.useQuery)({queryKey:["/api/conversations",N],enabled:!!N,refetchInterval:!!N&&1e4}),{data:af=[]}=(0,d.useQuery)({queryKey:["/api/messages/search",R],enabled:R.length>2,staleTime:3e4}),ag=(0,e.useMutation)({mutationFn:async a=>await (0,J.apiRequest)("/api/messages",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}),onSuccess:()=>{J.queryClient.invalidateQueries({queryKey:["/api/conversations"]}),J.queryClient.invalidateQueries({queryKey:["/api/conversations",N]}),Q("")},onError:a=>{$({title:"Error",description:a.message||"Failed to send message",variant:"destructive"})}}),ah=(0,e.useMutation)({mutationFn:async({messageId:a,emoji:b})=>await (0,J.apiRequest)(`/api/messages/${a}/reactions`,{method:"POST",body:JSON.stringify({emoji:b}),headers:{"Content-Type":"application/json"}}),onSuccess:()=>{J.queryClient.invalidateQueries({queryKey:["/api/conversations",N]})}}),ai=(a,b)=>{ah.mutate({messageId:a,emoji:b})},aj=()=>{if(!P.trim()||!N||!aa)return;let a=ab.find(a=>a.id===N);a&&(ag.mutate({recipientId:a.participant.id,body:P}),localStorage.removeItem(`draft-${N}`))},ak=(a,b)=>{confirm(b?"Delete this message for everyone?":"Delete this message for you?")&&($({title:"Deleted",description:"Message deleted successfully",variant:"destructive"}),J.queryClient.invalidateQueries({queryKey:["/api/conversations",N]}))},al=a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),aj())};(0,c.useEffect)(()=>{_.current?.scrollIntoView({behavior:"smooth"})},[ad]),(0,c.useEffect)(()=>{N&&P&&localStorage.setItem(`draft-${N}`,P)},[P,N]),(0,c.useEffect)(()=>{if(N){let a=localStorage.getItem(`draft-${N}`);a?Q(a):Q("")}},[N]);let am=()=>{O(null)},an=ab.filter(a=>!V||a.unreadCount>0).sort((a,b)=>{switch(X){case"newest":return new Date(b.lastMessage.timestamp).getTime()-new Date(a.lastMessage.timestamp).getTime();case"oldest":return new Date(a.lastMessage.timestamp).getTime()-new Date(b.lastMessage.timestamp).getTime();case"active":return b.unreadCount-a.unreadCount;default:return 0}}),ao=()=>(0,b.jsxs)(h.Card,{className:Z&&N?"hidden":"",children:[(0,b.jsxs)(h.CardHeader,{children:[(0,b.jsx)("div",{className:"flex items-center gap-2 mb-4",children:(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(t.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(j.Input,{type:"search",placeholder:"Search conversations...",className:"pl-9",value:R,onChange:a=>S(a.target.value),"data-testid":"input-search-conversations"})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(i.Button,{variant:V?"default":"outline",size:"sm",onClick:()=>W(!V),"data-testid":"button-filter-unread",children:"Unread Only"}),(0,b.jsxs)("select",{value:X,onChange:a=>Y(a.target.value),className:"text-sm border rounded px-2 py-1",children:[(0,b.jsx)("option",{value:"newest",children:"Newest First"}),(0,b.jsx)("option",{value:"oldest",children:"Oldest First"}),(0,b.jsx)("option",{value:"active",children:"Most Active"})]})]}),(0,b.jsx)(m.Tabs,{value:q,onValueChange:M,children:(0,b.jsxs)(m.TabsList,{className:"grid w-full grid-cols-2",children:[(0,b.jsxs)(m.TabsTrigger,{value:"inbox","data-testid":"tab-inbox",children:[(0,b.jsx)(r,{className:"w-4 h-4 mr-2"}),"Inbox"]}),(0,b.jsxs)(m.TabsTrigger,{value:"sent","data-testid":"tab-sent",children:[(0,b.jsx)(s,{className:"w-4 h-4 mr-2"}),"Sent"]})]})})]}),(0,b.jsx)(h.CardContent,{className:"p-0",children:ac?(0,b.jsx)("div",{className:"p-4 text-center text-muted-foreground",children:"Loading conversations..."}):0===an.length?(0,b.jsxs)("div",{className:"p-8 text-center text-muted-foreground",children:[(0,b.jsx)(o.MessageSquare,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{className:"text-lg font-medium",children:"No conversations yet"}),(0,b.jsx)("p",{className:"text-sm",children:"Start a conversation with other traders"})]}):(0,b.jsx)("div",{className:"divide-y",children:an.map(a=>(0,b.jsx)("div",{onClick:()=>{O(a.id)},className:`p-4 cursor-pointer hover-elevate relative ${N===a.id?"bg-muted":""}`,style:{borderLeft:a.unreadCount>0?"4px solid hsl(var(--primary))":"4px solid transparent"},"data-testid":`conversation-${a.id}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(n.Avatar,{children:(0,b.jsx)(n.AvatarFallback,{children:a.participant.username[0]})}),(0,b.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-background","data-testid":`status-online-${a.id}`})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsx)("span",{className:"font-semibold text-sm",children:a.participant.username}),a.unreadCount>0&&(0,b.jsx)(l.Badge,{variant:"default",className:"ml-2","data-testid":`badge-unread-${a.id}`,children:a.unreadCount})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground truncate",children:[a.lastMessage.isSentByMe&&"You: ",a.lastMessage.text]}),(0,b.jsx)("p",{suppressHydrationWarning:!0,className:"text-xs text-muted-foreground mt-1",children:(0,I.formatDistanceToNow)(new Date(a.lastMessage.timestamp),{addSuffix:!0})})]})]})},a.id))})})]}),ap=()=>{if(!N)return(0,b.jsx)(h.Card,{className:Z?"hidden":"",children:(0,b.jsxs)(h.CardContent,{className:"p-12 text-center",children:[(0,b.jsx)(o.MessageSquare,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground opacity-50"}),(0,b.jsx)("p",{className:"text-lg text-muted-foreground",children:"Select a conversation to view messages"})]})});let a=ab.find(a=>a.id===N);return a?(0,b.jsxs)(h.Card,{className:Z&&!N?"hidden":"",children:[(0,b.jsx)(h.CardHeader,{className:"border-b",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[Z&&(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",onClick:am,"data-testid":"button-back-to-conversations",children:(0,b.jsx)(u.ArrowLeft,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(n.Avatar,{children:(0,b.jsx)(n.AvatarFallback,{children:a.participant.username[0]})}),(0,b.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-background"})]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(h.CardTitle,{className:"text-lg",children:a.participant.username}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Online"})]}),(0,b.jsx)("div",{className:"ml-auto flex items-center gap-2",children:(0,b.jsxs)(H.DropdownMenu,{children:[(0,b.jsx)(H.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(i.Button,{variant:"ghost",size:"icon","data-testid":"button-conversation-actions",children:(0,b.jsx)(x,{className:"h-5 w-5"})})}),(0,b.jsxs)(H.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(H.DropdownMenuItem,{onClick:()=>(a.id,void $({title:"Pinned",description:"Conversation pinned to top"})),children:[(0,b.jsx)(y,{className:"mr-2 h-4 w-4"}),"Pin Conversation"]}),(0,b.jsxs)(H.DropdownMenuItem,{onClick:()=>(a.id,void($({title:"Archived",description:"Conversation moved to archive"}),O(null))),children:[(0,b.jsx)(z,{className:"mr-2 h-4 w-4"}),"Archive"]}),(0,b.jsxs)(H.DropdownMenuItem,{onClick:()=>(a.id,void $({title:"Muted",description:"You won't receive notifications from this conversation"})),children:[(0,b.jsx)(C,{className:"mr-2 h-4 w-4"}),"Mute Notifications"]}),(0,b.jsx)(H.DropdownMenuSeparator,{}),(0,b.jsxs)(H.DropdownMenuItem,{className:"text-destructive",onClick:()=>(a.participant.id,void(confirm("Are you sure you want to block this user?")&&($({title:"Blocked",description:"User has been blocked",variant:"destructive"}),O(null)))),children:[(0,b.jsx)(B.Ban,{className:"mr-2 h-4 w-4"}),"Block User"]}),(0,b.jsxs)(H.DropdownMenuItem,{className:"text-destructive",onClick:()=>(a.id,void(confirm("Are you sure you want to delete this conversation?")&&($({title:"Deleted",description:"Conversation deleted successfully",variant:"destructive"}),O(null),J.queryClient.invalidateQueries({queryKey:["/api/conversations"]})))),children:[(0,b.jsx)(A.Trash2,{className:"mr-2 h-4 w-4"}),"Delete Conversation"]})]})]})})]})}),(0,b.jsx)(h.CardContent,{className:"p-0",children:(0,b.jsxs)("div",{className:"h-[500px] flex flex-col",children:[(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[ae?(0,b.jsx)("div",{className:"text-center text-muted-foreground",children:"Loading messages..."}):0===ad.length?(0,b.jsx)("div",{className:"text-center text-muted-foreground",children:"No messages yet"}):ad.map(a=>(0,b.jsx)("div",{className:`flex ${a.senderId===aa?.id?"justify-end":"justify-start"}`,"data-testid":`message-${a.id}`,children:(0,b.jsxs)(H.DropdownMenu,{children:[(0,b.jsx)(H.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)("div",{className:`max-w-[70%] rounded-lg p-3 cursor-pointer hover:opacity-90 ${a.senderId===aa?.id?"bg-primary text-primary-foreground":"bg-muted"}`,children:[(0,b.jsx)("p",{className:"text-sm",children:a.text}),(0,b.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,b.jsx)("p",{suppressHydrationWarning:!0,className:`text-xs ${a.senderId===aa?.id?"text-primary-foreground/70":"text-muted-foreground"}`,children:(0,I.formatDistanceToNow)(new Date(a.timestamp),{addSuffix:!0})}),a.senderId===aa?.id&&(0,b.jsx)(b.Fragment,{children:a.readAt?(0,b.jsx)(w.CheckCheck,{className:"h-3 w-3 text-blue-300"}):a.deliveredAt?(0,b.jsx)(w.CheckCheck,{className:"h-3 w-3 text-primary-foreground/70"}):(0,b.jsx)(v.Check,{className:"h-3 w-3 text-primary-foreground/70"})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,b.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:b=>{b.stopPropagation(),ai(a.id,"👍")},children:"👍"}),(0,b.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:b=>{b.stopPropagation(),ai(a.id,"❤️")},children:"❤️"}),(0,b.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:b=>{b.stopPropagation(),ai(a.id,"😂")},children:"😂"})]})]})}),(0,b.jsxs)(H.DropdownMenuContent,{children:[(0,b.jsxs)(H.DropdownMenuItem,{onClick:()=>{var b;return b=a.text,void(navigator.clipboard.writeText(b),$({title:"Copied",description:"Message copied to clipboard"}))},children:[(0,b.jsx)(D.Copy,{className:"mr-2 h-4 w-4"}),"Copy Text"]}),a.senderId===aa?.id&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(H.DropdownMenuItem,{onClick:()=>{var b;let c;return a.id,void((c=prompt("Edit message:",b=a.text))&&c!==b&&$({title:"Edited",description:"Message updated successfully"}))},children:[(0,b.jsx)(E,{className:"mr-2 h-4 w-4"}),"Edit Message"]}),(0,b.jsx)(H.DropdownMenuSeparator,{}),(0,b.jsxs)(H.DropdownMenuItem,{className:"text-destructive",onClick:()=>ak(a.id,!1),children:[(0,b.jsx)(G,{className:"mr-2 h-4 w-4"}),"Delete for Me"]}),(0,b.jsxs)(H.DropdownMenuItem,{className:"text-destructive",onClick:()=>ak(a.id,!0),children:[(0,b.jsx)(G,{className:"mr-2 h-4 w-4"}),"Delete for Everyone"]})]}),(0,b.jsxs)(H.DropdownMenuItem,{onClick:()=>(a.text,void $({title:"Forward",description:"Forward feature coming soon"})),children:[(0,b.jsx)(F,{className:"mr-2 h-4 w-4"}),"Forward Message"]})]})]})},a.id)),T&&(0,b.jsx)("div",{className:"flex justify-start mb-2",children:(0,b.jsx)("div",{className:"bg-muted rounded-lg px-4 py-2",children:(0,b.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)("span",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,b.jsx)("span",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,b.jsx)("span",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground ml-2",children:"typing..."})]})})}),(0,b.jsx)("div",{ref:_})]}),(0,b.jsx)("div",{className:"border-t p-4",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(k.Textarea,{placeholder:"Type a message...",value:P,onChange:a=>Q(a.target.value),onKeyDown:al,className:"resize-none min-h-[60px] max-h-[120px]","data-testid":"input-message-text"}),(0,b.jsx)(i.Button,{size:"icon",onClick:aj,disabled:!P.trim()||ag.isPending,"data-testid":"button-send-message",children:(0,b.jsx)(p.Send,{className:"h-4 w-4"})})]})})]})})]}):null};return(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)(f.default,{userCoins:aa?.totalCoins||0}),(0,b.jsxs)("main",{className:"container max-w-6xl mx-auto px-4 py-8",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h1",{className:"text-4xl font-bold mb-2","data-testid":"text-page-title",children:"Messages"}),(0,b.jsx)("p",{className:"text-lg text-muted-foreground",children:"Connect with other traders privately"})]}),Z?(0,b.jsxs)("div",{className:"space-y-6",children:[ao(),ap()]}):(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-1",children:ao()}),(0,b.jsx)("div",{className:"lg:col-span-2",children:ap()})]})]}),(0,b.jsx)(g.default,{})]})}a.s(["default",()=>M],50869)}];

//# sourceMappingURL=app_messages_MessagesClient_tsx_a8fbcfd0._.js.map